<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A collection of GitHub Labs for learning and practicing Docker skills."><meta name=author content="Nir Geier - nirgeier@gmail.com"><link href=https://nirgeier.github.io/DockerLabs/Tasks/DockerCompose/ rel=canonical><link href=../DockerFile/ rel=prev><link href=../DockerNetwork/ rel=next><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.16"><title>Docker-Compose Tasks - DockerLabs - Docker Hands-On</title><link rel=stylesheet href=../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%202a7%207%200%200%200-7%207c0%202.38%201.19%204.47%203%205.74V17a1%201%200%200%200%201%201h6a1%201%200%200%200%201-1v-2.26c1.81-1.27%203-3.36%203-5.74a7%207%200%200%200-7-7M9%2021a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1H9z%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Mulish:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Mulish";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../css/print-site.css><link rel=stylesheet href=../../css/print-site-material.css><link rel=stylesheet href=../../assets/stylesheets/theme.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#docker-compose-tasks class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Determine classes --> <!-- Header --> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <!-- Link to home --> <a href=../.. title="DockerLabs - Docker Hands-On" class="md-header__button md-logo" aria-label="DockerLabs - Docker Hands-On" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <!-- Header title --> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> DockerLabs - Docker Hands-On </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Docker-Compose Tasks </span> </div> </div> </div> <div class=m-social__top> <!-- Social links --> <div class=md-social> <a href=https://github.com/nirgeier/DockerLabs target=_blank rel=noopener title="View on GitHub" class="md-social__link social-class__github"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://github.com/nirgeier/DockerLabs/network/members target=_blank rel=noopener title="Fork this repo" class="md-social__link social-class__fork"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg> </a> <a href=https://github.com/nirgeier/DockerLabs/stargazers target=_blank rel=noopener title="Star this repo" class="md-social__link social-class__star"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg> </a> <a href=https://www.linkedin.com/in/nirgeier/ target=_blank rel=noopener title="Connect on LinkedIn" class="md-social__link social-class__linkedin"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://discord.gg/U6xW23Ss target=_blank rel=noopener title="Follow me on Discord" class="md-social__link social-class__discord"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=https://stackoverflow.com/users/1755598/codewizard target=_blank rel=noopener title="Follow me on Stack Overflow" class="md-social__link social-class__stackoverflow"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg> </a> <a href=https://wa.me/972548122310 target=_blank rel=noopener title="Follow me on WhatsApp" class="md-social__link social-class__whatsapp"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg> </a> <a href=mailto:nirg@codewizard.co.il target=_blank rel=noopener title="Email me" class="md-social__link social-class__email"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg> </a> </div> </div> <!-- Color palette toggle --> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-hidden=true type=radio name=__palette id=__palette_0> </form> <!-- User preference: color palette --> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <!-- Site language selector --> <!-- Button to open search modal --> <!-- Check if search is actually enabled - see https://t.ly/DT_0V --> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class=md-header__source> <a href=https://github.com/nirgeier/DockerLabs title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> nirgeier/DockerLabs </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Labs </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../ class=md-tabs__link> Tasks </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="DockerLabs - Docker Hands-On" class="md-nav__button md-logo" aria-label="DockerLabs - Docker Hands-On" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> DockerLabs - Docker Hands-On </label> <div class=md-nav__source> <a href=https://github.com/nirgeier/DockerLabs title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </div> <div class=md-source__repository> nirgeier/DockerLabs </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Labs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=../ class="md-nav__link "> <span class=md-ellipsis> Tasks </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Tasks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../Docker-CLI-Tasks/ class=md-nav__link> <span class=md-ellipsis> Docker-CLI-Tasks </span> </a> </li> <li class=md-nav__item> <a href=../DockerFile/ class=md-nav__link> <span class=md-ellipsis> DockerFile Tasks </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Docker-Compose Tasks </span> </a> </li> <li class=md-nav__item> <a href=../DockerNetwork/ class=md-nav__link> <span class=md-ellipsis> Docker Network Tasks </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/nirgeier/DockerLabs/edit/master/docs/Tasks/DockerCompose/README.md title="Edit this page" class="md-content__button md-icon" rel=edit> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg> </a> <a href=https://github.com/nirgeier/DockerLabs/raw/master/docs/Tasks/DockerCompose/README.md title="View source of this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg> </a> <p><img alt="DockerLabs Banner" src=../../assets/images/docker-logos.png></p> <hr> <h1 id=docker-compose-tasks>Docker Compose Tasks<a class=headerlink href=#docker-compose-tasks title="Permanent link">&para;</a></h1> <ul> <li>Hands-on Docker Compose exercises covering multi-container application orchestration, service configuration, networking, and deployment patterns.</li> <li>Each task includes a clear scenario description, helpful hints, and detailed solutions with explanations.</li> <li>Practice these tasks to master Docker Compose for complex application stacks and microservices architectures.</li> </ul> <hr> <h4 id=table-of-contents>Table of Contents<a class=headerlink href=#table-of-contents title="Permanent link">&para;</a></h4> <ul> <li><a href=#01-basic-docker-compose-setup>01. Basic Docker Compose Setup</a></li> <li><a href=#02-multi-service-application>02. Multi-Service Application</a></li> <li><a href=#03-environment-variables-and-configuration>03. Environment Variables and Configuration</a></li> <li><a href=#04-volumes-and-data-persistence>04. Volumes and Data Persistence</a></li> <li><a href=#05-networking-between-services>05. Networking Between Services</a></li> <li><a href=#06-health-checks-and-dependencies>06. Health Checks and Dependencies</a></li> <li><a href=#07-scaling-services>07. Scaling Services</a></li> <li><a href=#08-build-configuration>08. Build Configuration</a></li> <li><a href=#09-override-files>09. Override Files</a></li> <li><a href=#10-secrets-management>10. Secrets Management</a></li> <li><a href=#11-logging-configuration>11. Logging Configuration</a></li> <li><a href=#12-resource-limits>12. Resource Limits</a></li> <li><a href=#13-profiles-and-selective-services>13. Profiles and Selective Services</a></li> <li><a href=#14-external-networks>14. External Networks</a></li> <li><a href=#15-custom-networks>15. Custom Networks</a></li> <li><a href=#16-load-balancing>16. Load Balancing</a></li> <li><a href=#17-multi-stage-deployments>17. Multi-Stage Deployments</a></li> <li><a href=#18-production-ready-stack>18. Production-Ready Stack</a></li> <li><a href=#19-basic-yaml-anchors-and-references>19. Basic YAML Anchors and References</a></li> <li><a href=#20-merging-service-configurations>20. Merging Service Configurations</a></li> <li><a href=#21-using-includes-for-modular-compose-files>21. Using Includes for Modular Compose Files</a></li> <li><a href=#22-environment-specific-fragments>22. Environment-Specific Fragments</a></li> <li><a href=#23-complex-fragment-hierarchies>23. Complex Fragment Hierarchies</a></li> <li><a href=#24-fragment-based-service-templates>24. Fragment-Based Service Templates</a></li> </ul> <hr> <h4 id=01-basic-docker-compose-setup>01. Basic Docker Compose Setup<a class=headerlink href=#01-basic-docker-compose-setup title="Permanent link">&para;</a></h4> <ul> <li> <p>Create a simple docker-compose.yml file to run a single web service with port mapping and volume mounting.</p> <h4 id=scenario><strong>Scenario:</strong><a class=headerlink href=#scenario title="Permanent link">&para;</a></h4> <ul> <li>As a developer, you need to quickly set up a development environment for a web application that requires consistent configuration across team members.</li> <li>Docker Compose allows you to define and run multi-container applications with a single command, ensuring everyone uses the same setup.</li> </ul> <h4 id=resources>Resources:<a class=headerlink href=#resources title="Permanent link">&para;</a></h4> <ul> <li><code>index.html</code> ➤ <code>/usr/share/nginx/html</code> <div class="language-html highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>    <span class=p>&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Docker Compose App<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;</span>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a><span class=p>&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Hello from Docker Compose!<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>This page is served by a container managed by Docker Compose.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-0-10><a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>version</code>, <code>services</code>, <code>image</code>, <code>ports</code>, and <code>volumes</code> keys</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./html:/usr/share/nginx/html</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># Start the services</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=c1># Check running services</span>
</span><span id=__span-2-5><a id=__codelineno-2-5 name=__codelineno-2-5 href=#__codelineno-2-5></a>docker-compose<span class=w> </span>ps
</span><span id=__span-2-6><a id=__codelineno-2-6 name=__codelineno-2-6 href=#__codelineno-2-6></a>
</span><span id=__span-2-7><a id=__codelineno-2-7 name=__codelineno-2-7 href=#__codelineno-2-7></a><span class=c1># View logs</span>
</span><span id=__span-2-8><a id=__codelineno-2-8 name=__codelineno-2-8 href=#__codelineno-2-8></a>docker-compose<span class=w> </span>logs
</span><span id=__span-2-9><a id=__codelineno-2-9 name=__codelineno-2-9 href=#__codelineno-2-9></a>
</span><span id=__span-2-10><a id=__codelineno-2-10 name=__codelineno-2-10 href=#__codelineno-2-10></a><span class=c1># Stop and remove services</span>
</span><span id=__span-2-11><a id=__codelineno-2-11 name=__codelineno-2-11 href=#__codelineno-2-11></a>docker-compose<span class=w> </span>down
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>version</strong>: Specifies the Compose file format version</li> <li><strong>services</strong>: Defines the containers to run</li> <li><strong>image</strong>: Specifies the Docker image to use</li> <li><strong>ports</strong>: Maps host ports to container ports</li> <li><strong>volumes</strong>: Mounts host directories into containers</li> <li><strong>docker-compose up -d</strong>: Starts services in detached mode</li> <li><strong>docker-compose down</strong>: Stops and removes containers and networks</li> </ul> </details> <hr> <h4 id=02-multi-service-application>02. Multi-Service Application<a class=headerlink href=#02-multi-service-application title="Permanent link">&para;</a></h4> <ul> <li> <p>Create a docker-compose.yml file that runs a web application with a database backend, demonstrating service communication.</p> <h4 id=scenario_1><strong>Scenario:</strong><a class=headerlink href=#scenario_1 title="Permanent link">&para;</a></h4> <ul> <li>You&rsquo;re developing a full-stack application that requires both a web server and a database to work together.</li> <li>Docker Compose enables you to define and manage multiple interconnected services that can communicate with each other securely.</li> </ul> <h4 id=resources_1>Resources:<a class=headerlink href=#resources_1 title="Permanent link">&para;</a></h4> <ul> <li><code>web/index.html</code> ➤ <code>/usr/share/nginx/html</code> <div class="language-html highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Multi-Service App<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Web App with Database<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span><span id=__span-3-6><a id=__codelineno-3-6 name=__codelineno-3-6 href=#__codelineno-3-6></a>    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Connected to PostgreSQL database via Docker Compose networking.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span><span id=__span-3-7><a id=__codelineno-3-7 name=__codelineno-3-7 href=#__codelineno-3-7></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-3-8><a id=__codelineno-3-8 name=__codelineno-3-8 href=#__codelineno-3-8></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>depends_on</code> for service dependencies and named volumes for data persistence</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-4-8><a id=__codelineno-4-8 name=__codelineno-4-8 href=#__codelineno-4-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-4-9><a id=__codelineno-4-9 name=__codelineno-4-9 href=#__codelineno-4-9></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-4-10><a id=__codelineno-4-10 name=__codelineno-4-10 href=#__codelineno-4-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-4-11><a id=__codelineno-4-11 name=__codelineno-4-11 href=#__codelineno-4-11></a>
</span><span id=__span-4-12><a id=__codelineno-4-12 name=__codelineno-4-12 href=#__codelineno-4-12></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-4-13><a id=__codelineno-4-13 name=__codelineno-4-13 href=#__codelineno-4-13></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-4-14><a id=__codelineno-4-14 name=__codelineno-4-14 href=#__codelineno-4-14></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-4-15><a id=__codelineno-4-15 name=__codelineno-4-15 href=#__codelineno-4-15></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-4-16><a id=__codelineno-4-16 name=__codelineno-4-16 href=#__codelineno-4-16></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-4-17><a id=__codelineno-4-17 name=__codelineno-4-17 href=#__codelineno-4-17></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-4-18><a id=__codelineno-4-18 name=__codelineno-4-18 href=#__codelineno-4-18></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-4-19><a id=__codelineno-4-19 name=__codelineno-4-19 href=#__codelineno-4-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-4-20><a id=__codelineno-4-20 name=__codelineno-4-20 href=#__codelineno-4-20></a>
</span><span id=__span-4-21><a id=__codelineno-4-21 name=__codelineno-4-21 href=#__codelineno-4-21></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-4-22><a id=__codelineno-4-22 name=__codelineno-4-22 href=#__codelineno-4-22></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>web/index.html</strong> <div class="language-html highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Multi-Service App<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Web App with Database<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a>    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Connected to PostgreSQL database via Docker Compose networking.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Start all services</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a>
</span><span id=__span-6-4><a id=__codelineno-6-4 name=__codelineno-6-4 href=#__codelineno-6-4></a><span class=c1># Check service connectivity</span>
</span><span id=__span-6-5><a id=__codelineno-6-5 name=__codelineno-6-5 href=#__codelineno-6-5></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>ping<span class=w> </span>-c<span class=w> </span><span class=m>2</span><span class=w> </span>db
</span><span id=__span-6-6><a id=__codelineno-6-6 name=__codelineno-6-6 href=#__codelineno-6-6></a>
</span><span id=__span-6-7><a id=__codelineno-6-7 name=__codelineno-6-7 href=#__codelineno-6-7></a><span class=c1># View database logs</span>
</span><span id=__span-6-8><a id=__codelineno-6-8 name=__codelineno-6-8 href=#__codelineno-6-8></a>docker-compose<span class=w> </span>logs<span class=w> </span>db
</span><span id=__span-6-9><a id=__codelineno-6-9 name=__codelineno-6-9 href=#__codelineno-6-9></a>
</span><span id=__span-6-10><a id=__codelineno-6-10 name=__codelineno-6-10 href=#__codelineno-6-10></a><span class=c1># Stop services</span>
</span><span id=__span-6-11><a id=__codelineno-6-11 name=__codelineno-6-11 href=#__codelineno-6-11></a>docker-compose<span class=w> </span>down
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>depends_on</strong>: Ensures services start in the correct order</li> <li><strong>environment</strong>: Sets environment variables for service configuration</li> <li><strong>volumes</strong>: Persists database data between container restarts</li> <li><strong>Service networking</strong>: Services can communicate using service names as hostnames</li> <li><strong>docker-compose exec</strong>: Runs commands in running service containers</li> </ul> </details> <hr> <h4 id=03-environment-variables-and-configuration>03. Environment Variables and Configuration<a class=headerlink href=#03-environment-variables-and-configuration title="Permanent link">&para;</a></h4> <ul> <li> <p>Create a configurable application stack using environment variables and .env files for different deployment environments.</p> <h4 id=scenario_2><strong>Scenario:</strong><a class=headerlink href=#scenario_2 title="Permanent link">&para;</a></h4> <ul> <li>Your application needs to run in multiple environments (development, staging, production) with different configurations like database credentials, ports, and feature flags.</li> <li>Docker Compose allows you to manage environment-specific configurations using environment variables and .env files.</li> </ul> <h4 id=resources_2>Resources:<a class=headerlink href=#resources_2 title="Permanent link">&para;</a></h4> <ul> <li><code>.env</code> ➤ Environment configuration file <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>APP_ENV=development
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>WEB_PORT=8080
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>DB_NAME=myapp
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>DB_USER=user
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>DB_PASSWORD=password
</span></code></pre></div></li> <li><code>web/index.html</code> ➤ <code>/usr/share/nginx/html</code> <div class="language-html highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Configurable App<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Environment: ${ENV}<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a>    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Configuration loaded from environment variables.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>${VARIABLE_NAME}</code> syntax and .env files for configuration management</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;${WEB_PORT:-8080}:80&quot;</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-9-8><a id=__codelineno-9-8 name=__codelineno-9-8 href=#__codelineno-9-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ENV=${APP_ENV:-development}</span>
</span><span id=__span-9-9><a id=__codelineno-9-9 name=__codelineno-9-9 href=#__codelineno-9-9></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-9-10><a id=__codelineno-9-10 name=__codelineno-9-10 href=#__codelineno-9-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-9-11><a id=__codelineno-9-11 name=__codelineno-9-11 href=#__codelineno-9-11></a>
</span><span id=__span-9-12><a id=__codelineno-9-12 name=__codelineno-9-12 href=#__codelineno-9-12></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-9-13><a id=__codelineno-9-13 name=__codelineno-9-13 href=#__codelineno-9-13></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-9-14><a id=__codelineno-9-14 name=__codelineno-9-14 href=#__codelineno-9-14></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-9-15><a id=__codelineno-9-15 name=__codelineno-9-15 href=#__codelineno-9-15></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${DB_NAME}</span>
</span><span id=__span-9-16><a id=__codelineno-9-16 name=__codelineno-9-16 href=#__codelineno-9-16></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${DB_USER}</span>
</span><span id=__span-9-17><a id=__codelineno-9-17 name=__codelineno-9-17 href=#__codelineno-9-17></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span>
</span><span id=__span-9-18><a id=__codelineno-9-18 name=__codelineno-9-18 href=#__codelineno-9-18></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-9-19><a id=__codelineno-9-19 name=__codelineno-9-19 href=#__codelineno-9-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-9-20><a id=__codelineno-9-20 name=__codelineno-9-20 href=#__codelineno-9-20></a>
</span><span id=__span-9-21><a id=__codelineno-9-21 name=__codelineno-9-21 href=#__codelineno-9-21></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-9-22><a id=__codelineno-9-22 name=__codelineno-9-22 href=#__codelineno-9-22></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>.env</strong> <div class="language-text highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a>APP_ENV=development
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a>WEB_PORT=8080
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a>DB_NAME=myapp
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a>DB_USER=user
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a>DB_PASSWORD=password
</span></code></pre></div></p> <p><strong>web/index.html</strong> <div class="language-html highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a><span class=p>&lt;</span><span class=nt>head</span><span class=p>&gt;&lt;</span><span class=nt>title</span><span class=p>&gt;</span>Configurable App<span class=p>&lt;/</span><span class=nt>title</span><span class=p>&gt;&lt;/</span><span class=nt>head</span><span class=p>&gt;</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>    <span class=p>&lt;</span><span class=nt>h1</span><span class=p>&gt;</span>Environment: ${ENV}<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;</span>
</span><span id=__span-11-6><a id=__codelineno-11-6 name=__codelineno-11-6 href=#__codelineno-11-6></a>    <span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Configuration loaded from environment variables.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span><span id=__span-11-7><a id=__codelineno-11-7 name=__codelineno-11-7 href=#__codelineno-11-7></a><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span><span id=__span-11-8><a id=__codelineno-11-8 name=__codelineno-11-8 href=#__codelineno-11-8></a><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Start with default .env</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=c1># Override environment variables</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=nv>WEB_PORT</span><span class=o>=</span><span class=m>3000</span><span class=w> </span>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=c1># Use different .env file</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>docker-compose<span class=w> </span>--env-file<span class=w> </span>.env.production<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=c1># Check environment in container</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>env<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>ENV
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>${VARIABLE}</strong>: Substitutes environment variable values</li> <li><strong>${VARIABLE:-default}</strong>: Provides default values for missing variables</li> <li><strong>.env file</strong>: Automatically loaded by docker-compose</li> <li><strong>&ndash;env-file</strong>: Specify custom environment file</li> <li><strong>Runtime overrides</strong>: Command-line variables override file values</li> </ul> </details> <hr> <h4 id=04-volumes-and-data-persistence>04. Volumes and Data Persistence<a class=headerlink href=#04-volumes-and-data-persistence title="Permanent link">&para;</a></h4> <ul> <li> <p>Implement different types of volumes (named, bind mounts, tmpfs) for data persistence and performance optimization.</p> <h4 id=scenario_3><strong>Scenario:</strong><a class=headerlink href=#scenario_3 title="Permanent link">&para;</a></h4> <ul> <li>Your application stack requires different data persistence strategies - some data needs to persist across container restarts, some needs high performance, and some should be temporary.</li> <li>Docker Compose provides flexible volume management to handle various data persistence requirements.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use named volumes, bind mounts, and tmpfs for different data persistence needs</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-13-5><a id=__codelineno-13-5 name=__codelineno-13-5 href=#__codelineno-13-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-13-6><a id=__codelineno-13-6 name=__codelineno-13-6 href=#__codelineno-13-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-13-7><a id=__codelineno-13-7 name=__codelineno-13-7 href=#__codelineno-13-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-13-8><a id=__codelineno-13-8 name=__codelineno-13-8 href=#__codelineno-13-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html:ro</span>
</span><span id=__span-13-9><a id=__codelineno-13-9 name=__codelineno-13-9 href=#__codelineno-13-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">logs:/var/log/nginx</span>
</span><span id=__span-13-10><a id=__codelineno-13-10 name=__codelineno-13-10 href=#__codelineno-13-10></a>
</span><span id=__span-13-11><a id=__codelineno-13-11 name=__codelineno-13-11 href=#__codelineno-13-11></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-13-12><a id=__codelineno-13-12 name=__codelineno-13-12 href=#__codelineno-13-12></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-13-13><a id=__codelineno-13-13 name=__codelineno-13-13 href=#__codelineno-13-13></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-13-14><a id=__codelineno-13-14 name=__codelineno-13-14 href=#__codelineno-13-14></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-13-15><a id=__codelineno-13-15 name=__codelineno-13-15 href=#__codelineno-13-15></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-13-16><a id=__codelineno-13-16 name=__codelineno-13-16 href=#__codelineno-13-16></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-13-17><a id=__codelineno-13-17 name=__codelineno-13-17 href=#__codelineno-13-17></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-13-18><a id=__codelineno-13-18 name=__codelineno-13-18 href=#__codelineno-13-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-13-19><a id=__codelineno-13-19 name=__codelineno-13-19 href=#__codelineno-13-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./init.sql:/docker-entrypoint-initdb.d/init.sql</span>
</span><span id=__span-13-20><a id=__codelineno-13-20 name=__codelineno-13-20 href=#__codelineno-13-20></a>
</span><span id=__span-13-21><a id=__codelineno-13-21 name=__codelineno-13-21 href=#__codelineno-13-21></a><span class=w>  </span><span class=nt>cache</span><span class=p>:</span>
</span><span id=__span-13-22><a id=__codelineno-13-22 name=__codelineno-13-22 href=#__codelineno-13-22></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:alpine</span>
</span><span id=__span-13-23><a id=__codelineno-13-23 name=__codelineno-13-23 href=#__codelineno-13-23></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-13-24><a id=__codelineno-13-24 name=__codelineno-13-24 href=#__codelineno-13-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">cache_data:/data</span>
</span><span id=__span-13-25><a id=__codelineno-13-25 name=__codelineno-13-25 href=#__codelineno-13-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tmpfs</span>
</span><span id=__span-13-26><a id=__codelineno-13-26 name=__codelineno-13-26 href=#__codelineno-13-26></a><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
</span><span id=__span-13-27><a id=__codelineno-13-27 name=__codelineno-13-27 href=#__codelineno-13-27></a><span class=w>        </span><span class=nt>tmpfs</span><span class=p>:</span>
</span><span id=__span-13-28><a id=__codelineno-13-28 name=__codelineno-13-28 href=#__codelineno-13-28></a><span class=w>          </span><span class=nt>size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
</span><span id=__span-13-29><a id=__codelineno-13-29 name=__codelineno-13-29 href=#__codelineno-13-29></a>
</span><span id=__span-13-30><a id=__codelineno-13-30 name=__codelineno-13-30 href=#__codelineno-13-30></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-13-31><a id=__codelineno-13-31 name=__codelineno-13-31 href=#__codelineno-13-31></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span><span id=__span-13-32><a id=__codelineno-13-32 name=__codelineno-13-32 href=#__codelineno-13-32></a><span class=w>  </span><span class=nt>logs</span><span class=p>:</span>
</span><span id=__span-13-33><a id=__codelineno-13-33 name=__codelineno-13-33 href=#__codelineno-13-33></a><span class=w>  </span><span class=nt>cache_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Start services</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># Check volume usage</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>docker<span class=w> </span>volume<span class=w> </span>ls
</span><span id=__span-14-6><a id=__codelineno-14-6 name=__codelineno-14-6 href=#__codelineno-14-6></a>
</span><span id=__span-14-7><a id=__codelineno-14-7 name=__codelineno-14-7 href=#__codelineno-14-7></a><span class=c1># Inspect a volume</span>
</span><span id=__span-14-8><a id=__codelineno-14-8 name=__codelineno-14-8 href=#__codelineno-14-8></a>docker<span class=w> </span>volume<span class=w> </span>inspect<span class=w> </span><span class=k>$(</span>docker-compose<span class=w> </span>ps<span class=w> </span>-q<span class=w> </span>db<span class=k>)</span>_db_data
</span><span id=__span-14-9><a id=__codelineno-14-9 name=__codelineno-14-9 href=#__codelineno-14-9></a>
</span><span id=__span-14-10><a id=__codelineno-14-10 name=__codelineno-14-10 href=#__codelineno-14-10></a><span class=c1># View logs volume content</span>
</span><span id=__span-14-11><a id=__codelineno-14-11 name=__codelineno-14-11 href=#__codelineno-14-11></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>ls<span class=w> </span>-la<span class=w> </span>/var/log/nginx/
</span><span id=__span-14-12><a id=__codelineno-14-12 name=__codelineno-14-12 href=#__codelineno-14-12></a>
</span><span id=__span-14-13><a id=__codelineno-14-13 name=__codelineno-14-13 href=#__codelineno-14-13></a><span class=c1># Clean up volumes</span>
</span><span id=__span-14-14><a id=__codelineno-14-14 name=__codelineno-14-14 href=#__codelineno-14-14></a>docker-compose<span class=w> </span>down<span class=w> </span>-v
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>Named volumes</strong>: Managed by Docker, persist across container lifecycle</li> <li><strong>Bind mounts</strong>: Host directories mounted into containers</li> <li><strong>:ro</strong>: Read-only mount for security</li> <li><strong>tmpfs</strong>: Temporary filesystem in memory</li> <li><strong>Volume lifecycle</strong>: Separate from container lifecycle</li> <li><strong>docker-compose down -v</strong>: Removes containers and volumes</li> </ul> </details> <hr> <h4 id=05-networking-between-services>05. Networking Between Services<a class=headerlink href=#05-networking-between-services title="Permanent link">&para;</a></h4> <ul> <li> <p>Configure custom networks in Docker Compose to control service communication and isolation.</p> <h4 id=scenario_4><strong>Scenario:</strong><a class=headerlink href=#scenario_4 title="Permanent link">&para;</a></h4> <ul> <li>Your application has multiple services that need controlled communication - some services should be publicly accessible, others should only communicate internally, and some need complete isolation.</li> <li>Docker Compose networking allows you to create custom networks with specific connectivity rules.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use custom networks with <code>internal: true</code> for backend isolation and multiple network connections</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;busybox httpd -f -p 8000 -h /tmp&quot;</span>
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id=__span-15-25><a id=__codelineno-15-25 name=__codelineno-15-25 href=#__codelineno-15-25></a>
</span><span id=__span-15-26><a id=__codelineno-15-26 name=__codelineno-15-26 href=#__codelineno-15-26></a><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-15-27><a id=__codelineno-15-27 name=__codelineno-15-27 href=#__codelineno-15-27></a><span class=w>  </span><span class=nt>frontend</span><span class=p>:</span>
</span><span id=__span-15-28><a id=__codelineno-15-28 name=__codelineno-15-28 href=#__codelineno-15-28></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-15-29><a id=__codelineno-15-29 name=__codelineno-15-29 href=#__codelineno-15-29></a><span class=w>  </span><span class=nt>backend</span><span class=p>:</span>
</span><span id=__span-15-30><a id=__codelineno-15-30 name=__codelineno-15-30 href=#__codelineno-15-30></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-15-31><a id=__codelineno-15-31 name=__codelineno-15-31 href=#__codelineno-15-31></a><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=c1># Start services</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a><span class=c1># Check networks</span>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a>docker<span class=w> </span>network<span class=w> </span>ls
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=c1># Test connectivity</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>ping<span class=w> </span>-c<span class=w> </span><span class=m>2</span><span class=w> </span>api
</span><span id=__span-16-9><a id=__codelineno-16-9 name=__codelineno-16-9 href=#__codelineno-16-9></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>ping<span class=w> </span>-c<span class=w> </span><span class=m>2</span><span class=w> </span>db
</span><span id=__span-16-10><a id=__codelineno-16-10 name=__codelineno-16-10 href=#__codelineno-16-10></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>api<span class=w> </span>ping<span class=w> </span>-c<span class=w> </span><span class=m>2</span><span class=w> </span>db
</span><span id=__span-16-11><a id=__codelineno-16-11 name=__codelineno-16-11 href=#__codelineno-16-11></a>
</span><span id=__span-16-12><a id=__codelineno-16-12 name=__codelineno-16-12 href=#__codelineno-16-12></a><span class=c1># Check network isolation (should fail)</span>
</span><span id=__span-16-13><a id=__codelineno-16-13 name=__codelineno-16-13 href=#__codelineno-16-13></a>curl<span class=w> </span>http://localhost:8000
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>Custom networks</strong>: Isolated communication channels</li> <li><strong>internal: true</strong>: Prevents external access to backend network</li> <li><strong>Multiple networks</strong>: Services can connect to multiple networks</li> <li><strong>Network isolation</strong>: Frontend accessible, backend internal only</li> <li><strong>Service discovery</strong>: Services communicate using service names</li> </ul> </details> <hr> <h4 id=06-health-checks-and-dependencies>06. Health Checks and Dependencies<a class=headerlink href=#06-health-checks-and-dependencies title="Permanent link">&para;</a></h4> <ul> <li> <p>Implement health checks and service dependencies to ensure proper startup order and fault tolerance.</p> <h4 id=scenario_5><strong>Scenario:</strong><a class=headerlink href=#scenario_5 title="Permanent link">&para;</a></h4> <ul> <li>Your application services have complex dependencies and need to verify they&rsquo;re healthy before other services start depending on them.</li> <li>Docker Compose health checks ensure services are ready before dependent services start, improving application reliability.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>healthcheck</code> with <code>depends_on.condition: service_healthy</code> for proper service startup sequencing</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-17-7><a id=__codelineno-17-7 name=__codelineno-17-7 href=#__codelineno-17-7></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-17-8><a id=__codelineno-17-8 name=__codelineno-17-8 href=#__codelineno-17-8></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-17-9><a id=__codelineno-17-9 name=__codelineno-17-9 href=#__codelineno-17-9></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-17-10><a id=__codelineno-17-10 name=__codelineno-17-10 href=#__codelineno-17-10></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;pg_isready</span><span class=nv> </span><span class=s>-U</span><span class=nv> </span><span class=s>user</span><span class=nv> </span><span class=s>-d</span><span class=nv> </span><span class=s>myapp&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-17-11><a id=__codelineno-17-11 name=__codelineno-17-11 href=#__codelineno-17-11></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-17-12><a id=__codelineno-17-12 name=__codelineno-17-12 href=#__codelineno-17-12></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-17-13><a id=__codelineno-17-13 name=__codelineno-17-13 href=#__codelineno-17-13></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id=__span-17-14><a id=__codelineno-17-14 name=__codelineno-17-14 href=#__codelineno-17-14></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-17-15><a id=__codelineno-17-15 name=__codelineno-17-15 href=#__codelineno-17-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-17-16><a id=__codelineno-17-16 name=__codelineno-17-16 href=#__codelineno-17-16></a>
</span><span id=__span-17-17><a id=__codelineno-17-17 name=__codelineno-17-17 href=#__codelineno-17-17></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-17-18><a id=__codelineno-17-18 name=__codelineno-17-18 href=#__codelineno-17-18></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-17-19><a id=__codelineno-17-19 name=__codelineno-17-19 href=#__codelineno-17-19></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-17-20><a id=__codelineno-17-20 name=__codelineno-17-20 href=#__codelineno-17-20></a><span class=w>      </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-17-21><a id=__codelineno-17-21 name=__codelineno-17-21 href=#__codelineno-17-21></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id=__span-17-22><a id=__codelineno-17-22 name=__codelineno-17-22 href=#__codelineno-17-22></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-17-23><a id=__codelineno-17-23 name=__codelineno-17-23 href=#__codelineno-17-23></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost:8000/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-17-24><a id=__codelineno-17-24 name=__codelineno-17-24 href=#__codelineno-17-24></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-17-25><a id=__codelineno-17-25 name=__codelineno-17-25 href=#__codelineno-17-25></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-17-26><a id=__codelineno-17-26 name=__codelineno-17-26 href=#__codelineno-17-26></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-17-27><a id=__codelineno-17-27 name=__codelineno-17-27 href=#__codelineno-17-27></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;OK&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 8000 -h /tmp&#39;</span>
</span><span id=__span-17-28><a id=__codelineno-17-28 name=__codelineno-17-28 href=#__codelineno-17-28></a>
</span><span id=__span-17-29><a id=__codelineno-17-29 name=__codelineno-17-29 href=#__codelineno-17-29></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-17-30><a id=__codelineno-17-30 name=__codelineno-17-30 href=#__codelineno-17-30></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-17-31><a id=__codelineno-17-31 name=__codelineno-17-31 href=#__codelineno-17-31></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-17-32><a id=__codelineno-17-32 name=__codelineno-17-32 href=#__codelineno-17-32></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-17-33><a id=__codelineno-17-33 name=__codelineno-17-33 href=#__codelineno-17-33></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-17-34><a id=__codelineno-17-34 name=__codelineno-17-34 href=#__codelineno-17-34></a><span class=w>      </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-17-35><a id=__codelineno-17-35 name=__codelineno-17-35 href=#__codelineno-17-35></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id=__span-17-36><a id=__codelineno-17-36 name=__codelineno-17-36 href=#__codelineno-17-36></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-17-37><a id=__codelineno-17-37 name=__codelineno-17-37 href=#__codelineno-17-37></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-17-38><a id=__codelineno-17-38 name=__codelineno-17-38 href=#__codelineno-17-38></a>
</span><span id=__span-17-39><a id=__codelineno-17-39 name=__codelineno-17-39 href=#__codelineno-17-39></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-17-40><a id=__codelineno-17-40 name=__codelineno-17-40 href=#__codelineno-17-40></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=c1># Start services (will wait for health checks)</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=c1># Monitor startup process</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a>docker-compose<span class=w> </span>logs<span class=w> </span>-f
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=c1># Check service health</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a>docker-compose<span class=w> </span>ps
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a><span class=c1># Test health endpoints</span>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>api<span class=w> </span>curl<span class=w> </span>http://localhost:8000/health
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>healthcheck</strong>: Defines how to check service health</li> <li><strong>depends_on.condition</strong>: Waits for healthy dependencies</li> <li><strong>Startup sequencing</strong>: Services start only when dependencies are ready</li> <li><strong>Fault tolerance</strong>: Automatic restarts for unhealthy services</li> <li><strong>Health monitoring</strong>: Continuous health checking during runtime</li> </ul> </details> <hr> <h4 id=07-scaling-services>07. Scaling Services<a class=headerlink href=#07-scaling-services title="Permanent link">&para;</a></h4> <ul> <li> <p>Scale services horizontally to handle increased load and implement load balancing.</p> <h4 id=scenario_6><strong>Scenario:</strong><a class=headerlink href=#scenario_6 title="Permanent link">&para;</a></h4> <ul> <li>Your application is experiencing high traffic and needs to handle more concurrent requests by running multiple instances of services.</li> <li>Docker Compose scaling allows you to run multiple instances of services and distribute load across them.</li> </ul> <h4 id=resources_3>Resources:<a class=headerlink href=#resources_3 title="Permanent link">&para;</a></h4> <ul> <li><code>lb/nginx.conf</code> ➤ <code>/etc/nginx/nginx.conf</code> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=k>events</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=w>    </span><span class=kn>worker_connections</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-19-3><a id=__codelineno-19-3 name=__codelineno-19-3 href=#__codelineno-19-3></a><span class=p>}</span>
</span><span id=__span-19-4><a id=__codelineno-19-4 name=__codelineno-19-4 href=#__codelineno-19-4></a>
</span><span id=__span-19-5><a id=__codelineno-19-5 name=__codelineno-19-5 href=#__codelineno-19-5></a><span class=k>http</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-6><a id=__codelineno-19-6 name=__codelineno-19-6 href=#__codelineno-19-6></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>api_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-7><a id=__codelineno-19-7 name=__codelineno-19-7 href=#__codelineno-19-7></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api</span><span class=p>:</span><span class=mi>8000</span><span class=p>;</span>
</span><span id=__span-19-8><a id=__codelineno-19-8 name=__codelineno-19-8 href=#__codelineno-19-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-19-9><a id=__codelineno-19-9 name=__codelineno-19-9 href=#__codelineno-19-9></a>
</span><span id=__span-19-10><a id=__codelineno-19-10 name=__codelineno-19-10 href=#__codelineno-19-10></a><span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-11><a id=__codelineno-19-11 name=__codelineno-19-11 href=#__codelineno-19-11></a><span class=w>        </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-19-12><a id=__codelineno-19-12 name=__codelineno-19-12 href=#__codelineno-19-12></a>
</span><span id=__span-19-13><a id=__codelineno-19-13 name=__codelineno-19-13 href=#__codelineno-19-13></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/api</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-14><a id=__codelineno-19-14 name=__codelineno-19-14 href=#__codelineno-19-14></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://api_backend</span><span class=p>;</span>
</span><span id=__span-19-15><a id=__codelineno-19-15 name=__codelineno-19-15 href=#__codelineno-19-15></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-19-16><a id=__codelineno-19-16 name=__codelineno-19-16 href=#__codelineno-19-16></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-19-17><a id=__codelineno-19-17 name=__codelineno-19-17 href=#__codelineno-19-17></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-19-18><a id=__codelineno-19-18 name=__codelineno-19-18 href=#__codelineno-19-18></a>
</span><span id=__span-19-19><a id=__codelineno-19-19 name=__codelineno-19-19 href=#__codelineno-19-19></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-19-20><a id=__codelineno-19-20 name=__codelineno-19-20 href=#__codelineno-19-20></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://web</span><span class=p>;</span>
</span><span id=__span-19-21><a id=__codelineno-19-21 name=__codelineno-19-21 href=#__codelineno-19-21></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-19-22><a id=__codelineno-19-22 name=__codelineno-19-22 href=#__codelineno-19-22></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-19-23><a id=__codelineno-19-23 name=__codelineno-19-23 href=#__codelineno-19-23></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-19-24><a id=__codelineno-19-24 name=__codelineno-19-24 href=#__codelineno-19-24></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-19-25><a id=__codelineno-19-25 name=__codelineno-19-25 href=#__codelineno-19-25></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>deploy.replicas</code> to scale services and configure load balancing with nginx upstream</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-20-6><a id=__codelineno-20-6 name=__codelineno-20-6 href=#__codelineno-20-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-20-7><a id=__codelineno-20-7 name=__codelineno-20-7 href=#__codelineno-20-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-20-8><a id=__codelineno-20-8 name=__codelineno-20-8 href=#__codelineno-20-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-20-9><a id=__codelineno-20-9 name=__codelineno-20-9 href=#__codelineno-20-9></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-20-10><a id=__codelineno-20-10 name=__codelineno-20-10 href=#__codelineno-20-10></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-20-11><a id=__codelineno-20-11 name=__codelineno-20-11 href=#__codelineno-20-11></a>
</span><span id=__span-20-12><a id=__codelineno-20-12 name=__codelineno-20-12 href=#__codelineno-20-12></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-20-13><a id=__codelineno-20-13 name=__codelineno-20-13 href=#__codelineno-20-13></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-20-14><a id=__codelineno-20-14 name=__codelineno-20-14 href=#__codelineno-20-14></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;</span>
</span><span id=__span-20-15><a id=__codelineno-20-15 name=__codelineno-20-15 href=#__codelineno-20-15></a><span class="l l-Scalar l-Scalar-Plain">while true; do</span>
</span><span id=__span-20-16><a id=__codelineno-20-16 name=__codelineno-20-16 href=#__codelineno-20-16></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">hostname=\$(hostname)</span>
</span><span id=__span-20-17><a id=__codelineno-20-17 name=__codelineno-20-17 href=#__codelineno-20-17></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">{ echo -e \&quot;HTTP/1.1 200 OK\r\nContent-Type</span><span class=nt>: text/plain\r\n\r\nAPI Instance</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">\$hostname\&quot;; } | nc -l -p 8000 -q 1 &gt; /dev/null</span>
</span><span id=__span-20-18><a id=__codelineno-20-18 name=__codelineno-20-18 href=#__codelineno-20-18></a><span class="l l-Scalar l-Scalar-Plain">done&quot;</span>
</span><span id=__span-20-19><a id=__codelineno-20-19 name=__codelineno-20-19 href=#__codelineno-20-19></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">deploy</span><span class="p p-Indicator">:</span>
</span><span id=__span-20-20><a id=__codelineno-20-20 name=__codelineno-20-20 href=#__codelineno-20-20></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-20-21><a id=__codelineno-20-21 name=__codelineno-20-21 href=#__codelineno-20-21></a>
</span><span id=__span-20-22><a id=__codelineno-20-22 name=__codelineno-20-22 href=#__codelineno-20-22></a><span class="w w-Error">  </span><span class=nt>loadbalancer</span><span class=p>:</span>
</span><span id=__span-20-23><a id=__codelineno-20-23 name=__codelineno-20-23 href=#__codelineno-20-23></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-20-24><a id=__codelineno-20-24 name=__codelineno-20-24 href=#__codelineno-20-24></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-20-25><a id=__codelineno-20-25 name=__codelineno-20-25 href=#__codelineno-20-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9090:80&quot;</span>
</span><span id=__span-20-26><a id=__codelineno-20-26 name=__codelineno-20-26 href=#__codelineno-20-26></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-20-27><a id=__codelineno-20-27 name=__codelineno-20-27 href=#__codelineno-20-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./lb/nginx.conf:/etc/nginx/nginx.conf</span>
</span><span id=__span-20-28><a id=__codelineno-20-28 name=__codelineno-20-28 href=#__codelineno-20-28></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-20-29><a id=__codelineno-20-29 name=__codelineno-20-29 href=#__codelineno-20-29></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-20-30><a id=__codelineno-20-30 name=__codelineno-20-30 href=#__codelineno-20-30></a>
</span><span id=__span-20-31><a id=__codelineno-20-31 name=__codelineno-20-31 href=#__codelineno-20-31></a><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-20-32><a id=__codelineno-20-32 name=__codelineno-20-32 href=#__codelineno-20-32></a><span class=w>  </span><span class=nt>default</span><span class=p>:</span>
</span><span id=__span-20-33><a id=__codelineno-20-33 name=__codelineno-20-33 href=#__codelineno-20-33></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span></code></pre></div></p> <p><strong>lb/nginx.conf</strong> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=k>events</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=w>    </span><span class=kn>worker_connections</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=p>}</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a><span class=k>http</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>api_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api</span><span class=p>:</span><span class=mi>8000</span><span class=p>;</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=w>        </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/api</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://api_backend</span><span class=p>;</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://web</span><span class=p>;</span>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-21-22><a id=__codelineno-21-22 name=__codelineno-21-22 href=#__codelineno-21-22></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-21-23><a id=__codelineno-21-23 name=__codelineno-21-23 href=#__codelineno-21-23></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-21-24><a id=__codelineno-21-24 name=__codelineno-21-24 href=#__codelineno-21-24></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-21-25><a id=__codelineno-21-25 name=__codelineno-21-25 href=#__codelineno-21-25></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=c1># Start scaled services</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=c1># Check running instances</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>docker-compose<span class=w> </span>ps
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=c1># Scale services dynamically</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a>docker-compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>--scale<span class=w> </span><span class=nv>api</span><span class=o>=</span><span class=m>3</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=c1># Test load balancing</span>
</span><span id=__span-22-11><a id=__codelineno-22-11 name=__codelineno-22-11 href=#__codelineno-22-11></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=m>1</span>..5<span class=o>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>curl<span class=w> </span>http://localhost:9090/api<span class=p>;</span><span class=w> </span><span class=k>done</span>
</span><span id=__span-22-12><a id=__codelineno-22-12 name=__codelineno-22-12 href=#__codelineno-22-12></a>
</span><span id=__span-22-13><a id=__codelineno-22-13 name=__codelineno-22-13 href=#__codelineno-22-13></a><span class=c1># Scale down</span>
</span><span id=__span-22-14><a id=__codelineno-22-14 name=__codelineno-22-14 href=#__codelineno-22-14></a>docker-compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>--scale<span class=w> </span><span class=nv>web</span><span class=o>=</span><span class=m>1</span>
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>deploy.replicas</strong>: Specifies number of service instances</li> <li><strong>Load balancing</strong>: Nginx distributes requests across instances</li> <li><strong>Service discovery</strong>: Automatic load balancing between replicas</li> <li><strong>Dynamic scaling</strong>: Change replica count without recreation</li> <li><strong>Instance identification</strong>: Each replica has unique hostname</li> </ul> </details> <hr> <h4 id=08-build-configuration>08. Build Configuration<a class=headerlink href=#08-build-configuration title="Permanent link">&para;</a></h4> <ul> <li> <p>Build custom images within Docker Compose using build contexts and Dockerfiles.</p> <h4 id=scenario_7><strong>Scenario:</strong><a class=headerlink href=#scenario_7 title="Permanent link">&para;</a></h4> <ul> <li>Your application requires custom Docker images that aren&rsquo;t available publicly, or you need to build images with specific configurations for your stack.</li> <li>Docker Compose can build images from Dockerfiles as part of the service definition.</li> </ul> <h4 id=resources_4>Resources:<a class=headerlink href=#resources_4 title="Permanent link">&para;</a></h4> <ul> <li><code>web/Dockerfile</code> ➤ Web service Dockerfile <div class="language-dockerfile highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=k>FROM</span><span class=w> </span><span class=s>node:18-alpine</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a><span class=k>COPY</span><span class=w> </span>package*.json<span class=w> </span>./
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a><span class=k>RUN</span><span class=w> </span>npm<span class=w> </span>ci<span class=w> </span>--only<span class=o>=</span>production
</span><span id=__span-23-5><a id=__codelineno-23-5 name=__codelineno-23-5 href=#__codelineno-23-5></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
</span><span id=__span-23-6><a id=__codelineno-23-6 name=__codelineno-23-6 href=#__codelineno-23-6></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>80</span>
</span><span id=__span-23-7><a id=__codelineno-23-7 name=__codelineno-23-7 href=#__codelineno-23-7></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;npm&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;start&quot;</span><span class=p>]</span>
</span></code></pre></div></li> <li><code>api/Dockerfile</code> ➤ API service Dockerfile <div class="language-dockerfile highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.9-slim</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=k>ARG</span><span class=w> </span>APP_VERSION
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=k>ENV</span><span class=w> </span><span class=nv>VERSION</span><span class=o>=</span><span class=nv>$APP_VERSION</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>3000</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;python&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.py&quot;</span><span class=p>]</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>build.context</code> and <code>build.args</code> to build custom images within Compose</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NODE_ENV=production</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=w>    </span><span class=nt>build</span><span class=p>:</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=w>      </span><span class=nt>context</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./api</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=w>      </span><span class=nt>dockerfile</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a><span class=w>      </span><span class=nt>args</span><span class=p>:</span>
</span><span id=__span-25-17><a id=__codelineno-25-17 name=__codelineno-25-17 href=#__codelineno-25-17></a><span class=w>        </span><span class=nt>APP_VERSION</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</span><span id=__span-25-18><a id=__codelineno-25-18 name=__codelineno-25-18 href=#__codelineno-25-18></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-25-19><a id=__codelineno-25-19 name=__codelineno-25-19 href=#__codelineno-25-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span><span id=__span-25-20><a id=__codelineno-25-20 name=__codelineno-25-20 href=#__codelineno-25-20></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-25-21><a id=__codelineno-25-21 name=__codelineno-25-21 href=#__codelineno-25-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=postgresql://user:pass@db:5432/myapp</span>
</span><span id=__span-25-22><a id=__codelineno-25-22 name=__codelineno-25-22 href=#__codelineno-25-22></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-25-23><a id=__codelineno-25-23 name=__codelineno-25-23 href=#__codelineno-25-23></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-25-24><a id=__codelineno-25-24 name=__codelineno-25-24 href=#__codelineno-25-24></a>
</span><span id=__span-25-25><a id=__codelineno-25-25 name=__codelineno-25-25 href=#__codelineno-25-25></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-25-26><a id=__codelineno-25-26 name=__codelineno-25-26 href=#__codelineno-25-26></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-25-27><a id=__codelineno-25-27 name=__codelineno-25-27 href=#__codelineno-25-27></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-25-28><a id=__codelineno-25-28 name=__codelineno-25-28 href=#__codelineno-25-28></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-25-29><a id=__codelineno-25-29 name=__codelineno-25-29 href=#__codelineno-25-29></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-25-30><a id=__codelineno-25-30 name=__codelineno-25-30 href=#__codelineno-25-30></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-25-31><a id=__codelineno-25-31 name=__codelineno-25-31 href=#__codelineno-25-31></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-25-32><a id=__codelineno-25-32 name=__codelineno-25-32 href=#__codelineno-25-32></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-25-33><a id=__codelineno-25-33 name=__codelineno-25-33 href=#__codelineno-25-33></a>
</span><span id=__span-25-34><a id=__codelineno-25-34 name=__codelineno-25-34 href=#__codelineno-25-34></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-25-35><a id=__codelineno-25-35 name=__codelineno-25-35 href=#__codelineno-25-35></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>web/Dockerfile</strong> <div class="language-dockerfile highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=k>FROM</span><span class=w> </span><span class=s>node:18-alpine</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=k>COPY</span><span class=w> </span>package*.json<span class=w> </span>./
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=k>RUN</span><span class=w> </span>npm<span class=w> </span>ci<span class=w> </span>--only<span class=o>=</span>production
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>80</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;npm&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;start&quot;</span><span class=p>]</span>
</span></code></pre></div></p> <p><strong>api/Dockerfile</strong> <div class="language-dockerfile highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=k>FROM</span><span class=w> </span><span class=s>python:3.9-slim</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=k>ARG</span><span class=w> </span>APP_VERSION
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a><span class=k>ENV</span><span class=w> </span><span class=nv>VERSION</span><span class=o>=</span><span class=nv>$APP_VERSION</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a><span class=k>WORKDIR</span><span class=w> </span><span class=s>/app</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a><span class=k>COPY</span><span class=w> </span>requirements.txt<span class=w> </span>.
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a><span class=k>RUN</span><span class=w> </span>pip<span class=w> </span>install<span class=w> </span>-r<span class=w> </span>requirements.txt
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a><span class=k>COPY</span><span class=w> </span>.<span class=w> </span>.
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a><span class=k>EXPOSE</span><span class=w> </span><span class=s>3000</span>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a><span class=k>CMD</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;python&quot;</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;app.py&quot;</span><span class=p>]</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># Build and start services</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a>docker-compose<span class=w> </span>up<span class=w> </span>--build<span class=w> </span>-d
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=c1># Rebuild specific service</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a>docker-compose<span class=w> </span>build<span class=w> </span>api
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=c1># Build without cache</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a>docker-compose<span class=w> </span>build<span class=w> </span>--no-cache
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=c1># View build logs</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a>docker-compose<span class=w> </span>build<span class=w> </span>--progress<span class=w> </span>plain
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>build.context</strong>: Directory containing Dockerfile and build context</li> <li><strong>build.dockerfile</strong>: Specify custom Dockerfile name/location</li> <li><strong>build.args</strong>: Pass build arguments to Dockerfile</li> <li><strong>&ndash;build</strong>: Force rebuild of images</li> <li><strong>Selective building</strong>: Rebuild only specific services</li> <li><strong>Build caching</strong>: Leverages Docker layer caching</li> </ul> </details> <hr> <h4 id=09-override-files>09. Override Files<a class=headerlink href=#09-override-files title="Permanent link">&para;</a></h4> <ul> <li> <p>Use multiple docker-compose files to manage different environments and configurations.</p> <h4 id=scenario_8><strong>Scenario:</strong><a class=headerlink href=#scenario_8 title="Permanent link">&para;</a></h4> <ul> <li>Your application needs different configurations for development, testing, and production environments with varying resource requirements, logging levels, and service configurations.</li> <li>Docker Compose override files allow you to maintain a base configuration while applying environment-specific customizations.</li> </ul> <h4 id=resources_5>Resources:<a class=headerlink href=#resources_5 title="Permanent link">&para;</a></h4> <ul> <li><code>docker-compose.override.yml</code> ➤ Development overrides <div class="language-yaml highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-29-4><a id=__codelineno-29-4 name=__codelineno-29-4 href=#__codelineno-29-4></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-29-5><a id=__codelineno-29-5 name=__codelineno-29-5 href=#__codelineno-29-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG=true</span>
</span><span id=__span-29-6><a id=__codelineno-29-6 name=__codelineno-29-6 href=#__codelineno-29-6></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-29-7><a id=__codelineno-29-7 name=__codelineno-29-7 href=#__codelineno-29-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-29-8><a id=__codelineno-29-8 name=__codelineno-29-8 href=#__codelineno-29-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/app/node_modules</span>
</span><span id=__span-29-9><a id=__codelineno-29-9 name=__codelineno-29-9 href=#__codelineno-29-9></a>
</span><span id=__span-29-10><a id=__codelineno-29-10 name=__codelineno-29-10 href=#__codelineno-29-10></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-29-11><a id=__codelineno-29-11 name=__codelineno-29-11 href=#__codelineno-29-11></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-29-12><a id=__codelineno-29-12 name=__codelineno-29-12 href=#__codelineno-29-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5432:5432&quot;</span>
</span><span id=__span-29-13><a id=__codelineno-29-13 name=__codelineno-29-13 href=#__codelineno-29-13></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-29-14><a id=__codelineno-29-14 name=__codelineno-29-14 href=#__codelineno-29-14></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">devpassword</span>
</span></code></pre></div></li> <li><code>docker-compose.prod.yml</code> ➤ Production overrides <div class="language-yaml highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NODE_ENV=production</span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-30-20><a id=__codelineno-30-20 name=__codelineno-30-20 href=#__codelineno-30-20></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>docker-compose.override.yml</code> for development and custom override files for production</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> (base) <div class="language-yaml highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-31-14><a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-31-15><a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-31-16><a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-31-17><a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-31-18><a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a>
</span><span id=__span-31-19><a id=__codelineno-31-19 name=__codelineno-31-19 href=#__codelineno-31-19></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-31-20><a id=__codelineno-31-20 name=__codelineno-31-20 href=#__codelineno-31-20></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>docker-compose.override.yml</strong> (development) <div class="language-yaml highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG=true</span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/app/node_modules</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5432:5432&quot;</span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">devpassword</span>
</span></code></pre></div></p> <p><strong>docker-compose.prod.yml</strong> (production) <div class="language-yaml highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NODE_ENV=production</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-33-18><a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-33-19><a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-33-20><a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># Development (uses override automatically)</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=c1># Production</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a>docker-compose<span class=w> </span>-f<span class=w> </span>docker-compose.yml<span class=w> </span>-f<span class=w> </span>docker-compose.prod.yml<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=c1># Staging with custom override</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>docker-compose<span class=w> </span>-f<span class=w> </span>docker-compose.yml<span class=w> </span>-f<span class=w> </span>docker-compose.staging.yml<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a><span class=c1># List all services from combined files</span>
</span><span id=__span-34-11><a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a>docker-compose<span class=w> </span>-f<span class=w> </span>docker-compose.yml<span class=w> </span>-f<span class=w> </span>docker-compose.prod.yml<span class=w> </span>config
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>Automatic override</strong>: docker-compose.override.yml loaded automatically</li> <li><strong>Multiple files</strong>: Use -f to specify multiple compose files</li> <li><strong>Merging rules</strong>: Override files extend and modify base configuration</li> <li><strong>Environment separation</strong>: Different settings for dev/staging/prod</li> <li><strong>docker-compose config</strong>: Validate and view merged configuration</li> </ul> </details> <hr> <h4 id=10-secrets-management>10. Secrets Management<a class=headerlink href=#10-secrets-management title="Permanent link">&para;</a></h4> <ul> <li> <p>Securely manage sensitive data like passwords and API keys using Docker Compose secrets.</p> <h4 id=scenario_9><strong>Scenario:</strong><a class=headerlink href=#scenario_9 title="Permanent link">&para;</a></h4> <ul> <li>Your application requires sensitive information like database passwords, API keys, and certificates that shouldn&rsquo;t be stored in plain text in your compose files.</li> <li>Docker Compose secrets provide a secure way to manage sensitive data and make it available to services at runtime.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>secrets</code> with <code>file</code> source to securely pass sensitive data to containers</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-35-7><a id=__codelineno-35-7 name=__codelineno-35-7 href=#__codelineno-35-7></a><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-35-8><a id=__codelineno-35-8 name=__codelineno-35-8 href=#__codelineno-35-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx_cert</span>
</span><span id=__span-35-9><a id=__codelineno-35-9 name=__codelineno-35-9 href=#__codelineno-35-9></a><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/nginx.crt</span>
</span><span id=__span-35-10><a id=__codelineno-35-10 name=__codelineno-35-10 href=#__codelineno-35-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx_key</span>
</span><span id=__span-35-11><a id=__codelineno-35-11 name=__codelineno-35-11 href=#__codelineno-35-11></a><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/private/nginx.key</span>
</span><span id=__span-35-12><a id=__codelineno-35-12 name=__codelineno-35-12 href=#__codelineno-35-12></a>
</span><span id=__span-35-13><a id=__codelineno-35-13 name=__codelineno-35-13 href=#__codelineno-35-13></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-35-14><a id=__codelineno-35-14 name=__codelineno-35-14 href=#__codelineno-35-14></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-35-15><a id=__codelineno-35-15 name=__codelineno-35-15 href=#__codelineno-35-15></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-35-16><a id=__codelineno-35-16 name=__codelineno-35-16 href=#__codelineno-35-16></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-35-17><a id=__codelineno-35-17 name=__codelineno-35-17 href=#__codelineno-35-17></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-35-18><a id=__codelineno-35-18 name=__codelineno-35-18 href=#__codelineno-35-18></a><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-35-19><a id=__codelineno-35-19 name=__codelineno-35-19 href=#__codelineno-35-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_password</span>
</span><span id=__span-35-20><a id=__codelineno-35-20 name=__codelineno-35-20 href=#__codelineno-35-20></a><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres_password</span>
</span><span id=__span-35-21><a id=__codelineno-35-21 name=__codelineno-35-21 href=#__codelineno-35-21></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
</span><span id=__span-35-22><a id=__codelineno-35-22 name=__codelineno-35-22 href=#__codelineno-35-22></a><span class=w>      </span><span class=no>sh -c &quot;</span>
</span><span id=__span-35-23><a id=__codelineno-35-23 name=__codelineno-35-23 href=#__codelineno-35-23></a><span class=w>      </span><span class=no>export POSTGRES_PASSWORD=$(cat /run/secrets/postgres_password) &amp;&amp;</span>
</span><span id=__span-35-24><a id=__codelineno-35-24 name=__codelineno-35-24 href=#__codelineno-35-24></a><span class=w>      </span><span class=no>docker-entrypoint.sh postgres</span>
</span><span id=__span-35-25><a id=__codelineno-35-25 name=__codelineno-35-25 href=#__codelineno-35-25></a><span class=w>      </span><span class=no>&quot;</span>
</span><span id=__span-35-26><a id=__codelineno-35-26 name=__codelineno-35-26 href=#__codelineno-35-26></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-35-27><a id=__codelineno-35-27 name=__codelineno-35-27 href=#__codelineno-35-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-35-28><a id=__codelineno-35-28 name=__codelineno-35-28 href=#__codelineno-35-28></a>
</span><span id=__span-35-29><a id=__codelineno-35-29 name=__codelineno-35-29 href=#__codelineno-35-29></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-35-30><a id=__codelineno-35-30 name=__codelineno-35-30 href=#__codelineno-35-30></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-35-31><a id=__codelineno-35-31 name=__codelineno-35-31 href=#__codelineno-35-31></a><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-35-32><a id=__codelineno-35-32 name=__codelineno-35-32 href=#__codelineno-35-32></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api_key</span>
</span><span id=__span-35-33><a id=__codelineno-35-33 name=__codelineno-35-33 href=#__codelineno-35-33></a><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/api_key</span>
</span><span id=__span-35-34><a id=__codelineno-35-34 name=__codelineno-35-34 href=#__codelineno-35-34></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-35-35><a id=__codelineno-35-35 name=__codelineno-35-35 href=#__codelineno-35-35></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">API_KEY_FILE=/run/secrets/api_key</span>
</span><span id=__span-35-36><a id=__codelineno-35-36 name=__codelineno-35-36 href=#__codelineno-35-36></a>
</span><span id=__span-35-37><a id=__codelineno-35-37 name=__codelineno-35-37 href=#__codelineno-35-37></a><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-35-38><a id=__codelineno-35-38 name=__codelineno-35-38 href=#__codelineno-35-38></a><span class=w>  </span><span class=nt>nginx_cert</span><span class=p>:</span>
</span><span id=__span-35-39><a id=__codelineno-35-39 name=__codelineno-35-39 href=#__codelineno-35-39></a><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/nginx.crt</span>
</span><span id=__span-35-40><a id=__codelineno-35-40 name=__codelineno-35-40 href=#__codelineno-35-40></a><span class=w>  </span><span class=nt>nginx_key</span><span class=p>:</span>
</span><span id=__span-35-41><a id=__codelineno-35-41 name=__codelineno-35-41 href=#__codelineno-35-41></a><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/nginx.key</span>
</span><span id=__span-35-42><a id=__codelineno-35-42 name=__codelineno-35-42 href=#__codelineno-35-42></a><span class=w>  </span><span class=nt>db_password</span><span class=p>:</span>
</span><span id=__span-35-43><a id=__codelineno-35-43 name=__codelineno-35-43 href=#__codelineno-35-43></a><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/db_password.txt</span>
</span><span id=__span-35-44><a id=__codelineno-35-44 name=__codelineno-35-44 href=#__codelineno-35-44></a><span class=w>  </span><span class=nt>api_key</span><span class=p>:</span>
</span><span id=__span-35-45><a id=__codelineno-35-45 name=__codelineno-35-45 href=#__codelineno-35-45></a><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/api_key.txt</span>
</span><span id=__span-35-46><a id=__codelineno-35-46 name=__codelineno-35-46 href=#__codelineno-35-46></a>
</span><span id=__span-35-47><a id=__codelineno-35-47 name=__codelineno-35-47 href=#__codelineno-35-47></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-35-48><a id=__codelineno-35-48 name=__codelineno-35-48 href=#__codelineno-35-48></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a><span class=c1># Create secrets directory</span>
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>mkdir<span class=w> </span>-p<span class=w> </span>secrets
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a><span class=c1># Create secret files (never commit these)</span>
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;mysecretpassword&quot;</span><span class=w> </span>&gt;<span class=w> </span>secrets/db_password.txt
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;sk-1234567890abcdef&quot;</span><span class=w> </span>&gt;<span class=w> </span>secrets/api_key.txt
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>
</span><span id=__span-36-8><a id=__codelineno-36-8 name=__codelineno-36-8 href=#__codelineno-36-8></a><span class=c1># Start services</span>
</span><span id=__span-36-9><a id=__codelineno-36-9 name=__codelineno-36-9 href=#__codelineno-36-9></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-36-10><a id=__codelineno-36-10 name=__codelineno-36-10 href=#__codelineno-36-10></a>
</span><span id=__span-36-11><a id=__codelineno-36-11 name=__codelineno-36-11 href=#__codelineno-36-11></a><span class=c1># Check secrets in containers</span>
</span><span id=__span-36-12><a id=__codelineno-36-12 name=__codelineno-36-12 href=#__codelineno-36-12></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>api<span class=w> </span>cat<span class=w> </span>/run/secrets/api_key
</span><span id=__span-36-13><a id=__codelineno-36-13 name=__codelineno-36-13 href=#__codelineno-36-13></a>
</span><span id=__span-36-14><a id=__codelineno-36-14 name=__codelineno-36-14 href=#__codelineno-36-14></a><span class=c1># Clean up (remove secrets)</span>
</span><span id=__span-36-15><a id=__codelineno-36-15 name=__codelineno-36-15 href=#__codelineno-36-15></a>docker-compose<span class=w> </span>down
</span><span id=__span-36-16><a id=__codelineno-36-16 name=__codelineno-36-16 href=#__codelineno-36-16></a>rm<span class=w> </span>-rf<span class=w> </span>secrets/
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>secrets</strong>: Secure way to pass sensitive data to containers</li> <li><strong>file source</strong>: Load secrets from external files</li> <li><strong>target</strong>: Location where secret is mounted in container</li> <li><strong>Runtime only</strong>: Secrets not stored in image layers</li> <li><strong>Access control</strong>: Secrets only available to specified services</li> <li><strong>External management</strong>: Secrets can be managed by external systems</li> </ul> </details> <hr> <h4 id=11-logging-configuration>11. Logging Configuration<a class=headerlink href=#11-logging-configuration title="Permanent link">&para;</a></h4> <ul> <li> <p>Configure centralized logging for all services in a Docker Compose stack.</p> <h4 id=scenario_10><strong>Scenario:</strong><a class=headerlink href=#scenario_10 title="Permanent link">&para;</a></h4> <ul> <li>Your multi-service application generates logs from different components, and you need to centralize logging for monitoring, debugging, and compliance purposes.</li> <li>Docker Compose logging configuration allows you to define logging drivers and options for consistent log management across all services.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>logging.driver</code> and <code>logging.options</code> to configure log rotation and formatting</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=w>    </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a><span class=w>      </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-37-9><a id=__codelineno-37-9 name=__codelineno-37-9 href=#__codelineno-37-9></a><span class=w>      </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-37-10><a id=__codelineno-37-10 name=__codelineno-37-10 href=#__codelineno-37-10></a><span class=w>        </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10m&quot;</span>
</span><span id=__span-37-11><a id=__codelineno-37-11 name=__codelineno-37-11 href=#__codelineno-37-11></a><span class=w>        </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3&quot;</span>
</span><span id=__span-37-12><a id=__codelineno-37-12 name=__codelineno-37-12 href=#__codelineno-37-12></a>
</span><span id=__span-37-13><a id=__codelineno-37-13 name=__codelineno-37-13 href=#__codelineno-37-13></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-37-14><a id=__codelineno-37-14 name=__codelineno-37-14 href=#__codelineno-37-14></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-37-15><a id=__codelineno-37-15 name=__codelineno-37-15 href=#__codelineno-37-15></a><span class=w>    </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-37-16><a id=__codelineno-37-16 name=__codelineno-37-16 href=#__codelineno-37-16></a><span class=w>      </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-37-17><a id=__codelineno-37-17 name=__codelineno-37-17 href=#__codelineno-37-17></a><span class=w>      </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-37-18><a id=__codelineno-37-18 name=__codelineno-37-18 href=#__codelineno-37-18></a><span class=w>        </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;20m&quot;</span>
</span><span id=__span-37-19><a id=__codelineno-37-19 name=__codelineno-37-19 href=#__codelineno-37-19></a><span class=w>        </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;5&quot;</span>
</span><span id=__span-37-20><a id=__codelineno-37-20 name=__codelineno-37-20 href=#__codelineno-37-20></a><span class=w>        </span><span class=nt>labels</span><span class=p>:</span><span class=w> </span><span class=s>&quot;service&quot;</span>
</span><span id=__span-37-21><a id=__codelineno-37-21 name=__codelineno-37-21 href=#__codelineno-37-21></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;</span>
</span><span id=__span-37-22><a id=__codelineno-37-22 name=__codelineno-37-22 href=#__codelineno-37-22></a><span class="l l-Scalar l-Scalar-Plain">while true; do</span>
</span><span id=__span-37-23><a id=__codelineno-37-23 name=__codelineno-37-23 href=#__codelineno-37-23></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">echo \&quot;\$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) - INFO - API request processed\&quot;</span>
</span><span id=__span-37-24><a id=__codelineno-37-24 name=__codelineno-37-24 href=#__codelineno-37-24></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">sleep 5</span>
</span><span id=__span-37-25><a id=__codelineno-37-25 name=__codelineno-37-25 href=#__codelineno-37-25></a><span class="l l-Scalar l-Scalar-Plain">done&quot;</span>
</span><span id=__span-37-26><a id=__codelineno-37-26 name=__codelineno-37-26 href=#__codelineno-37-26></a>
</span><span id=__span-37-27><a id=__codelineno-37-27 name=__codelineno-37-27 href=#__codelineno-37-27></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
</span><span id=__span-37-28><a id=__codelineno-37-28 name=__codelineno-37-28 href=#__codelineno-37-28></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-37-29><a id=__codelineno-37-29 name=__codelineno-37-29 href=#__codelineno-37-29></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-37-30><a id=__codelineno-37-30 name=__codelineno-37-30 href=#__codelineno-37-30></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-37-31><a id=__codelineno-37-31 name=__codelineno-37-31 href=#__codelineno-37-31></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-37-32><a id=__codelineno-37-32 name=__codelineno-37-32 href=#__codelineno-37-32></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-37-33><a id=__codelineno-37-33 name=__codelineno-37-33 href=#__codelineno-37-33></a><span class=w>    </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-37-34><a id=__codelineno-37-34 name=__codelineno-37-34 href=#__codelineno-37-34></a><span class=w>      </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-37-35><a id=__codelineno-37-35 name=__codelineno-37-35 href=#__codelineno-37-35></a><span class=w>      </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-37-36><a id=__codelineno-37-36 name=__codelineno-37-36 href=#__codelineno-37-36></a><span class=w>        </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;50m&quot;</span>
</span><span id=__span-37-37><a id=__codelineno-37-37 name=__codelineno-37-37 href=#__codelineno-37-37></a><span class=w>        </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2&quot;</span>
</span><span id=__span-37-38><a id=__codelineno-37-38 name=__codelineno-37-38 href=#__codelineno-37-38></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-37-39><a id=__codelineno-37-39 name=__codelineno-37-39 href=#__codelineno-37-39></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-37-40><a id=__codelineno-37-40 name=__codelineno-37-40 href=#__codelineno-37-40></a>
</span><span id=__span-37-41><a id=__codelineno-37-41 name=__codelineno-37-41 href=#__codelineno-37-41></a><span class="w w-Error">  </span><span class=nt>log-collector</span><span class=p>:</span>
</span><span id=__span-37-42><a id=__codelineno-37-42 name=__codelineno-37-42 href=#__codelineno-37-42></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluent/fluent-bit:latest</span>
</span><span id=__span-37-43><a id=__codelineno-37-43 name=__codelineno-37-43 href=#__codelineno-37-43></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-37-44><a id=__codelineno-37-44 name=__codelineno-37-44 href=#__codelineno-37-44></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
</span><span id=__span-37-45><a id=__codelineno-37-45 name=__codelineno-37-45 href=#__codelineno-37-45></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf</span>
</span><span id=__span-37-46><a id=__codelineno-37-46 name=__codelineno-37-46 href=#__codelineno-37-46></a><span class=w>    </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-37-47><a id=__codelineno-37-47 name=__codelineno-37-47 href=#__codelineno-37-47></a><span class=w>      </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-37-48><a id=__codelineno-37-48 name=__codelineno-37-48 href=#__codelineno-37-48></a>
</span><span id=__span-37-49><a id=__codelineno-37-49 name=__codelineno-37-49 href=#__codelineno-37-49></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-37-50><a id=__codelineno-37-50 name=__codelineno-37-50 href=#__codelineno-37-50></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class=c1># Start services</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=c1># View logs for specific service</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a>docker-compose<span class=w> </span>logs<span class=w> </span>web
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a>
</span><span id=__span-38-7><a id=__codelineno-38-7 name=__codelineno-38-7 href=#__codelineno-38-7></a><span class=c1># View logs with timestamps</span>
</span><span id=__span-38-8><a id=__codelineno-38-8 name=__codelineno-38-8 href=#__codelineno-38-8></a>docker-compose<span class=w> </span>logs<span class=w> </span>--timestamps<span class=w> </span>api
</span><span id=__span-38-9><a id=__codelineno-38-9 name=__codelineno-38-9 href=#__codelineno-38-9></a>
</span><span id=__span-38-10><a id=__codelineno-38-10 name=__codelineno-38-10 href=#__codelineno-38-10></a><span class=c1># Follow logs in real-time</span>
</span><span id=__span-38-11><a id=__codelineno-38-11 name=__codelineno-38-11 href=#__codelineno-38-11></a>docker-compose<span class=w> </span>logs<span class=w> </span>-f
</span><span id=__span-38-12><a id=__codelineno-38-12 name=__codelineno-38-12 href=#__codelineno-38-12></a>
</span><span id=__span-38-13><a id=__codelineno-38-13 name=__codelineno-38-13 href=#__codelineno-38-13></a><span class=c1># View logs for all services</span>
</span><span id=__span-38-14><a id=__codelineno-38-14 name=__codelineno-38-14 href=#__codelineno-38-14></a>docker-compose<span class=w> </span>logs
</span><span id=__span-38-15><a id=__codelineno-38-15 name=__codelineno-38-15 href=#__codelineno-38-15></a>
</span><span id=__span-38-16><a id=__codelineno-38-16 name=__codelineno-38-16 href=#__codelineno-38-16></a><span class=c1># Export logs to file</span>
</span><span id=__span-38-17><a id=__codelineno-38-17 name=__codelineno-38-17 href=#__codelineno-38-17></a>docker-compose<span class=w> </span>logs<span class=w> </span>&gt;<span class=w> </span>app_logs.txt
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>logging.driver</strong>: Specifies the logging driver (json-file, syslog, etc.)</li> <li><strong>max-size</strong>: Maximum size of log files before rotation</li> <li><strong>max-file</strong>: Maximum number of log files to keep</li> <li><strong>Log rotation</strong>: Automatic log file management</li> <li><strong>Centralized logging</strong>: Collect logs from multiple services</li> <li><strong>Log filtering</strong>: View logs by service or time range</li> </ul> </details> <hr> <h4 id=12-resource-limits>12. Resource Limits<a class=headerlink href=#12-resource-limits title="Permanent link">&para;</a></h4> <ul> <li> <p>Set CPU and memory limits for services to ensure fair resource allocation and prevent resource exhaustion.</p> <h4 id=scenario_11><strong>Scenario:</strong><a class=headerlink href=#scenario_11 title="Permanent link">&para;</a></h4> <ul> <li>Your application runs multiple services on shared infrastructure, and you need to ensure that no single service can consume all available resources and impact other services.</li> <li>Docker Compose resource limits allow you to control CPU and memory usage for each service.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>deploy.resources.limits</code> and <code>deploy.resources.reservations</code> for CPU and memory control</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-39-12><a id=__codelineno-39-12 name=__codelineno-39-12 href=#__codelineno-39-12></a><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span>
</span><span id=__span-39-13><a id=__codelineno-39-13 name=__codelineno-39-13 href=#__codelineno-39-13></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id=__span-39-14><a id=__codelineno-39-14 name=__codelineno-39-14 href=#__codelineno-39-14></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.25&#39;</span>
</span><span id=__span-39-15><a id=__codelineno-39-15 name=__codelineno-39-15 href=#__codelineno-39-15></a>
</span><span id=__span-39-16><a id=__codelineno-39-16 name=__codelineno-39-16 href=#__codelineno-39-16></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-39-17><a id=__codelineno-39-17 name=__codelineno-39-17 href=#__codelineno-39-17></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-39-18><a id=__codelineno-39-18 name=__codelineno-39-18 href=#__codelineno-39-18></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-39-19><a id=__codelineno-39-19 name=__codelineno-39-19 href=#__codelineno-39-19></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-39-20><a id=__codelineno-39-20 name=__codelineno-39-20 href=#__codelineno-39-20></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-39-21><a id=__codelineno-39-21 name=__codelineno-39-21 href=#__codelineno-39-21></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-39-22><a id=__codelineno-39-22 name=__codelineno-39-22 href=#__codelineno-39-22></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span><span id=__span-39-23><a id=__codelineno-39-23 name=__codelineno-39-23 href=#__codelineno-39-23></a><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span>
</span><span id=__span-39-24><a id=__codelineno-39-24 name=__codelineno-39-24 href=#__codelineno-39-24></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-39-25><a id=__codelineno-39-25 name=__codelineno-39-25 href=#__codelineno-39-25></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-39-26><a id=__codelineno-39-26 name=__codelineno-39-26 href=#__codelineno-39-26></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;</span>
</span><span id=__span-39-27><a id=__codelineno-39-27 name=__codelineno-39-27 href=#__codelineno-39-27></a><span class="l l-Scalar l-Scalar-Plain">while true; do</span>
</span><span id=__span-39-28><a id=__codelineno-39-28 name=__codelineno-39-28 href=#__codelineno-39-28></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">mem=\$(free | grep Mem | awk &#39;{printf \&quot;%.0f\&quot;, \$3/\$2 * 100.0}&#39;)</span>
</span><span id=__span-39-29><a id=__codelineno-39-29 name=__codelineno-39-29 href=#__codelineno-39-29></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">cpu=\$(top -bn1 | grep &#39;Cpu(s)&#39; | sed &#39;s/.*, *\([0-9.]*\)%* id.*/\1/&#39; | awk &#39;{print 100 - \$1}&#39;)</span>
</span><span id=__span-39-30><a id=__codelineno-39-30 name=__codelineno-39-30 href=#__codelineno-39-30></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">echo \&quot;Memory</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">\${mem}%, CPU</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">\${cpu}%\&quot;</span>
</span><span id=__span-39-31><a id=__codelineno-39-31 name=__codelineno-39-31 href=#__codelineno-39-31></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">sleep 10</span>
</span><span id=__span-39-32><a id=__codelineno-39-32 name=__codelineno-39-32 href=#__codelineno-39-32></a><span class="l l-Scalar l-Scalar-Plain">done&quot;</span>
</span><span id=__span-39-33><a id=__codelineno-39-33 name=__codelineno-39-33 href=#__codelineno-39-33></a>
</span><span id=__span-39-34><a id=__codelineno-39-34 name=__codelineno-39-34 href=#__codelineno-39-34></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
</span><span id=__span-39-35><a id=__codelineno-39-35 name=__codelineno-39-35 href=#__codelineno-39-35></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-39-36><a id=__codelineno-39-36 name=__codelineno-39-36 href=#__codelineno-39-36></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-39-37><a id=__codelineno-39-37 name=__codelineno-39-37 href=#__codelineno-39-37></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-39-38><a id=__codelineno-39-38 name=__codelineno-39-38 href=#__codelineno-39-38></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-39-39><a id=__codelineno-39-39 name=__codelineno-39-39 href=#__codelineno-39-39></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-39-40><a id=__codelineno-39-40 name=__codelineno-39-40 href=#__codelineno-39-40></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-39-41><a id=__codelineno-39-41 name=__codelineno-39-41 href=#__codelineno-39-41></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-39-42><a id=__codelineno-39-42 name=__codelineno-39-42 href=#__codelineno-39-42></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-39-43><a id=__codelineno-39-43 name=__codelineno-39-43 href=#__codelineno-39-43></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-39-44><a id=__codelineno-39-44 name=__codelineno-39-44 href=#__codelineno-39-44></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;2.0&#39;</span>
</span><span id=__span-39-45><a id=__codelineno-39-45 name=__codelineno-39-45 href=#__codelineno-39-45></a><span class=w>        </span><span class=nt>reservations</span><span class=p>:</span>
</span><span id=__span-39-46><a id=__codelineno-39-46 name=__codelineno-39-46 href=#__codelineno-39-46></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-39-47><a id=__codelineno-39-47 name=__codelineno-39-47 href=#__codelineno-39-47></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span><span id=__span-39-48><a id=__codelineno-39-48 name=__codelineno-39-48 href=#__codelineno-39-48></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-39-49><a id=__codelineno-39-49 name=__codelineno-39-49 href=#__codelineno-39-49></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-39-50><a id=__codelineno-39-50 name=__codelineno-39-50 href=#__codelineno-39-50></a>
</span><span id=__span-39-51><a id=__codelineno-39-51 name=__codelineno-39-51 href=#__codelineno-39-51></a><span class="w w-Error">  </span><span class=nt>monitoring</span><span class=p>:</span>
</span><span id=__span-39-52><a id=__codelineno-39-52 name=__codelineno-39-52 href=#__codelineno-39-52></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id=__span-39-53><a id=__codelineno-39-53 name=__codelineno-39-53 href=#__codelineno-39-53></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-39-54><a id=__codelineno-39-54 name=__codelineno-39-54 href=#__codelineno-39-54></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9090:9090&quot;</span>
</span><span id=__span-39-55><a id=__codelineno-39-55 name=__codelineno-39-55 href=#__codelineno-39-55></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-39-56><a id=__codelineno-39-56 name=__codelineno-39-56 href=#__codelineno-39-56></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml</span>
</span><span id=__span-39-57><a id=__codelineno-39-57 name=__codelineno-39-57 href=#__codelineno-39-57></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-39-58><a id=__codelineno-39-58 name=__codelineno-39-58 href=#__codelineno-39-58></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-39-59><a id=__codelineno-39-59 name=__codelineno-39-59 href=#__codelineno-39-59></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-39-60><a id=__codelineno-39-60 name=__codelineno-39-60 href=#__codelineno-39-60></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-39-61><a id=__codelineno-39-61 name=__codelineno-39-61 href=#__codelineno-39-61></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.25&#39;</span>
</span><span id=__span-39-62><a id=__codelineno-39-62 name=__codelineno-39-62 href=#__codelineno-39-62></a>
</span><span id=__span-39-63><a id=__codelineno-39-63 name=__codelineno-39-63 href=#__codelineno-39-63></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-39-64><a id=__codelineno-39-64 name=__codelineno-39-64 href=#__codelineno-39-64></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># Start services with resource limits</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=c1># Check resource usage</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>docker<span class=w> </span>stats
</span><span id=__span-40-6><a id=__codelineno-40-6 name=__codelineno-40-6 href=#__codelineno-40-6></a>
</span><span id=__span-40-7><a id=__codelineno-40-7 name=__codelineno-40-7 href=#__codelineno-40-7></a><span class=c1># View resource limits</span>
</span><span id=__span-40-8><a id=__codelineno-40-8 name=__codelineno-40-8 href=#__codelineno-40-8></a>docker-compose<span class=w> </span>ps
</span><span id=__span-40-9><a id=__codelineno-40-9 name=__codelineno-40-9 href=#__codelineno-40-9></a>
</span><span id=__span-40-10><a id=__codelineno-40-10 name=__codelineno-40-10 href=#__codelineno-40-10></a><span class=c1># Monitor specific container</span>
</span><span id=__span-40-11><a id=__codelineno-40-11 name=__codelineno-40-11 href=#__codelineno-40-11></a>docker<span class=w> </span>stats<span class=w> </span><span class=k>$(</span>docker-compose<span class=w> </span>ps<span class=w> </span>-q<span class=w> </span>api<span class=k>)</span>
</span><span id=__span-40-12><a id=__codelineno-40-12 name=__codelineno-40-12 href=#__codelineno-40-12></a>
</span><span id=__span-40-13><a id=__codelineno-40-13 name=__codelineno-40-13 href=#__codelineno-40-13></a><span class=c1># Check if limits are enforced (try to consume more memory)</span>
</span><span id=__span-40-14><a id=__codelineno-40-14 name=__codelineno-40-14 href=#__codelineno-40-14></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>api<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s2>&quot;</span>
</span><span id=__span-40-15><a id=__codelineno-40-15 name=__codelineno-40-15 href=#__codelineno-40-15></a><span class=s2>data=&#39;&#39;</span>
</span><span id=__span-40-16><a id=__codelineno-40-16 name=__codelineno-40-16 href=#__codelineno-40-16></a><span class=s2>while true; do</span>
</span><span id=__span-40-17><a id=__codelineno-40-17 name=__codelineno-40-17 href=#__codelineno-40-17></a><span class=s2>  data=\&quot;\$data\$data\&quot;</span>
</span><span id=__span-40-18><a id=__codelineno-40-18 name=__codelineno-40-18 href=#__codelineno-40-18></a><span class=s2>  sleep 0.1</span>
</span><span id=__span-40-19><a id=__codelineno-40-19 name=__codelineno-40-19 href=#__codelineno-40-19></a><span class=s2>done&quot;</span>
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>limits</strong>: Hard limits that containers cannot exceed</li> <li><strong>reservations</strong>: Guaranteed minimum resources</li> <li><strong>memory</strong>: RAM limits (supports m, g suffixes)</li> <li><strong>cpus</strong>: CPU core limits (supports decimal values)</li> <li><strong>Resource enforcement</strong>: Docker prevents exceeding limits</li> <li><strong>Monitoring</strong>: Track resource usage with docker stats</li> </ul> </details> <hr> <h4 id=13-profiles-and-selective-services>13. Profiles and Selective Services<a class=headerlink href=#13-profiles-and-selective-services title="Permanent link">&para;</a></h4> <ul> <li> <p>Use profiles to run different combinations of services for development, testing, and production.</p> <h4 id=scenario_12><strong>Scenario:</strong><a class=headerlink href=#scenario_12 title="Permanent link">&para;</a></h4> <ul> <li>Your application has services that are only needed in certain environments - debugging tools for development, testing services for CI/CD, and monitoring services for production.</li> <li>Docker Compose profiles allow you to define which services run in different scenarios without modifying the compose file.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>profiles</code> to group services and <code>--profile</code> flag to run specific combinations</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-41-9><a id=__codelineno-41-9 name=__codelineno-41-9 href=#__codelineno-41-9></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-41-10><a id=__codelineno-41-10 name=__codelineno-41-10 href=#__codelineno-41-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id=__span-41-11><a id=__codelineno-41-11 name=__codelineno-41-11 href=#__codelineno-41-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
</span><span id=__span-41-12><a id=__codelineno-41-12 name=__codelineno-41-12 href=#__codelineno-41-12></a>
</span><span id=__span-41-13><a id=__codelineno-41-13 name=__codelineno-41-13 href=#__codelineno-41-13></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-41-14><a id=__codelineno-41-14 name=__codelineno-41-14 href=#__codelineno-41-14></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-41-15><a id=__codelineno-41-15 name=__codelineno-41-15 href=#__codelineno-41-15></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-41-16><a id=__codelineno-41-16 name=__codelineno-41-16 href=#__codelineno-41-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-41-17><a id=__codelineno-41-17 name=__codelineno-41-17 href=#__codelineno-41-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
</span><span id=__span-41-18><a id=__codelineno-41-18 name=__codelineno-41-18 href=#__codelineno-41-18></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;API Response&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 8000 -h /tmp&#39;</span>
</span><span id=__span-41-19><a id=__codelineno-41-19 name=__codelineno-41-19 href=#__codelineno-41-19></a>
</span><span id=__span-41-20><a id=__codelineno-41-20 name=__codelineno-41-20 href=#__codelineno-41-20></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-41-21><a id=__codelineno-41-21 name=__codelineno-41-21 href=#__codelineno-41-21></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-41-22><a id=__codelineno-41-22 name=__codelineno-41-22 href=#__codelineno-41-22></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-41-23><a id=__codelineno-41-23 name=__codelineno-41-23 href=#__codelineno-41-23></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-41-24><a id=__codelineno-41-24 name=__codelineno-41-24 href=#__codelineno-41-24></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-41-25><a id=__codelineno-41-25 name=__codelineno-41-25 href=#__codelineno-41-25></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-41-26><a id=__codelineno-41-26 name=__codelineno-41-26 href=#__codelineno-41-26></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-41-27><a id=__codelineno-41-27 name=__codelineno-41-27 href=#__codelineno-41-27></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id=__span-41-28><a id=__codelineno-41-28 name=__codelineno-41-28 href=#__codelineno-41-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
</span><span id=__span-41-29><a id=__codelineno-41-29 name=__codelineno-41-29 href=#__codelineno-41-29></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-41-30><a id=__codelineno-41-30 name=__codelineno-41-30 href=#__codelineno-41-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-41-31><a id=__codelineno-41-31 name=__codelineno-41-31 href=#__codelineno-41-31></a>
</span><span id=__span-41-32><a id=__codelineno-41-32 name=__codelineno-41-32 href=#__codelineno-41-32></a><span class=w>  </span><span class=nt>debug</span><span class=p>:</span>
</span><span id=__span-41-33><a id=__codelineno-41-33 name=__codelineno-41-33 href=#__codelineno-41-33></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-41-34><a id=__codelineno-41-34 name=__codelineno-41-34 href=#__codelineno-41-34></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-41-35><a id=__codelineno-41-35 name=__codelineno-41-35 href=#__codelineno-41-35></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">debug</span>
</span><span id=__span-41-36><a id=__codelineno-41-36 name=__codelineno-41-36 href=#__codelineno-41-36></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">tail -f /dev/null</span>
</span><span id=__span-41-37><a id=__codelineno-41-37 name=__codelineno-41-37 href=#__codelineno-41-37></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-41-38><a id=__codelineno-41-38 name=__codelineno-41-38 href=#__codelineno-41-38></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
</span><span id=__span-41-39><a id=__codelineno-41-39 name=__codelineno-41-39 href=#__codelineno-41-39></a>
</span><span id=__span-41-40><a id=__codelineno-41-40 name=__codelineno-41-40 href=#__codelineno-41-40></a><span class=w>  </span><span class=nt>test</span><span class=p>:</span>
</span><span id=__span-41-41><a id=__codelineno-41-41 name=__codelineno-41-41 href=#__codelineno-41-41></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python:3.9-alpine</span>
</span><span id=__span-41-42><a id=__codelineno-41-42 name=__codelineno-41-42 href=#__codelineno-41-42></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-41-43><a id=__codelineno-41-43 name=__codelineno-41-43 href=#__codelineno-41-43></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id=__span-41-44><a id=__codelineno-41-44 name=__codelineno-41-44 href=#__codelineno-41-44></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python -m pytest /app/tests/</span>
</span><span id=__span-41-45><a id=__codelineno-41-45 name=__codelineno-41-45 href=#__codelineno-41-45></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-41-46><a id=__codelineno-41-46 name=__codelineno-41-46 href=#__codelineno-41-46></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
</span><span id=__span-41-47><a id=__codelineno-41-47 name=__codelineno-41-47 href=#__codelineno-41-47></a>
</span><span id=__span-41-48><a id=__codelineno-41-48 name=__codelineno-41-48 href=#__codelineno-41-48></a><span class=w>  </span><span class=nt>monitoring</span><span class=p>:</span>
</span><span id=__span-41-49><a id=__codelineno-41-49 name=__codelineno-41-49 href=#__codelineno-41-49></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id=__span-41-50><a id=__codelineno-41-50 name=__codelineno-41-50 href=#__codelineno-41-50></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-41-51><a id=__codelineno-41-51 name=__codelineno-41-51 href=#__codelineno-41-51></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9090:9090&quot;</span>
</span><span id=__span-41-52><a id=__codelineno-41-52 name=__codelineno-41-52 href=#__codelineno-41-52></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-41-53><a id=__codelineno-41-53 name=__codelineno-41-53 href=#__codelineno-41-53></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id=__span-41-54><a id=__codelineno-41-54 name=__codelineno-41-54 href=#__codelineno-41-54></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-41-55><a id=__codelineno-41-55 name=__codelineno-41-55 href=#__codelineno-41-55></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-41-56><a id=__codelineno-41-56 name=__codelineno-41-56 href=#__codelineno-41-56></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml</span>
</span><span id=__span-41-57><a id=__codelineno-41-57 name=__codelineno-41-57 href=#__codelineno-41-57></a>
</span><span id=__span-41-58><a id=__codelineno-41-58 name=__codelineno-41-58 href=#__codelineno-41-58></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-41-59><a id=__codelineno-41-59 name=__codelineno-41-59 href=#__codelineno-41-59></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1># Run only web service</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>docker-compose<span class=w> </span>--profile<span class=w> </span>web<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=c1># Run web with database</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>docker-compose<span class=w> </span>--profile<span class=w> </span>web<span class=w> </span>--profile<span class=w> </span>database<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=c1># Run full application stack</span>
</span><span id=__span-42-8><a id=__codelineno-42-8 name=__codelineno-42-8 href=#__codelineno-42-8></a>docker-compose<span class=w> </span>--profile<span class=w> </span>full<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-42-9><a id=__codelineno-42-9 name=__codelineno-42-9 href=#__codelineno-42-9></a>
</span><span id=__span-42-10><a id=__codelineno-42-10 name=__codelineno-42-10 href=#__codelineno-42-10></a><span class=c1># Run tests</span>
</span><span id=__span-42-11><a id=__codelineno-42-11 name=__codelineno-42-11 href=#__codelineno-42-11></a>docker-compose<span class=w> </span>--profile<span class=w> </span><span class=nb>test</span><span class=w> </span>up
</span><span id=__span-42-12><a id=__codelineno-42-12 name=__codelineno-42-12 href=#__codelineno-42-12></a>
</span><span id=__span-42-13><a id=__codelineno-42-13 name=__codelineno-42-13 href=#__codelineno-42-13></a><span class=c1># Development with debug tools</span>
</span><span id=__span-42-14><a id=__codelineno-42-14 name=__codelineno-42-14 href=#__codelineno-42-14></a>docker-compose<span class=w> </span>--profile<span class=w> </span>full<span class=w> </span>--profile<span class=w> </span>debug<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-42-15><a id=__codelineno-42-15 name=__codelineno-42-15 href=#__codelineno-42-15></a>
</span><span id=__span-42-16><a id=__codelineno-42-16 name=__codelineno-42-16 href=#__codelineno-42-16></a><span class=c1># Production with monitoring</span>
</span><span id=__span-42-17><a id=__codelineno-42-17 name=__codelineno-42-17 href=#__codelineno-42-17></a>docker-compose<span class=w> </span>--profile<span class=w> </span>full<span class=w> </span>--profile<span class=w> </span>production<span class=w> </span>up<span class=w> </span>-d
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>profiles</strong>: Assign services to specific profiles</li> <li><strong>&ndash;profile</strong>: Activate specific profiles when running</li> <li><strong>Service grouping</strong>: Logical grouping of related services</li> <li><strong>Environment-specific</strong>: Different service combinations per environment</li> <li><strong>Selective deployment</strong>: Run only needed services for each use case</li> </ul> </details> <hr> <h4 id=14-external-networks>14. External Networks<a class=headerlink href=#14-external-networks title="Permanent link">&para;</a></h4> <ul> <li> <p>Connect Docker Compose services to existing external networks for integration with other applications.</p> <h4 id=scenario_13><strong>Scenario:</strong><a class=headerlink href=#scenario_13 title="Permanent link">&para;</a></h4> <ul> <li>Your application needs to communicate with services running outside of Docker Compose, such as a company-wide database or legacy applications.</li> <li>Docker Compose external networks allow services to connect to pre-existing Docker networks.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>external: true</code> and <code>name</code> to connect to existing Docker networks</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-43-8><a id=__codelineno-43-8 name=__codelineno-43-8 href=#__codelineno-43-8></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span><span id=__span-43-9><a id=__codelineno-43-9 name=__codelineno-43-9 href=#__codelineno-43-9></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">external-network</span>
</span><span id=__span-43-10><a id=__codelineno-43-10 name=__codelineno-43-10 href=#__codelineno-43-10></a>
</span><span id=__span-43-11><a id=__codelineno-43-11 name=__codelineno-43-11 href=#__codelineno-43-11></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-43-12><a id=__codelineno-43-12 name=__codelineno-43-12 href=#__codelineno-43-12></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-43-13><a id=__codelineno-43-13 name=__codelineno-43-13 href=#__codelineno-43-13></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-43-14><a id=__codelineno-43-14 name=__codelineno-43-14 href=#__codelineno-43-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span><span id=__span-43-15><a id=__codelineno-43-15 name=__codelineno-43-15 href=#__codelineno-43-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">external-network</span>
</span><span id=__span-43-16><a id=__codelineno-43-16 name=__codelineno-43-16 href=#__codelineno-43-16></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;busybox httpd -f -p 8000 -h /tmp&quot;</span>
</span><span id=__span-43-17><a id=__codelineno-43-17 name=__codelineno-43-17 href=#__codelineno-43-17></a>
</span><span id=__span-43-18><a id=__codelineno-43-18 name=__codelineno-43-18 href=#__codelineno-43-18></a><span class=w>  </span><span class=nt>legacy-connector</span><span class=p>:</span>
</span><span id=__span-43-19><a id=__codelineno-43-19 name=__codelineno-43-19 href=#__codelineno-43-19></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-43-20><a id=__codelineno-43-20 name=__codelineno-43-20 href=#__codelineno-43-20></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-43-21><a id=__codelineno-43-21 name=__codelineno-43-21 href=#__codelineno-43-21></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">external-network</span>
</span><span id=__span-43-22><a id=__codelineno-43-22 name=__codelineno-43-22 href=#__codelineno-43-22></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ping -c 4 legacy-service</span>
</span><span id=__span-43-23><a id=__codelineno-43-23 name=__codelineno-43-23 href=#__codelineno-43-23></a>
</span><span id=__span-43-24><a id=__codelineno-43-24 name=__codelineno-43-24 href=#__codelineno-43-24></a><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-43-25><a id=__codelineno-43-25 name=__codelineno-43-25 href=#__codelineno-43-25></a><span class=w>  </span><span class=nt>app-network</span><span class=p>:</span>
</span><span id=__span-43-26><a id=__codelineno-43-26 name=__codelineno-43-26 href=#__codelineno-43-26></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-43-27><a id=__codelineno-43-27 name=__codelineno-43-27 href=#__codelineno-43-27></a><span class=w>  </span><span class=nt>external-network</span><span class=p>:</span>
</span><span id=__span-43-28><a id=__codelineno-43-28 name=__codelineno-43-28 href=#__codelineno-43-28></a><span class=w>    </span><span class=nt>external</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-43-29><a id=__codelineno-43-29 name=__codelineno-43-29 href=#__codelineno-43-29></a><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">company-network</span>
</span></code></pre></div></p> <p><strong>Setup Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># Create external network (if not exists)</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>docker<span class=w> </span>network<span class=w> </span>create<span class=w> </span>company-network
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=c1># Start external service</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>docker<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>--name<span class=w> </span>legacy-service<span class=w> </span>--network<span class=w> </span>company-network<span class=w> </span>alpine<span class=w> </span>sleep<span class=w> </span>infinity
</span><span id=__span-44-6><a id=__codelineno-44-6 name=__codelineno-44-6 href=#__codelineno-44-6></a>
</span><span id=__span-44-7><a id=__codelineno-44-7 name=__codelineno-44-7 href=#__codelineno-44-7></a><span class=c1># Start compose services</span>
</span><span id=__span-44-8><a id=__codelineno-44-8 name=__codelineno-44-8 href=#__codelineno-44-8></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-44-9><a id=__codelineno-44-9 name=__codelineno-44-9 href=#__codelineno-44-9></a>
</span><span id=__span-44-10><a id=__codelineno-44-10 name=__codelineno-44-10 href=#__codelineno-44-10></a><span class=c1># Test connectivity</span>
</span><span id=__span-44-11><a id=__codelineno-44-11 name=__codelineno-44-11 href=#__codelineno-44-11></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>legacy-connector<span class=w> </span>ping<span class=w> </span>-c<span class=w> </span><span class=m>2</span><span class=w> </span>legacy-service
</span><span id=__span-44-12><a id=__codelineno-44-12 name=__codelineno-44-12 href=#__codelineno-44-12></a>
</span><span id=__span-44-13><a id=__codelineno-44-13 name=__codelineno-44-13 href=#__codelineno-44-13></a><span class=c1># Check networks</span>
</span><span id=__span-44-14><a id=__codelineno-44-14 name=__codelineno-44-14 href=#__codelineno-44-14></a>docker<span class=w> </span>network<span class=w> </span>ls
</span><span id=__span-44-15><a id=__codelineno-44-15 name=__codelineno-44-15 href=#__codelineno-44-15></a>docker<span class=w> </span>network<span class=w> </span>inspect<span class=w> </span>company-network
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>external: true</strong>: Connect to existing Docker network</li> <li><strong>name</strong>: Specify the exact network name</li> <li><strong>Network sharing</strong>: Services can communicate across compose files</li> <li><strong>Legacy integration</strong>: Connect to existing infrastructure</li> <li><strong>Network isolation</strong>: Control which services access external networks</li> </ul> </details> <hr> <h4 id=15-custom-networks>15. Custom Networks<a class=headerlink href=#15-custom-networks title="Permanent link">&para;</a></h4> <ul> <li> <p>Create custom networks with specific configurations for advanced networking requirements.</p> <h4 id=scenario_14><strong>Scenario:</strong><a class=headerlink href=#scenario_14 title="Permanent link">&para;</a></h4> <ul> <li>Your application requires specific network configurations like custom subnets, IP ranges, or network drivers for security, performance, or compliance reasons.</li> <li>Docker Compose custom networks allow you to define network properties like IP ranges, subnets, and drivers.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>ipam.config</code> to define custom subnets and <code>ipv4_address</code> for static IP assignment</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-45-6><a id=__codelineno-45-6 name=__codelineno-45-6 href=#__codelineno-45-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-45-7><a id=__codelineno-45-7 name=__codelineno-45-7 href=#__codelineno-45-7></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-45-8><a id=__codelineno-45-8 name=__codelineno-45-8 href=#__codelineno-45-8></a><span class=w>      </span><span class=nt>frontend</span><span class=p>:</span>
</span><span id=__span-45-9><a id=__codelineno-45-9 name=__codelineno-45-9 href=#__codelineno-45-9></a><span class=w>        </span><span class=nt>ipv4_address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.10</span>
</span><span id=__span-45-10><a id=__codelineno-45-10 name=__codelineno-45-10 href=#__codelineno-45-10></a>
</span><span id=__span-45-11><a id=__codelineno-45-11 name=__codelineno-45-11 href=#__codelineno-45-11></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-45-12><a id=__codelineno-45-12 name=__codelineno-45-12 href=#__codelineno-45-12></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-45-13><a id=__codelineno-45-13 name=__codelineno-45-13 href=#__codelineno-45-13></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-45-14><a id=__codelineno-45-14 name=__codelineno-45-14 href=#__codelineno-45-14></a><span class=w>      </span><span class=nt>frontend</span><span class=p>:</span>
</span><span id=__span-45-15><a id=__codelineno-45-15 name=__codelineno-45-15 href=#__codelineno-45-15></a><span class=w>        </span><span class=nt>ipv4_address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.11</span>
</span><span id=__span-45-16><a id=__codelineno-45-16 name=__codelineno-45-16 href=#__codelineno-45-16></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span>
</span><span id=__span-45-17><a id=__codelineno-45-17 name=__codelineno-45-17 href=#__codelineno-45-17></a><span class=w>        </span><span class=nt>ipv4_address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.10</span>
</span><span id=__span-45-18><a id=__codelineno-45-18 name=__codelineno-45-18 href=#__codelineno-45-18></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;busybox httpd -f -p 8000 -h /tmp&quot;</span>
</span><span id=__span-45-19><a id=__codelineno-45-19 name=__codelineno-45-19 href=#__codelineno-45-19></a>
</span><span id=__span-45-20><a id=__codelineno-45-20 name=__codelineno-45-20 href=#__codelineno-45-20></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-45-21><a id=__codelineno-45-21 name=__codelineno-45-21 href=#__codelineno-45-21></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-45-22><a id=__codelineno-45-22 name=__codelineno-45-22 href=#__codelineno-45-22></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-45-23><a id=__codelineno-45-23 name=__codelineno-45-23 href=#__codelineno-45-23></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-45-24><a id=__codelineno-45-24 name=__codelineno-45-24 href=#__codelineno-45-24></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-45-25><a id=__codelineno-45-25 name=__codelineno-45-25 href=#__codelineno-45-25></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-45-26><a id=__codelineno-45-26 name=__codelineno-45-26 href=#__codelineno-45-26></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-45-27><a id=__codelineno-45-27 name=__codelineno-45-27 href=#__codelineno-45-27></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span>
</span><span id=__span-45-28><a id=__codelineno-45-28 name=__codelineno-45-28 href=#__codelineno-45-28></a><span class=w>        </span><span class=nt>ipv4_address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.11</span>
</span><span id=__span-45-29><a id=__codelineno-45-29 name=__codelineno-45-29 href=#__codelineno-45-29></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-45-30><a id=__codelineno-45-30 name=__codelineno-45-30 href=#__codelineno-45-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-45-31><a id=__codelineno-45-31 name=__codelineno-45-31 href=#__codelineno-45-31></a>
</span><span id=__span-45-32><a id=__codelineno-45-32 name=__codelineno-45-32 href=#__codelineno-45-32></a><span class=w>  </span><span class=nt>monitoring</span><span class=p>:</span>
</span><span id=__span-45-33><a id=__codelineno-45-33 name=__codelineno-45-33 href=#__codelineno-45-33></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-45-34><a id=__codelineno-45-34 name=__codelineno-45-34 href=#__codelineno-45-34></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-45-35><a id=__codelineno-45-35 name=__codelineno-45-35 href=#__codelineno-45-35></a><span class=w>      </span><span class=nt>frontend</span><span class=p>:</span>
</span><span id=__span-45-36><a id=__codelineno-45-36 name=__codelineno-45-36 href=#__codelineno-45-36></a><span class=w>        </span><span class=nt>ipv4_address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.12</span>
</span><span id=__span-45-37><a id=__codelineno-45-37 name=__codelineno-45-37 href=#__codelineno-45-37></a><span class=w>      </span><span class=nt>backend</span><span class=p>:</span>
</span><span id=__span-45-38><a id=__codelineno-45-38 name=__codelineno-45-38 href=#__codelineno-45-38></a><span class=w>        </span><span class=nt>ipv4_address</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.12</span>
</span><span id=__span-45-39><a id=__codelineno-45-39 name=__codelineno-45-39 href=#__codelineno-45-39></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">watch -n 5 &#39;echo &quot;Monitoring networks&quot;&#39;</span>
</span><span id=__span-45-40><a id=__codelineno-45-40 name=__codelineno-45-40 href=#__codelineno-45-40></a>
</span><span id=__span-45-41><a id=__codelineno-45-41 name=__codelineno-45-41 href=#__codelineno-45-41></a><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-45-42><a id=__codelineno-45-42 name=__codelineno-45-42 href=#__codelineno-45-42></a><span class=w>  </span><span class=nt>frontend</span><span class=p>:</span>
</span><span id=__span-45-43><a id=__codelineno-45-43 name=__codelineno-45-43 href=#__codelineno-45-43></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-45-44><a id=__codelineno-45-44 name=__codelineno-45-44 href=#__codelineno-45-44></a><span class=w>    </span><span class=nt>ipam</span><span class=p>:</span>
</span><span id=__span-45-45><a id=__codelineno-45-45 name=__codelineno-45-45 href=#__codelineno-45-45></a><span class=w>      </span><span class=nt>config</span><span class=p>:</span>
</span><span id=__span-45-46><a id=__codelineno-45-46 name=__codelineno-45-46 href=#__codelineno-45-46></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>subnet</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.0/16</span>
</span><span id=__span-45-47><a id=__codelineno-45-47 name=__codelineno-45-47 href=#__codelineno-45-47></a><span class=w>          </span><span class=nt>gateway</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.1</span>
</span><span id=__span-45-48><a id=__codelineno-45-48 name=__codelineno-45-48 href=#__codelineno-45-48></a><span class=w>  </span><span class=nt>backend</span><span class=p>:</span>
</span><span id=__span-45-49><a id=__codelineno-45-49 name=__codelineno-45-49 href=#__codelineno-45-49></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-45-50><a id=__codelineno-45-50 name=__codelineno-45-50 href=#__codelineno-45-50></a><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-45-51><a id=__codelineno-45-51 name=__codelineno-45-51 href=#__codelineno-45-51></a><span class=w>    </span><span class=nt>ipam</span><span class=p>:</span>
</span><span id=__span-45-52><a id=__codelineno-45-52 name=__codelineno-45-52 href=#__codelineno-45-52></a><span class=w>      </span><span class=nt>config</span><span class=p>:</span>
</span><span id=__span-45-53><a id=__codelineno-45-53 name=__codelineno-45-53 href=#__codelineno-45-53></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>subnet</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.0/16</span>
</span><span id=__span-45-54><a id=__codelineno-45-54 name=__codelineno-45-54 href=#__codelineno-45-54></a><span class=w>          </span><span class=nt>gateway</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.1</span>
</span><span id=__span-45-55><a id=__codelineno-45-55 name=__codelineno-45-55 href=#__codelineno-45-55></a>
</span><span id=__span-45-56><a id=__codelineno-45-56 name=__codelineno-45-56 href=#__codelineno-45-56></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-45-57><a id=__codelineno-45-57 name=__codelineno-45-57 href=#__codelineno-45-57></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-46-1><a id=__codelineno-46-1 name=__codelineno-46-1 href=#__codelineno-46-1></a><span class=c1># Start services with custom networks</span>
</span><span id=__span-46-2><a id=__codelineno-46-2 name=__codelineno-46-2 href=#__codelineno-46-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-46-3><a id=__codelineno-46-3 name=__codelineno-46-3 href=#__codelineno-46-3></a>
</span><span id=__span-46-4><a id=__codelineno-46-4 name=__codelineno-46-4 href=#__codelineno-46-4></a><span class=c1># Check network configurations</span>
</span><span id=__span-46-5><a id=__codelineno-46-5 name=__codelineno-46-5 href=#__codelineno-46-5></a>docker<span class=w> </span>network<span class=w> </span>ls
</span><span id=__span-46-6><a id=__codelineno-46-6 name=__codelineno-46-6 href=#__codelineno-46-6></a>docker<span class=w> </span>network<span class=w> </span>inspect<span class=w> </span><span class=k>$(</span>docker-compose<span class=w> </span>ps<span class=w> </span>-q<span class=w> </span>web<span class=w> </span><span class=p>|</span><span class=w> </span>xargs<span class=w> </span>docker<span class=w> </span>inspect<span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span>-r<span class=w> </span><span class=s1>&#39;.[0].NetworkSettings.Networks | keys[]&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-1<span class=k>)</span>
</span><span id=__span-46-7><a id=__codelineno-46-7 name=__codelineno-46-7 href=#__codelineno-46-7></a>
</span><span id=__span-46-8><a id=__codelineno-46-8 name=__codelineno-46-8 href=#__codelineno-46-8></a><span class=c1># Test connectivity</span>
</span><span id=__span-46-9><a id=__codelineno-46-9 name=__codelineno-46-9 href=#__codelineno-46-9></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>ping<span class=w> </span>-c<span class=w> </span><span class=m>2</span><span class=w> </span><span class=m>172</span>.20.0.11
</span><span id=__span-46-10><a id=__codelineno-46-10 name=__codelineno-46-10 href=#__codelineno-46-10></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>api<span class=w> </span>ping<span class=w> </span>-c<span class=w> </span><span class=m>2</span><span class=w> </span><span class=m>172</span>.21.0.11
</span><span id=__span-46-11><a id=__codelineno-46-11 name=__codelineno-46-11 href=#__codelineno-46-11></a>
</span><span id=__span-46-12><a id=__codelineno-46-12 name=__codelineno-46-12 href=#__codelineno-46-12></a><span class=c1># Check IP assignments</span>
</span><span id=__span-46-13><a id=__codelineno-46-13 name=__codelineno-46-13 href=#__codelineno-46-13></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>ip<span class=w> </span>addr<span class=w> </span>show<span class=w> </span>eth0
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>ipam.config</strong>: Define custom IP address management</li> <li><strong>subnet</strong>: IP address range for the network</li> <li><strong>ipv4_address</strong>: Assign static IP to specific services</li> <li><strong>internal: true</strong>: Prevent external access to backend network</li> <li><strong>Network segmentation</strong>: Separate frontend and backend traffic</li> <li><strong>IP predictability</strong>: Static IPs for consistent service communication</li> </ul> </details> <hr> <h4 id=16-load-balancing>16. Load Balancing<a class=headerlink href=#16-load-balancing title="Permanent link">&para;</a></h4> <ul> <li> <p>Implement load balancing across multiple service instances for high availability and scalability.</p> <h4 id=scenario_15><strong>Scenario:</strong><a class=headerlink href=#scenario_15 title="Permanent link">&para;</a></h4> <ul> <li>Your application needs to handle high traffic loads and provide fault tolerance by distributing requests across multiple service instances.</li> <li>Docker Compose load balancing works with service scaling to automatically distribute traffic across healthy instances.</li> </ul> <h4 id=resources_6>Resources:<a class=headerlink href=#resources_6 title="Permanent link">&para;</a></h4> <ul> <li><code>nginx/loadbalancer.conf</code> ➤ <code>/etc/nginx/nginx.conf</code> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-47-1><a id=__codelineno-47-1 name=__codelineno-47-1 href=#__codelineno-47-1></a><span class=k>events</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-2><a id=__codelineno-47-2 name=__codelineno-47-2 href=#__codelineno-47-2></a><span class=w>    </span><span class=kn>worker_connections</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-47-3><a id=__codelineno-47-3 name=__codelineno-47-3 href=#__codelineno-47-3></a><span class=p>}</span>
</span><span id=__span-47-4><a id=__codelineno-47-4 name=__codelineno-47-4 href=#__codelineno-47-4></a>
</span><span id=__span-47-5><a id=__codelineno-47-5 name=__codelineno-47-5 href=#__codelineno-47-5></a><span class=k>http</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-6><a id=__codelineno-47-6 name=__codelineno-47-6 href=#__codelineno-47-6></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>web_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-7><a id=__codelineno-47-7 name=__codelineno-47-7 href=#__codelineno-47-7></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>web</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-47-8><a id=__codelineno-47-8 name=__codelineno-47-8 href=#__codelineno-47-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-47-9><a id=__codelineno-47-9 name=__codelineno-47-9 href=#__codelineno-47-9></a>
</span><span id=__span-47-10><a id=__codelineno-47-10 name=__codelineno-47-10 href=#__codelineno-47-10></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>api_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-11><a id=__codelineno-47-11 name=__codelineno-47-11 href=#__codelineno-47-11></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api</span><span class=p>:</span><span class=mi>8000</span><span class=p>;</span>
</span><span id=__span-47-12><a id=__codelineno-47-12 name=__codelineno-47-12 href=#__codelineno-47-12></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-47-13><a id=__codelineno-47-13 name=__codelineno-47-13 href=#__codelineno-47-13></a>
</span><span id=__span-47-14><a id=__codelineno-47-14 name=__codelineno-47-14 href=#__codelineno-47-14></a><span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-15><a id=__codelineno-47-15 name=__codelineno-47-15 href=#__codelineno-47-15></a><span class=w>        </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-47-16><a id=__codelineno-47-16 name=__codelineno-47-16 href=#__codelineno-47-16></a>
</span><span id=__span-47-17><a id=__codelineno-47-17 name=__codelineno-47-17 href=#__codelineno-47-17></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-18><a id=__codelineno-47-18 name=__codelineno-47-18 href=#__codelineno-47-18></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://web_backend</span><span class=p>;</span>
</span><span id=__span-47-19><a id=__codelineno-47-19 name=__codelineno-47-19 href=#__codelineno-47-19></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-47-20><a id=__codelineno-47-20 name=__codelineno-47-20 href=#__codelineno-47-20></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-47-21><a id=__codelineno-47-21 name=__codelineno-47-21 href=#__codelineno-47-21></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span><span id=__span-47-22><a id=__codelineno-47-22 name=__codelineno-47-22 href=#__codelineno-47-22></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-Proto</span><span class=w> </span><span class=nv>$scheme</span><span class=p>;</span>
</span><span id=__span-47-23><a id=__codelineno-47-23 name=__codelineno-47-23 href=#__codelineno-47-23></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-47-24><a id=__codelineno-47-24 name=__codelineno-47-24 href=#__codelineno-47-24></a>
</span><span id=__span-47-25><a id=__codelineno-47-25 name=__codelineno-47-25 href=#__codelineno-47-25></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/api</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-47-26><a id=__codelineno-47-26 name=__codelineno-47-26 href=#__codelineno-47-26></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://api_backend</span><span class=p>;</span>
</span><span id=__span-47-27><a id=__codelineno-47-27 name=__codelineno-47-27 href=#__codelineno-47-27></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-47-28><a id=__codelineno-47-28 name=__codelineno-47-28 href=#__codelineno-47-28></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-47-29><a id=__codelineno-47-29 name=__codelineno-47-29 href=#__codelineno-47-29></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span><span id=__span-47-30><a id=__codelineno-47-30 name=__codelineno-47-30 href=#__codelineno-47-30></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-Proto</span><span class=w> </span><span class=nv>$scheme</span><span class=p>;</span>
</span><span id=__span-47-31><a id=__codelineno-47-31 name=__codelineno-47-31 href=#__codelineno-47-31></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-47-32><a id=__codelineno-47-32 name=__codelineno-47-32 href=#__codelineno-47-32></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-47-33><a id=__codelineno-47-33 name=__codelineno-47-33 href=#__codelineno-47-33></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use nginx as load balancer with upstream blocks and deploy.replicas for scaling</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-48-1><a id=__codelineno-48-1 name=__codelineno-48-1 href=#__codelineno-48-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-48-2><a id=__codelineno-48-2 name=__codelineno-48-2 href=#__codelineno-48-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-48-3><a id=__codelineno-48-3 name=__codelineno-48-3 href=#__codelineno-48-3></a><span class=w>  </span><span class=nt>loadbalancer</span><span class=p>:</span>
</span><span id=__span-48-4><a id=__codelineno-48-4 name=__codelineno-48-4 href=#__codelineno-48-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-48-5><a id=__codelineno-48-5 name=__codelineno-48-5 href=#__codelineno-48-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-48-6><a id=__codelineno-48-6 name=__codelineno-48-6 href=#__codelineno-48-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-48-7><a id=__codelineno-48-7 name=__codelineno-48-7 href=#__codelineno-48-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-48-8><a id=__codelineno-48-8 name=__codelineno-48-8 href=#__codelineno-48-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./nginx/loadbalancer.conf:/etc/nginx/nginx.conf</span>
</span><span id=__span-48-9><a id=__codelineno-48-9 name=__codelineno-48-9 href=#__codelineno-48-9></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-48-10><a id=__codelineno-48-10 name=__codelineno-48-10 href=#__codelineno-48-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id=__span-48-11><a id=__codelineno-48-11 name=__codelineno-48-11 href=#__codelineno-48-11></a>
</span><span id=__span-48-12><a id=__codelineno-48-12 name=__codelineno-48-12 href=#__codelineno-48-12></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-48-13><a id=__codelineno-48-13 name=__codelineno-48-13 href=#__codelineno-48-13></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-48-14><a id=__codelineno-48-14 name=__codelineno-48-14 href=#__codelineno-48-14></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-48-15><a id=__codelineno-48-15 name=__codelineno-48-15 href=#__codelineno-48-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id=__span-48-16><a id=__codelineno-48-16 name=__codelineno-48-16 href=#__codelineno-48-16></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-48-17><a id=__codelineno-48-17 name=__codelineno-48-17 href=#__codelineno-48-17></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-48-18><a id=__codelineno-48-18 name=__codelineno-48-18 href=#__codelineno-48-18></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-48-19><a id=__codelineno-48-19 name=__codelineno-48-19 href=#__codelineno-48-19></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-48-20><a id=__codelineno-48-20 name=__codelineno-48-20 href=#__codelineno-48-20></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-48-21><a id=__codelineno-48-21 name=__codelineno-48-21 href=#__codelineno-48-21></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-48-22><a id=__codelineno-48-22 name=__codelineno-48-22 href=#__codelineno-48-22></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-48-23><a id=__codelineno-48-23 name=__codelineno-48-23 href=#__codelineno-48-23></a>
</span><span id=__span-48-24><a id=__codelineno-48-24 name=__codelineno-48-24 href=#__codelineno-48-24></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-48-25><a id=__codelineno-48-25 name=__codelineno-48-25 href=#__codelineno-48-25></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-48-26><a id=__codelineno-48-26 name=__codelineno-48-26 href=#__codelineno-48-26></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-48-27><a id=__codelineno-48-27 name=__codelineno-48-27 href=#__codelineno-48-27></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-48-28><a id=__codelineno-48-28 name=__codelineno-48-28 href=#__codelineno-48-28></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;</span>
</span><span id=__span-48-29><a id=__codelineno-48-29 name=__codelineno-48-29 href=#__codelineno-48-29></a><span class="l l-Scalar l-Scalar-Plain">while true; do</span>
</span><span id=__span-48-30><a id=__codelineno-48-30 name=__codelineno-48-30 href=#__codelineno-48-30></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">hostname=\$(hostname)</span>
</span><span id=__span-48-31><a id=__codelineno-48-31 name=__codelineno-48-31 href=#__codelineno-48-31></a><span class=w>  </span><span class="l l-Scalar l-Scalar-Plain">{ echo -e \&quot;HTTP/1.1 200 OK\r\nContent-Type</span><span class="p p-Indicator">:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">text/plain\r\n\r\nAPI Response from \$hostname\&quot;; } | nc -l -p 8000 -q 1 &gt; /dev/null</span>
</span><span id=__span-48-32><a id=__codelineno-48-32 name=__codelineno-48-32 href=#__codelineno-48-32></a><span class="l l-Scalar l-Scalar-Plain">done&quot;</span>
</span><span id=__span-48-33><a id=__codelineno-48-33 name=__codelineno-48-33 href=#__codelineno-48-33></a><span class=w>    </span><span class="l l-Scalar l-Scalar-Plain">healthcheck</span><span class="p p-Indicator">:</span>
</span><span id=__span-48-34><a id=__codelineno-48-34 name=__codelineno-48-34 href=#__codelineno-48-34></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;OK&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-48-35><a id=__codelineno-48-35 name=__codelineno-48-35 href=#__codelineno-48-35></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
</span><span id=__span-48-36><a id=__codelineno-48-36 name=__codelineno-48-36 href=#__codelineno-48-36></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-48-37><a id=__codelineno-48-37 name=__codelineno-48-37 href=#__codelineno-48-37></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-48-38><a id=__codelineno-48-38 name=__codelineno-48-38 href=#__codelineno-48-38></a>
</span><span id=__span-48-39><a id=__codelineno-48-39 name=__codelineno-48-39 href=#__codelineno-48-39></a><span class="w w-Error">  </span><span class=nt>redis</span><span class=p>:</span>
</span><span id=__span-48-40><a id=__codelineno-48-40 name=__codelineno-48-40 href=#__codelineno-48-40></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:alpine</span>
</span><span id=__span-48-41><a id=__codelineno-48-41 name=__codelineno-48-41 href=#__codelineno-48-41></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-48-42><a id=__codelineno-48-42 name=__codelineno-48-42 href=#__codelineno-48-42></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
</span><span id=__span-48-43><a id=__codelineno-48-43 name=__codelineno-48-43 href=#__codelineno-48-43></a>
</span><span id=__span-48-44><a id=__codelineno-48-44 name=__codelineno-48-44 href=#__codelineno-48-44></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-48-45><a id=__codelineno-48-45 name=__codelineno-48-45 href=#__codelineno-48-45></a><span class=w>  </span><span class=nt>redis_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>nginx/loadbalancer.conf</strong> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-49-1><a id=__codelineno-49-1 name=__codelineno-49-1 href=#__codelineno-49-1></a><span class=k>events</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-49-2><a id=__codelineno-49-2 name=__codelineno-49-2 href=#__codelineno-49-2></a><span class=w>    </span><span class=kn>worker_connections</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-49-3><a id=__codelineno-49-3 name=__codelineno-49-3 href=#__codelineno-49-3></a><span class=p>}</span>
</span><span id=__span-49-4><a id=__codelineno-49-4 name=__codelineno-49-4 href=#__codelineno-49-4></a>
</span><span id=__span-49-5><a id=__codelineno-49-5 name=__codelineno-49-5 href=#__codelineno-49-5></a><span class=k>http</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-49-6><a id=__codelineno-49-6 name=__codelineno-49-6 href=#__codelineno-49-6></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>web_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-49-7><a id=__codelineno-49-7 name=__codelineno-49-7 href=#__codelineno-49-7></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>web</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-49-8><a id=__codelineno-49-8 name=__codelineno-49-8 href=#__codelineno-49-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-49-9><a id=__codelineno-49-9 name=__codelineno-49-9 href=#__codelineno-49-9></a>
</span><span id=__span-49-10><a id=__codelineno-49-10 name=__codelineno-49-10 href=#__codelineno-49-10></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>api_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-49-11><a id=__codelineno-49-11 name=__codelineno-49-11 href=#__codelineno-49-11></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api</span><span class=p>:</span><span class=mi>8000</span><span class=p>;</span>
</span><span id=__span-49-12><a id=__codelineno-49-12 name=__codelineno-49-12 href=#__codelineno-49-12></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-49-13><a id=__codelineno-49-13 name=__codelineno-49-13 href=#__codelineno-49-13></a>
</span><span id=__span-49-14><a id=__codelineno-49-14 name=__codelineno-49-14 href=#__codelineno-49-14></a><span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-49-15><a id=__codelineno-49-15 name=__codelineno-49-15 href=#__codelineno-49-15></a><span class=w>        </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-49-16><a id=__codelineno-49-16 name=__codelineno-49-16 href=#__codelineno-49-16></a>
</span><span id=__span-49-17><a id=__codelineno-49-17 name=__codelineno-49-17 href=#__codelineno-49-17></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-49-18><a id=__codelineno-49-18 name=__codelineno-49-18 href=#__codelineno-49-18></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://web_backend</span><span class=p>;</span>
</span><span id=__span-49-19><a id=__codelineno-49-19 name=__codelineno-49-19 href=#__codelineno-49-19></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-49-20><a id=__codelineno-49-20 name=__codelineno-49-20 href=#__codelineno-49-20></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-49-21><a id=__codelineno-49-21 name=__codelineno-49-21 href=#__codelineno-49-21></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span><span id=__span-49-22><a id=__codelineno-49-22 name=__codelineno-49-22 href=#__codelineno-49-22></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-Proto</span><span class=w> </span><span class=nv>$scheme</span><span class=p>;</span>
</span><span id=__span-49-23><a id=__codelineno-49-23 name=__codelineno-49-23 href=#__codelineno-49-23></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-49-24><a id=__codelineno-49-24 name=__codelineno-49-24 href=#__codelineno-49-24></a>
</span><span id=__span-49-25><a id=__codelineno-49-25 name=__codelineno-49-25 href=#__codelineno-49-25></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/api</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-49-26><a id=__codelineno-49-26 name=__codelineno-49-26 href=#__codelineno-49-26></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://api_backend</span><span class=p>;</span>
</span><span id=__span-49-27><a id=__codelineno-49-27 name=__codelineno-49-27 href=#__codelineno-49-27></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-49-28><a id=__codelineno-49-28 name=__codelineno-49-28 href=#__codelineno-49-28></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-49-29><a id=__codelineno-49-29 name=__codelineno-49-29 href=#__codelineno-49-29></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-For</span><span class=w> </span><span class=nv>$proxy_add_x_forwarded_for</span><span class=p>;</span>
</span><span id=__span-49-30><a id=__codelineno-49-30 name=__codelineno-49-30 href=#__codelineno-49-30></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Forwarded-Proto</span><span class=w> </span><span class=nv>$scheme</span><span class=p>;</span>
</span><span id=__span-49-31><a id=__codelineno-49-31 name=__codelineno-49-31 href=#__codelineno-49-31></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-49-32><a id=__codelineno-49-32 name=__codelineno-49-32 href=#__codelineno-49-32></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-49-33><a id=__codelineno-49-33 name=__codelineno-49-33 href=#__codelineno-49-33></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-50-1><a id=__codelineno-50-1 name=__codelineno-50-1 href=#__codelineno-50-1></a><span class=c1># Start load balanced services</span>
</span><span id=__span-50-2><a id=__codelineno-50-2 name=__codelineno-50-2 href=#__codelineno-50-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-50-3><a id=__codelineno-50-3 name=__codelineno-50-3 href=#__codelineno-50-3></a>
</span><span id=__span-50-4><a id=__codelineno-50-4 name=__codelineno-50-4 href=#__codelineno-50-4></a><span class=c1># Test load balancing</span>
</span><span id=__span-50-5><a id=__codelineno-50-5 name=__codelineno-50-5 href=#__codelineno-50-5></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=m>1</span>..10<span class=o>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>curl<span class=w> </span>-s<span class=w> </span>http://localhost:8080/api<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span><span class=s2>&quot;API Response&quot;</span><span class=p>;</span><span class=w> </span><span class=k>done</span>
</span><span id=__span-50-6><a id=__codelineno-50-6 name=__codelineno-50-6 href=#__codelineno-50-6></a>
</span><span id=__span-50-7><a id=__codelineno-50-7 name=__codelineno-50-7 href=#__codelineno-50-7></a><span class=c1># Check service instances</span>
</span><span id=__span-50-8><a id=__codelineno-50-8 name=__codelineno-50-8 href=#__codelineno-50-8></a>docker-compose<span class=w> </span>ps
</span><span id=__span-50-9><a id=__codelineno-50-9 name=__codelineno-50-9 href=#__codelineno-50-9></a>
</span><span id=__span-50-10><a id=__codelineno-50-10 name=__codelineno-50-10 href=#__codelineno-50-10></a><span class=c1># Scale services</span>
</span><span id=__span-50-11><a id=__codelineno-50-11 name=__codelineno-50-11 href=#__codelineno-50-11></a>docker-compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>--scale<span class=w> </span><span class=nv>web</span><span class=o>=</span><span class=m>5</span>
</span><span id=__span-50-12><a id=__codelineno-50-12 name=__codelineno-50-12 href=#__codelineno-50-12></a>
</span><span id=__span-50-13><a id=__codelineno-50-13 name=__codelineno-50-13 href=#__codelineno-50-13></a><span class=c1># Test failover (stop one instance)</span>
</span><span id=__span-50-14><a id=__codelineno-50-14 name=__codelineno-50-14 href=#__codelineno-50-14></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web.1<span class=w> </span>nginx<span class=w> </span>-s<span class=w> </span>stop
</span><span id=__span-50-15><a id=__codelineno-50-15 name=__codelineno-50-15 href=#__codelineno-50-15></a><span class=c1># Requests should still work</span>
</span><span id=__span-50-16><a id=__codelineno-50-16 name=__codelineno-50-16 href=#__codelineno-50-16></a>curl<span class=w> </span>http://localhost:8080/
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>upstream blocks</strong>: Define backend server groups for load balancing</li> <li><strong>proxy_pass</strong>: Forward requests to backend services</li> <li><strong>deploy.replicas</strong>: Create multiple instances for load distribution</li> <li><strong>healthcheck</strong>: Ensure only healthy instances receive traffic</li> <li><strong>Automatic failover</strong>: Traffic rerouted when instances become unhealthy</li> <li><strong>Session persistence</strong>: Optional sticky sessions for stateful applications</li> </ul> </details> <hr> <h4 id=17-multi-stage-deployments>17. Multi-Stage Deployments<a class=headerlink href=#17-multi-stage-deployments title="Permanent link">&para;</a></h4> <ul> <li> <p>Implement blue-green or canary deployment strategies using Docker Compose.</p> <h4 id=scenario_16><strong>Scenario:</strong><a class=headerlink href=#scenario_16 title="Permanent link">&para;</a></h4> <ul> <li>You need to deploy application updates with zero downtime and the ability to quickly rollback if issues occur.</li> <li>Multi-stage deployments with Docker Compose allow you to run multiple versions of your application simultaneously and gradually shift traffic.</li> </ul> <h4 id=resources_7>Resources:<a class=headerlink href=#resources_7 title="Permanent link">&para;</a></h4> <ul> <li><code>nginx/nginx.conf</code> ➤ Load balancer configuration for canary deployment <div class="language-nginx highlight"><pre><span></span><code><span id=__span-51-1><a id=__codelineno-51-1 name=__codelineno-51-1 href=#__codelineno-51-1></a><span class=k>events</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-2><a id=__codelineno-51-2 name=__codelineno-51-2 href=#__codelineno-51-2></a><span class=w>    </span><span class=kn>worker_connections</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-51-3><a id=__codelineno-51-3 name=__codelineno-51-3 href=#__codelineno-51-3></a><span class=p>}</span>
</span><span id=__span-51-4><a id=__codelineno-51-4 name=__codelineno-51-4 href=#__codelineno-51-4></a>
</span><span id=__span-51-5><a id=__codelineno-51-5 name=__codelineno-51-5 href=#__codelineno-51-5></a><span class=k>http</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-6><a id=__codelineno-51-6 name=__codelineno-51-6 href=#__codelineno-51-6></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>web_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-7><a id=__codelineno-51-7 name=__codelineno-51-7 href=#__codelineno-51-7></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>web-v1</span><span class=p>:</span><span class=mi>80</span><span class=w> </span><span class=s>weight=9</span><span class=p>;</span>
</span><span id=__span-51-8><a id=__codelineno-51-8 name=__codelineno-51-8 href=#__codelineno-51-8></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>web-v2</span><span class=p>:</span><span class=mi>80</span><span class=w> </span><span class=s>weight=1</span><span class=p>;</span>
</span><span id=__span-51-9><a id=__codelineno-51-9 name=__codelineno-51-9 href=#__codelineno-51-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-51-10><a id=__codelineno-51-10 name=__codelineno-51-10 href=#__codelineno-51-10></a>
</span><span id=__span-51-11><a id=__codelineno-51-11 name=__codelineno-51-11 href=#__codelineno-51-11></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>api_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-12><a id=__codelineno-51-12 name=__codelineno-51-12 href=#__codelineno-51-12></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api-v1</span><span class=p>:</span><span class=mi>8000</span><span class=w> </span><span class=s>weight=9</span><span class=p>;</span>
</span><span id=__span-51-13><a id=__codelineno-51-13 name=__codelineno-51-13 href=#__codelineno-51-13></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api-v2</span><span class=p>:</span><span class=mi>8000</span><span class=w> </span><span class=s>weight=1</span><span class=p>;</span>
</span><span id=__span-51-14><a id=__codelineno-51-14 name=__codelineno-51-14 href=#__codelineno-51-14></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-51-15><a id=__codelineno-51-15 name=__codelineno-51-15 href=#__codelineno-51-15></a>
</span><span id=__span-51-16><a id=__codelineno-51-16 name=__codelineno-51-16 href=#__codelineno-51-16></a><span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-17><a id=__codelineno-51-17 name=__codelineno-51-17 href=#__codelineno-51-17></a><span class=w>        </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-51-18><a id=__codelineno-51-18 name=__codelineno-51-18 href=#__codelineno-51-18></a>
</span><span id=__span-51-19><a id=__codelineno-51-19 name=__codelineno-51-19 href=#__codelineno-51-19></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-20><a id=__codelineno-51-20 name=__codelineno-51-20 href=#__codelineno-51-20></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://web_backend</span><span class=p>;</span>
</span><span id=__span-51-21><a id=__codelineno-51-21 name=__codelineno-51-21 href=#__codelineno-51-21></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-51-22><a id=__codelineno-51-22 name=__codelineno-51-22 href=#__codelineno-51-22></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-51-23><a id=__codelineno-51-23 name=__codelineno-51-23 href=#__codelineno-51-23></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-51-24><a id=__codelineno-51-24 name=__codelineno-51-24 href=#__codelineno-51-24></a>
</span><span id=__span-51-25><a id=__codelineno-51-25 name=__codelineno-51-25 href=#__codelineno-51-25></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/api</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-51-26><a id=__codelineno-51-26 name=__codelineno-51-26 href=#__codelineno-51-26></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://api_backend</span><span class=p>;</span>
</span><span id=__span-51-27><a id=__codelineno-51-27 name=__codelineno-51-27 href=#__codelineno-51-27></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-51-28><a id=__codelineno-51-28 name=__codelineno-51-28 href=#__codelineno-51-28></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-51-29><a id=__codelineno-51-29 name=__codelineno-51-29 href=#__codelineno-51-29></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-51-30><a id=__codelineno-51-30 name=__codelineno-51-30 href=#__codelineno-51-30></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-51-31><a id=__codelineno-51-31 name=__codelineno-51-31 href=#__codelineno-51-31></a><span class=p>}</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use profiles to control which version runs and nginx upstream weights for traffic shifting</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> (base) <div class="language-yaml highlight"><pre><span></span><code><span id=__span-52-1><a id=__codelineno-52-1 name=__codelineno-52-1 href=#__codelineno-52-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-52-2><a id=__codelineno-52-2 name=__codelineno-52-2 href=#__codelineno-52-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-52-3><a id=__codelineno-52-3 name=__codelineno-52-3 href=#__codelineno-52-3></a><span class=w>  </span><span class=nt>loadbalancer</span><span class=p>:</span>
</span><span id=__span-52-4><a id=__codelineno-52-4 name=__codelineno-52-4 href=#__codelineno-52-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-52-5><a id=__codelineno-52-5 name=__codelineno-52-5 href=#__codelineno-52-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-52-6><a id=__codelineno-52-6 name=__codelineno-52-6 href=#__codelineno-52-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-52-7><a id=__codelineno-52-7 name=__codelineno-52-7 href=#__codelineno-52-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-52-8><a id=__codelineno-52-8 name=__codelineno-52-8 href=#__codelineno-52-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./nginx/nginx.conf:/etc/nginx/nginx.conf</span>
</span><span id=__span-52-9><a id=__codelineno-52-9 name=__codelineno-52-9 href=#__codelineno-52-9></a>
</span><span id=__span-52-10><a id=__codelineno-52-10 name=__codelineno-52-10 href=#__codelineno-52-10></a><span class=w>  </span><span class=nt>web-v1</span><span class=p>:</span>
</span><span id=__span-52-11><a id=__codelineno-52-11 name=__codelineno-52-11 href=#__codelineno-52-11></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-52-12><a id=__codelineno-52-12 name=__codelineno-52-12 href=#__codelineno-52-12></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-52-13><a id=__codelineno-52-13 name=__codelineno-52-13 href=#__codelineno-52-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web/v1:/usr/share/nginx/html</span>
</span><span id=__span-52-14><a id=__codelineno-52-14 name=__codelineno-52-14 href=#__codelineno-52-14></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-52-15><a id=__codelineno-52-15 name=__codelineno-52-15 href=#__codelineno-52-15></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VERSION=v1</span>
</span><span id=__span-52-16><a id=__codelineno-52-16 name=__codelineno-52-16 href=#__codelineno-52-16></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-52-17><a id=__codelineno-52-17 name=__codelineno-52-17 href=#__codelineno-52-17></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-52-18><a id=__codelineno-52-18 name=__codelineno-52-18 href=#__codelineno-52-18></a>
</span><span id=__span-52-19><a id=__codelineno-52-19 name=__codelineno-52-19 href=#__codelineno-52-19></a><span class=w>  </span><span class=nt>web-v2</span><span class=p>:</span>
</span><span id=__span-52-20><a id=__codelineno-52-20 name=__codelineno-52-20 href=#__codelineno-52-20></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-52-21><a id=__codelineno-52-21 name=__codelineno-52-21 href=#__codelineno-52-21></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-52-22><a id=__codelineno-52-22 name=__codelineno-52-22 href=#__codelineno-52-22></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web/v2:/usr/share/nginx/html</span>
</span><span id=__span-52-23><a id=__codelineno-52-23 name=__codelineno-52-23 href=#__codelineno-52-23></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-52-24><a id=__codelineno-52-24 name=__codelineno-52-24 href=#__codelineno-52-24></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VERSION=v2</span>
</span><span id=__span-52-25><a id=__codelineno-52-25 name=__codelineno-52-25 href=#__codelineno-52-25></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-52-26><a id=__codelineno-52-26 name=__codelineno-52-26 href=#__codelineno-52-26></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-52-27><a id=__codelineno-52-27 name=__codelineno-52-27 href=#__codelineno-52-27></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-52-28><a id=__codelineno-52-28 name=__codelineno-52-28 href=#__codelineno-52-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
</span><span id=__span-52-29><a id=__codelineno-52-29 name=__codelineno-52-29 href=#__codelineno-52-29></a>
</span><span id=__span-52-30><a id=__codelineno-52-30 name=__codelineno-52-30 href=#__codelineno-52-30></a><span class=w>  </span><span class=nt>api-v1</span><span class=p>:</span>
</span><span id=__span-52-31><a id=__codelineno-52-31 name=__codelineno-52-31 href=#__codelineno-52-31></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-52-32><a id=__codelineno-52-32 name=__codelineno-52-32 href=#__codelineno-52-32></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-52-33><a id=__codelineno-52-33 name=__codelineno-52-33 href=#__codelineno-52-33></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VERSION=v1</span>
</span><span id=__span-52-34><a id=__codelineno-52-34 name=__codelineno-52-34 href=#__codelineno-52-34></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;API v1&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 8000 -h /tmp&#39;</span>
</span><span id=__span-52-35><a id=__codelineno-52-35 name=__codelineno-52-35 href=#__codelineno-52-35></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-52-36><a id=__codelineno-52-36 name=__codelineno-52-36 href=#__codelineno-52-36></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-52-37><a id=__codelineno-52-37 name=__codelineno-52-37 href=#__codelineno-52-37></a>
</span><span id=__span-52-38><a id=__codelineno-52-38 name=__codelineno-52-38 href=#__codelineno-52-38></a><span class=w>  </span><span class=nt>api-v2</span><span class=p>:</span>
</span><span id=__span-52-39><a id=__codelineno-52-39 name=__codelineno-52-39 href=#__codelineno-52-39></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-52-40><a id=__codelineno-52-40 name=__codelineno-52-40 href=#__codelineno-52-40></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-52-41><a id=__codelineno-52-41 name=__codelineno-52-41 href=#__codelineno-52-41></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">VERSION=v2</span>
</span><span id=__span-52-42><a id=__codelineno-52-42 name=__codelineno-52-42 href=#__codelineno-52-42></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;API v2 - New Feature!&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 8000 -h /tmp&#39;</span>
</span><span id=__span-52-43><a id=__codelineno-52-43 name=__codelineno-52-43 href=#__codelineno-52-43></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-52-44><a id=__codelineno-52-44 name=__codelineno-52-44 href=#__codelineno-52-44></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-52-45><a id=__codelineno-52-45 name=__codelineno-52-45 href=#__codelineno-52-45></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-52-46><a id=__codelineno-52-46 name=__codelineno-52-46 href=#__codelineno-52-46></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
</span></code></pre></div></p> <p><strong>nginx/nginx.conf</strong> (canary deployment - 90% v1, 10% v2) <div class="language-nginx highlight"><pre><span></span><code><span id=__span-53-1><a id=__codelineno-53-1 name=__codelineno-53-1 href=#__codelineno-53-1></a><span class=k>events</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-53-2><a id=__codelineno-53-2 name=__codelineno-53-2 href=#__codelineno-53-2></a><span class=w>    </span><span class=kn>worker_connections</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-53-3><a id=__codelineno-53-3 name=__codelineno-53-3 href=#__codelineno-53-3></a><span class=p>}</span>
</span><span id=__span-53-4><a id=__codelineno-53-4 name=__codelineno-53-4 href=#__codelineno-53-4></a>
</span><span id=__span-53-5><a id=__codelineno-53-5 name=__codelineno-53-5 href=#__codelineno-53-5></a><span class=k>http</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-53-6><a id=__codelineno-53-6 name=__codelineno-53-6 href=#__codelineno-53-6></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>web_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-53-7><a id=__codelineno-53-7 name=__codelineno-53-7 href=#__codelineno-53-7></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>web-v1</span><span class=p>:</span><span class=mi>80</span><span class=w> </span><span class=s>weight=9</span><span class=p>;</span>
</span><span id=__span-53-8><a id=__codelineno-53-8 name=__codelineno-53-8 href=#__codelineno-53-8></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>web-v2</span><span class=p>:</span><span class=mi>80</span><span class=w> </span><span class=s>weight=1</span><span class=p>;</span>
</span><span id=__span-53-9><a id=__codelineno-53-9 name=__codelineno-53-9 href=#__codelineno-53-9></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-53-10><a id=__codelineno-53-10 name=__codelineno-53-10 href=#__codelineno-53-10></a>
</span><span id=__span-53-11><a id=__codelineno-53-11 name=__codelineno-53-11 href=#__codelineno-53-11></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>api_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-53-12><a id=__codelineno-53-12 name=__codelineno-53-12 href=#__codelineno-53-12></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api-v1</span><span class=p>:</span><span class=mi>8000</span><span class=w> </span><span class=s>weight=9</span><span class=p>;</span>
</span><span id=__span-53-13><a id=__codelineno-53-13 name=__codelineno-53-13 href=#__codelineno-53-13></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api-v2</span><span class=p>:</span><span class=mi>8000</span><span class=w> </span><span class=s>weight=1</span><span class=p>;</span>
</span><span id=__span-53-14><a id=__codelineno-53-14 name=__codelineno-53-14 href=#__codelineno-53-14></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-53-15><a id=__codelineno-53-15 name=__codelineno-53-15 href=#__codelineno-53-15></a>
</span><span id=__span-53-16><a id=__codelineno-53-16 name=__codelineno-53-16 href=#__codelineno-53-16></a><span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-53-17><a id=__codelineno-53-17 name=__codelineno-53-17 href=#__codelineno-53-17></a><span class=w>        </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-53-18><a id=__codelineno-53-18 name=__codelineno-53-18 href=#__codelineno-53-18></a>
</span><span id=__span-53-19><a id=__codelineno-53-19 name=__codelineno-53-19 href=#__codelineno-53-19></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-53-20><a id=__codelineno-53-20 name=__codelineno-53-20 href=#__codelineno-53-20></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://web_backend</span><span class=p>;</span>
</span><span id=__span-53-21><a id=__codelineno-53-21 name=__codelineno-53-21 href=#__codelineno-53-21></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-53-22><a id=__codelineno-53-22 name=__codelineno-53-22 href=#__codelineno-53-22></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-53-23><a id=__codelineno-53-23 name=__codelineno-53-23 href=#__codelineno-53-23></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-53-24><a id=__codelineno-53-24 name=__codelineno-53-24 href=#__codelineno-53-24></a>
</span><span id=__span-53-25><a id=__codelineno-53-25 name=__codelineno-53-25 href=#__codelineno-53-25></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/api</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-53-26><a id=__codelineno-53-26 name=__codelineno-53-26 href=#__codelineno-53-26></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://api_backend</span><span class=p>;</span>
</span><span id=__span-53-27><a id=__codelineno-53-27 name=__codelineno-53-27 href=#__codelineno-53-27></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>Host</span><span class=w> </span><span class=nv>$host</span><span class=p>;</span>
</span><span id=__span-53-28><a id=__codelineno-53-28 name=__codelineno-53-28 href=#__codelineno-53-28></a><span class=w>            </span><span class=kn>proxy_set_header</span><span class=w> </span><span class=s>X-Real-IP</span><span class=w> </span><span class=nv>$remote_addr</span><span class=p>;</span>
</span><span id=__span-53-29><a id=__codelineno-53-29 name=__codelineno-53-29 href=#__codelineno-53-29></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-53-30><a id=__codelineno-53-30 name=__codelineno-53-30 href=#__codelineno-53-30></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-53-31><a id=__codelineno-53-31 name=__codelineno-53-31 href=#__codelineno-53-31></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-54-1><a id=__codelineno-54-1 name=__codelineno-54-1 href=#__codelineno-54-1></a><span class=c1># Start with only v1</span>
</span><span id=__span-54-2><a id=__codelineno-54-2 name=__codelineno-54-2 href=#__codelineno-54-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-54-3><a id=__codelineno-54-3 name=__codelineno-54-3 href=#__codelineno-54-3></a>
</span><span id=__span-54-4><a id=__codelineno-54-4 name=__codelineno-54-4 href=#__codelineno-54-4></a><span class=c1># Test current version</span>
</span><span id=__span-54-5><a id=__codelineno-54-5 name=__codelineno-54-5 href=#__codelineno-54-5></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=m>1</span>..10<span class=o>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>curl<span class=w> </span>-s<span class=w> </span>http://localhost:8080/api<span class=p>;</span><span class=w> </span><span class=k>done</span>
</span><span id=__span-54-6><a id=__codelineno-54-6 name=__codelineno-54-6 href=#__codelineno-54-6></a>
</span><span id=__span-54-7><a id=__codelineno-54-7 name=__codelineno-54-7 href=#__codelineno-54-7></a><span class=c1># Deploy v2 alongside v1 (canary)</span>
</span><span id=__span-54-8><a id=__codelineno-54-8 name=__codelineno-54-8 href=#__codelineno-54-8></a>docker-compose<span class=w> </span>--profile<span class=w> </span>v2<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-54-9><a id=__codelineno-54-9 name=__codelineno-54-9 href=#__codelineno-54-9></a>
</span><span id=__span-54-10><a id=__codelineno-54-10 name=__codelineno-54-10 href=#__codelineno-54-10></a><span class=c1># Update nginx config for canary deployment</span>
</span><span id=__span-54-11><a id=__codelineno-54-11 name=__codelineno-54-11 href=#__codelineno-54-11></a><span class=c1># (edit nginx.conf to add v2 with low weight)</span>
</span><span id=__span-54-12><a id=__codelineno-54-12 name=__codelineno-54-12 href=#__codelineno-54-12></a>
</span><span id=__span-54-13><a id=__codelineno-54-13 name=__codelineno-54-13 href=#__codelineno-54-13></a><span class=c1># Reload nginx config</span>
</span><span id=__span-54-14><a id=__codelineno-54-14 name=__codelineno-54-14 href=#__codelineno-54-14></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>loadbalancer<span class=w> </span>nginx<span class=w> </span>-s<span class=w> </span>reload
</span><span id=__span-54-15><a id=__codelineno-54-15 name=__codelineno-54-15 href=#__codelineno-54-15></a>
</span><span id=__span-54-16><a id=__codelineno-54-16 name=__codelineno-54-16 href=#__codelineno-54-16></a><span class=c1># Test canary deployment</span>
</span><span id=__span-54-17><a id=__codelineno-54-17 name=__codelineno-54-17 href=#__codelineno-54-17></a><span class=k>for</span><span class=w> </span>i<span class=w> </span><span class=k>in</span><span class=w> </span><span class=o>{</span><span class=m>1</span>..20<span class=o>}</span><span class=p>;</span><span class=w> </span><span class=k>do</span><span class=w> </span>curl<span class=w> </span>-s<span class=w> </span>http://localhost:8080/api<span class=p>;</span><span class=w> </span><span class=k>done</span>
</span><span id=__span-54-18><a id=__codelineno-54-18 name=__codelineno-54-18 href=#__codelineno-54-18></a>
</span><span id=__span-54-19><a id=__codelineno-54-19 name=__codelineno-54-19 href=#__codelineno-54-19></a><span class=c1># Full rollout to v2 (blue-green)</span>
</span><span id=__span-54-20><a id=__codelineno-54-20 name=__codelineno-54-20 href=#__codelineno-54-20></a><span class=c1># Update nginx.conf to send all traffic to v2</span>
</span><span id=__span-54-21><a id=__codelineno-54-21 name=__codelineno-54-21 href=#__codelineno-54-21></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>loadbalancer<span class=w> </span>nginx<span class=w> </span>-s<span class=w> </span>reload
</span><span id=__span-54-22><a id=__codelineno-54-22 name=__codelineno-54-22 href=#__codelineno-54-22></a>
</span><span id=__span-54-23><a id=__codelineno-54-23 name=__codelineno-54-23 href=#__codelineno-54-23></a><span class=c1># Remove v1 services</span>
</span><span id=__span-54-24><a id=__codelineno-54-24 name=__codelineno-54-24 href=#__codelineno-54-24></a>docker-compose<span class=w> </span>rm<span class=w> </span>-f<span class=w> </span>web-v1<span class=w> </span>api-v1
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>Canary deployment</strong>: Route small percentage of traffic to new version</li> <li><strong>Blue-green deployment</strong>: Switch all traffic to new version at once</li> <li><strong>Profiles</strong>: Control which version services are running</li> <li><strong>Load balancer config</strong>: Dynamic traffic shifting without downtime</li> <li><strong>Rollback capability</strong>: Quickly switch back to previous version</li> <li><strong>Zero downtime</strong>: New version tested before full rollout</li> </ul> </details> <hr> <h4 id=18-production-ready-stack>18. Production-Ready Stack<a class=headerlink href=#18-production-ready-stack title="Permanent link">&para;</a></h4> <ul> <li> <p>Create a complete production-ready application stack with monitoring, logging, and security best practices.</p> <h4 id=scenario_17><strong>Scenario:</strong><a class=headerlink href=#scenario_17 title="Permanent link">&para;</a></h4> <ul> <li>You&rsquo;re deploying a critical application to production that requires monitoring, centralized logging, security hardening, and automated backups.</li> <li>A production-ready Docker Compose stack includes all necessary components for running applications reliably in production environments.</li> </ul> </li> </ul> <p><strong>Hint:</strong> Combine all production best practices: health checks, secrets, resource limits, logging, monitoring, and backups</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-55-1><a id=__codelineno-55-1 name=__codelineno-55-1 href=#__codelineno-55-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-55-2><a id=__codelineno-55-2 name=__codelineno-55-2 href=#__codelineno-55-2></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-55-3><a id=__codelineno-55-3 name=__codelineno-55-3 href=#__codelineno-55-3></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-55-4><a id=__codelineno-55-4 name=__codelineno-55-4 href=#__codelineno-55-4></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-55-5><a id=__codelineno-55-5 name=__codelineno-55-5 href=#__codelineno-55-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-55-6><a id=__codelineno-55-6 name=__codelineno-55-6 href=#__codelineno-55-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;80:80&quot;</span>
</span><span id=__span-55-7><a id=__codelineno-55-7 name=__codelineno-55-7 href=#__codelineno-55-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;443:443&quot;</span>
</span><span id=__span-55-8><a id=__codelineno-55-8 name=__codelineno-55-8 href=#__codelineno-55-8></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-55-9><a id=__codelineno-55-9 name=__codelineno-55-9 href=#__codelineno-55-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html:ro</span>
</span><span id=__span-55-10><a id=__codelineno-55-10 name=__codelineno-55-10 href=#__codelineno-55-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./nginx/nginx.conf:/etc/nginx/nginx.conf:ro</span>
</span><span id=__span-55-11><a id=__codelineno-55-11 name=__codelineno-55-11 href=#__codelineno-55-11></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./ssl:/etc/ssl/certs:ro</span>
</span><span id=__span-55-12><a id=__codelineno-55-12 name=__codelineno-55-12 href=#__codelineno-55-12></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-55-13><a id=__codelineno-55-13 name=__codelineno-55-13 href=#__codelineno-55-13></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-55-14><a id=__codelineno-55-14 name=__codelineno-55-14 href=#__codelineno-55-14></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-55-15><a id=__codelineno-55-15 name=__codelineno-55-15 href=#__codelineno-55-15></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-55-16><a id=__codelineno-55-16 name=__codelineno-55-16 href=#__codelineno-55-16></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-55-17><a id=__codelineno-55-17 name=__codelineno-55-17 href=#__codelineno-55-17></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-55-18><a id=__codelineno-55-18 name=__codelineno-55-18 href=#__codelineno-55-18></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-55-19><a id=__codelineno-55-19 name=__codelineno-55-19 href=#__codelineno-55-19></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-55-20><a id=__codelineno-55-20 name=__codelineno-55-20 href=#__codelineno-55-20></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-55-21><a id=__codelineno-55-21 name=__codelineno-55-21 href=#__codelineno-55-21></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-55-22><a id=__codelineno-55-22 name=__codelineno-55-22 href=#__codelineno-55-22></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-55-23><a id=__codelineno-55-23 name=__codelineno-55-23 href=#__codelineno-55-23></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-55-24><a id=__codelineno-55-24 name=__codelineno-55-24 href=#__codelineno-55-24></a><span class=w>      </span><span class=nt>restart_policy</span><span class=p>:</span>
</span><span id=__span-55-25><a id=__codelineno-55-25 name=__codelineno-55-25 href=#__codelineno-55-25></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id=__span-55-26><a id=__codelineno-55-26 name=__codelineno-55-26 href=#__codelineno-55-26></a><span class=w>        </span><span class=nt>delay</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-55-27><a id=__codelineno-55-27 name=__codelineno-55-27 href=#__codelineno-55-27></a><span class=w>        </span><span class=nt>max_attempts</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-55-28><a id=__codelineno-55-28 name=__codelineno-55-28 href=#__codelineno-55-28></a><span class=w>        </span><span class=nt>window</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">120s</span>
</span><span id=__span-55-29><a id=__codelineno-55-29 name=__codelineno-55-29 href=#__codelineno-55-29></a>
</span><span id=__span-55-30><a id=__codelineno-55-30 name=__codelineno-55-30 href=#__codelineno-55-30></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-55-31><a id=__codelineno-55-31 name=__codelineno-55-31 href=#__codelineno-55-31></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-55-32><a id=__codelineno-55-32 name=__codelineno-55-32 href=#__codelineno-55-32></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-55-33><a id=__codelineno-55-33 name=__codelineno-55-33 href=#__codelineno-55-33></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=postgresql://user:pass@db:5432/myapp</span>
</span><span id=__span-55-34><a id=__codelineno-55-34 name=__codelineno-55-34 href=#__codelineno-55-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_URL=redis://redis:6379</span>
</span><span id=__span-55-35><a id=__codelineno-55-35 name=__codelineno-55-35 href=#__codelineno-55-35></a><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-55-36><a id=__codelineno-55-36 name=__codelineno-55-36 href=#__codelineno-55-36></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api_key</span>
</span><span id=__span-55-37><a id=__codelineno-55-37 name=__codelineno-55-37 href=#__codelineno-55-37></a><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/api_key</span>
</span><span id=__span-55-38><a id=__codelineno-55-38 name=__codelineno-55-38 href=#__codelineno-55-38></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-55-39><a id=__codelineno-55-39 name=__codelineno-55-39 href=#__codelineno-55-39></a><span class=w>      </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-55-40><a id=__codelineno-55-40 name=__codelineno-55-40 href=#__codelineno-55-40></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id=__span-55-41><a id=__codelineno-55-41 name=__codelineno-55-41 href=#__codelineno-55-41></a><span class=w>      </span><span class=nt>redis</span><span class=p>:</span>
</span><span id=__span-55-42><a id=__codelineno-55-42 name=__codelineno-55-42 href=#__codelineno-55-42></a><span class=w>        </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id=__span-55-43><a id=__codelineno-55-43 name=__codelineno-55-43 href=#__codelineno-55-43></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-55-44><a id=__codelineno-55-44 name=__codelineno-55-44 href=#__codelineno-55-44></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost:8000/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-55-45><a id=__codelineno-55-45 name=__codelineno-55-45 href=#__codelineno-55-45></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-55-46><a id=__codelineno-55-46 name=__codelineno-55-46 href=#__codelineno-55-46></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-55-47><a id=__codelineno-55-47 name=__codelineno-55-47 href=#__codelineno-55-47></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-55-48><a id=__codelineno-55-48 name=__codelineno-55-48 href=#__codelineno-55-48></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-55-49><a id=__codelineno-55-49 name=__codelineno-55-49 href=#__codelineno-55-49></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-55-50><a id=__codelineno-55-50 name=__codelineno-55-50 href=#__codelineno-55-50></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-55-51><a id=__codelineno-55-51 name=__codelineno-55-51 href=#__codelineno-55-51></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-55-52><a id=__codelineno-55-52 name=__codelineno-55-52 href=#__codelineno-55-52></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span><span id=__span-55-53><a id=__codelineno-55-53 name=__codelineno-55-53 href=#__codelineno-55-53></a><span class=w>    </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-55-54><a id=__codelineno-55-54 name=__codelineno-55-54 href=#__codelineno-55-54></a><span class=w>      </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-55-55><a id=__codelineno-55-55 name=__codelineno-55-55 href=#__codelineno-55-55></a><span class=w>      </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-55-56><a id=__codelineno-55-56 name=__codelineno-55-56 href=#__codelineno-55-56></a><span class=w>        </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10m&quot;</span>
</span><span id=__span-55-57><a id=__codelineno-55-57 name=__codelineno-55-57 href=#__codelineno-55-57></a><span class=w>        </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3&quot;</span>
</span><span id=__span-55-58><a id=__codelineno-55-58 name=__codelineno-55-58 href=#__codelineno-55-58></a>
</span><span id=__span-55-59><a id=__codelineno-55-59 name=__codelineno-55-59 href=#__codelineno-55-59></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-55-60><a id=__codelineno-55-60 name=__codelineno-55-60 href=#__codelineno-55-60></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-55-61><a id=__codelineno-55-61 name=__codelineno-55-61 href=#__codelineno-55-61></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-55-62><a id=__codelineno-55-62 name=__codelineno-55-62 href=#__codelineno-55-62></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-55-63><a id=__codelineno-55-63 name=__codelineno-55-63 href=#__codelineno-55-63></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-55-64><a id=__codelineno-55-64 name=__codelineno-55-64 href=#__codelineno-55-64></a><span class=w>    </span><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-55-65><a id=__codelineno-55-65 name=__codelineno-55-65 href=#__codelineno-55-65></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_password</span>
</span><span id=__span-55-66><a id=__codelineno-55-66 name=__codelineno-55-66 href=#__codelineno-55-66></a><span class=w>        </span><span class=nt>target</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres_password</span>
</span><span id=__span-55-67><a id=__codelineno-55-67 name=__codelineno-55-67 href=#__codelineno-55-67></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-55-68><a id=__codelineno-55-68 name=__codelineno-55-68 href=#__codelineno-55-68></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-55-69><a id=__codelineno-55-69 name=__codelineno-55-69 href=#__codelineno-55-69></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./backup:/backup</span>
</span><span id=__span-55-70><a id=__codelineno-55-70 name=__codelineno-55-70 href=#__codelineno-55-70></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-55-71><a id=__codelineno-55-71 name=__codelineno-55-71 href=#__codelineno-55-71></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;pg_isready</span><span class=nv> </span><span class=s>-U</span><span class=nv> </span><span class=s>user</span><span class=nv> </span><span class=s>-d</span><span class=nv> </span><span class=s>myapp&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-55-72><a id=__codelineno-55-72 name=__codelineno-55-72 href=#__codelineno-55-72></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-55-73><a id=__codelineno-55-73 name=__codelineno-55-73 href=#__codelineno-55-73></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-55-74><a id=__codelineno-55-74 name=__codelineno-55-74 href=#__codelineno-55-74></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id=__span-55-75><a id=__codelineno-55-75 name=__codelineno-55-75 href=#__codelineno-55-75></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-55-76><a id=__codelineno-55-76 name=__codelineno-55-76 href=#__codelineno-55-76></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-55-77><a id=__codelineno-55-77 name=__codelineno-55-77 href=#__codelineno-55-77></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-55-78><a id=__codelineno-55-78 name=__codelineno-55-78 href=#__codelineno-55-78></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-55-79><a id=__codelineno-55-79 name=__codelineno-55-79 href=#__codelineno-55-79></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;2.0&#39;</span>
</span><span id=__span-55-80><a id=__codelineno-55-80 name=__codelineno-55-80 href=#__codelineno-55-80></a><span class=w>    </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-55-81><a id=__codelineno-55-81 name=__codelineno-55-81 href=#__codelineno-55-81></a><span class=w>      </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-55-82><a id=__codelineno-55-82 name=__codelineno-55-82 href=#__codelineno-55-82></a><span class=w>      </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-55-83><a id=__codelineno-55-83 name=__codelineno-55-83 href=#__codelineno-55-83></a><span class=w>        </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;50m&quot;</span>
</span><span id=__span-55-84><a id=__codelineno-55-84 name=__codelineno-55-84 href=#__codelineno-55-84></a><span class=w>        </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;5&quot;</span>
</span><span id=__span-55-85><a id=__codelineno-55-85 name=__codelineno-55-85 href=#__codelineno-55-85></a>
</span><span id=__span-55-86><a id=__codelineno-55-86 name=__codelineno-55-86 href=#__codelineno-55-86></a><span class=w>  </span><span class=nt>redis</span><span class=p>:</span>
</span><span id=__span-55-87><a id=__codelineno-55-87 name=__codelineno-55-87 href=#__codelineno-55-87></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis:alpine</span>
</span><span id=__span-55-88><a id=__codelineno-55-88 name=__codelineno-55-88 href=#__codelineno-55-88></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-55-89><a id=__codelineno-55-89 name=__codelineno-55-89 href=#__codelineno-55-89></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
</span><span id=__span-55-90><a id=__codelineno-55-90 name=__codelineno-55-90 href=#__codelineno-55-90></a><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-55-91><a id=__codelineno-55-91 name=__codelineno-55-91 href=#__codelineno-55-91></a><span class=w>      </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;redis-cli&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;ping&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-55-92><a id=__codelineno-55-92 name=__codelineno-55-92 href=#__codelineno-55-92></a><span class=w>      </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-55-93><a id=__codelineno-55-93 name=__codelineno-55-93 href=#__codelineno-55-93></a><span class=w>      </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3s</span>
</span><span id=__span-55-94><a id=__codelineno-55-94 name=__codelineno-55-94 href=#__codelineno-55-94></a><span class=w>      </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-55-95><a id=__codelineno-55-95 name=__codelineno-55-95 href=#__codelineno-55-95></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-55-96><a id=__codelineno-55-96 name=__codelineno-55-96 href=#__codelineno-55-96></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-55-97><a id=__codelineno-55-97 name=__codelineno-55-97 href=#__codelineno-55-97></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-55-98><a id=__codelineno-55-98 name=__codelineno-55-98 href=#__codelineno-55-98></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-55-99><a id=__codelineno-55-99 name=__codelineno-55-99 href=#__codelineno-55-99></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-55-100><a id=__codelineno-55-100 name=__codelineno-55-100 href=#__codelineno-55-100></a>
</span><span id=__span-55-101><a id=__codelineno-55-101 name=__codelineno-55-101 href=#__codelineno-55-101></a><span class=w>  </span><span class=nt>backup</span><span class=p>:</span>
</span><span id=__span-55-102><a id=__codelineno-55-102 name=__codelineno-55-102 href=#__codelineno-55-102></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-55-103><a id=__codelineno-55-103 name=__codelineno-55-103 href=#__codelineno-55-103></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-55-104><a id=__codelineno-55-104 name=__codelineno-55-104 href=#__codelineno-55-104></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data:ro</span>
</span><span id=__span-55-105><a id=__codelineno-55-105 name=__codelineno-55-105 href=#__codelineno-55-105></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./backup:/backup</span>
</span><span id=__span-55-106><a id=__codelineno-55-106 name=__codelineno-55-106 href=#__codelineno-55-106></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">&gt;</span>
</span><span id=__span-55-107><a id=__codelineno-55-107 name=__codelineno-55-107 href=#__codelineno-55-107></a><span class=w>      </span><span class=no>sh -c &quot;</span>
</span><span id=__span-55-108><a id=__codelineno-55-108 name=__codelineno-55-108 href=#__codelineno-55-108></a><span class=w>      </span><span class=no>while true; do</span>
</span><span id=__span-55-109><a id=__codelineno-55-109 name=__codelineno-55-109 href=#__codelineno-55-109></a><span class=w>        </span><span class=no>pg_dump -U user -h db myapp &gt; /backup/backup_$(date +%Y%m%d_%H%M%S).sql</span>
</span><span id=__span-55-110><a id=__codelineno-55-110 name=__codelineno-55-110 href=#__codelineno-55-110></a><span class=w>        </span><span class=no>sleep 3600</span>
</span><span id=__span-55-111><a id=__codelineno-55-111 name=__codelineno-55-111 href=#__codelineno-55-111></a><span class=w>      </span><span class=no>done</span>
</span><span id=__span-55-112><a id=__codelineno-55-112 name=__codelineno-55-112 href=#__codelineno-55-112></a><span class=w>      </span><span class=no>&quot;</span>
</span><span id=__span-55-113><a id=__codelineno-55-113 name=__codelineno-55-113 href=#__codelineno-55-113></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-55-114><a id=__codelineno-55-114 name=__codelineno-55-114 href=#__codelineno-55-114></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-55-115><a id=__codelineno-55-115 name=__codelineno-55-115 href=#__codelineno-55-115></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-55-116><a id=__codelineno-55-116 name=__codelineno-55-116 href=#__codelineno-55-116></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backup</span>
</span><span id=__span-55-117><a id=__codelineno-55-117 name=__codelineno-55-117 href=#__codelineno-55-117></a>
</span><span id=__span-55-118><a id=__codelineno-55-118 name=__codelineno-55-118 href=#__codelineno-55-118></a><span class=w>  </span><span class=nt>monitoring</span><span class=p>:</span>
</span><span id=__span-55-119><a id=__codelineno-55-119 name=__codelineno-55-119 href=#__codelineno-55-119></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id=__span-55-120><a id=__codelineno-55-120 name=__codelineno-55-120 href=#__codelineno-55-120></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-55-121><a id=__codelineno-55-121 name=__codelineno-55-121 href=#__codelineno-55-121></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;9090:9090&quot;</span>
</span><span id=__span-55-122><a id=__codelineno-55-122 name=__codelineno-55-122 href=#__codelineno-55-122></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-55-123><a id=__codelineno-55-123 name=__codelineno-55-123 href=#__codelineno-55-123></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro</span>
</span><span id=__span-55-124><a id=__codelineno-55-124 name=__codelineno-55-124 href=#__codelineno-55-124></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring_data:/prometheus</span>
</span><span id=__span-55-125><a id=__codelineno-55-125 name=__codelineno-55-125 href=#__codelineno-55-125></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span>
</span><span id=__span-55-126><a id=__codelineno-55-126 name=__codelineno-55-126 href=#__codelineno-55-126></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span>
</span><span id=__span-55-127><a id=__codelineno-55-127 name=__codelineno-55-127 href=#__codelineno-55-127></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--storage.tsdb.path=/prometheus&#39;</span>
</span><span id=__span-55-128><a id=__codelineno-55-128 name=__codelineno-55-128 href=#__codelineno-55-128></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--web.console.libraries=/etc/prometheus/console_libraries&#39;</span>
</span><span id=__span-55-129><a id=__codelineno-55-129 name=__codelineno-55-129 href=#__codelineno-55-129></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--web.console.templates=/etc/prometheus/consoles&#39;</span>
</span><span id=__span-55-130><a id=__codelineno-55-130 name=__codelineno-55-130 href=#__codelineno-55-130></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--storage.tsdb.retention.time=200h&#39;</span>
</span><span id=__span-55-131><a id=__codelineno-55-131 name=__codelineno-55-131 href=#__codelineno-55-131></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&#39;--web.enable-lifecycle&#39;</span>
</span><span id=__span-55-132><a id=__codelineno-55-132 name=__codelineno-55-132 href=#__codelineno-55-132></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-55-133><a id=__codelineno-55-133 name=__codelineno-55-133 href=#__codelineno-55-133></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id=__span-55-134><a id=__codelineno-55-134 name=__codelineno-55-134 href=#__codelineno-55-134></a>
</span><span id=__span-55-135><a id=__codelineno-55-135 name=__codelineno-55-135 href=#__codelineno-55-135></a><span class=w>  </span><span class=nt>log-aggregator</span><span class=p>:</span>
</span><span id=__span-55-136><a id=__codelineno-55-136 name=__codelineno-55-136 href=#__codelineno-55-136></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">fluent/fluent-bit:latest</span>
</span><span id=__span-55-137><a id=__codelineno-55-137 name=__codelineno-55-137 href=#__codelineno-55-137></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-55-138><a id=__codelineno-55-138 name=__codelineno-55-138 href=#__codelineno-55-138></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
</span><span id=__span-55-139><a id=__codelineno-55-139 name=__codelineno-55-139 href=#__codelineno-55-139></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf:ro</span>
</span><span id=__span-55-140><a id=__codelineno-55-140 name=__codelineno-55-140 href=#__codelineno-55-140></a><span class=w>    </span><span class=nt>profiles</span><span class=p>:</span>
</span><span id=__span-55-141><a id=__codelineno-55-141 name=__codelineno-55-141 href=#__codelineno-55-141></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">logging</span>
</span><span id=__span-55-142><a id=__codelineno-55-142 name=__codelineno-55-142 href=#__codelineno-55-142></a>
</span><span id=__span-55-143><a id=__codelineno-55-143 name=__codelineno-55-143 href=#__codelineno-55-143></a><span class=nt>secrets</span><span class=p>:</span>
</span><span id=__span-55-144><a id=__codelineno-55-144 name=__codelineno-55-144 href=#__codelineno-55-144></a><span class=w>  </span><span class=nt>api_key</span><span class=p>:</span>
</span><span id=__span-55-145><a id=__codelineno-55-145 name=__codelineno-55-145 href=#__codelineno-55-145></a><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/api_key.txt</span>
</span><span id=__span-55-146><a id=__codelineno-55-146 name=__codelineno-55-146 href=#__codelineno-55-146></a><span class=w>  </span><span class=nt>db_password</span><span class=p>:</span>
</span><span id=__span-55-147><a id=__codelineno-55-147 name=__codelineno-55-147 href=#__codelineno-55-147></a><span class=w>    </span><span class=nt>file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/db_password.txt</span>
</span><span id=__span-55-148><a id=__codelineno-55-148 name=__codelineno-55-148 href=#__codelineno-55-148></a>
</span><span id=__span-55-149><a id=__codelineno-55-149 name=__codelineno-55-149 href=#__codelineno-55-149></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-55-150><a id=__codelineno-55-150 name=__codelineno-55-150 href=#__codelineno-55-150></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span><span id=__span-55-151><a id=__codelineno-55-151 name=__codelineno-55-151 href=#__codelineno-55-151></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id=__span-55-152><a id=__codelineno-55-152 name=__codelineno-55-152 href=#__codelineno-55-152></a><span class=w>  </span><span class=nt>redis_data</span><span class=p>:</span>
</span><span id=__span-55-153><a id=__codelineno-55-153 name=__codelineno-55-153 href=#__codelineno-55-153></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id=__span-55-154><a id=__codelineno-55-154 name=__codelineno-55-154 href=#__codelineno-55-154></a><span class=w>  </span><span class=nt>monitoring_data</span><span class=p>:</span>
</span><span id=__span-55-155><a id=__codelineno-55-155 name=__codelineno-55-155 href=#__codelineno-55-155></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id=__span-55-156><a id=__codelineno-55-156 name=__codelineno-55-156 href=#__codelineno-55-156></a>
</span><span id=__span-55-157><a id=__codelineno-55-157 name=__codelineno-55-157 href=#__codelineno-55-157></a><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-55-158><a id=__codelineno-55-158 name=__codelineno-55-158 href=#__codelineno-55-158></a><span class=w>  </span><span class=nt>frontend</span><span class=p>:</span>
</span><span id=__span-55-159><a id=__codelineno-55-159 name=__codelineno-55-159 href=#__codelineno-55-159></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-55-160><a id=__codelineno-55-160 name=__codelineno-55-160 href=#__codelineno-55-160></a><span class=w>  </span><span class=nt>backend</span><span class=p>:</span>
</span><span id=__span-55-161><a id=__codelineno-55-161 name=__codelineno-55-161 href=#__codelineno-55-161></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-55-162><a id=__codelineno-55-162 name=__codelineno-55-162 href=#__codelineno-55-162></a><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-56-1><a id=__codelineno-56-1 name=__codelineno-56-1 href=#__codelineno-56-1></a><span class=c1># Create secrets</span>
</span><span id=__span-56-2><a id=__codelineno-56-2 name=__codelineno-56-2 href=#__codelineno-56-2></a>mkdir<span class=w> </span>-p<span class=w> </span>secrets
</span><span id=__span-56-3><a id=__codelineno-56-3 name=__codelineno-56-3 href=#__codelineno-56-3></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;my-secret-api-key&quot;</span><span class=w> </span>&gt;<span class=w> </span>secrets/api_key.txt
</span><span id=__span-56-4><a id=__codelineno-56-4 name=__codelineno-56-4 href=#__codelineno-56-4></a><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;my-secret-db-password&quot;</span><span class=w> </span>&gt;<span class=w> </span>secrets/db_password.txt
</span><span id=__span-56-5><a id=__codelineno-56-5 name=__codelineno-56-5 href=#__codelineno-56-5></a>
</span><span id=__span-56-6><a id=__codelineno-56-6 name=__codelineno-56-6 href=#__codelineno-56-6></a><span class=c1># Start production stack</span>
</span><span id=__span-56-7><a id=__codelineno-56-7 name=__codelineno-56-7 href=#__codelineno-56-7></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-56-8><a id=__codelineno-56-8 name=__codelineno-56-8 href=#__codelineno-56-8></a>
</span><span id=__span-56-9><a id=__codelineno-56-9 name=__codelineno-56-9 href=#__codelineno-56-9></a><span class=c1># Start with monitoring</span>
</span><span id=__span-56-10><a id=__codelineno-56-10 name=__codelineno-56-10 href=#__codelineno-56-10></a>docker-compose<span class=w> </span>--profile<span class=w> </span>monitoring<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-56-11><a id=__codelineno-56-11 name=__codelineno-56-11 href=#__codelineno-56-11></a>
</span><span id=__span-56-12><a id=__codelineno-56-12 name=__codelineno-56-12 href=#__codelineno-56-12></a><span class=c1># Start with logging</span>
</span><span id=__span-56-13><a id=__codelineno-56-13 name=__codelineno-56-13 href=#__codelineno-56-13></a>docker-compose<span class=w> </span>--profile<span class=w> </span>logging<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-56-14><a id=__codelineno-56-14 name=__codelineno-56-14 href=#__codelineno-56-14></a>
</span><span id=__span-56-15><a id=__codelineno-56-15 name=__codelineno-56-15 href=#__codelineno-56-15></a><span class=c1># Start backup service</span>
</span><span id=__span-56-16><a id=__codelineno-56-16 name=__codelineno-56-16 href=#__codelineno-56-16></a>docker-compose<span class=w> </span>--profile<span class=w> </span>backup<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-56-17><a id=__codelineno-56-17 name=__codelineno-56-17 href=#__codelineno-56-17></a>
</span><span id=__span-56-18><a id=__codelineno-56-18 name=__codelineno-56-18 href=#__codelineno-56-18></a><span class=c1># Check all services</span>
</span><span id=__span-56-19><a id=__codelineno-56-19 name=__codelineno-56-19 href=#__codelineno-56-19></a>docker-compose<span class=w> </span>ps
</span><span id=__span-56-20><a id=__codelineno-56-20 name=__codelineno-56-20 href=#__codelineno-56-20></a>
</span><span id=__span-56-21><a id=__codelineno-56-21 name=__codelineno-56-21 href=#__codelineno-56-21></a><span class=c1># View logs</span>
</span><span id=__span-56-22><a id=__codelineno-56-22 name=__codelineno-56-22 href=#__codelineno-56-22></a>docker-compose<span class=w> </span>logs<span class=w> </span>-f
</span><span id=__span-56-23><a id=__codelineno-56-23 name=__codelineno-56-23 href=#__codelineno-56-23></a>
</span><span id=__span-56-24><a id=__codelineno-56-24 name=__codelineno-56-24 href=#__codelineno-56-24></a><span class=c1># Monitor resources</span>
</span><span id=__span-56-25><a id=__codelineno-56-25 name=__codelineno-56-25 href=#__codelineno-56-25></a>docker<span class=w> </span>stats
</span><span id=__span-56-26><a id=__codelineno-56-26 name=__codelineno-56-26 href=#__codelineno-56-26></a>
</span><span id=__span-56-27><a id=__codelineno-56-27 name=__codelineno-56-27 href=#__codelineno-56-27></a><span class=c1># Backup database</span>
</span><span id=__span-56-28><a id=__codelineno-56-28 name=__codelineno-56-28 href=#__codelineno-56-28></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>backup<span class=w> </span>ls<span class=w> </span>/backup/
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>Production hardening</strong>: Resource limits, health checks, secrets management</li> <li><strong>Monitoring</strong>: Prometheus for metrics collection</li> <li><strong>Logging</strong>: Centralized log aggregation with Fluent Bit</li> <li><strong>Backup</strong>: Automated database backups</li> <li><strong>Security</strong>: Secrets, read-only volumes, network isolation</li> <li><strong>High availability</strong>: Health checks, restart policies, resource management</li> <li><strong>Scalability</strong>: Profiles for optional services, resource limits</li> <li><strong>Maintainability</strong>: Structured configuration, clear separation of concerns</li> </ul> </details> <hr> <h4 id=19-basic-yaml-anchors-and-references>19. Basic YAML Anchors and References<a class=headerlink href=#19-basic-yaml-anchors-and-references title="Permanent link">&para;</a></h4> <ul> <li> <p>Learn the fundamentals of YAML anchors and references to avoid repetition in Docker Compose files.</p> <h4 id=scenario_18><strong>Scenario:</strong><a class=headerlink href=#scenario_18 title="Permanent link">&para;</a></h4> <ul> <li>You have multiple services that share common configuration elements like environment variables, volumes, or network settings.</li> <li>YAML anchors (&amp;) and references (*) allow you to define reusable configuration blocks and reference them throughout your compose file.</li> </ul> <h4 id=resources_8>Resources:<a class=headerlink href=#resources_8 title="Permanent link">&para;</a></h4> <ul> <li><code>docker-compose.yml</code> ➤ Main compose file with anchors and references <div class="language-yaml highlight"><pre><span></span><code><span id=__span-57-1><a id=__codelineno-57-1 name=__codelineno-57-1 href=#__codelineno-57-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-57-2><a id=__codelineno-57-2 name=__codelineno-57-2 href=#__codelineno-57-2></a>
</span><span id=__span-57-3><a id=__codelineno-57-3 name=__codelineno-57-3 href=#__codelineno-57-3></a><span class=nt>x-common-env</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;common-env</span>
</span><span id=__span-57-4><a id=__codelineno-57-4 name=__codelineno-57-4 href=#__codelineno-57-4></a><span class=w>  </span><span class=nt>APP_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-57-5><a id=__codelineno-57-5 name=__codelineno-57-5 href=#__codelineno-57-5></a><span class=w>  </span><span class=nt>LOG_LEVEL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id=__span-57-6><a id=__codelineno-57-6 name=__codelineno-57-6 href=#__codelineno-57-6></a>
</span><span id=__span-57-7><a id=__codelineno-57-7 name=__codelineno-57-7 href=#__codelineno-57-7></a><span class=nt>x-common-volumes</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;common-volumes</span>
</span><span id=__span-57-8><a id=__codelineno-57-8 name=__codelineno-57-8 href=#__codelineno-57-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/app/logs</span>
</span><span id=__span-57-9><a id=__codelineno-57-9 name=__codelineno-57-9 href=#__codelineno-57-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./config:/app/config:ro</span>
</span><span id=__span-57-10><a id=__codelineno-57-10 name=__codelineno-57-10 href=#__codelineno-57-10></a>
</span><span id=__span-57-11><a id=__codelineno-57-11 name=__codelineno-57-11 href=#__codelineno-57-11></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-57-12><a id=__codelineno-57-12 name=__codelineno-57-12 href=#__codelineno-57-12></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-57-13><a id=__codelineno-57-13 name=__codelineno-57-13 href=#__codelineno-57-13></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-57-14><a id=__codelineno-57-14 name=__codelineno-57-14 href=#__codelineno-57-14></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-57-15><a id=__codelineno-57-15 name=__codelineno-57-15 href=#__codelineno-57-15></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-env</span>
</span><span id=__span-57-16><a id=__codelineno-57-16 name=__codelineno-57-16 href=#__codelineno-57-16></a><span class=w>      </span><span class=nt>SERVICE_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id=__span-57-17><a id=__codelineno-57-17 name=__codelineno-57-17 href=#__codelineno-57-17></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w> </span><span class=nv>*common-volumes</span>
</span><span id=__span-57-18><a id=__codelineno-57-18 name=__codelineno-57-18 href=#__codelineno-57-18></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-57-19><a id=__codelineno-57-19 name=__codelineno-57-19 href=#__codelineno-57-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-57-20><a id=__codelineno-57-20 name=__codelineno-57-20 href=#__codelineno-57-20></a>
</span><span id=__span-57-21><a id=__codelineno-57-21 name=__codelineno-57-21 href=#__codelineno-57-21></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-57-22><a id=__codelineno-57-22 name=__codelineno-57-22 href=#__codelineno-57-22></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-57-23><a id=__codelineno-57-23 name=__codelineno-57-23 href=#__codelineno-57-23></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-57-24><a id=__codelineno-57-24 name=__codelineno-57-24 href=#__codelineno-57-24></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-env</span>
</span><span id=__span-57-25><a id=__codelineno-57-25 name=__codelineno-57-25 href=#__codelineno-57-25></a><span class=w>      </span><span class=nt>SERVICE_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-57-26><a id=__codelineno-57-26 name=__codelineno-57-26 href=#__codelineno-57-26></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w> </span><span class=nv>*common-volumes</span>
</span><span id=__span-57-27><a id=__codelineno-57-27 name=__codelineno-57-27 href=#__codelineno-57-27></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-57-28><a id=__codelineno-57-28 name=__codelineno-57-28 href=#__codelineno-57-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>&amp;anchor-name</code> to define reusable blocks and <code>*anchor-name</code> to reference them</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-58-1><a id=__codelineno-58-1 name=__codelineno-58-1 href=#__codelineno-58-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-58-2><a id=__codelineno-58-2 name=__codelineno-58-2 href=#__codelineno-58-2></a>
</span><span id=__span-58-3><a id=__codelineno-58-3 name=__codelineno-58-3 href=#__codelineno-58-3></a><span class=nt>x-common-env</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;common-env</span>
</span><span id=__span-58-4><a id=__codelineno-58-4 name=__codelineno-58-4 href=#__codelineno-58-4></a><span class=w>  </span><span class=nt>APP_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-58-5><a id=__codelineno-58-5 name=__codelineno-58-5 href=#__codelineno-58-5></a><span class=w>  </span><span class=nt>LOG_LEVEL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id=__span-58-6><a id=__codelineno-58-6 name=__codelineno-58-6 href=#__codelineno-58-6></a><span class=w>  </span><span class=nt>TZ</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id=__span-58-7><a id=__codelineno-58-7 name=__codelineno-58-7 href=#__codelineno-58-7></a>
</span><span id=__span-58-8><a id=__codelineno-58-8 name=__codelineno-58-8 href=#__codelineno-58-8></a><span class=nt>x-common-volumes</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;common-volumes</span>
</span><span id=__span-58-9><a id=__codelineno-58-9 name=__codelineno-58-9 href=#__codelineno-58-9></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/app/logs</span>
</span><span id=__span-58-10><a id=__codelineno-58-10 name=__codelineno-58-10 href=#__codelineno-58-10></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./config:/app/config:ro</span>
</span><span id=__span-58-11><a id=__codelineno-58-11 name=__codelineno-58-11 href=#__codelineno-58-11></a>
</span><span id=__span-58-12><a id=__codelineno-58-12 name=__codelineno-58-12 href=#__codelineno-58-12></a><span class=nt>x-common-deploy</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;common-deploy</span>
</span><span id=__span-58-13><a id=__codelineno-58-13 name=__codelineno-58-13 href=#__codelineno-58-13></a><span class=w>  </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-58-14><a id=__codelineno-58-14 name=__codelineno-58-14 href=#__codelineno-58-14></a><span class=w>    </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-58-15><a id=__codelineno-58-15 name=__codelineno-58-15 href=#__codelineno-58-15></a><span class=w>      </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-58-16><a id=__codelineno-58-16 name=__codelineno-58-16 href=#__codelineno-58-16></a><span class=w>      </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-58-17><a id=__codelineno-58-17 name=__codelineno-58-17 href=#__codelineno-58-17></a><span class=w>    </span><span class=nt>restart_policy</span><span class=p>:</span>
</span><span id=__span-58-18><a id=__codelineno-58-18 name=__codelineno-58-18 href=#__codelineno-58-18></a><span class=w>      </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id=__span-58-19><a id=__codelineno-58-19 name=__codelineno-58-19 href=#__codelineno-58-19></a>
</span><span id=__span-58-20><a id=__codelineno-58-20 name=__codelineno-58-20 href=#__codelineno-58-20></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-58-21><a id=__codelineno-58-21 name=__codelineno-58-21 href=#__codelineno-58-21></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-58-22><a id=__codelineno-58-22 name=__codelineno-58-22 href=#__codelineno-58-22></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-58-23><a id=__codelineno-58-23 name=__codelineno-58-23 href=#__codelineno-58-23></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-58-24><a id=__codelineno-58-24 name=__codelineno-58-24 href=#__codelineno-58-24></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-env</span>
</span><span id=__span-58-25><a id=__codelineno-58-25 name=__codelineno-58-25 href=#__codelineno-58-25></a><span class=w>      </span><span class=nt>SERVICE_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id=__span-58-26><a id=__codelineno-58-26 name=__codelineno-58-26 href=#__codelineno-58-26></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w> </span><span class=nv>*common-volumes</span>
</span><span id=__span-58-27><a id=__codelineno-58-27 name=__codelineno-58-27 href=#__codelineno-58-27></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-58-28><a id=__codelineno-58-28 name=__codelineno-58-28 href=#__codelineno-58-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-58-29><a id=__codelineno-58-29 name=__codelineno-58-29 href=#__codelineno-58-29></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w> </span><span class=nv>*common-deploy</span>
</span><span id=__span-58-30><a id=__codelineno-58-30 name=__codelineno-58-30 href=#__codelineno-58-30></a>
</span><span id=__span-58-31><a id=__codelineno-58-31 name=__codelineno-58-31 href=#__codelineno-58-31></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-58-32><a id=__codelineno-58-32 name=__codelineno-58-32 href=#__codelineno-58-32></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-58-33><a id=__codelineno-58-33 name=__codelineno-58-33 href=#__codelineno-58-33></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-58-34><a id=__codelineno-58-34 name=__codelineno-58-34 href=#__codelineno-58-34></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-env</span>
</span><span id=__span-58-35><a id=__codelineno-58-35 name=__codelineno-58-35 href=#__codelineno-58-35></a><span class=w>      </span><span class=nt>SERVICE_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-58-36><a id=__codelineno-58-36 name=__codelineno-58-36 href=#__codelineno-58-36></a><span class=w>      </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id=__span-58-37><a id=__codelineno-58-37 name=__codelineno-58-37 href=#__codelineno-58-37></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span><span class=w> </span><span class=nv>*common-volumes</span>
</span><span id=__span-58-38><a id=__codelineno-58-38 name=__codelineno-58-38 href=#__codelineno-58-38></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-58-39><a id=__codelineno-58-39 name=__codelineno-58-39 href=#__codelineno-58-39></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span><span id=__span-58-40><a id=__codelineno-58-40 name=__codelineno-58-40 href=#__codelineno-58-40></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w> </span><span class=nv>*common-deploy</span>
</span><span id=__span-58-41><a id=__codelineno-58-41 name=__codelineno-58-41 href=#__codelineno-58-41></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-58-42><a id=__codelineno-58-42 name=__codelineno-58-42 href=#__codelineno-58-42></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-58-43><a id=__codelineno-58-43 name=__codelineno-58-43 href=#__codelineno-58-43></a>
</span><span id=__span-58-44><a id=__codelineno-58-44 name=__codelineno-58-44 href=#__codelineno-58-44></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-58-45><a id=__codelineno-58-45 name=__codelineno-58-45 href=#__codelineno-58-45></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-58-46><a id=__codelineno-58-46 name=__codelineno-58-46 href=#__codelineno-58-46></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-58-47><a id=__codelineno-58-47 name=__codelineno-58-47 href=#__codelineno-58-47></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-58-48><a id=__codelineno-58-48 name=__codelineno-58-48 href=#__codelineno-58-48></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-58-49><a id=__codelineno-58-49 name=__codelineno-58-49 href=#__codelineno-58-49></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-58-50><a id=__codelineno-58-50 name=__codelineno-58-50 href=#__codelineno-58-50></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-58-51><a id=__codelineno-58-51 name=__codelineno-58-51 href=#__codelineno-58-51></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-58-52><a id=__codelineno-58-52 name=__codelineno-58-52 href=#__codelineno-58-52></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w> </span><span class=nv>*common-deploy</span>
</span><span id=__span-58-53><a id=__codelineno-58-53 name=__codelineno-58-53 href=#__codelineno-58-53></a>
</span><span id=__span-58-54><a id=__codelineno-58-54 name=__codelineno-58-54 href=#__codelineno-58-54></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-58-55><a id=__codelineno-58-55 name=__codelineno-58-55 href=#__codelineno-58-55></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-59-1><a id=__codelineno-59-1 name=__codelineno-59-1 href=#__codelineno-59-1></a><span class=c1># Start services</span>
</span><span id=__span-59-2><a id=__codelineno-59-2 name=__codelineno-59-2 href=#__codelineno-59-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-59-3><a id=__codelineno-59-3 name=__codelineno-59-3 href=#__codelineno-59-3></a>
</span><span id=__span-59-4><a id=__codelineno-59-4 name=__codelineno-59-4 href=#__codelineno-59-4></a><span class=c1># Check environment variables</span>
</span><span id=__span-59-5><a id=__codelineno-59-5 name=__codelineno-59-5 href=#__codelineno-59-5></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>env<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>APP_ENV
</span><span id=__span-59-6><a id=__codelineno-59-6 name=__codelineno-59-6 href=#__codelineno-59-6></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>api<span class=w> </span>env<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>SERVICE_NAME
</span><span id=__span-59-7><a id=__codelineno-59-7 name=__codelineno-59-7 href=#__codelineno-59-7></a>
</span><span id=__span-59-8><a id=__codelineno-59-8 name=__codelineno-59-8 href=#__codelineno-59-8></a><span class=c1># View configuration</span>
</span><span id=__span-59-9><a id=__codelineno-59-9 name=__codelineno-59-9 href=#__codelineno-59-9></a>docker-compose<span class=w> </span>config
</span><span id=__span-59-10><a id=__codelineno-59-10 name=__codelineno-59-10 href=#__codelineno-59-10></a>
</span><span id=__span-59-11><a id=__codelineno-59-11 name=__codelineno-59-11 href=#__codelineno-59-11></a><span class=c1># Stop services</span>
</span><span id=__span-59-12><a id=__codelineno-59-12 name=__codelineno-59-12 href=#__codelineno-59-12></a>docker-compose<span class=w> </span>down
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>x- prefix</strong>: Extension fields for reusable configurations</li> <li><strong>&amp;anchor</strong>: Defines a named anchor for later reference</li> <li>***reference**: References the anchored configuration</li> <li><strong>&lt;&lt;: *anchor</strong>: Merges the referenced configuration</li> <li><strong>DRY principle</strong>: Avoids repetition in compose files</li> <li><strong>Maintainability</strong>: Changes to common config affect all services</li> </ul> </details> <hr> <h4 id=20-merging-service-configurations>20. Merging Service Configurations<a class=headerlink href=#20-merging-service-configurations title="Permanent link">&para;</a></h4> <ul> <li> <p>Use YAML merge keys to combine base configurations with service-specific overrides.</p> <h4 id=scenario_19><strong>Scenario:</strong><a class=headerlink href=#scenario_19 title="Permanent link">&para;</a></h4> <ul> <li>Your services have a common base configuration but need individual customizations for ports, environment variables, or resource limits.</li> <li>The merge key (&lt;&lt;) allows you to combine multiple configurations, with later values overriding earlier ones.</li> </ul> <h4 id=resources_9>Resources:<a class=headerlink href=#resources_9 title="Permanent link">&para;</a></h4> <ul> <li><code>docker-compose.yml</code> ➤ Compose file demonstrating merge operations <div class="language-yaml highlight"><pre><span></span><code><span id=__span-60-1><a id=__codelineno-60-1 name=__codelineno-60-1 href=#__codelineno-60-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-60-2><a id=__codelineno-60-2 name=__codelineno-60-2 href=#__codelineno-60-2></a>
</span><span id=__span-60-3><a id=__codelineno-60-3 name=__codelineno-60-3 href=#__codelineno-60-3></a><span class=nt>x-base-service</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;base-service</span>
</span><span id=__span-60-4><a id=__codelineno-60-4 name=__codelineno-60-4 href=#__codelineno-60-4></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-60-5><a id=__codelineno-60-5 name=__codelineno-60-5 href=#__codelineno-60-5></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-60-6><a id=__codelineno-60-6 name=__codelineno-60-6 href=#__codelineno-60-6></a><span class=w>    </span><span class=nt>APP_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-60-7><a id=__codelineno-60-7 name=__codelineno-60-7 href=#__codelineno-60-7></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-60-8><a id=__codelineno-60-8 name=__codelineno-60-8 href=#__codelineno-60-8></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-60-9><a id=__codelineno-60-9 name=__codelineno-60-9 href=#__codelineno-60-9></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-60-10><a id=__codelineno-60-10 name=__codelineno-60-10 href=#__codelineno-60-10></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id=__span-60-11><a id=__codelineno-60-11 name=__codelineno-60-11 href=#__codelineno-60-11></a><span class=w>        </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.25&#39;</span>
</span><span id=__span-60-12><a id=__codelineno-60-12 name=__codelineno-60-12 href=#__codelineno-60-12></a>
</span><span id=__span-60-13><a id=__codelineno-60-13 name=__codelineno-60-13 href=#__codelineno-60-13></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-60-14><a id=__codelineno-60-14 name=__codelineno-60-14 href=#__codelineno-60-14></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-60-15><a id=__codelineno-60-15 name=__codelineno-60-15 href=#__codelineno-60-15></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*base-service</span>
</span><span id=__span-60-16><a id=__codelineno-60-16 name=__codelineno-60-16 href=#__codelineno-60-16></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-60-17><a id=__codelineno-60-17 name=__codelineno-60-17 href=#__codelineno-60-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-60-18><a id=__codelineno-60-18 name=__codelineno-60-18 href=#__codelineno-60-18></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx -g &#39;daemon off;&#39;</span>
</span><span id=__span-60-19><a id=__codelineno-60-19 name=__codelineno-60-19 href=#__codelineno-60-19></a>
</span><span id=__span-60-20><a id=__codelineno-60-20 name=__codelineno-60-20 href=#__codelineno-60-20></a><span class=w>  </span><span class=nt>worker</span><span class=p>:</span>
</span><span id=__span-60-21><a id=__codelineno-60-21 name=__codelineno-60-21 href=#__codelineno-60-21></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*base-service</span>
</span><span id=__span-60-22><a id=__codelineno-60-22 name=__codelineno-60-22 href=#__codelineno-60-22></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-60-23><a id=__codelineno-60-23 name=__codelineno-60-23 href=#__codelineno-60-23></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*base-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-60-24><a id=__codelineno-60-24 name=__codelineno-60-24 href=#__codelineno-60-24></a><span class=w>      </span><span class=nt>WORKER_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">background</span>
</span><span id=__span-60-25><a id=__codelineno-60-25 name=__codelineno-60-25 href=#__codelineno-60-25></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;while true; do echo &quot;Working...&quot;; sleep 30; done&#39;</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>&lt;&lt;: *anchor</code> to merge configurations and override specific values</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-61-1><a id=__codelineno-61-1 name=__codelineno-61-1 href=#__codelineno-61-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-61-2><a id=__codelineno-61-2 name=__codelineno-61-2 href=#__codelineno-61-2></a>
</span><span id=__span-61-3><a id=__codelineno-61-3 name=__codelineno-61-3 href=#__codelineno-61-3></a><span class=nt>x-base-service</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;base-service</span>
</span><span id=__span-61-4><a id=__codelineno-61-4 name=__codelineno-61-4 href=#__codelineno-61-4></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-61-5><a id=__codelineno-61-5 name=__codelineno-61-5 href=#__codelineno-61-5></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-61-6><a id=__codelineno-61-6 name=__codelineno-61-6 href=#__codelineno-61-6></a><span class=w>    </span><span class=nt>APP_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-61-7><a id=__codelineno-61-7 name=__codelineno-61-7 href=#__codelineno-61-7></a><span class=w>    </span><span class=nt>LOG_LEVEL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id=__span-61-8><a id=__codelineno-61-8 name=__codelineno-61-8 href=#__codelineno-61-8></a><span class=w>    </span><span class=nt>TZ</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id=__span-61-9><a id=__codelineno-61-9 name=__codelineno-61-9 href=#__codelineno-61-9></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-61-10><a id=__codelineno-61-10 name=__codelineno-61-10 href=#__codelineno-61-10></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-61-11><a id=__codelineno-61-11 name=__codelineno-61-11 href=#__codelineno-61-11></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-61-12><a id=__codelineno-61-12 name=__codelineno-61-12 href=#__codelineno-61-12></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id=__span-61-13><a id=__codelineno-61-13 name=__codelineno-61-13 href=#__codelineno-61-13></a><span class=w>        </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.25&#39;</span>
</span><span id=__span-61-14><a id=__codelineno-61-14 name=__codelineno-61-14 href=#__codelineno-61-14></a><span class=w>    </span><span class=nt>restart_policy</span><span class=p>:</span>
</span><span id=__span-61-15><a id=__codelineno-61-15 name=__codelineno-61-15 href=#__codelineno-61-15></a><span class=w>      </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id=__span-61-16><a id=__codelineno-61-16 name=__codelineno-61-16 href=#__codelineno-61-16></a><span class=w>  </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-61-17><a id=__codelineno-61-17 name=__codelineno-61-17 href=#__codelineno-61-17></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-61-18><a id=__codelineno-61-18 name=__codelineno-61-18 href=#__codelineno-61-18></a><span class=w>    </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-61-19><a id=__codelineno-61-19 name=__codelineno-61-19 href=#__codelineno-61-19></a><span class=w>      </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10m&quot;</span>
</span><span id=__span-61-20><a id=__codelineno-61-20 name=__codelineno-61-20 href=#__codelineno-61-20></a><span class=w>      </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3&quot;</span>
</span><span id=__span-61-21><a id=__codelineno-61-21 name=__codelineno-61-21 href=#__codelineno-61-21></a>
</span><span id=__span-61-22><a id=__codelineno-61-22 name=__codelineno-61-22 href=#__codelineno-61-22></a><span class=nt>x-web-config</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;web-config</span>
</span><span id=__span-61-23><a id=__codelineno-61-23 name=__codelineno-61-23 href=#__codelineno-61-23></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*base-service</span>
</span><span id=__span-61-24><a id=__codelineno-61-24 name=__codelineno-61-24 href=#__codelineno-61-24></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-61-25><a id=__codelineno-61-25 name=__codelineno-61-25 href=#__codelineno-61-25></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-61-26><a id=__codelineno-61-26 name=__codelineno-61-26 href=#__codelineno-61-26></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-61-27><a id=__codelineno-61-27 name=__codelineno-61-27 href=#__codelineno-61-27></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-61-28><a id=__codelineno-61-28 name=__codelineno-61-28 href=#__codelineno-61-28></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-61-29><a id=__codelineno-61-29 name=__codelineno-61-29 href=#__codelineno-61-29></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-61-30><a id=__codelineno-61-30 name=__codelineno-61-30 href=#__codelineno-61-30></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-61-31><a id=__codelineno-61-31 name=__codelineno-61-31 href=#__codelineno-61-31></a>
</span><span id=__span-61-32><a id=__codelineno-61-32 name=__codelineno-61-32 href=#__codelineno-61-32></a><span class=nt>x-api-config</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;api-config</span>
</span><span id=__span-61-33><a id=__codelineno-61-33 name=__codelineno-61-33 href=#__codelineno-61-33></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*base-service</span>
</span><span id=__span-61-34><a id=__codelineno-61-34 name=__codelineno-61-34 href=#__codelineno-61-34></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-61-35><a id=__codelineno-61-35 name=__codelineno-61-35 href=#__codelineno-61-35></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span><span id=__span-61-36><a id=__codelineno-61-36 name=__codelineno-61-36 href=#__codelineno-61-36></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-61-37><a id=__codelineno-61-37 name=__codelineno-61-37 href=#__codelineno-61-37></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*base-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-61-38><a id=__codelineno-61-38 name=__codelineno-61-38 href=#__codelineno-61-38></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-61-39><a id=__codelineno-61-39 name=__codelineno-61-39 href=#__codelineno-61-39></a><span class=w>    </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id=__span-61-40><a id=__codelineno-61-40 name=__codelineno-61-40 href=#__codelineno-61-40></a><span class=w>  </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-61-41><a id=__codelineno-61-41 name=__codelineno-61-41 href=#__codelineno-61-41></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-61-42><a id=__codelineno-61-42 name=__codelineno-61-42 href=#__codelineno-61-42></a>
</span><span id=__span-61-43><a id=__codelineno-61-43 name=__codelineno-61-43 href=#__codelineno-61-43></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-61-44><a id=__codelineno-61-44 name=__codelineno-61-44 href=#__codelineno-61-44></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-61-45><a id=__codelineno-61-45 name=__codelineno-61-45 href=#__codelineno-61-45></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-config</span>
</span><span id=__span-61-46><a id=__codelineno-61-46 name=__codelineno-61-46 href=#__codelineno-61-46></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;&lt;h1&gt;Web Service&lt;/h1&gt;&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 80 -h /tmp&#39;</span>
</span><span id=__span-61-47><a id=__codelineno-61-47 name=__codelineno-61-47 href=#__codelineno-61-47></a>
</span><span id=__span-61-48><a id=__codelineno-61-48 name=__codelineno-61-48 href=#__codelineno-61-48></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-61-49><a id=__codelineno-61-49 name=__codelineno-61-49 href=#__codelineno-61-49></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-config</span>
</span><span id=__span-61-50><a id=__codelineno-61-50 name=__codelineno-61-50 href=#__codelineno-61-50></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;while true; do echo &quot;API running on port 3000&quot;; sleep 10; done&#39;</span>
</span><span id=__span-61-51><a id=__codelineno-61-51 name=__codelineno-61-51 href=#__codelineno-61-51></a>
</span><span id=__span-61-52><a id=__codelineno-61-52 name=__codelineno-61-52 href=#__codelineno-61-52></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-61-53><a id=__codelineno-61-53 name=__codelineno-61-53 href=#__codelineno-61-53></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-61-54><a id=__codelineno-61-54 name=__codelineno-61-54 href=#__codelineno-61-54></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-61-55><a id=__codelineno-61-55 name=__codelineno-61-55 href=#__codelineno-61-55></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-61-56><a id=__codelineno-61-56 name=__codelineno-61-56 href=#__codelineno-61-56></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-61-57><a id=__codelineno-61-57 name=__codelineno-61-57 href=#__codelineno-61-57></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-61-58><a id=__codelineno-61-58 name=__codelineno-61-58 href=#__codelineno-61-58></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-61-59><a id=__codelineno-61-59 name=__codelineno-61-59 href=#__codelineno-61-59></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-61-60><a id=__codelineno-61-60 name=__codelineno-61-60 href=#__codelineno-61-60></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span><span class=w> </span><span class=nv>*base-service</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-61-61><a id=__codelineno-61-61 name=__codelineno-61-61 href=#__codelineno-61-61></a>
</span><span id=__span-61-62><a id=__codelineno-61-62 name=__codelineno-61-62 href=#__codelineno-61-62></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-61-63><a id=__codelineno-61-63 name=__codelineno-61-63 href=#__codelineno-61-63></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-62-1><a id=__codelineno-62-1 name=__codelineno-62-1 href=#__codelineno-62-1></a><span class=c1># Start services</span>
</span><span id=__span-62-2><a id=__codelineno-62-2 name=__codelineno-62-2 href=#__codelineno-62-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-62-3><a id=__codelineno-62-3 name=__codelineno-62-3 href=#__codelineno-62-3></a>
</span><span id=__span-62-4><a id=__codelineno-62-4 name=__codelineno-62-4 href=#__codelineno-62-4></a><span class=c1># Check merged configurations</span>
</span><span id=__span-62-5><a id=__codelineno-62-5 name=__codelineno-62-5 href=#__codelineno-62-5></a>docker-compose<span class=w> </span>config
</span><span id=__span-62-6><a id=__codelineno-62-6 name=__codelineno-62-6 href=#__codelineno-62-6></a>
</span><span id=__span-62-7><a id=__codelineno-62-7 name=__codelineno-62-7 href=#__codelineno-62-7></a><span class=c1># Test services</span>
</span><span id=__span-62-8><a id=__codelineno-62-8 name=__codelineno-62-8 href=#__codelineno-62-8></a>curl<span class=w> </span>http://localhost:8080
</span><span id=__span-62-9><a id=__codelineno-62-9 name=__codelineno-62-9 href=#__codelineno-62-9></a>docker-compose<span class=w> </span>logs<span class=w> </span>api
</span><span id=__span-62-10><a id=__codelineno-62-10 name=__codelineno-62-10 href=#__codelineno-62-10></a>
</span><span id=__span-62-11><a id=__codelineno-62-11 name=__codelineno-62-11 href=#__codelineno-62-11></a><span class=c1># Inspect service configurations</span>
</span><span id=__span-62-12><a id=__codelineno-62-12 name=__codelineno-62-12 href=#__codelineno-62-12></a>docker<span class=w> </span>inspect<span class=w> </span><span class=k>$(</span>docker-compose<span class=w> </span>ps<span class=w> </span>-q<span class=w> </span>web<span class=k>)</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span><span class=s1>&#39;.[0].Config.Env&#39;</span>
</span><span id=__span-62-13><a id=__codelineno-62-13 name=__codelineno-62-13 href=#__codelineno-62-13></a>
</span><span id=__span-62-14><a id=__codelineno-62-14 name=__codelineno-62-14 href=#__codelineno-62-14></a><span class=c1># Stop services</span>
</span><span id=__span-62-15><a id=__codelineno-62-15 name=__codelineno-62-15 href=#__codelineno-62-15></a>docker-compose<span class=w> </span>down
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>&lt;&lt;: *anchor</strong>: Merges the referenced configuration into the current block</li> <li><strong>Override behavior</strong>: Later values override earlier ones with the same key</li> <li><strong>Nested merges</strong>: Can merge multiple levels of configuration</li> <li><strong>Base + specific</strong>: Common pattern of base config plus service-specific additions</li> <li><strong>Configuration inheritance</strong>: Services inherit from base configurations</li> </ul> </details> <hr> <h4 id=21-using-includes-for-modular-compose-files>21. Using Includes for Modular Compose Files<a class=headerlink href=#21-using-includes-for-modular-compose-files title="Permanent link">&para;</a></h4> <ul> <li> <p>Split large compose files into smaller, manageable modules using Docker Compose includes.</p> <h4 id=scenario_20><strong>Scenario:</strong><a class=headerlink href=#scenario_20 title="Permanent link">&para;</a></h4> <ul> <li>Your application stack is complex with many services, networks, and volumes, making the compose file difficult to maintain.</li> <li>Docker Compose includes allow you to split your configuration across multiple files for better organization and reusability.</li> </ul> <h4 id=resources_10>Resources:<a class=headerlink href=#resources_10 title="Permanent link">&para;</a></h4> <ul> <li><code>docker-compose.yml</code> ➤ Main compose file with includes <div class="language-yaml highlight"><pre><span></span><code><span id=__span-63-1><a id=__codelineno-63-1 name=__codelineno-63-1 href=#__codelineno-63-1></a><span class=nt>include</span><span class=p>:</span>
</span><span id=__span-63-2><a id=__codelineno-63-2 name=__codelineno-63-2 href=#__codelineno-63-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">services.yml</span>
</span><span id=__span-63-3><a id=__codelineno-63-3 name=__codelineno-63-3 href=#__codelineno-63-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networks.yml</span>
</span><span id=__span-63-4><a id=__codelineno-63-4 name=__codelineno-63-4 href=#__codelineno-63-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">volumes.yml</span>
</span><span id=__span-63-5><a id=__codelineno-63-5 name=__codelineno-63-5 href=#__codelineno-63-5></a>
</span><span id=__span-63-6><a id=__codelineno-63-6 name=__codelineno-63-6 href=#__codelineno-63-6></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-63-7><a id=__codelineno-63-7 name=__codelineno-63-7 href=#__codelineno-63-7></a>
</span><span id=__span-63-8><a id=__codelineno-63-8 name=__codelineno-63-8 href=#__codelineno-63-8></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-63-9><a id=__codelineno-63-9 name=__codelineno-63-9 href=#__codelineno-63-9></a><span class=w>  </span><span class=nt>proxy</span><span class=p>:</span>
</span><span id=__span-63-10><a id=__codelineno-63-10 name=__codelineno-63-10 href=#__codelineno-63-10></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-63-11><a id=__codelineno-63-11 name=__codelineno-63-11 href=#__codelineno-63-11></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-63-12><a id=__codelineno-63-12 name=__codelineno-63-12 href=#__codelineno-63-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;80:80&quot;</span>
</span></code></pre></div></li> <li><code>services.yml</code> ➤ Service definitions <div class="language-yaml highlight"><pre><span></span><code><span id=__span-64-1><a id=__codelineno-64-1 name=__codelineno-64-1 href=#__codelineno-64-1></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-64-2><a id=__codelineno-64-2 name=__codelineno-64-2 href=#__codelineno-64-2></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-64-3><a id=__codelineno-64-3 name=__codelineno-64-3 href=#__codelineno-64-3></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-64-4><a id=__codelineno-64-4 name=__codelineno-64-4 href=#__codelineno-64-4></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-64-5><a id=__codelineno-64-5 name=__codelineno-64-5 href=#__codelineno-64-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-64-6><a id=__codelineno-64-6 name=__codelineno-64-6 href=#__codelineno-64-6></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-64-7><a id=__codelineno-64-7 name=__codelineno-64-7 href=#__codelineno-64-7></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-64-8><a id=__codelineno-64-8 name=__codelineno-64-8 href=#__codelineno-64-8></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-64-9><a id=__codelineno-64-9 name=__codelineno-64-9 href=#__codelineno-64-9></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-64-10><a id=__codelineno-64-10 name=__codelineno-64-10 href=#__codelineno-64-10></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span></code></pre></div></li> <li><code>networks.yml</code> ➤ Network definitions <div class="language-yaml highlight"><pre><span></span><code><span id=__span-65-1><a id=__codelineno-65-1 name=__codelineno-65-1 href=#__codelineno-65-1></a><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-65-2><a id=__codelineno-65-2 name=__codelineno-65-2 href=#__codelineno-65-2></a><span class=w>  </span><span class=nt>frontend</span><span class=p>:</span>
</span><span id=__span-65-3><a id=__codelineno-65-3 name=__codelineno-65-3 href=#__codelineno-65-3></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-65-4><a id=__codelineno-65-4 name=__codelineno-65-4 href=#__codelineno-65-4></a><span class=w>  </span><span class=nt>backend</span><span class=p>:</span>
</span><span id=__span-65-5><a id=__codelineno-65-5 name=__codelineno-65-5 href=#__codelineno-65-5></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-65-6><a id=__codelineno-65-6 name=__codelineno-65-6 href=#__codelineno-65-6></a><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use <code>include</code> directive to reference external compose files</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> (main) <div class="language-yaml highlight"><pre><span></span><code><span id=__span-66-1><a id=__codelineno-66-1 name=__codelineno-66-1 href=#__codelineno-66-1></a><span class=nt>include</span><span class=p>:</span>
</span><span id=__span-66-2><a id=__codelineno-66-2 name=__codelineno-66-2 href=#__codelineno-66-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">services.yml</span>
</span><span id=__span-66-3><a id=__codelineno-66-3 name=__codelineno-66-3 href=#__codelineno-66-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networks.yml</span>
</span><span id=__span-66-4><a id=__codelineno-66-4 name=__codelineno-66-4 href=#__codelineno-66-4></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">volumes.yml</span>
</span><span id=__span-66-5><a id=__codelineno-66-5 name=__codelineno-66-5 href=#__codelineno-66-5></a>
</span><span id=__span-66-6><a id=__codelineno-66-6 name=__codelineno-66-6 href=#__codelineno-66-6></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-66-7><a id=__codelineno-66-7 name=__codelineno-66-7 href=#__codelineno-66-7></a>
</span><span id=__span-66-8><a id=__codelineno-66-8 name=__codelineno-66-8 href=#__codelineno-66-8></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-66-9><a id=__codelineno-66-9 name=__codelineno-66-9 href=#__codelineno-66-9></a><span class=w>  </span><span class=nt>proxy</span><span class=p>:</span>
</span><span id=__span-66-10><a id=__codelineno-66-10 name=__codelineno-66-10 href=#__codelineno-66-10></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-66-11><a id=__codelineno-66-11 name=__codelineno-66-11 href=#__codelineno-66-11></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-66-12><a id=__codelineno-66-12 name=__codelineno-66-12 href=#__codelineno-66-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;80:80&quot;</span>
</span><span id=__span-66-13><a id=__codelineno-66-13 name=__codelineno-66-13 href=#__codelineno-66-13></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-66-14><a id=__codelineno-66-14 name=__codelineno-66-14 href=#__codelineno-66-14></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./proxy/nginx.conf:/etc/nginx/nginx.conf:ro</span>
</span><span id=__span-66-15><a id=__codelineno-66-15 name=__codelineno-66-15 href=#__codelineno-66-15></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-66-16><a id=__codelineno-66-16 name=__codelineno-66-16 href=#__codelineno-66-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-66-17><a id=__codelineno-66-17 name=__codelineno-66-17 href=#__codelineno-66-17></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-66-18><a id=__codelineno-66-18 name=__codelineno-66-18 href=#__codelineno-66-18></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id=__span-66-19><a id=__codelineno-66-19 name=__codelineno-66-19 href=#__codelineno-66-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span></code></pre></div></p> <p><strong>services.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-67-1><a id=__codelineno-67-1 name=__codelineno-67-1 href=#__codelineno-67-1></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-67-2><a id=__codelineno-67-2 name=__codelineno-67-2 href=#__codelineno-67-2></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-67-3><a id=__codelineno-67-3 name=__codelineno-67-3 href=#__codelineno-67-3></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-67-4><a id=__codelineno-67-4 name=__codelineno-67-4 href=#__codelineno-67-4></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-67-5><a id=__codelineno-67-5 name=__codelineno-67-5 href=#__codelineno-67-5></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web_data:/usr/share/nginx/html</span>
</span><span id=__span-67-6><a id=__codelineno-67-6 name=__codelineno-67-6 href=#__codelineno-67-6></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-67-7><a id=__codelineno-67-7 name=__codelineno-67-7 href=#__codelineno-67-7></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-67-8><a id=__codelineno-67-8 name=__codelineno-67-8 href=#__codelineno-67-8></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-67-9><a id=__codelineno-67-9 name=__codelineno-67-9 href=#__codelineno-67-9></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-67-10><a id=__codelineno-67-10 name=__codelineno-67-10 href=#__codelineno-67-10></a>
</span><span id=__span-67-11><a id=__codelineno-67-11 name=__codelineno-67-11 href=#__codelineno-67-11></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-67-12><a id=__codelineno-67-12 name=__codelineno-67-12 href=#__codelineno-67-12></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-67-13><a id=__codelineno-67-13 name=__codelineno-67-13 href=#__codelineno-67-13></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-67-14><a id=__codelineno-67-14 name=__codelineno-67-14 href=#__codelineno-67-14></a><span class=w>      </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id=__span-67-15><a id=__codelineno-67-15 name=__codelineno-67-15 href=#__codelineno-67-15></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-67-16><a id=__codelineno-67-16 name=__codelineno-67-16 href=#__codelineno-67-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-67-17><a id=__codelineno-67-17 name=__codelineno-67-17 href=#__codelineno-67-17></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id=__span-67-18><a id=__codelineno-67-18 name=__codelineno-67-18 href=#__codelineno-67-18></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-67-19><a id=__codelineno-67-19 name=__codelineno-67-19 href=#__codelineno-67-19></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-67-20><a id=__codelineno-67-20 name=__codelineno-67-20 href=#__codelineno-67-20></a>
</span><span id=__span-67-21><a id=__codelineno-67-21 name=__codelineno-67-21 href=#__codelineno-67-21></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-67-22><a id=__codelineno-67-22 name=__codelineno-67-22 href=#__codelineno-67-22></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-67-23><a id=__codelineno-67-23 name=__codelineno-67-23 href=#__codelineno-67-23></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-67-24><a id=__codelineno-67-24 name=__codelineno-67-24 href=#__codelineno-67-24></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-67-25><a id=__codelineno-67-25 name=__codelineno-67-25 href=#__codelineno-67-25></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-67-26><a id=__codelineno-67-26 name=__codelineno-67-26 href=#__codelineno-67-26></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-67-27><a id=__codelineno-67-27 name=__codelineno-67-27 href=#__codelineno-67-27></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-67-28><a id=__codelineno-67-28 name=__codelineno-67-28 href=#__codelineno-67-28></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-67-29><a id=__codelineno-67-29 name=__codelineno-67-29 href=#__codelineno-67-29></a><span class=w>    </span><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-67-30><a id=__codelineno-67-30 name=__codelineno-67-30 href=#__codelineno-67-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span></code></pre></div></p> <p><strong>networks.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-68-1><a id=__codelineno-68-1 name=__codelineno-68-1 href=#__codelineno-68-1></a><span class=nt>networks</span><span class=p>:</span>
</span><span id=__span-68-2><a id=__codelineno-68-2 name=__codelineno-68-2 href=#__codelineno-68-2></a><span class=w>  </span><span class=nt>frontend</span><span class=p>:</span>
</span><span id=__span-68-3><a id=__codelineno-68-3 name=__codelineno-68-3 href=#__codelineno-68-3></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-68-4><a id=__codelineno-68-4 name=__codelineno-68-4 href=#__codelineno-68-4></a><span class=w>    </span><span class=nt>ipam</span><span class=p>:</span>
</span><span id=__span-68-5><a id=__codelineno-68-5 name=__codelineno-68-5 href=#__codelineno-68-5></a><span class=w>      </span><span class=nt>config</span><span class=p>:</span>
</span><span id=__span-68-6><a id=__codelineno-68-6 name=__codelineno-68-6 href=#__codelineno-68-6></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>subnet</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.0/16</span>
</span><span id=__span-68-7><a id=__codelineno-68-7 name=__codelineno-68-7 href=#__codelineno-68-7></a><span class=w>  </span><span class=nt>backend</span><span class=p>:</span>
</span><span id=__span-68-8><a id=__codelineno-68-8 name=__codelineno-68-8 href=#__codelineno-68-8></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id=__span-68-9><a id=__codelineno-68-9 name=__codelineno-68-9 href=#__codelineno-68-9></a><span class=w>    </span><span class=nt>internal</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-68-10><a id=__codelineno-68-10 name=__codelineno-68-10 href=#__codelineno-68-10></a><span class=w>    </span><span class=nt>ipam</span><span class=p>:</span>
</span><span id=__span-68-11><a id=__codelineno-68-11 name=__codelineno-68-11 href=#__codelineno-68-11></a><span class=w>      </span><span class=nt>config</span><span class=p>:</span>
</span><span id=__span-68-12><a id=__codelineno-68-12 name=__codelineno-68-12 href=#__codelineno-68-12></a><span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>subnet</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.0/16</span>
</span></code></pre></div></p> <p><strong>volumes.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-69-1><a id=__codelineno-69-1 name=__codelineno-69-1 href=#__codelineno-69-1></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-69-2><a id=__codelineno-69-2 name=__codelineno-69-2 href=#__codelineno-69-2></a><span class=w>  </span><span class=nt>web_data</span><span class=p>:</span>
</span><span id=__span-69-3><a id=__codelineno-69-3 name=__codelineno-69-3 href=#__codelineno-69-3></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>proxy/nginx.conf</strong> <div class="language-nginx highlight"><pre><span></span><code><span id=__span-70-1><a id=__codelineno-70-1 name=__codelineno-70-1 href=#__codelineno-70-1></a><span class=k>events</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-2><a id=__codelineno-70-2 name=__codelineno-70-2 href=#__codelineno-70-2></a><span class=w>    </span><span class=kn>worker_connections</span><span class=w> </span><span class=mi>1024</span><span class=p>;</span>
</span><span id=__span-70-3><a id=__codelineno-70-3 name=__codelineno-70-3 href=#__codelineno-70-3></a><span class=p>}</span>
</span><span id=__span-70-4><a id=__codelineno-70-4 name=__codelineno-70-4 href=#__codelineno-70-4></a>
</span><span id=__span-70-5><a id=__codelineno-70-5 name=__codelineno-70-5 href=#__codelineno-70-5></a><span class=k>http</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-6><a id=__codelineno-70-6 name=__codelineno-70-6 href=#__codelineno-70-6></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>web_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-7><a id=__codelineno-70-7 name=__codelineno-70-7 href=#__codelineno-70-7></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>web</span><span class=p>:</span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-70-8><a id=__codelineno-70-8 name=__codelineno-70-8 href=#__codelineno-70-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-70-9><a id=__codelineno-70-9 name=__codelineno-70-9 href=#__codelineno-70-9></a>
</span><span id=__span-70-10><a id=__codelineno-70-10 name=__codelineno-70-10 href=#__codelineno-70-10></a><span class=w>    </span><span class=kn>upstream</span><span class=w> </span><span class=s>api_backend</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-11><a id=__codelineno-70-11 name=__codelineno-70-11 href=#__codelineno-70-11></a><span class=w>        </span><span class=kn>server</span><span class=w> </span><span class=n>api</span><span class=p>:</span><span class=mi>3000</span><span class=p>;</span>
</span><span id=__span-70-12><a id=__codelineno-70-12 name=__codelineno-70-12 href=#__codelineno-70-12></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-70-13><a id=__codelineno-70-13 name=__codelineno-70-13 href=#__codelineno-70-13></a>
</span><span id=__span-70-14><a id=__codelineno-70-14 name=__codelineno-70-14 href=#__codelineno-70-14></a><span class=w>    </span><span class=kn>server</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-15><a id=__codelineno-70-15 name=__codelineno-70-15 href=#__codelineno-70-15></a><span class=w>        </span><span class=kn>listen</span><span class=w> </span><span class=mi>80</span><span class=p>;</span>
</span><span id=__span-70-16><a id=__codelineno-70-16 name=__codelineno-70-16 href=#__codelineno-70-16></a>
</span><span id=__span-70-17><a id=__codelineno-70-17 name=__codelineno-70-17 href=#__codelineno-70-17></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-18><a id=__codelineno-70-18 name=__codelineno-70-18 href=#__codelineno-70-18></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://web_backend</span><span class=p>;</span>
</span><span id=__span-70-19><a id=__codelineno-70-19 name=__codelineno-70-19 href=#__codelineno-70-19></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-70-20><a id=__codelineno-70-20 name=__codelineno-70-20 href=#__codelineno-70-20></a>
</span><span id=__span-70-21><a id=__codelineno-70-21 name=__codelineno-70-21 href=#__codelineno-70-21></a><span class=w>        </span><span class=kn>location</span><span class=w> </span><span class=s>/api</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-70-22><a id=__codelineno-70-22 name=__codelineno-70-22 href=#__codelineno-70-22></a><span class=w>            </span><span class=kn>proxy_pass</span><span class=w> </span><span class=s>http://api_backend</span><span class=p>;</span>
</span><span id=__span-70-23><a id=__codelineno-70-23 name=__codelineno-70-23 href=#__codelineno-70-23></a><span class=w>        </span><span class=p>}</span>
</span><span id=__span-70-24><a id=__codelineno-70-24 name=__codelineno-70-24 href=#__codelineno-70-24></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-70-25><a id=__codelineno-70-25 name=__codelineno-70-25 href=#__codelineno-70-25></a><span class=p>}</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-71-1><a id=__codelineno-71-1 name=__codelineno-71-1 href=#__codelineno-71-1></a><span class=c1># Start all services from modular files</span>
</span><span id=__span-71-2><a id=__codelineno-71-2 name=__codelineno-71-2 href=#__codelineno-71-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-71-3><a id=__codelineno-71-3 name=__codelineno-71-3 href=#__codelineno-71-3></a>
</span><span id=__span-71-4><a id=__codelineno-71-4 name=__codelineno-71-4 href=#__codelineno-71-4></a><span class=c1># Check included configurations</span>
</span><span id=__span-71-5><a id=__codelineno-71-5 name=__codelineno-71-5 href=#__codelineno-71-5></a>docker-compose<span class=w> </span>config
</span><span id=__span-71-6><a id=__codelineno-71-6 name=__codelineno-71-6 href=#__codelineno-71-6></a>
</span><span id=__span-71-7><a id=__codelineno-71-7 name=__codelineno-71-7 href=#__codelineno-71-7></a><span class=c1># List all services from includes</span>
</span><span id=__span-71-8><a id=__codelineno-71-8 name=__codelineno-71-8 href=#__codelineno-71-8></a>docker-compose<span class=w> </span>ps
</span><span id=__span-71-9><a id=__codelineno-71-9 name=__codelineno-71-9 href=#__codelineno-71-9></a>
</span><span id=__span-71-10><a id=__codelineno-71-10 name=__codelineno-71-10 href=#__codelineno-71-10></a><span class=c1># View logs from specific service</span>
</span><span id=__span-71-11><a id=__codelineno-71-11 name=__codelineno-71-11 href=#__codelineno-71-11></a>docker-compose<span class=w> </span>logs<span class=w> </span>web
</span><span id=__span-71-12><a id=__codelineno-71-12 name=__codelineno-71-12 href=#__codelineno-71-12></a>
</span><span id=__span-71-13><a id=__codelineno-71-13 name=__codelineno-71-13 href=#__codelineno-71-13></a><span class=c1># Stop all services</span>
</span><span id=__span-71-14><a id=__codelineno-71-14 name=__codelineno-71-14 href=#__codelineno-71-14></a>docker-compose<span class=w> </span>down
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>include</strong>: References external compose files to include their configurations</li> <li><strong>Modular organization</strong>: Split large files into logical components</li> <li><strong>Reusability</strong>: Include files can be shared across projects</li> <li><strong>Maintainability</strong>: Easier to manage and version control smaller files</li> <li><strong>Override capability</strong>: Main file can override included configurations</li> </ul> </details> <hr> <h4 id=22-environment-specific-fragments>22. Environment-Specific Fragments<a class=headerlink href=#22-environment-specific-fragments title="Permanent link">&para;</a></h4> <ul> <li> <p>Create environment-specific configurations using fragments and conditional includes.</p> <h4 id=scenario_21><strong>Scenario:</strong><a class=headerlink href=#scenario_21 title="Permanent link">&para;</a></h4> <ul> <li>You need different service configurations for development, staging, and production environments with varying resource allocations, logging levels, and monitoring.</li> <li>Fragments combined with includes allow you to maintain environment-specific configurations while sharing common elements.</li> </ul> <h4 id=resources_11>Resources:<a class=headerlink href=#resources_11 title="Permanent link">&para;</a></h4> <ul> <li><code>docker-compose.yml</code> ➤ Main file with environment includes <div class="language-yaml highlight"><pre><span></span><code><span id=__span-72-1><a id=__codelineno-72-1 name=__codelineno-72-1 href=#__codelineno-72-1></a><span class=nt>include</span><span class=p>:</span>
</span><span id=__span-72-2><a id=__codelineno-72-2 name=__codelineno-72-2 href=#__codelineno-72-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">common.yml</span>
</span><span id=__span-72-3><a id=__codelineno-72-3 name=__codelineno-72-3 href=#__codelineno-72-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">environments/${ENVIRONMENT}.yml</span>
</span><span id=__span-72-4><a id=__codelineno-72-4 name=__codelineno-72-4 href=#__codelineno-72-4></a>
</span><span id=__span-72-5><a id=__codelineno-72-5 name=__codelineno-72-5 href=#__codelineno-72-5></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span></code></pre></div></li> <li><code>environments/development.yml</code> ➤ Development-specific config <div class="language-yaml highlight"><pre><span></span><code><span id=__span-73-1><a id=__codelineno-73-1 name=__codelineno-73-1 href=#__codelineno-73-1></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-73-2><a id=__codelineno-73-2 name=__codelineno-73-2 href=#__codelineno-73-2></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-73-3><a id=__codelineno-73-3 name=__codelineno-73-3 href=#__codelineno-73-3></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-73-4><a id=__codelineno-73-4 name=__codelineno-73-4 href=#__codelineno-73-4></a><span class=w>      </span><span class=nt>DEBUG</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-73-5><a id=__codelineno-73-5 name=__codelineno-73-5 href=#__codelineno-73-5></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-73-6><a id=__codelineno-73-6 name=__codelineno-73-6 href=#__codelineno-73-6></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span></code></pre></div></li> <li><code>environments/production.yml</code> ➤ Production-specific config <div class="language-yaml highlight"><pre><span></span><code><span id=__span-74-1><a id=__codelineno-74-1 name=__codelineno-74-1 href=#__codelineno-74-1></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-74-2><a id=__codelineno-74-2 name=__codelineno-74-2 href=#__codelineno-74-2></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-74-3><a id=__codelineno-74-3 name=__codelineno-74-3 href=#__codelineno-74-3></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-74-4><a id=__codelineno-74-4 name=__codelineno-74-4 href=#__codelineno-74-4></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-74-5><a id=__codelineno-74-5 name=__codelineno-74-5 href=#__codelineno-74-5></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-74-6><a id=__codelineno-74-6 name=__codelineno-74-6 href=#__codelineno-74-6></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-74-7><a id=__codelineno-74-7 name=__codelineno-74-7 href=#__codelineno-74-7></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-74-8><a id=__codelineno-74-8 name=__codelineno-74-8 href=#__codelineno-74-8></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-74-9><a id=__codelineno-74-9 name=__codelineno-74-9 href=#__codelineno-74-9></a><span class=w>      </span><span class=nt>NODE_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Use environment variables in include paths and fragments for environment-specific configurations</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> (main) <div class="language-yaml highlight"><pre><span></span><code><span id=__span-75-1><a id=__codelineno-75-1 name=__codelineno-75-1 href=#__codelineno-75-1></a><span class=nt>include</span><span class=p>:</span>
</span><span id=__span-75-2><a id=__codelineno-75-2 name=__codelineno-75-2 href=#__codelineno-75-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">common.yml</span>
</span><span id=__span-75-3><a id=__codelineno-75-3 name=__codelineno-75-3 href=#__codelineno-75-3></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">environments/${ENVIRONMENT:-development}.yml</span>
</span><span id=__span-75-4><a id=__codelineno-75-4 name=__codelineno-75-4 href=#__codelineno-75-4></a>
</span><span id=__span-75-5><a id=__codelineno-75-5 name=__codelineno-75-5 href=#__codelineno-75-5></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-75-6><a id=__codelineno-75-6 name=__codelineno-75-6 href=#__codelineno-75-6></a>
</span><span id=__span-75-7><a id=__codelineno-75-7 name=__codelineno-75-7 href=#__codelineno-75-7></a><span class=nt>x-env-overrides</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;env-overrides</span>
</span><span id=__span-75-8><a id=__codelineno-75-8 name=__codelineno-75-8 href=#__codelineno-75-8></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-75-9><a id=__codelineno-75-9 name=__codelineno-75-9 href=#__codelineno-75-9></a><span class=w>    </span><span class=nt>ENVIRONMENT</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${ENVIRONMENT:-development}</span>
</span><span id=__span-75-10><a id=__codelineno-75-10 name=__codelineno-75-10 href=#__codelineno-75-10></a><span class=w>  </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-75-11><a id=__codelineno-75-11 name=__codelineno-75-11 href=#__codelineno-75-11></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-75-12><a id=__codelineno-75-12 name=__codelineno-75-12 href=#__codelineno-75-12></a><span class=w>    </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-75-13><a id=__codelineno-75-13 name=__codelineno-75-13 href=#__codelineno-75-13></a><span class=w>      </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${LOG_MAX_SIZE:-10m}</span>
</span><span id=__span-75-14><a id=__codelineno-75-14 name=__codelineno-75-14 href=#__codelineno-75-14></a><span class=w>      </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${LOG_MAX_FILE:-3}</span>
</span></code></pre></div></p> <p><strong>common.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-76-1><a id=__codelineno-76-1 name=__codelineno-76-1 href=#__codelineno-76-1></a><span class=nt>x-common-service</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;common-service</span>
</span><span id=__span-76-2><a id=__codelineno-76-2 name=__codelineno-76-2 href=#__codelineno-76-2></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id=__span-76-3><a id=__codelineno-76-3 name=__codelineno-76-3 href=#__codelineno-76-3></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*env-overrides</span>
</span><span id=__span-76-4><a id=__codelineno-76-4 name=__codelineno-76-4 href=#__codelineno-76-4></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-76-5><a id=__codelineno-76-5 name=__codelineno-76-5 href=#__codelineno-76-5></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-76-6><a id=__codelineno-76-6 name=__codelineno-76-6 href=#__codelineno-76-6></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-76-7><a id=__codelineno-76-7 name=__codelineno-76-7 href=#__codelineno-76-7></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${MEMORY_LIMIT:-128M}</span>
</span><span id=__span-76-8><a id=__codelineno-76-8 name=__codelineno-76-8 href=#__codelineno-76-8></a><span class=w>        </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">${CPU_LIMIT:-0.25}</span>
</span><span id=__span-76-9><a id=__codelineno-76-9 name=__codelineno-76-9 href=#__codelineno-76-9></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-76-10><a id=__codelineno-76-10 name=__codelineno-76-10 href=#__codelineno-76-10></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;OK&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-76-11><a id=__codelineno-76-11 name=__codelineno-76-11 href=#__codelineno-76-11></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-76-12><a id=__codelineno-76-12 name=__codelineno-76-12 href=#__codelineno-76-12></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-76-13><a id=__codelineno-76-13 name=__codelineno-76-13 href=#__codelineno-76-13></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-76-14><a id=__codelineno-76-14 name=__codelineno-76-14 href=#__codelineno-76-14></a>
</span><span id=__span-76-15><a id=__codelineno-76-15 name=__codelineno-76-15 href=#__codelineno-76-15></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-76-16><a id=__codelineno-76-16 name=__codelineno-76-16 href=#__codelineno-76-16></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-76-17><a id=__codelineno-76-17 name=__codelineno-76-17 href=#__codelineno-76-17></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-service</span>
</span><span id=__span-76-18><a id=__codelineno-76-18 name=__codelineno-76-18 href=#__codelineno-76-18></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;&lt;h1&gt;Web Service - ${ENVIRONMENT}&lt;/h1&gt;&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 80 -h /tmp&#39;</span>
</span><span id=__span-76-19><a id=__codelineno-76-19 name=__codelineno-76-19 href=#__codelineno-76-19></a>
</span><span id=__span-76-20><a id=__codelineno-76-20 name=__codelineno-76-20 href=#__codelineno-76-20></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-76-21><a id=__codelineno-76-21 name=__codelineno-76-21 href=#__codelineno-76-21></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-service</span>
</span><span id=__span-76-22><a id=__codelineno-76-22 name=__codelineno-76-22 href=#__codelineno-76-22></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-76-23><a id=__codelineno-76-23 name=__codelineno-76-23 href=#__codelineno-76-23></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*common-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-76-24><a id=__codelineno-76-24 name=__codelineno-76-24 href=#__codelineno-76-24></a><span class=w>      </span><span class=nt>SERVICE_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-76-25><a id=__codelineno-76-25 name=__codelineno-76-25 href=#__codelineno-76-25></a><span class=w>    </span><span class=nt>command</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;while true; do echo &quot;API in ${ENVIRONMENT}&quot;; sleep 10; done&#39;</span>
</span><span id=__span-76-26><a id=__codelineno-76-26 name=__codelineno-76-26 href=#__codelineno-76-26></a>
</span><span id=__span-76-27><a id=__codelineno-76-27 name=__codelineno-76-27 href=#__codelineno-76-27></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-76-28><a id=__codelineno-76-28 name=__codelineno-76-28 href=#__codelineno-76-28></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-76-29><a id=__codelineno-76-29 name=__codelineno-76-29 href=#__codelineno-76-29></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-76-30><a id=__codelineno-76-30 name=__codelineno-76-30 href=#__codelineno-76-30></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-76-31><a id=__codelineno-76-31 name=__codelineno-76-31 href=#__codelineno-76-31></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-76-32><a id=__codelineno-76-32 name=__codelineno-76-32 href=#__codelineno-76-32></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-76-33><a id=__codelineno-76-33 name=__codelineno-76-33 href=#__codelineno-76-33></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-76-34><a id=__codelineno-76-34 name=__codelineno-76-34 href=#__codelineno-76-34></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-76-35><a id=__codelineno-76-35 name=__codelineno-76-35 href=#__codelineno-76-35></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*env-overrides</span>
</span><span id=__span-76-36><a id=__codelineno-76-36 name=__codelineno-76-36 href=#__codelineno-76-36></a>
</span><span id=__span-76-37><a id=__codelineno-76-37 name=__codelineno-76-37 href=#__codelineno-76-37></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-76-38><a id=__codelineno-76-38 name=__codelineno-76-38 href=#__codelineno-76-38></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>environments/development.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-77-1><a id=__codelineno-77-1 name=__codelineno-77-1 href=#__codelineno-77-1></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-77-2><a id=__codelineno-77-2 name=__codelineno-77-2 href=#__codelineno-77-2></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-77-3><a id=__codelineno-77-3 name=__codelineno-77-3 href=#__codelineno-77-3></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-77-4><a id=__codelineno-77-4 name=__codelineno-77-4 href=#__codelineno-77-4></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-77-5><a id=__codelineno-77-5 name=__codelineno-77-5 href=#__codelineno-77-5></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-77-6><a id=__codelineno-77-6 name=__codelineno-77-6 href=#__codelineno-77-6></a><span class=w>      </span><span class=nt>DEBUG</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id=__span-77-7><a id=__codelineno-77-7 name=__codelineno-77-7 href=#__codelineno-77-7></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-77-8><a id=__codelineno-77-8 name=__codelineno-77-8 href=#__codelineno-77-8></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./dev-logs:/app/logs</span>
</span><span id=__span-77-9><a id=__codelineno-77-9 name=__codelineno-77-9 href=#__codelineno-77-9></a>
</span><span id=__span-77-10><a id=__codelineno-77-10 name=__codelineno-77-10 href=#__codelineno-77-10></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-77-11><a id=__codelineno-77-11 name=__codelineno-77-11 href=#__codelineno-77-11></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-77-12><a id=__codelineno-77-12 name=__codelineno-77-12 href=#__codelineno-77-12></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span><span id=__span-77-13><a id=__codelineno-77-13 name=__codelineno-77-13 href=#__codelineno-77-13></a>
</span><span id=__span-77-14><a id=__codelineno-77-14 name=__codelineno-77-14 href=#__codelineno-77-14></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-77-15><a id=__codelineno-77-15 name=__codelineno-77-15 href=#__codelineno-77-15></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-77-16><a id=__codelineno-77-16 name=__codelineno-77-16 href=#__codelineno-77-16></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5432:5432&quot;</span>
</span></code></pre></div></p> <p><strong>environments/production.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-78-1><a id=__codelineno-78-1 name=__codelineno-78-1 href=#__codelineno-78-1></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-78-2><a id=__codelineno-78-2 name=__codelineno-78-2 href=#__codelineno-78-2></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-78-3><a id=__codelineno-78-3 name=__codelineno-78-3 href=#__codelineno-78-3></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-78-4><a id=__codelineno-78-4 name=__codelineno-78-4 href=#__codelineno-78-4></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-78-5><a id=__codelineno-78-5 name=__codelineno-78-5 href=#__codelineno-78-5></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-78-6><a id=__codelineno-78-6 name=__codelineno-78-6 href=#__codelineno-78-6></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-78-7><a id=__codelineno-78-7 name=__codelineno-78-7 href=#__codelineno-78-7></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-78-8><a id=__codelineno-78-8 name=__codelineno-78-8 href=#__codelineno-78-8></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span><span id=__span-78-9><a id=__codelineno-78-9 name=__codelineno-78-9 href=#__codelineno-78-9></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-78-10><a id=__codelineno-78-10 name=__codelineno-78-10 href=#__codelineno-78-10></a><span class=w>      </span><span class=nt>NODE_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-78-11><a id=__codelineno-78-11 name=__codelineno-78-11 href=#__codelineno-78-11></a>
</span><span id=__span-78-12><a id=__codelineno-78-12 name=__codelineno-78-12 href=#__codelineno-78-12></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-78-13><a id=__codelineno-78-13 name=__codelineno-78-13 href=#__codelineno-78-13></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-78-14><a id=__codelineno-78-14 name=__codelineno-78-14 href=#__codelineno-78-14></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-78-15><a id=__codelineno-78-15 name=__codelineno-78-15 href=#__codelineno-78-15></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-78-16><a id=__codelineno-78-16 name=__codelineno-78-16 href=#__codelineno-78-16></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-78-17><a id=__codelineno-78-17 name=__codelineno-78-17 href=#__codelineno-78-17></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-78-18><a id=__codelineno-78-18 name=__codelineno-78-18 href=#__codelineno-78-18></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-78-19><a id=__codelineno-78-19 name=__codelineno-78-19 href=#__codelineno-78-19></a>
</span><span id=__span-78-20><a id=__codelineno-78-20 name=__codelineno-78-20 href=#__codelineno-78-20></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-78-21><a id=__codelineno-78-21 name=__codelineno-78-21 href=#__codelineno-78-21></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-78-22><a id=__codelineno-78-22 name=__codelineno-78-22 href=#__codelineno-78-22></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-78-23><a id=__codelineno-78-23 name=__codelineno-78-23 href=#__codelineno-78-23></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-78-24><a id=__codelineno-78-24 name=__codelineno-78-24 href=#__codelineno-78-24></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-78-25><a id=__codelineno-78-25 name=__codelineno-78-25 href=#__codelineno-78-25></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;2.0&#39;</span>
</span></code></pre></div></p> <p><strong>environments/staging.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-79-1><a id=__codelineno-79-1 name=__codelineno-79-1 href=#__codelineno-79-1></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-79-2><a id=__codelineno-79-2 name=__codelineno-79-2 href=#__codelineno-79-2></a><span class=w>  </span><span class=nt>web</span><span class=p>:</span>
</span><span id=__span-79-3><a id=__codelineno-79-3 name=__codelineno-79-3 href=#__codelineno-79-3></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-79-4><a id=__codelineno-79-4 name=__codelineno-79-4 href=#__codelineno-79-4></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-79-5><a id=__codelineno-79-5 name=__codelineno-79-5 href=#__codelineno-79-5></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-79-6><a id=__codelineno-79-6 name=__codelineno-79-6 href=#__codelineno-79-6></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-79-7><a id=__codelineno-79-7 name=__codelineno-79-7 href=#__codelineno-79-7></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-79-8><a id=__codelineno-79-8 name=__codelineno-79-8 href=#__codelineno-79-8></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-79-9><a id=__codelineno-79-9 name=__codelineno-79-9 href=#__codelineno-79-9></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-79-10><a id=__codelineno-79-10 name=__codelineno-79-10 href=#__codelineno-79-10></a><span class=w>      </span><span class=nt>NODE_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
</span><span id=__span-79-11><a id=__codelineno-79-11 name=__codelineno-79-11 href=#__codelineno-79-11></a>
</span><span id=__span-79-12><a id=__codelineno-79-12 name=__codelineno-79-12 href=#__codelineno-79-12></a><span class=w>  </span><span class=nt>api</span><span class=p>:</span>
</span><span id=__span-79-13><a id=__codelineno-79-13 name=__codelineno-79-13 href=#__codelineno-79-13></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-79-14><a id=__codelineno-79-14 name=__codelineno-79-14 href=#__codelineno-79-14></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id=__span-79-15><a id=__codelineno-79-15 name=__codelineno-79-15 href=#__codelineno-79-15></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-79-16><a id=__codelineno-79-16 name=__codelineno-79-16 href=#__codelineno-79-16></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-79-17><a id=__codelineno-79-17 name=__codelineno-79-17 href=#__codelineno-79-17></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id=__span-79-18><a id=__codelineno-79-18 name=__codelineno-79-18 href=#__codelineno-79-18></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.25&#39;</span>
</span><span id=__span-79-19><a id=__codelineno-79-19 name=__codelineno-79-19 href=#__codelineno-79-19></a>
</span><span id=__span-79-20><a id=__codelineno-79-20 name=__codelineno-79-20 href=#__codelineno-79-20></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-79-21><a id=__codelineno-79-21 name=__codelineno-79-21 href=#__codelineno-79-21></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-79-22><a id=__codelineno-79-22 name=__codelineno-79-22 href=#__codelineno-79-22></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-79-23><a id=__codelineno-79-23 name=__codelineno-79-23 href=#__codelineno-79-23></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-79-24><a id=__codelineno-79-24 name=__codelineno-79-24 href=#__codelineno-79-24></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-79-25><a id=__codelineno-79-25 name=__codelineno-79-25 href=#__codelineno-79-25></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-80-1><a id=__codelineno-80-1 name=__codelineno-80-1 href=#__codelineno-80-1></a><span class=c1># Development environment</span>
</span><span id=__span-80-2><a id=__codelineno-80-2 name=__codelineno-80-2 href=#__codelineno-80-2></a><span class=nv>ENVIRONMENT</span><span class=o>=</span>development<span class=w> </span>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-80-3><a id=__codelineno-80-3 name=__codelineno-80-3 href=#__codelineno-80-3></a>
</span><span id=__span-80-4><a id=__codelineno-80-4 name=__codelineno-80-4 href=#__codelineno-80-4></a><span class=c1># Production environment</span>
</span><span id=__span-80-5><a id=__codelineno-80-5 name=__codelineno-80-5 href=#__codelineno-80-5></a><span class=nv>ENVIRONMENT</span><span class=o>=</span>production<span class=w> </span>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-80-6><a id=__codelineno-80-6 name=__codelineno-80-6 href=#__codelineno-80-6></a>
</span><span id=__span-80-7><a id=__codelineno-80-7 name=__codelineno-80-7 href=#__codelineno-80-7></a><span class=c1># Staging environment</span>
</span><span id=__span-80-8><a id=__codelineno-80-8 name=__codelineno-80-8 href=#__codelineno-80-8></a><span class=nv>ENVIRONMENT</span><span class=o>=</span>staging<span class=w> </span>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-80-9><a id=__codelineno-80-9 name=__codelineno-80-9 href=#__codelineno-80-9></a>
</span><span id=__span-80-10><a id=__codelineno-80-10 name=__codelineno-80-10 href=#__codelineno-80-10></a><span class=c1># Check current configuration</span>
</span><span id=__span-80-11><a id=__codelineno-80-11 name=__codelineno-80-11 href=#__codelineno-80-11></a>docker-compose<span class=w> </span>config
</span><span id=__span-80-12><a id=__codelineno-80-12 name=__codelineno-80-12 href=#__codelineno-80-12></a>
</span><span id=__span-80-13><a id=__codelineno-80-13 name=__codelineno-80-13 href=#__codelineno-80-13></a><span class=c1># View environment-specific settings</span>
</span><span id=__span-80-14><a id=__codelineno-80-14 name=__codelineno-80-14 href=#__codelineno-80-14></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web<span class=w> </span>env<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>ENVIRONMENT
</span><span id=__span-80-15><a id=__codelineno-80-15 name=__codelineno-80-15 href=#__codelineno-80-15></a>
</span><span id=__span-80-16><a id=__codelineno-80-16 name=__codelineno-80-16 href=#__codelineno-80-16></a><span class=c1># Stop services</span>
</span><span id=__span-80-17><a id=__codelineno-80-17 name=__codelineno-80-17 href=#__codelineno-80-17></a>docker-compose<span class=w> </span>down
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>Environment variables in includes</strong>: Dynamic file inclusion based on environment</li> <li><strong>Fragment overrides</strong>: Environment files override common configurations</li> <li><strong>Conditional configuration</strong>: Different settings per environment</li> <li><strong>Scalability</strong>: Easy to add new environments</li> <li><strong>Maintainability</strong>: Separate concerns for common vs environment-specific config</li> </ul> </details> <hr> <h4 id=23-complex-fragment-hierarchies>23. Complex Fragment Hierarchies<a class=headerlink href=#23-complex-fragment-hierarchies title="Permanent link">&para;</a></h4> <ul> <li> <p>Build complex configuration hierarchies using nested anchors and multiple inheritance levels.</p> <h4 id=scenario_22><strong>Scenario:</strong><a class=headerlink href=#scenario_22 title="Permanent link">&para;</a></h4> <ul> <li>Your application has services with multiple inheritance levels - base configurations, service-type configurations, and instance-specific overrides.</li> <li>Complex fragment hierarchies allow you to build sophisticated configuration inheritance chains.</li> </ul> <h4 id=resources_12>Resources:<a class=headerlink href=#resources_12 title="Permanent link">&para;</a></h4> <ul> <li><code>docker-compose.yml</code> ➤ Complex fragment hierarchy <div class="language-yaml highlight"><pre><span></span><code><span id=__span-81-1><a id=__codelineno-81-1 name=__codelineno-81-1 href=#__codelineno-81-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-81-2><a id=__codelineno-81-2 name=__codelineno-81-2 href=#__codelineno-81-2></a>
</span><span id=__span-81-3><a id=__codelineno-81-3 name=__codelineno-81-3 href=#__codelineno-81-3></a><span class=nt>x-base</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;base</span>
</span><span id=__span-81-4><a id=__codelineno-81-4 name=__codelineno-81-4 href=#__codelineno-81-4></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-81-5><a id=__codelineno-81-5 name=__codelineno-81-5 href=#__codelineno-81-5></a><span class=w>    </span><span class=nt>APP_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-81-6><a id=__codelineno-81-6 name=__codelineno-81-6 href=#__codelineno-81-6></a>
</span><span id=__span-81-7><a id=__codelineno-81-7 name=__codelineno-81-7 href=#__codelineno-81-7></a><span class=nt>x-service-base</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;service-base</span>
</span><span id=__span-81-8><a id=__codelineno-81-8 name=__codelineno-81-8 href=#__codelineno-81-8></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*base</span>
</span><span id=__span-81-9><a id=__codelineno-81-9 name=__codelineno-81-9 href=#__codelineno-81-9></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-81-10><a id=__codelineno-81-10 name=__codelineno-81-10 href=#__codelineno-81-10></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-81-11><a id=__codelineno-81-11 name=__codelineno-81-11 href=#__codelineno-81-11></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-81-12><a id=__codelineno-81-12 name=__codelineno-81-12 href=#__codelineno-81-12></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id=__span-81-13><a id=__codelineno-81-13 name=__codelineno-81-13 href=#__codelineno-81-13></a>
</span><span id=__span-81-14><a id=__codelineno-81-14 name=__codelineno-81-14 href=#__codelineno-81-14></a><span class=nt>x-web-service</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;web-service</span>
</span><span id=__span-81-15><a id=__codelineno-81-15 name=__codelineno-81-15 href=#__codelineno-81-15></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span>
</span><span id=__span-81-16><a id=__codelineno-81-16 name=__codelineno-81-16 href=#__codelineno-81-16></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-81-17><a id=__codelineno-81-17 name=__codelineno-81-17 href=#__codelineno-81-17></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-81-18><a id=__codelineno-81-18 name=__codelineno-81-18 href=#__codelineno-81-18></a>
</span><span id=__span-81-19><a id=__codelineno-81-19 name=__codelineno-81-19 href=#__codelineno-81-19></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-81-20><a id=__codelineno-81-20 name=__codelineno-81-20 href=#__codelineno-81-20></a><span class=w>  </span><span class=nt>web-primary</span><span class=p>:</span>
</span><span id=__span-81-21><a id=__codelineno-81-21 name=__codelineno-81-21 href=#__codelineno-81-21></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-service</span>
</span><span id=__span-81-22><a id=__codelineno-81-22 name=__codelineno-81-22 href=#__codelineno-81-22></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-81-23><a id=__codelineno-81-23 name=__codelineno-81-23 href=#__codelineno-81-23></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-81-24><a id=__codelineno-81-24 name=__codelineno-81-24 href=#__codelineno-81-24></a><span class=w>      </span><span class=nt>INSTANCE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">primary</span>
</span><span id=__span-81-25><a id=__codelineno-81-25 name=__codelineno-81-25 href=#__codelineno-81-25></a>
</span><span id=__span-81-26><a id=__codelineno-81-26 name=__codelineno-81-26 href=#__codelineno-81-26></a><span class=w>  </span><span class=nt>web-secondary</span><span class=p>:</span>
</span><span id=__span-81-27><a id=__codelineno-81-27 name=__codelineno-81-27 href=#__codelineno-81-27></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-service</span>
</span><span id=__span-81-28><a id=__codelineno-81-28 name=__codelineno-81-28 href=#__codelineno-81-28></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-81-29><a id=__codelineno-81-29 name=__codelineno-81-29 href=#__codelineno-81-29></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-81-30><a id=__codelineno-81-30 name=__codelineno-81-30 href=#__codelineno-81-30></a><span class=w>      </span><span class=nt>INSTANCE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secondary</span>
</span><span id=__span-81-31><a id=__codelineno-81-31 name=__codelineno-81-31 href=#__codelineno-81-31></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-81-32><a id=__codelineno-81-32 name=__codelineno-81-32 href=#__codelineno-81-32></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-service</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-81-33><a id=__codelineno-81-33 name=__codelineno-81-33 href=#__codelineno-81-33></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Create multi-level inheritance chains with anchors and merges</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-82-1><a id=__codelineno-82-1 name=__codelineno-82-1 href=#__codelineno-82-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-82-2><a id=__codelineno-82-2 name=__codelineno-82-2 href=#__codelineno-82-2></a>
</span><span id=__span-82-3><a id=__codelineno-82-3 name=__codelineno-82-3 href=#__codelineno-82-3></a><span class=nt>x-global</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;global</span>
</span><span id=__span-82-4><a id=__codelineno-82-4 name=__codelineno-82-4 href=#__codelineno-82-4></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-82-5><a id=__codelineno-82-5 name=__codelineno-82-5 href=#__codelineno-82-5></a><span class=w>    </span><span class=nt>APP_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-82-6><a id=__codelineno-82-6 name=__codelineno-82-6 href=#__codelineno-82-6></a><span class=w>    </span><span class=nt>LOG_LEVEL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id=__span-82-7><a id=__codelineno-82-7 name=__codelineno-82-7 href=#__codelineno-82-7></a><span class=w>    </span><span class=nt>TZ</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id=__span-82-8><a id=__codelineno-82-8 name=__codelineno-82-8 href=#__codelineno-82-8></a><span class=w>  </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-82-9><a id=__codelineno-82-9 name=__codelineno-82-9 href=#__codelineno-82-9></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-82-10><a id=__codelineno-82-10 name=__codelineno-82-10 href=#__codelineno-82-10></a><span class=w>    </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-82-11><a id=__codelineno-82-11 name=__codelineno-82-11 href=#__codelineno-82-11></a><span class=w>      </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10m&quot;</span>
</span><span id=__span-82-12><a id=__codelineno-82-12 name=__codelineno-82-12 href=#__codelineno-82-12></a><span class=w>      </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3&quot;</span>
</span><span id=__span-82-13><a id=__codelineno-82-13 name=__codelineno-82-13 href=#__codelineno-82-13></a>
</span><span id=__span-82-14><a id=__codelineno-82-14 name=__codelineno-82-14 href=#__codelineno-82-14></a><span class=nt>x-infrastructure</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;infrastructure</span>
</span><span id=__span-82-15><a id=__codelineno-82-15 name=__codelineno-82-15 href=#__codelineno-82-15></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*global</span>
</span><span id=__span-82-16><a id=__codelineno-82-16 name=__codelineno-82-16 href=#__codelineno-82-16></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-82-17><a id=__codelineno-82-17 name=__codelineno-82-17 href=#__codelineno-82-17></a><span class=w>    </span><span class=nt>restart_policy</span><span class=p>:</span>
</span><span id=__span-82-18><a id=__codelineno-82-18 name=__codelineno-82-18 href=#__codelineno-82-18></a><span class=w>      </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id=__span-82-19><a id=__codelineno-82-19 name=__codelineno-82-19 href=#__codelineno-82-19></a><span class=w>      </span><span class=nt>delay</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-82-20><a id=__codelineno-82-20 name=__codelineno-82-20 href=#__codelineno-82-20></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-82-21><a id=__codelineno-82-21 name=__codelineno-82-21 href=#__codelineno-82-21></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-82-22><a id=__codelineno-82-22 name=__codelineno-82-22 href=#__codelineno-82-22></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id=__span-82-23><a id=__codelineno-82-23 name=__codelineno-82-23 href=#__codelineno-82-23></a><span class=w>        </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.25&#39;</span>
</span><span id=__span-82-24><a id=__codelineno-82-24 name=__codelineno-82-24 href=#__codelineno-82-24></a>
</span><span id=__span-82-25><a id=__codelineno-82-25 name=__codelineno-82-25 href=#__codelineno-82-25></a><span class=nt>x-web-infrastructure</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;web-infrastructure</span>
</span><span id=__span-82-26><a id=__codelineno-82-26 name=__codelineno-82-26 href=#__codelineno-82-26></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*infrastructure</span>
</span><span id=__span-82-27><a id=__codelineno-82-27 name=__codelineno-82-27 href=#__codelineno-82-27></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-82-28><a id=__codelineno-82-28 name=__codelineno-82-28 href=#__codelineno-82-28></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-82-29><a id=__codelineno-82-29 name=__codelineno-82-29 href=#__codelineno-82-29></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-82-30><a id=__codelineno-82-30 name=__codelineno-82-30 href=#__codelineno-82-30></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-82-31><a id=__codelineno-82-31 name=__codelineno-82-31 href=#__codelineno-82-31></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-82-32><a id=__codelineno-82-32 name=__codelineno-82-32 href=#__codelineno-82-32></a>
</span><span id=__span-82-33><a id=__codelineno-82-33 name=__codelineno-82-33 href=#__codelineno-82-33></a><span class=nt>x-api-infrastructure</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;api-infrastructure</span>
</span><span id=__span-82-34><a id=__codelineno-82-34 name=__codelineno-82-34 href=#__codelineno-82-34></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*infrastructure</span>
</span><span id=__span-82-35><a id=__codelineno-82-35 name=__codelineno-82-35 href=#__codelineno-82-35></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-82-36><a id=__codelineno-82-36 name=__codelineno-82-36 href=#__codelineno-82-36></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-82-37><a id=__codelineno-82-37 name=__codelineno-82-37 href=#__codelineno-82-37></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-82-38><a id=__codelineno-82-38 name=__codelineno-82-38 href=#__codelineno-82-38></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-82-39><a id=__codelineno-82-39 name=__codelineno-82-39 href=#__codelineno-82-39></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;API</span><span class=nv> </span><span class=s>health</span><span class=nv> </span><span class=s>check&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-82-40><a id=__codelineno-82-40 name=__codelineno-82-40 href=#__codelineno-82-40></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-82-41><a id=__codelineno-82-41 name=__codelineno-82-41 href=#__codelineno-82-41></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-82-42><a id=__codelineno-82-42 name=__codelineno-82-42 href=#__codelineno-82-42></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-82-43><a id=__codelineno-82-43 name=__codelineno-82-43 href=#__codelineno-82-43></a>
</span><span id=__span-82-44><a id=__codelineno-82-44 name=__codelineno-82-44 href=#__codelineno-82-44></a><span class=nt>x-database-infrastructure</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;database-infrastructure</span>
</span><span id=__span-82-45><a id=__codelineno-82-45 name=__codelineno-82-45 href=#__codelineno-82-45></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*infrastructure</span>
</span><span id=__span-82-46><a id=__codelineno-82-46 name=__codelineno-82-46 href=#__codelineno-82-46></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-82-47><a id=__codelineno-82-47 name=__codelineno-82-47 href=#__codelineno-82-47></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-82-48><a id=__codelineno-82-48 name=__codelineno-82-48 href=#__codelineno-82-48></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id=__span-82-49><a id=__codelineno-82-49 name=__codelineno-82-49 href=#__codelineno-82-49></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-82-50><a id=__codelineno-82-50 name=__codelineno-82-50 href=#__codelineno-82-50></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;pg_isready</span><span class=nv> </span><span class=s>-U</span><span class=nv> </span><span class=s>user</span><span class=nv> </span><span class=s>-d</span><span class=nv> </span><span class=s>myapp&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-82-51><a id=__codelineno-82-51 name=__codelineno-82-51 href=#__codelineno-82-51></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-82-52><a id=__codelineno-82-52 name=__codelineno-82-52 href=#__codelineno-82-52></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-82-53><a id=__codelineno-82-53 name=__codelineno-82-53 href=#__codelineno-82-53></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id=__span-82-54><a id=__codelineno-82-54 name=__codelineno-82-54 href=#__codelineno-82-54></a>
</span><span id=__span-82-55><a id=__codelineno-82-55 name=__codelineno-82-55 href=#__codelineno-82-55></a><span class=nt>x-web-primary</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;web-primary</span>
</span><span id=__span-82-56><a id=__codelineno-82-56 name=__codelineno-82-56 href=#__codelineno-82-56></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-infrastructure</span>
</span><span id=__span-82-57><a id=__codelineno-82-57 name=__codelineno-82-57 href=#__codelineno-82-57></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-82-58><a id=__codelineno-82-58 name=__codelineno-82-58 href=#__codelineno-82-58></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-82-59><a id=__codelineno-82-59 name=__codelineno-82-59 href=#__codelineno-82-59></a><span class=w>    </span><span class=nt>INSTANCE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">primary</span>
</span><span id=__span-82-60><a id=__codelineno-82-60 name=__codelineno-82-60 href=#__codelineno-82-60></a><span class=w>    </span><span class=nt>ROLE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-82-61><a id=__codelineno-82-61 name=__codelineno-82-61 href=#__codelineno-82-61></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-82-62><a id=__codelineno-82-62 name=__codelineno-82-62 href=#__codelineno-82-62></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-82-63><a id=__codelineno-82-63 name=__codelineno-82-63 href=#__codelineno-82-63></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-82-64><a id=__codelineno-82-64 name=__codelineno-82-64 href=#__codelineno-82-64></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-82-65><a id=__codelineno-82-65 name=__codelineno-82-65 href=#__codelineno-82-65></a><span class=w>    </span><span class=nt>labels</span><span class=p>:</span>
</span><span id=__span-82-66><a id=__codelineno-82-66 name=__codelineno-82-66 href=#__codelineno-82-66></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;service.role=primary&quot;</span>
</span><span id=__span-82-67><a id=__codelineno-82-67 name=__codelineno-82-67 href=#__codelineno-82-67></a>
</span><span id=__span-82-68><a id=__codelineno-82-68 name=__codelineno-82-68 href=#__codelineno-82-68></a><span class=nt>x-web-secondary</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;web-secondary</span>
</span><span id=__span-82-69><a id=__codelineno-82-69 name=__codelineno-82-69 href=#__codelineno-82-69></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-infrastructure</span>
</span><span id=__span-82-70><a id=__codelineno-82-70 name=__codelineno-82-70 href=#__codelineno-82-70></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-82-71><a id=__codelineno-82-71 name=__codelineno-82-71 href=#__codelineno-82-71></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-82-72><a id=__codelineno-82-72 name=__codelineno-82-72 href=#__codelineno-82-72></a><span class=w>    </span><span class=nt>INSTANCE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">secondary</span>
</span><span id=__span-82-73><a id=__codelineno-82-73 name=__codelineno-82-73 href=#__codelineno-82-73></a><span class=w>    </span><span class=nt>ROLE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-82-74><a id=__codelineno-82-74 name=__codelineno-82-74 href=#__codelineno-82-74></a><span class=w>  </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-82-75><a id=__codelineno-82-75 name=__codelineno-82-75 href=#__codelineno-82-75></a><span class=w>    </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8081:80&quot;</span>
</span><span id=__span-82-76><a id=__codelineno-82-76 name=__codelineno-82-76 href=#__codelineno-82-76></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-82-77><a id=__codelineno-82-77 name=__codelineno-82-77 href=#__codelineno-82-77></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-82-78><a id=__codelineno-82-78 name=__codelineno-82-78 href=#__codelineno-82-78></a><span class=w>    </span><span class=nt>labels</span><span class=p>:</span>
</span><span id=__span-82-79><a id=__codelineno-82-79 name=__codelineno-82-79 href=#__codelineno-82-79></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;service.role=secondary&quot;</span>
</span><span id=__span-82-80><a id=__codelineno-82-80 name=__codelineno-82-80 href=#__codelineno-82-80></a>
</span><span id=__span-82-81><a id=__codelineno-82-81 name=__codelineno-82-81 href=#__codelineno-82-81></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-82-82><a id=__codelineno-82-82 name=__codelineno-82-82 href=#__codelineno-82-82></a><span class=w>  </span><span class=nt>web-primary</span><span class=p>:</span>
</span><span id=__span-82-83><a id=__codelineno-82-83 name=__codelineno-82-83 href=#__codelineno-82-83></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-primary</span>
</span><span id=__span-82-84><a id=__codelineno-82-84 name=__codelineno-82-84 href=#__codelineno-82-84></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-82-85><a id=__codelineno-82-85 name=__codelineno-82-85 href=#__codelineno-82-85></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-82-86><a id=__codelineno-82-86 name=__codelineno-82-86 href=#__codelineno-82-86></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web/primary:/usr/share/nginx/html:ro</span>
</span><span id=__span-82-87><a id=__codelineno-82-87 name=__codelineno-82-87 href=#__codelineno-82-87></a>
</span><span id=__span-82-88><a id=__codelineno-82-88 name=__codelineno-82-88 href=#__codelineno-82-88></a><span class=w>  </span><span class=nt>web-secondary</span><span class=p>:</span>
</span><span id=__span-82-89><a id=__codelineno-82-89 name=__codelineno-82-89 href=#__codelineno-82-89></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-secondary</span>
</span><span id=__span-82-90><a id=__codelineno-82-90 name=__codelineno-82-90 href=#__codelineno-82-90></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-82-91><a id=__codelineno-82-91 name=__codelineno-82-91 href=#__codelineno-82-91></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-82-92><a id=__codelineno-82-92 name=__codelineno-82-92 href=#__codelineno-82-92></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web/secondary:/usr/share/nginx/html:ro</span>
</span><span id=__span-82-93><a id=__codelineno-82-93 name=__codelineno-82-93 href=#__codelineno-82-93></a>
</span><span id=__span-82-94><a id=__codelineno-82-94 name=__codelineno-82-94 href=#__codelineno-82-94></a><span class=w>  </span><span class=nt>api-main</span><span class=p>:</span>
</span><span id=__span-82-95><a id=__codelineno-82-95 name=__codelineno-82-95 href=#__codelineno-82-95></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-infrastructure</span>
</span><span id=__span-82-96><a id=__codelineno-82-96 name=__codelineno-82-96 href=#__codelineno-82-96></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-82-97><a id=__codelineno-82-97 name=__codelineno-82-97 href=#__codelineno-82-97></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-82-98><a id=__codelineno-82-98 name=__codelineno-82-98 href=#__codelineno-82-98></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span><span id=__span-82-99><a id=__codelineno-82-99 name=__codelineno-82-99 href=#__codelineno-82-99></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-82-100><a id=__codelineno-82-100 name=__codelineno-82-100 href=#__codelineno-82-100></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-82-101><a id=__codelineno-82-101 name=__codelineno-82-101 href=#__codelineno-82-101></a><span class=w>      </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id=__span-82-102><a id=__codelineno-82-102 name=__codelineno-82-102 href=#__codelineno-82-102></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-82-103><a id=__codelineno-82-103 name=__codelineno-82-103 href=#__codelineno-82-103></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-82-104><a id=__codelineno-82-104 name=__codelineno-82-104 href=#__codelineno-82-104></a>
</span><span id=__span-82-105><a id=__codelineno-82-105 name=__codelineno-82-105 href=#__codelineno-82-105></a><span class=w>  </span><span class=nt>api-worker</span><span class=p>:</span>
</span><span id=__span-82-106><a id=__codelineno-82-106 name=__codelineno-82-106 href=#__codelineno-82-106></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-infrastructure</span>
</span><span id=__span-82-107><a id=__codelineno-82-107 name=__codelineno-82-107 href=#__codelineno-82-107></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-82-108><a id=__codelineno-82-108 name=__codelineno-82-108 href=#__codelineno-82-108></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-82-109><a id=__codelineno-82-109 name=__codelineno-82-109 href=#__codelineno-82-109></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-82-110><a id=__codelineno-82-110 name=__codelineno-82-110 href=#__codelineno-82-110></a><span class=w>      </span><span class=nt>WORKER_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">background</span>
</span><span id=__span-82-111><a id=__codelineno-82-111 name=__codelineno-82-111 href=#__codelineno-82-111></a><span class=w>      </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id=__span-82-112><a id=__codelineno-82-112 name=__codelineno-82-112 href=#__codelineno-82-112></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-82-113><a id=__codelineno-82-113 name=__codelineno-82-113 href=#__codelineno-82-113></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-82-114><a id=__codelineno-82-114 name=__codelineno-82-114 href=#__codelineno-82-114></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-82-115><a id=__codelineno-82-115 name=__codelineno-82-115 href=#__codelineno-82-115></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-82-116><a id=__codelineno-82-116 name=__codelineno-82-116 href=#__codelineno-82-116></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-82-117><a id=__codelineno-82-117 name=__codelineno-82-117 href=#__codelineno-82-117></a>
</span><span id=__span-82-118><a id=__codelineno-82-118 name=__codelineno-82-118 href=#__codelineno-82-118></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-82-119><a id=__codelineno-82-119 name=__codelineno-82-119 href=#__codelineno-82-119></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*database-infrastructure</span>
</span><span id=__span-82-120><a id=__codelineno-82-120 name=__codelineno-82-120 href=#__codelineno-82-120></a><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-82-121><a id=__codelineno-82-121 name=__codelineno-82-121 href=#__codelineno-82-121></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-82-122><a id=__codelineno-82-122 name=__codelineno-82-122 href=#__codelineno-82-122></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*database-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-82-123><a id=__codelineno-82-123 name=__codelineno-82-123 href=#__codelineno-82-123></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-82-124><a id=__codelineno-82-124 name=__codelineno-82-124 href=#__codelineno-82-124></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-82-125><a id=__codelineno-82-125 name=__codelineno-82-125 href=#__codelineno-82-125></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-82-126><a id=__codelineno-82-126 name=__codelineno-82-126 href=#__codelineno-82-126></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-82-127><a id=__codelineno-82-127 name=__codelineno-82-127 href=#__codelineno-82-127></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-82-128><a id=__codelineno-82-128 name=__codelineno-82-128 href=#__codelineno-82-128></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-82-129><a id=__codelineno-82-129 name=__codelineno-82-129 href=#__codelineno-82-129></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5432:5432&quot;</span>
</span><span id=__span-82-130><a id=__codelineno-82-130 name=__codelineno-82-130 href=#__codelineno-82-130></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-82-131><a id=__codelineno-82-131 name=__codelineno-82-131 href=#__codelineno-82-131></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*database-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-82-132><a id=__codelineno-82-132 name=__codelineno-82-132 href=#__codelineno-82-132></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-82-133><a id=__codelineno-82-133 name=__codelineno-82-133 href=#__codelineno-82-133></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-82-134><a id=__codelineno-82-134 name=__codelineno-82-134 href=#__codelineno-82-134></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-82-135><a id=__codelineno-82-135 name=__codelineno-82-135 href=#__codelineno-82-135></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span><span id=__span-82-136><a id=__codelineno-82-136 name=__codelineno-82-136 href=#__codelineno-82-136></a>
</span><span id=__span-82-137><a id=__codelineno-82-137 name=__codelineno-82-137 href=#__codelineno-82-137></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-82-138><a id=__codelineno-82-138 name=__codelineno-82-138 href=#__codelineno-82-138></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-83-1><a id=__codelineno-83-1 name=__codelineno-83-1 href=#__codelineno-83-1></a><span class=c1># Start complex hierarchy services</span>
</span><span id=__span-83-2><a id=__codelineno-83-2 name=__codelineno-83-2 href=#__codelineno-83-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-83-3><a id=__codelineno-83-3 name=__codelineno-83-3 href=#__codelineno-83-3></a>
</span><span id=__span-83-4><a id=__codelineno-83-4 name=__codelineno-83-4 href=#__codelineno-83-4></a><span class=c1># Check configuration hierarchy</span>
</span><span id=__span-83-5><a id=__codelineno-83-5 name=__codelineno-83-5 href=#__codelineno-83-5></a>docker-compose<span class=w> </span>config<span class=w> </span><span class=p>|</span><span class=w> </span>head<span class=w> </span>-50
</span><span id=__span-83-6><a id=__codelineno-83-6 name=__codelineno-83-6 href=#__codelineno-83-6></a>
</span><span id=__span-83-7><a id=__codelineno-83-7 name=__codelineno-83-7 href=#__codelineno-83-7></a><span class=c1># View service inheritance</span>
</span><span id=__span-83-8><a id=__codelineno-83-8 name=__codelineno-83-8 href=#__codelineno-83-8></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>web-primary<span class=w> </span>env<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>INSTANCE
</span><span id=__span-83-9><a id=__codelineno-83-9 name=__codelineno-83-9 href=#__codelineno-83-9></a>docker-compose<span class=w> </span><span class=nb>exec</span><span class=w> </span>api-worker<span class=w> </span>env<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>WORKER_TYPE
</span><span id=__span-83-10><a id=__codelineno-83-10 name=__codelineno-83-10 href=#__codelineno-83-10></a>
</span><span id=__span-83-11><a id=__codelineno-83-11 name=__codelineno-83-11 href=#__codelineno-83-11></a><span class=c1># Check labels and metadata</span>
</span><span id=__span-83-12><a id=__codelineno-83-12 name=__codelineno-83-12 href=#__codelineno-83-12></a>docker<span class=w> </span>inspect<span class=w> </span><span class=k>$(</span>docker-compose<span class=w> </span>ps<span class=w> </span>-q<span class=w> </span>web-primary<span class=k>)</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span><span class=s1>&#39;.[0].Config.Labels&#39;</span>
</span><span id=__span-83-13><a id=__codelineno-83-13 name=__codelineno-83-13 href=#__codelineno-83-13></a>
</span><span id=__span-83-14><a id=__codelineno-83-14 name=__codelineno-83-14 href=#__codelineno-83-14></a><span class=c1># Stop services</span>
</span><span id=__span-83-15><a id=__codelineno-83-15 name=__codelineno-83-15 href=#__codelineno-83-15></a>docker-compose<span class=w> </span>down
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>Multi-level inheritance</strong>: Global → Infrastructure → Service-type → Instance-specific</li> <li><strong>Complex merging</strong>: Multiple levels of configuration inheritance</li> <li><strong>Override chains</strong>: Each level can override previous configurations</li> <li><strong>Modular design</strong>: Easy to add new service types or instances</li> <li><strong>Configuration clarity</strong>: Clear separation of concerns across inheritance levels</li> </ul> </details> <hr> <h4 id=24-fragment-based-service-templates>24. Fragment-Based Service Templates<a class=headerlink href=#24-fragment-based-service-templates title="Permanent link">&para;</a></h4> <ul> <li> <p>Create reusable service templates using fragments for common service patterns.</p> <h4 id=scenario_23><strong>Scenario:</strong><a class=headerlink href=#scenario_23 title="Permanent link">&para;</a></h4> <ul> <li>Your application uses similar service patterns repeatedly (like web services, worker services, or API services) with slight variations.</li> <li>Service templates using fragments allow you to define reusable patterns and instantiate them with specific configurations.</li> </ul> <h4 id=resources_13>Resources:<a class=headerlink href=#resources_13 title="Permanent link">&para;</a></h4> <ul> <li><code>docker-compose.yml</code> ➤ Service templates with fragments <div class="language-yaml highlight"><pre><span></span><code><span id=__span-84-1><a id=__codelineno-84-1 name=__codelineno-84-1 href=#__codelineno-84-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-84-2><a id=__codelineno-84-2 name=__codelineno-84-2 href=#__codelineno-84-2></a>
</span><span id=__span-84-3><a id=__codelineno-84-3 name=__codelineno-84-3 href=#__codelineno-84-3></a><span class=nt>x-web-template</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;web-template</span>
</span><span id=__span-84-4><a id=__codelineno-84-4 name=__codelineno-84-4 href=#__codelineno-84-4></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-84-5><a id=__codelineno-84-5 name=__codelineno-84-5 href=#__codelineno-84-5></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-84-6><a id=__codelineno-84-6 name=__codelineno-84-6 href=#__codelineno-84-6></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id=__span-84-7><a id=__codelineno-84-7 name=__codelineno-84-7 href=#__codelineno-84-7></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-84-8><a id=__codelineno-84-8 name=__codelineno-84-8 href=#__codelineno-84-8></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-84-9><a id=__codelineno-84-9 name=__codelineno-84-9 href=#__codelineno-84-9></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-84-10><a id=__codelineno-84-10 name=__codelineno-84-10 href=#__codelineno-84-10></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-84-11><a id=__codelineno-84-11 name=__codelineno-84-11 href=#__codelineno-84-11></a>
</span><span id=__span-84-12><a id=__codelineno-84-12 name=__codelineno-84-12 href=#__codelineno-84-12></a><span class=nt>x-api-template</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;api-template</span>
</span><span id=__span-84-13><a id=__codelineno-84-13 name=__codelineno-84-13 href=#__codelineno-84-13></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-84-14><a id=__codelineno-84-14 name=__codelineno-84-14 href=#__codelineno-84-14></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-84-15><a id=__codelineno-84-15 name=__codelineno-84-15 href=#__codelineno-84-15></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-84-16><a id=__codelineno-84-16 name=__codelineno-84-16 href=#__codelineno-84-16></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-84-17><a id=__codelineno-84-17 name=__codelineno-84-17 href=#__codelineno-84-17></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-84-18><a id=__codelineno-84-18 name=__codelineno-84-18 href=#__codelineno-84-18></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-84-19><a id=__codelineno-84-19 name=__codelineno-84-19 href=#__codelineno-84-19></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-84-20><a id=__codelineno-84-20 name=__codelineno-84-20 href=#__codelineno-84-20></a>
</span><span id=__span-84-21><a id=__codelineno-84-21 name=__codelineno-84-21 href=#__codelineno-84-21></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-84-22><a id=__codelineno-84-22 name=__codelineno-84-22 href=#__codelineno-84-22></a><span class=w>  </span><span class=nt>web-frontend</span><span class=p>:</span>
</span><span id=__span-84-23><a id=__codelineno-84-23 name=__codelineno-84-23 href=#__codelineno-84-23></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span>
</span><span id=__span-84-24><a id=__codelineno-84-24 name=__codelineno-84-24 href=#__codelineno-84-24></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-84-25><a id=__codelineno-84-25 name=__codelineno-84-25 href=#__codelineno-84-25></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-84-26><a id=__codelineno-84-26 name=__codelineno-84-26 href=#__codelineno-84-26></a>
</span><span id=__span-84-27><a id=__codelineno-84-27 name=__codelineno-84-27 href=#__codelineno-84-27></a><span class=w>  </span><span class=nt>web-admin</span><span class=p>:</span>
</span><span id=__span-84-28><a id=__codelineno-84-28 name=__codelineno-84-28 href=#__codelineno-84-28></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span>
</span><span id=__span-84-29><a id=__codelineno-84-29 name=__codelineno-84-29 href=#__codelineno-84-29></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-84-30><a id=__codelineno-84-30 name=__codelineno-84-30 href=#__codelineno-84-30></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8081:80&quot;</span>
</span><span id=__span-84-31><a id=__codelineno-84-31 name=__codelineno-84-31 href=#__codelineno-84-31></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-84-32><a id=__codelineno-84-32 name=__codelineno-84-32 href=#__codelineno-84-32></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-84-33><a id=__codelineno-84-33 name=__codelineno-84-33 href=#__codelineno-84-33></a><span class=w>      </span><span class=nt>SECTION</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span></code></pre></div></li> </ul> </li> </ul> <p><strong>Hint:</strong> Define service templates as anchors and instantiate them with specific overrides</p> <details> <summary>Solution</summary> <p><strong>Solution:</strong></p> <p><strong>docker-compose.yml</strong> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-85-1><a id=__codelineno-85-1 name=__codelineno-85-1 href=#__codelineno-85-1></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&#39;3.8&#39;</span>
</span><span id=__span-85-2><a id=__codelineno-85-2 name=__codelineno-85-2 href=#__codelineno-85-2></a>
</span><span id=__span-85-3><a id=__codelineno-85-3 name=__codelineno-85-3 href=#__codelineno-85-3></a><span class=nt>x-service-base</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;service-base</span>
</span><span id=__span-85-4><a id=__codelineno-85-4 name=__codelineno-85-4 href=#__codelineno-85-4></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-5><a id=__codelineno-85-5 name=__codelineno-85-5 href=#__codelineno-85-5></a><span class=w>    </span><span class=nt>APP_ENV</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id=__span-85-6><a id=__codelineno-85-6 name=__codelineno-85-6 href=#__codelineno-85-6></a><span class=w>    </span><span class=nt>LOG_LEVEL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id=__span-85-7><a id=__codelineno-85-7 name=__codelineno-85-7 href=#__codelineno-85-7></a><span class=w>    </span><span class=nt>TZ</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id=__span-85-8><a id=__codelineno-85-8 name=__codelineno-85-8 href=#__codelineno-85-8></a><span class=w>  </span><span class=nt>logging</span><span class=p>:</span>
</span><span id=__span-85-9><a id=__codelineno-85-9 name=__codelineno-85-9 href=#__codelineno-85-9></a><span class=w>    </span><span class=nt>driver</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id=__span-85-10><a id=__codelineno-85-10 name=__codelineno-85-10 href=#__codelineno-85-10></a><span class=w>    </span><span class=nt>options</span><span class=p>:</span>
</span><span id=__span-85-11><a id=__codelineno-85-11 name=__codelineno-85-11 href=#__codelineno-85-11></a><span class=w>      </span><span class=nt>max-size</span><span class=p>:</span><span class=w> </span><span class=s>&quot;10m&quot;</span>
</span><span id=__span-85-12><a id=__codelineno-85-12 name=__codelineno-85-12 href=#__codelineno-85-12></a><span class=w>      </span><span class=nt>max-file</span><span class=p>:</span><span class=w> </span><span class=s>&quot;3&quot;</span>
</span><span id=__span-85-13><a id=__codelineno-85-13 name=__codelineno-85-13 href=#__codelineno-85-13></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-85-14><a id=__codelineno-85-14 name=__codelineno-85-14 href=#__codelineno-85-14></a><span class=w>    </span><span class=nt>restart_policy</span><span class=p>:</span>
</span><span id=__span-85-15><a id=__codelineno-85-15 name=__codelineno-85-15 href=#__codelineno-85-15></a><span class=w>      </span><span class=nt>condition</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id=__span-85-16><a id=__codelineno-85-16 name=__codelineno-85-16 href=#__codelineno-85-16></a><span class=w>      </span><span class=nt>delay</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-85-17><a id=__codelineno-85-17 name=__codelineno-85-17 href=#__codelineno-85-17></a>
</span><span id=__span-85-18><a id=__codelineno-85-18 name=__codelineno-85-18 href=#__codelineno-85-18></a><span class=nt>x-web-template</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;web-template</span>
</span><span id=__span-85-19><a id=__codelineno-85-19 name=__codelineno-85-19 href=#__codelineno-85-19></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span>
</span><span id=__span-85-20><a id=__codelineno-85-20 name=__codelineno-85-20 href=#__codelineno-85-20></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id=__span-85-21><a id=__codelineno-85-21 name=__codelineno-85-21 href=#__codelineno-85-21></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-22><a id=__codelineno-85-22 name=__codelineno-85-22 href=#__codelineno-85-22></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-23><a id=__codelineno-85-23 name=__codelineno-85-23 href=#__codelineno-85-23></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id=__span-85-24><a id=__codelineno-85-24 name=__codelineno-85-24 href=#__codelineno-85-24></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-85-25><a id=__codelineno-85-25 name=__codelineno-85-25 href=#__codelineno-85-25></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-85-26><a id=__codelineno-85-26 name=__codelineno-85-26 href=#__codelineno-85-26></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-85-27><a id=__codelineno-85-27 name=__codelineno-85-27 href=#__codelineno-85-27></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-85-28><a id=__codelineno-85-28 name=__codelineno-85-28 href=#__codelineno-85-28></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-85-29><a id=__codelineno-85-29 name=__codelineno-85-29 href=#__codelineno-85-29></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-85-30><a id=__codelineno-85-30 name=__codelineno-85-30 href=#__codelineno-85-30></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-85-31><a id=__codelineno-85-31 name=__codelineno-85-31 href=#__codelineno-85-31></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-85-32><a id=__codelineno-85-32 name=__codelineno-85-32 href=#__codelineno-85-32></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-85-33><a id=__codelineno-85-33 name=__codelineno-85-33 href=#__codelineno-85-33></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id=__span-85-34><a id=__codelineno-85-34 name=__codelineno-85-34 href=#__codelineno-85-34></a><span class=w>        </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.5&#39;</span>
</span><span id=__span-85-35><a id=__codelineno-85-35 name=__codelineno-85-35 href=#__codelineno-85-35></a>
</span><span id=__span-85-36><a id=__codelineno-85-36 name=__codelineno-85-36 href=#__codelineno-85-36></a><span class=nt>x-api-template</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;api-template</span>
</span><span id=__span-85-37><a id=__codelineno-85-37 name=__codelineno-85-37 href=#__codelineno-85-37></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span>
</span><span id=__span-85-38><a id=__codelineno-85-38 name=__codelineno-85-38 href=#__codelineno-85-38></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id=__span-85-39><a id=__codelineno-85-39 name=__codelineno-85-39 href=#__codelineno-85-39></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-40><a id=__codelineno-85-40 name=__codelineno-85-40 href=#__codelineno-85-40></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-41><a id=__codelineno-85-41 name=__codelineno-85-41 href=#__codelineno-85-41></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id=__span-85-42><a id=__codelineno-85-42 name=__codelineno-85-42 href=#__codelineno-85-42></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-85-43><a id=__codelineno-85-43 name=__codelineno-85-43 href=#__codelineno-85-43></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;API</span><span class=nv> </span><span class=s>OK&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-85-44><a id=__codelineno-85-44 name=__codelineno-85-44 href=#__codelineno-85-44></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id=__span-85-45><a id=__codelineno-85-45 name=__codelineno-85-45 href=#__codelineno-85-45></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-85-46><a id=__codelineno-85-46 name=__codelineno-85-46 href=#__codelineno-85-46></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-85-47><a id=__codelineno-85-47 name=__codelineno-85-47 href=#__codelineno-85-47></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-85-48><a id=__codelineno-85-48 name=__codelineno-85-48 href=#__codelineno-85-48></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-85-49><a id=__codelineno-85-49 name=__codelineno-85-49 href=#__codelineno-85-49></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-85-50><a id=__codelineno-85-50 name=__codelineno-85-50 href=#__codelineno-85-50></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-85-51><a id=__codelineno-85-51 name=__codelineno-85-51 href=#__codelineno-85-51></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id=__span-85-52><a id=__codelineno-85-52 name=__codelineno-85-52 href=#__codelineno-85-52></a><span class=w>        </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;1.0&#39;</span>
</span><span id=__span-85-53><a id=__codelineno-85-53 name=__codelineno-85-53 href=#__codelineno-85-53></a>
</span><span id=__span-85-54><a id=__codelineno-85-54 name=__codelineno-85-54 href=#__codelineno-85-54></a><span class=nt>x-worker-template</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;worker-template</span>
</span><span id=__span-85-55><a id=__codelineno-85-55 name=__codelineno-85-55 href=#__codelineno-85-55></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span>
</span><span id=__span-85-56><a id=__codelineno-85-56 name=__codelineno-85-56 href=#__codelineno-85-56></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">python:3.9-alpine</span>
</span><span id=__span-85-57><a id=__codelineno-85-57 name=__codelineno-85-57 href=#__codelineno-85-57></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-58><a id=__codelineno-85-58 name=__codelineno-85-58 href=#__codelineno-85-58></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-59><a id=__codelineno-85-59 name=__codelineno-85-59 href=#__codelineno-85-59></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">worker</span>
</span><span id=__span-85-60><a id=__codelineno-85-60 name=__codelineno-85-60 href=#__codelineno-85-60></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-85-61><a id=__codelineno-85-61 name=__codelineno-85-61 href=#__codelineno-85-61></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;Worker</span><span class=nv> </span><span class=s>OK&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-85-62><a id=__codelineno-85-62 name=__codelineno-85-62 href=#__codelineno-85-62></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">60s</span>
</span><span id=__span-85-63><a id=__codelineno-85-63 name=__codelineno-85-63 href=#__codelineno-85-63></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-85-64><a id=__codelineno-85-64 name=__codelineno-85-64 href=#__codelineno-85-64></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id=__span-85-65><a id=__codelineno-85-65 name=__codelineno-85-65 href=#__codelineno-85-65></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-85-66><a id=__codelineno-85-66 name=__codelineno-85-66 href=#__codelineno-85-66></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-85-67><a id=__codelineno-85-67 name=__codelineno-85-67 href=#__codelineno-85-67></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-85-68><a id=__codelineno-85-68 name=__codelineno-85-68 href=#__codelineno-85-68></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-85-69><a id=__codelineno-85-69 name=__codelineno-85-69 href=#__codelineno-85-69></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id=__span-85-70><a id=__codelineno-85-70 name=__codelineno-85-70 href=#__codelineno-85-70></a><span class=w>        </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.25&#39;</span>
</span><span id=__span-85-71><a id=__codelineno-85-71 name=__codelineno-85-71 href=#__codelineno-85-71></a>
</span><span id=__span-85-72><a id=__codelineno-85-72 name=__codelineno-85-72 href=#__codelineno-85-72></a><span class=nt>x-database-template</span><span class=p>:</span><span class=w> </span><span class=nl>&amp;database-template</span>
</span><span id=__span-85-73><a id=__codelineno-85-73 name=__codelineno-85-73 href=#__codelineno-85-73></a><span class=w>  </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span>
</span><span id=__span-85-74><a id=__codelineno-85-74 name=__codelineno-85-74 href=#__codelineno-85-74></a><span class=w>  </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id=__span-85-75><a id=__codelineno-85-75 name=__codelineno-85-75 href=#__codelineno-85-75></a><span class=w>  </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-76><a id=__codelineno-85-76 name=__codelineno-85-76 href=#__codelineno-85-76></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-77><a id=__codelineno-85-77 name=__codelineno-85-77 href=#__codelineno-85-77></a><span class=w>    </span><span class=nt>SERVICE_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id=__span-85-78><a id=__codelineno-85-78 name=__codelineno-85-78 href=#__codelineno-85-78></a><span class=w>  </span><span class=nt>healthcheck</span><span class=p>:</span>
</span><span id=__span-85-79><a id=__codelineno-85-79 name=__codelineno-85-79 href=#__codelineno-85-79></a><span class=w>    </span><span class=nt>test</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">[</span><span class=s>&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class=w> </span><span class=s>&quot;pg_isready</span><span class=nv> </span><span class=s>-U</span><span class=nv> </span><span class=s>${POSTGRES_USER:-user}</span><span class=nv> </span><span class=s>-d</span><span class=nv> </span><span class=s>${POSTGRES_DB:-myapp}&quot;</span><span class="p p-Indicator">]</span>
</span><span id=__span-85-80><a id=__codelineno-85-80 name=__codelineno-85-80 href=#__codelineno-85-80></a><span class=w>    </span><span class=nt>interval</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id=__span-85-81><a id=__codelineno-85-81 name=__codelineno-85-81 href=#__codelineno-85-81></a><span class=w>    </span><span class=nt>timeout</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id=__span-85-82><a id=__codelineno-85-82 name=__codelineno-85-82 href=#__codelineno-85-82></a><span class=w>    </span><span class=nt>retries</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id=__span-85-83><a id=__codelineno-85-83 name=__codelineno-85-83 href=#__codelineno-85-83></a><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-85-84><a id=__codelineno-85-84 name=__codelineno-85-84 href=#__codelineno-85-84></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*service-base</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-85-85><a id=__codelineno-85-85 name=__codelineno-85-85 href=#__codelineno-85-85></a><span class=w>    </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-85-86><a id=__codelineno-85-86 name=__codelineno-85-86 href=#__codelineno-85-86></a><span class=w>      </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-85-87><a id=__codelineno-85-87 name=__codelineno-85-87 href=#__codelineno-85-87></a><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id=__span-85-88><a id=__codelineno-85-88 name=__codelineno-85-88 href=#__codelineno-85-88></a><span class=w>        </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;2.0&#39;</span>
</span><span id=__span-85-89><a id=__codelineno-85-89 name=__codelineno-85-89 href=#__codelineno-85-89></a>
</span><span id=__span-85-90><a id=__codelineno-85-90 name=__codelineno-85-90 href=#__codelineno-85-90></a><span class=nt>services</span><span class=p>:</span>
</span><span id=__span-85-91><a id=__codelineno-85-91 name=__codelineno-85-91 href=#__codelineno-85-91></a><span class=w>  </span><span class=c1># Web services</span>
</span><span id=__span-85-92><a id=__codelineno-85-92 name=__codelineno-85-92 href=#__codelineno-85-92></a><span class=w>  </span><span class=nt>web-frontend</span><span class=p>:</span>
</span><span id=__span-85-93><a id=__codelineno-85-93 name=__codelineno-85-93 href=#__codelineno-85-93></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span>
</span><span id=__span-85-94><a id=__codelineno-85-94 name=__codelineno-85-94 href=#__codelineno-85-94></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-85-95><a id=__codelineno-85-95 name=__codelineno-85-95 href=#__codelineno-85-95></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8080:80&quot;</span>
</span><span id=__span-85-96><a id=__codelineno-85-96 name=__codelineno-85-96 href=#__codelineno-85-96></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-85-97><a id=__codelineno-85-97 name=__codelineno-85-97 href=#__codelineno-85-97></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web/frontend:/usr/share/nginx/html:ro</span>
</span><span id=__span-85-98><a id=__codelineno-85-98 name=__codelineno-85-98 href=#__codelineno-85-98></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-99><a id=__codelineno-85-99 name=__codelineno-85-99 href=#__codelineno-85-99></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-100><a id=__codelineno-85-100 name=__codelineno-85-100 href=#__codelineno-85-100></a><span class=w>      </span><span class=nt>SECTION</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id=__span-85-101><a id=__codelineno-85-101 name=__codelineno-85-101 href=#__codelineno-85-101></a>
</span><span id=__span-85-102><a id=__codelineno-85-102 name=__codelineno-85-102 href=#__codelineno-85-102></a><span class=w>  </span><span class=nt>web-admin</span><span class=p>:</span>
</span><span id=__span-85-103><a id=__codelineno-85-103 name=__codelineno-85-103 href=#__codelineno-85-103></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span>
</span><span id=__span-85-104><a id=__codelineno-85-104 name=__codelineno-85-104 href=#__codelineno-85-104></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-85-105><a id=__codelineno-85-105 name=__codelineno-85-105 href=#__codelineno-85-105></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8081:80&quot;</span>
</span><span id=__span-85-106><a id=__codelineno-85-106 name=__codelineno-85-106 href=#__codelineno-85-106></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-85-107><a id=__codelineno-85-107 name=__codelineno-85-107 href=#__codelineno-85-107></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web/admin:/usr/share/nginx/html:ro</span>
</span><span id=__span-85-108><a id=__codelineno-85-108 name=__codelineno-85-108 href=#__codelineno-85-108></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-109><a id=__codelineno-85-109 name=__codelineno-85-109 href=#__codelineno-85-109></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-110><a id=__codelineno-85-110 name=__codelineno-85-110 href=#__codelineno-85-110></a><span class=w>      </span><span class=nt>SECTION</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id=__span-85-111><a id=__codelineno-85-111 name=__codelineno-85-111 href=#__codelineno-85-111></a>
</span><span id=__span-85-112><a id=__codelineno-85-112 name=__codelineno-85-112 href=#__codelineno-85-112></a><span class=w>  </span><span class=nt>web-api-docs</span><span class=p>:</span>
</span><span id=__span-85-113><a id=__codelineno-85-113 name=__codelineno-85-113 href=#__codelineno-85-113></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span>
</span><span id=__span-85-114><a id=__codelineno-85-114 name=__codelineno-85-114 href=#__codelineno-85-114></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-85-115><a id=__codelineno-85-115 name=__codelineno-85-115 href=#__codelineno-85-115></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;8082:80&quot;</span>
</span><span id=__span-85-116><a id=__codelineno-85-116 name=__codelineno-85-116 href=#__codelineno-85-116></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-85-117><a id=__codelineno-85-117 name=__codelineno-85-117 href=#__codelineno-85-117></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">./web/docs:/usr/share/nginx/html:ro</span>
</span><span id=__span-85-118><a id=__codelineno-85-118 name=__codelineno-85-118 href=#__codelineno-85-118></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-119><a id=__codelineno-85-119 name=__codelineno-85-119 href=#__codelineno-85-119></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-120><a id=__codelineno-85-120 name=__codelineno-85-120 href=#__codelineno-85-120></a><span class=w>      </span><span class=nt>SECTION</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">api-docs</span>
</span><span id=__span-85-121><a id=__codelineno-85-121 name=__codelineno-85-121 href=#__codelineno-85-121></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-85-122><a id=__codelineno-85-122 name=__codelineno-85-122 href=#__codelineno-85-122></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*web-template</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-85-123><a id=__codelineno-85-123 name=__codelineno-85-123 href=#__codelineno-85-123></a><span class=w>      </span><span class=nt>resources</span><span class=p>:</span>
</span><span id=__span-85-124><a id=__codelineno-85-124 name=__codelineno-85-124 href=#__codelineno-85-124></a><span class=w>        </span><span class=nt>limits</span><span class=p>:</span>
</span><span id=__span-85-125><a id=__codelineno-85-125 name=__codelineno-85-125 href=#__codelineno-85-125></a><span class=w>          </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id=__span-85-126><a id=__codelineno-85-126 name=__codelineno-85-126 href=#__codelineno-85-126></a><span class=w>          </span><span class=nt>cpus</span><span class=p>:</span><span class=w> </span><span class=s>&#39;0.25&#39;</span>
</span><span id=__span-85-127><a id=__codelineno-85-127 name=__codelineno-85-127 href=#__codelineno-85-127></a>
</span><span id=__span-85-128><a id=__codelineno-85-128 name=__codelineno-85-128 href=#__codelineno-85-128></a><span class=w>  </span><span class=c1># API services</span>
</span><span id=__span-85-129><a id=__codelineno-85-129 name=__codelineno-85-129 href=#__codelineno-85-129></a><span class=w>  </span><span class=nt>api-users</span><span class=p>:</span>
</span><span id=__span-85-130><a id=__codelineno-85-130 name=__codelineno-85-130 href=#__codelineno-85-130></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-template</span>
</span><span id=__span-85-131><a id=__codelineno-85-131 name=__codelineno-85-131 href=#__codelineno-85-131></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-85-132><a id=__codelineno-85-132 name=__codelineno-85-132 href=#__codelineno-85-132></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3000:3000&quot;</span>
</span><span id=__span-85-133><a id=__codelineno-85-133 name=__codelineno-85-133 href=#__codelineno-85-133></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-134><a id=__codelineno-85-134 name=__codelineno-85-134 href=#__codelineno-85-134></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-135><a id=__codelineno-85-135 name=__codelineno-85-135 href=#__codelineno-85-135></a><span class=w>      </span><span class=nt>MODULE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">users</span>
</span><span id=__span-85-136><a id=__codelineno-85-136 name=__codelineno-85-136 href=#__codelineno-85-136></a><span class=w>      </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id=__span-85-137><a id=__codelineno-85-137 name=__codelineno-85-137 href=#__codelineno-85-137></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-85-138><a id=__codelineno-85-138 name=__codelineno-85-138 href=#__codelineno-85-138></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-85-139><a id=__codelineno-85-139 name=__codelineno-85-139 href=#__codelineno-85-139></a>
</span><span id=__span-85-140><a id=__codelineno-85-140 name=__codelineno-85-140 href=#__codelineno-85-140></a><span class=w>  </span><span class=nt>api-products</span><span class=p>:</span>
</span><span id=__span-85-141><a id=__codelineno-85-141 name=__codelineno-85-141 href=#__codelineno-85-141></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-template</span>
</span><span id=__span-85-142><a id=__codelineno-85-142 name=__codelineno-85-142 href=#__codelineno-85-142></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-85-143><a id=__codelineno-85-143 name=__codelineno-85-143 href=#__codelineno-85-143></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;3001:3000&quot;</span>
</span><span id=__span-85-144><a id=__codelineno-85-144 name=__codelineno-85-144 href=#__codelineno-85-144></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-145><a id=__codelineno-85-145 name=__codelineno-85-145 href=#__codelineno-85-145></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*api-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-146><a id=__codelineno-85-146 name=__codelineno-85-146 href=#__codelineno-85-146></a><span class=w>      </span><span class=nt>MODULE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">products</span>
</span><span id=__span-85-147><a id=__codelineno-85-147 name=__codelineno-85-147 href=#__codelineno-85-147></a><span class=w>      </span><span class=nt>DATABASE_URL</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id=__span-85-148><a id=__codelineno-85-148 name=__codelineno-85-148 href=#__codelineno-85-148></a><span class=w>    </span><span class=nt>depends_on</span><span class=p>:</span>
</span><span id=__span-85-149><a id=__codelineno-85-149 name=__codelineno-85-149 href=#__codelineno-85-149></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id=__span-85-150><a id=__codelineno-85-150 name=__codelineno-85-150 href=#__codelineno-85-150></a>
</span><span id=__span-85-151><a id=__codelineno-85-151 name=__codelineno-85-151 href=#__codelineno-85-151></a><span class=w>  </span><span class=c1># Worker services</span>
</span><span id=__span-85-152><a id=__codelineno-85-152 name=__codelineno-85-152 href=#__codelineno-85-152></a><span class=w>  </span><span class=nt>worker-email</span><span class=p>:</span>
</span><span id=__span-85-153><a id=__codelineno-85-153 name=__codelineno-85-153 href=#__codelineno-85-153></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*worker-template</span>
</span><span id=__span-85-154><a id=__codelineno-85-154 name=__codelineno-85-154 href=#__codelineno-85-154></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-155><a id=__codelineno-85-155 name=__codelineno-85-155 href=#__codelineno-85-155></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*worker-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-156><a id=__codelineno-85-156 name=__codelineno-85-156 href=#__codelineno-85-156></a><span class=w>      </span><span class=nt>WORKER_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">email</span>
</span><span id=__span-85-157><a id=__codelineno-85-157 name=__codelineno-85-157 href=#__codelineno-85-157></a><span class=w>      </span><span class=nt>QUEUE_NAME</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">email_queue</span>
</span><span id=__span-85-158><a id=__codelineno-85-158 name=__codelineno-85-158 href=#__codelineno-85-158></a><span class=w>    </span><span class=nt>deploy</span><span class=p>:</span>
</span><span id=__span-85-159><a id=__codelineno-85-159 name=__codelineno-85-159 href=#__codelineno-85-159></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*worker-template</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id=__span-85-160><a id=__codelineno-85-160 name=__codelineno-85-160 href=#__codelineno-85-160></a><span class=w>      </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-85-161><a id=__codelineno-85-161 name=__codelineno-85-161 href=#__codelineno-85-161></a>
</span><span id=__span-85-162><a id=__codelineno-85-162 name=__codelineno-85-162 href=#__codelineno-85-162></a><span class=w>  </span><span class=nt>worker-reports</span><span class=p>:</span>
</span><span id=__span-85-163><a id=__codelineno-85-163 name=__codelineno-85-163 href=#__codelineno-85-163></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*worker-template</span>
</span><span id=__span-85-164><a id=__codelineno-85-164 name=__codelineno-85-164 href=#__codelineno-85-164></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-165><a id=__codelineno-85-165 name=__codelineno-85-165 href=#__codelineno-85-165></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*worker-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-166><a id=__codelineno-85-166 name=__codelineno-85-166 href=#__codelineno-85-166></a><span class=w>      </span><span class=nt>WORKER_TYPE</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">reports</span>
</span><span id=__span-85-167><a id=__codelineno-85-167 name=__codelineno-85-167 href=#__codelineno-85-167></a><span class=w>      </span><span class=nt>SCHEDULE</span><span class=p>:</span><span class=w> </span><span class=s>&quot;0</span><span class=nv> </span><span class=s>*/6</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*</span><span class=nv> </span><span class=s>*&quot;</span>
</span><span id=__span-85-168><a id=__codelineno-85-168 name=__codelineno-85-168 href=#__codelineno-85-168></a>
</span><span id=__span-85-169><a id=__codelineno-85-169 name=__codelineno-85-169 href=#__codelineno-85-169></a><span class=w>  </span><span class=c1># Database</span>
</span><span id=__span-85-170><a id=__codelineno-85-170 name=__codelineno-85-170 href=#__codelineno-85-170></a><span class=w>  </span><span class=nt>db</span><span class=p>:</span>
</span><span id=__span-85-171><a id=__codelineno-85-171 name=__codelineno-85-171 href=#__codelineno-85-171></a><span class=w>    </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*database-template</span>
</span><span id=__span-85-172><a id=__codelineno-85-172 name=__codelineno-85-172 href=#__codelineno-85-172></a><span class=w>    </span><span class=nt>environment</span><span class=p>:</span>
</span><span id=__span-85-173><a id=__codelineno-85-173 name=__codelineno-85-173 href=#__codelineno-85-173></a><span class=w>      </span><span class=nt>&lt;&lt;</span><span class=p>:</span><span class=w> </span><span class=nv>*database-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id=__span-85-174><a id=__codelineno-85-174 name=__codelineno-85-174 href=#__codelineno-85-174></a><span class=w>      </span><span class=nt>POSTGRES_DB</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id=__span-85-175><a id=__codelineno-85-175 name=__codelineno-85-175 href=#__codelineno-85-175></a><span class=w>      </span><span class=nt>POSTGRES_USER</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id=__span-85-176><a id=__codelineno-85-176 name=__codelineno-85-176 href=#__codelineno-85-176></a><span class=w>      </span><span class=nt>POSTGRES_PASSWORD</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id=__span-85-177><a id=__codelineno-85-177 name=__codelineno-85-177 href=#__codelineno-85-177></a><span class=w>    </span><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-85-178><a id=__codelineno-85-178 name=__codelineno-85-178 href=#__codelineno-85-178></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id=__span-85-179><a id=__codelineno-85-179 name=__codelineno-85-179 href=#__codelineno-85-179></a><span class=w>    </span><span class=nt>ports</span><span class=p>:</span>
</span><span id=__span-85-180><a id=__codelineno-85-180 name=__codelineno-85-180 href=#__codelineno-85-180></a><span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=s>&quot;5432:5432&quot;</span>
</span><span id=__span-85-181><a id=__codelineno-85-181 name=__codelineno-85-181 href=#__codelineno-85-181></a>
</span><span id=__span-85-182><a id=__codelineno-85-182 name=__codelineno-85-182 href=#__codelineno-85-182></a><span class=nt>volumes</span><span class=p>:</span>
</span><span id=__span-85-183><a id=__codelineno-85-183 name=__codelineno-85-183 href=#__codelineno-85-183></a><span class=w>  </span><span class=nt>db_data</span><span class=p>:</span>
</span></code></pre></div></p> <p><strong>Commands:</strong> <div class="language-bash highlight"><pre><span></span><code><span id=__span-86-1><a id=__codelineno-86-1 name=__codelineno-86-1 href=#__codelineno-86-1></a><span class=c1># Start templated services</span>
</span><span id=__span-86-2><a id=__codelineno-86-2 name=__codelineno-86-2 href=#__codelineno-86-2></a>docker-compose<span class=w> </span>up<span class=w> </span>-d
</span><span id=__span-86-3><a id=__codelineno-86-3 name=__codelineno-86-3 href=#__codelineno-86-3></a>
</span><span id=__span-86-4><a id=__codelineno-86-4 name=__codelineno-86-4 href=#__codelineno-86-4></a><span class=c1># Check template instantiation</span>
</span><span id=__span-86-5><a id=__codelineno-86-5 name=__codelineno-86-5 href=#__codelineno-86-5></a>docker-compose<span class=w> </span>ps
</span><span id=__span-86-6><a id=__codelineno-86-6 name=__codelineno-86-6 href=#__codelineno-86-6></a>
</span><span id=__span-86-7><a id=__codelineno-86-7 name=__codelineno-86-7 href=#__codelineno-86-7></a><span class=c1># View service configurations</span>
</span><span id=__span-86-8><a id=__codelineno-86-8 name=__codelineno-86-8 href=#__codelineno-86-8></a>docker-compose<span class=w> </span>config<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>-A<span class=w> </span><span class=m>10</span><span class=w> </span><span class=s2>&quot;web-frontend:&quot;</span>
</span><span id=__span-86-9><a id=__codelineno-86-9 name=__codelineno-86-9 href=#__codelineno-86-9></a>
</span><span id=__span-86-10><a id=__codelineno-86-10 name=__codelineno-86-10 href=#__codelineno-86-10></a><span class=c1># Test different service types</span>
</span><span id=__span-86-11><a id=__codelineno-86-11 name=__codelineno-86-11 href=#__codelineno-86-11></a>curl<span class=w> </span>http://localhost:8080
</span><span id=__span-86-12><a id=__codelineno-86-12 name=__codelineno-86-12 href=#__codelineno-86-12></a>curl<span class=w> </span>http://localhost:8081
</span><span id=__span-86-13><a id=__codelineno-86-13 name=__codelineno-86-13 href=#__codelineno-86-13></a>docker-compose<span class=w> </span>logs<span class=w> </span>api-users
</span><span id=__span-86-14><a id=__codelineno-86-14 name=__codelineno-86-14 href=#__codelineno-86-14></a>
</span><span id=__span-86-15><a id=__codelineno-86-15 name=__codelineno-86-15 href=#__codelineno-86-15></a><span class=c1># Scale templated services</span>
</span><span id=__span-86-16><a id=__codelineno-86-16 name=__codelineno-86-16 href=#__codelineno-86-16></a>docker-compose<span class=w> </span>up<span class=w> </span>-d<span class=w> </span>--scale<span class=w> </span>worker-email<span class=o>=</span><span class=m>3</span>
</span><span id=__span-86-17><a id=__codelineno-86-17 name=__codelineno-86-17 href=#__codelineno-86-17></a>
</span><span id=__span-86-18><a id=__codelineno-86-18 name=__codelineno-86-18 href=#__codelineno-86-18></a><span class=c1># Stop services</span>
</span><span id=__span-86-19><a id=__codelineno-86-19 name=__codelineno-86-19 href=#__codelineno-86-19></a>docker-compose<span class=w> </span>down
</span></code></pre></div></p> <p><strong>Explanation:</strong></p> <ul> <li><strong>Service templates</strong>: Reusable patterns for common service types</li> <li><strong>Template instantiation</strong>: Create multiple services from the same template</li> <li><strong>Customization</strong>: Override template defaults for specific instances</li> <li><strong>Consistency</strong>: Ensure similar services follow the same patterns</li> <li><strong>Maintainability</strong>: Changes to templates affect all instances</li> <li><strong>Scalability</strong>: Easy to add new services following established patterns</li> </ul> </details> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Render date of last update --> <!-- Render date of creation --> <!-- ---------------------------------------------------------------------- --> <!-- Render authors --> <!-- ---------------------------------------------------------------------- --> <!-- Render committers from GitHub --> <!-- Render committers from GitLab --> <!-- Render committers --> <!-- ---------------------------------------------------------------------- --> <!-- Determine date of last update --> <!-- Determine date of creation --> <!-- Source file information --> <aside class=md-source-file> <!-- Date of last update --> <span class=md-source-file__fact> <span class=md-icon title="Last update"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 26, 2025 11:00:09 UTC">October 26, 2025</span> </span> <!-- Authors (git-authors plugin) --> <!-- Authors (git-committers plugin) --> <!-- Fallback: Manual GitHub avatar for repository owner --> <span class=md-source-file__fact> <nav> <a href=https://github.com/nirgeier class=md-author title=@nirgeier> <img src="https://avatars.githubusercontent.com/u/555154?size=256" alt="Nir Geier"> </a> </nav> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class=md-footer> <div class=logo1></div> <div class=logo2></div> <!-- Link to previous and/or next page --> <nav class="md-footer__inner md-grid" aria-label=Footer> <!-- Link to previous page --> <a href=../DockerFile/ class="md-footer__link md-footer__link--prev" aria-label="Previous: DockerFile Tasks"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> DockerFile Tasks </div> </div> </a> <!-- <ul class="social-badges">
          <li><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target="_blank" rel="noopener"><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a></li>
          <li><a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener"><i class="fab fa-linkedin" aria-hidden="true"></i><span class="sr-only">LinkedIn profile</span></a></li>
          <li><a href="mailto:nirgeier@gmail.com"><img src="https://img.shields.io/badge/-nirgeier@gmail.com-fcc624?style=flat&logo=Gmail&logoColor=red" alt="Gmail Badge"></a></li>
          <li><a href="mailto:nirg@codewizard.co.il"><img src="https://img.shields.io/badge/-nirg@codewizard.co.il-fcc624?style=flat&logo=microsoftoutlook&logoColor=blue" alt="Outlook Badge"></a></li>
        </ul> --> <!-- Link to next page --> <a href=../DockerNetwork/ class="md-footer__link md-footer__link--next" aria-label="Next: Docker Network Tasks"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> Docker Network Tasks </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> ©2021-2025 Nir Geier<br><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target=_blank rel=noopener><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a> </div> </div> <!-- Social links --> <div class=md-social> <a href=https://github.com/nirgeier/DockerLabs target=_blank rel=noopener title="View on GitHub" class="md-social__link social-class__github"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://github.com/nirgeier/DockerLabs/network/members target=_blank rel=noopener title="Fork this repo" class="md-social__link social-class__fork"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg> </a> <a href=https://github.com/nirgeier/DockerLabs/stargazers target=_blank rel=noopener title="Star this repo" class="md-social__link social-class__star"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg> </a> <a href=https://www.linkedin.com/in/nirgeier/ target=_blank rel=noopener title="Connect on LinkedIn" class="md-social__link social-class__linkedin"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> <a href=https://discord.gg/U6xW23Ss target=_blank rel=noopener title="Follow me on Discord" class="md-social__link social-class__discord"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg> </a> <a href=https://stackoverflow.com/users/1755598/codewizard target=_blank rel=noopener title="Follow me on Stack Overflow" class="md-social__link social-class__stackoverflow"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg> </a> <a href=https://wa.me/972548122310 target=_blank rel=noopener title="Follow me on WhatsApp" class="md-social__link social-class__whatsapp"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg> </a> <a href=mailto:nirg@codewizard.co.il target=_blank rel=noopener title="Email me" class="md-social__link social-class__email"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill=currentColor d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <div class=md-progress data-md-component=progress role=progressbar></div> <script id=__config type=application/json>{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "content.footer.last-updated", "content.footer.contributors", {"navigation.expand": false}, "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", {"navigation.top": true}, "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate", "toc.sticky"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../assets/javascripts/bundle.50899def.min.js></script> <script src=../../js/print-site.js></script> <script src=https://buttons.github.io/buttons.js></script> </body> </html>