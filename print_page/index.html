
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A collection of GitHub Labs for learning and practicing Docker skills.">
      
      
        <meta name="author" content="Nir Geier - nirgeier@gmail.com">
      
      
        <link rel="canonical" href="https://nirgeier.github.io/DockerLabs/print_page/">
      
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Print Site - DockerLabs - Docker Hands-On</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%202a7%207%200%200%200-7%207c0%202.38%201.19%204.47%203%205.74V17a1%201%200%200%200%201%201h6a1%201%200%200%200%201-1v-2.26c1.81-1.27%203-3.36%203-5.74a7%207%200%200%200-7-7M9%2021a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1H9z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Mulish";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/theme.css">
    
    <script>__md_scope=new URL("/DockerLabs/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#section-1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine classes -->





<!-- Header -->
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">

    <!-- Link to home -->
    <a href=".." title="DockerLabs - Docker Hands-On"
      class="md-header__button md-logo" aria-label="DockerLabs - Docker Hands-On" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DockerLabs - Docker Hands-On
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
            Print Site
            
          </span>
        </div>
      </div>
    </div>

    <div class="m-social__top">
      <!-- Social links -->
      
      
<div class="md-social">
    
    
    
    
    
    <a href="https://github.com/nirgeier/DockerLabs" target="_blank" rel="noopener" title="View on GitHub"
        class="md-social__link social-class__github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/DockerLabs/network/members" target="_blank" rel="noopener" title="Fork this repo"
        class="md-social__link social-class__fork">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/DockerLabs/stargazers" target="_blank" rel="noopener" title="Star this repo"
        class="md-social__link social-class__star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener" title="Connect on LinkedIn"
        class="md-social__link social-class__linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://discord.gg/U6xW23Ss" target="_blank" rel="noopener" title="Follow me on Discord"
        class="md-social__link social-class__discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://stackoverflow.com/users/1755598/codewizard" target="_blank" rel="noopener" title="Follow me on Stack Overflow"
        class="md-social__link social-class__stackoverflow">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://wa.me/972548122310" target="_blank" rel="noopener" title="Follow me on WhatsApp"
        class="md-social__link social-class__whatsapp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg>
    </a>
    
    
    
    
    
    <a href="mailto:nirg@codewizard.co.il" target="_blank" rel="noopener" title="Email me"
        class="md-social__link social-class__email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg>
    </a>
    
</div>
      
    </div>

    <!-- Color palette toggle -->
    
    
    <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
    
    

    <!-- User preference: color palette -->
    
    <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
    

    <!-- Check if search is actually enabled - see https://t.ly/DT_0V -->
    
    <label class="md-header__button md-icon" for="__search">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
    </label>

    <!-- Search interface -->
    <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    

    <!-- Repository information -->
    
    <div class="md-header__source">
      <a href="https://github.com/nirgeier/DockerLabs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nirgeier/DockerLabs
  </div>
</a>
    </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
  
  
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  
    
  
  Labs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Tasks/" class="md-tabs__link">
          
  
  
    
  
  Tasks

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
  
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DockerLabs - Docker Hands-On" class="md-nav__button md-logo" aria-label="DockerLabs - Docker Hands-On" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    DockerLabs - Docker Hands-On
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nirgeier/DockerLabs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nirgeier/DockerLabs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href=".." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../Tasks/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        
                    <section class='print-page md-section' id='section-1' heading-number='1'>
                        <h1>Labs<a class='headerlink' href='#section-1' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="index" heading-number="1.1"><h1 id="index-dockerlabs-hands-on">DockerLabs Hands-on<a class="headerlink" href="#index-dockerlabs-hands-on" title="Permanent link">&para;</a></h1>
<p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<ul>
<li>Welcome to the lab workspace that accompanies the DockerLabs project. </li>
<li>Each folder below is a self-contained lab that you can complete independently to sharpen specific containerization skills. </li>
<li>Follow the README file in each lab for detailed steps.</li>
</ul>
<h2 id="index-how-to-use-those-labs">How to Use Those Labs<a class="headerlink" href="#index-how-to-use-those-labs" title="Permanent link">&para;</a></h2>
<ul>
<li>There are several ways to run the Docker Labs. </li>
<li>Choose the method that works best for you.<ul>
<li><img alt="" class="width-24px" src="../../assets/images/killercoda-icon.png" /> Killercoda  (Recommended)</li>
<li>üìú From Source</li>
<li><img alt="" class="width-24px" src="../../assets/images/gcp.png" /> Using Google Cloud Shell</li>
</ul>
</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="index-__tabbed_1_1" name="index-__tabbed_1" type="radio" /><input id="index-__tabbed_1_2" name="index-__tabbed_1" type="radio" /><input id="index-__tabbed_1_3" name="index-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="index-__tabbed_1_1"><img alt="" class="" src="../../assets/images/killercoda-icon.png" width-24px="width-24px" /> Killercoda  (Recommended)</label><label for="index-__tabbed_1_2">üìú From Source</label><label for="index-__tabbed_1_3"><img alt="" class="width-24px" src="../../assets/images/gcp.png" /> Using Google Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>The easiest way to get started with the labs</li>
<li>Learn Docker in your browser without any local installation</li>
</ul>
<p>üåê <a href="https://killercoda.com/codewizard/scenario/DockerLabs" target="_blank"><strong>Launch on Killercoda</strong></a></p>
<p><strong>Benefits:</strong></p>
<ul>
<li>No installation required</li>
<li>Pre-configured environment</li>
<li>Works on any device with a web browser</li>
<li>All tools pre-installed</li>
</ul>
</div>
<div class="tabbed-block">
<p>For those who prefer to run it directly on their machine:</p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#index-__codelineno-0-1"></a><span class="c1"># Clone the repository</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#index-__codelineno-0-2"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/nirgeier/DockerLabs.git
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#index-__codelineno-0-3"></a><span class="c1"># Change to the Labs directory</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#index-__codelineno-0-4"></a><span class="nb">cd</span><span class="w"> </span>DockerLabs/Labs
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#index-__codelineno-0-5"></a><span class="c1"># Start with the Docker CLI lab</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#index-__codelineno-0-6"></a><span class="nb">cd</span><span class="w"> </span><span class="m">001</span>-DockerCli
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#index-__codelineno-0-7"></a><span class="c1"># Follow the instructions in the README of each lab</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#index-__codelineno-0-8"></a>cat<span class="w"> </span>README.md
</span></code></pre></div>
<strong>Prerequisites:</strong></p>
<ul>
<li>Ansible installed on your system</li>
<li>A Unix-like operating system (Linux, macOS, or Windows with WSL)</li>
<li>Basic command-line tools</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>Google Cloud Shell provides a free, browser-based environment with all necessary tools pre-installed.</li>
<li>Click on the <code>Open in Google Cloud Shell</code> button below:</li>
</ul>
<p><a href="https://console.cloud.google.com/cloudshell/editor?cloudshell_git_repo=https://github.com/nirgeier/DockerLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<ul>
<li>The repository will automatically be cloned into a free Cloud instance.</li>
<li>Use <strong><kbd>CTRL</kbd></strong> + click to open it in a new window.</li>
<li>Follow the instructions in the README of each lab.</li>
</ul>
<p><strong>Benefits:</strong></p>
<ul>
<li>No local installation required</li>
<li>Pre-configured environment</li>
<li>Works on any device with a web browser</li>
<li>All tools pre-installed</li>
<li>Free tier available</li>
</ul>
</div>
</div>
</div>
<hr />
<h2 id="index-lab-index">Lab Index<a class="headerlink" href="#index-lab-index" title="Permanent link">&para;</a></h2>
<div class="grid cards">
<ul>
<li>
<h2 id="index-001-docker-cli">001 - Docker CLI<a class="headerlink" href="#index-001-docker-cli" title="Permanent link">&para;</a></h2>
<hr />
<p>Practice the core Docker CLI commands for running, inspecting, and managing containers.</p>
<p><a href="#001-dockercli"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-002-dockerfile-basics">002 - Dockerfile Basics<a class="headerlink" href="#index-002-dockerfile-basics" title="Permanent link">&para;</a></h2>
<hr />
<p>Build your first Node.js container image from a Dockerfile and publish it to a registry.</p>
<p><a href="#002-dockerfile"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-003-dockerfile-multi-stage">003 - Dockerfile Multi-Stage<a class="headerlink" href="#index-003-dockerfile-multi-stage" title="Permanent link">&para;</a></h2>
<hr />
<p>Learn how multi-stage Dockerfiles produce lean images across build targets.</p>
<p><a href="#003-dockerfile-multistage"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-004-local-registry">004 - Local Registry<a class="headerlink" href="#index-004-local-registry" title="Permanent link">&para;</a></h2>
<hr />
<p>Stand up a private registry, retag images, and push or pull them locally.</p>
<p><a href="#004-localregistry"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-005-docker-compose-stack">005 - Docker Compose Stack<a class="headerlink" href="#index-005-docker-compose-stack" title="Permanent link">&para;</a></h2>
<hr />
<p>Orchestrate a WordPress and MariaDB stack with Docker Compose.</p>
<p><a href="#005-dockercompose-basics"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-006-compose-environments">006 - Compose Environments<a class="headerlink" href="#index-006-compose-environments" title="Permanent link">&para;</a></h2>
<hr />
<p>Structure Compose files and env vars for dev and prod workflows.</p>
<p><a href="#006-dockercompose-env"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-007-docker-compose-fragments">007 - Docker Compose Fragments<a class="headerlink" href="#index-007-docker-compose-fragments" title="Permanent link">&para;</a></h2>
<hr />
<p>Learn advanced Docker Compose features with fragments and modular configurations.</p>
<p><a href="#007-dockercompose-fragments"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-008-cri-crictl">008 - CRI <code>crictl</code><a class="headerlink" href="#index-008-cri-crictl" title="Permanent link">&para;</a></h2>
<hr />
<p>Learn about container runtime interface tooling using crictl.</p>
<p><a href="#008-crictl"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-009-dive-layers">009 - Dive Layers<a class="headerlink" href="#index-009-dive-layers" title="Permanent link">&para;</a></h2>
<hr />
<p>Explore image layer creation and visualize them with the dive tool.</p>
<p><a href="#009-dive-layers"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-010-docker-bake">010 - Docker Bake<a class="headerlink" href="#index-010-docker-bake" title="Permanent link">&para;</a></h2>
<hr />
<p>Use Docker Buildx Bake to coordinate complex, multi-target image builds.</p>
<p><a href="#010-bake"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-011-security-trust">011 - Security &amp; Trust<a class="headerlink" href="#index-011-security-trust" title="Permanent link">&para;</a></h2>
<hr />
<p>Learn advanced Docker security features and best practices for container security.</p>
<p><a href="#011-security&trust"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-012-gvisor-seccomp">012 - gVisor Seccomp<a class="headerlink" href="#index-012-gvisor-seccomp" title="Permanent link">&para;</a></h2>
<hr />
<p>Apply a gVisor runtime profile to block privileged syscalls inside a container.</p>
<p><a href="#012-gvisor"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-013-onictl">013 - onictl<a class="headerlink" href="#index-013-onictl" title="Permanent link">&para;</a></h2>
<hr />
<p>Learn about container networking with onictl.</p>
<p><a href="#013-onictl"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
<li>
<h2 id="index-100-hands-on-intro">100 - Hands-On Intro<a class="headerlink" href="#index-100-hands-on-intro" title="Permanent link">&para;</a></h2>
<hr />
<p>Guided Node.js exercise covering the full build, run, and publish workflow.</p>
<p><a href="#100-hands-on"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13.22 19.03a.75.75 0 0 1 0-1.06L18.19 13H3.75a.75.75 0 0 1 0-1.5h14.44l-4.97-4.97a.749.749 0 0 1 .326-1.275.75.75 0 0 1 .734.215l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0"/></svg></span> Get started</a></p>
</li>
</ul>
</div>
<hr />
<h2 id="index-tasks">Tasks<a class="headerlink" href="#index-tasks" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Task</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#tasks-dockercommit">DockerCommit</a></td>
<td>In-class exercise for capturing container changes with <code>docker commit</code>.</td>
</tr>
<tr>
<td><a href="#tasks-dockerdebug">DockerDebug</a></td>
<td>Debugging challenge: troubleshoot a crashing Flask container and fix missing configurations.</td>
</tr>
<tr>
<td><a href="#tasks-dockerfileadvanced">DockerfileAdvanced</a></td>
<td>Advanced Dockerfile exercise covering BuildKit secrets, caching, and health checks.</td>
</tr>
<tr>
<td><a href="#tasks-dockerlogs">DockerLogs</a></td>
<td>In-class exercise for running cowsay container, managing logs, and debugging.</td>
</tr>
<tr>
<td><a href="#tasks-multistage">MultiStage</a></td>
<td>In-class exercise for creating multi-stage Dockerfiles with alpine and node images.</td>
</tr>
</tbody>
</table>
<hr />
<p>Happy learning and hacking with Docker!</p></section><section class="print-page" id="001-dockercli" heading-number="1.2"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="001-dockercli-lab-001-docker-cli">Lab 001 - Docker CLI<a class="headerlink" href="#001-dockercli-lab-001-docker-cli" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab covers the basics of the Docker CLI.</li>
<li>You will learn how to run, manage, and interact with Docker containers using various Docker commands.</li>
<li>By the end of this lab, you will have a solid understanding of how to use the Docker CLI for container management.</li>
</ul>
<hr />
<h2 id="001-dockercli-docker-cli-commands">Docker CLI Commands<a class="headerlink" href="#001-dockercli-docker-cli-commands" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#001-dockercli-docker-attach"><code>docker attach</code></a></li>
<li><a href="#001-dockercli-docker-build"><code>docker build</code></a></li>
<li><a href="#001-dockercli-docker-commit"><code>docker commit</code></a></li>
<li><a href="#001-dockercli-docker-cp"><code>docker cp</code></a></li>
<li><a href="#001-dockercli-docker-create"><code>docker create</code></a></li>
<li><a href="#001-dockercli-docker-exec"><code>docker exec</code></a></li>
<li><a href="#001-dockercli-docker-images"><code>docker images</code></a></li>
<li><a href="#001-dockercli-docker-inspect"><code>docker inspect</code></a></li>
<li><a href="#001-dockercli-docker-kill"><code>docker kill</code></a></li>
<li><a href="#001-dockercli-docker-logs"><code>docker logs</code></a></li>
<li><a href="#001-dockercli-docker-pause"><code>docker pause</code></a></li>
<li><a href="#001-dockercli-docker-ps"><code>docker ps</code></a></li>
<li><a href="#001-dockercli-docker-pull"><code>docker pull</code></a></li>
<li><a href="#001-dockercli-docker-push"><code>docker push</code></a></li>
<li><a href="#001-dockercli-docker-rename"><code>docker rename</code></a></li>
<li><a href="#001-dockercli-docker-restart"><code>docker restart</code></a></li>
<li><a href="#001-dockercli-docker-rm"><code>docker rm</code></a></li>
<li><a href="#001-dockercli-docker-rmi"><code>docker rmi</code></a></li>
<li><a href="#001-dockercli-docker-run"><code>docker run</code></a></li>
<li><a href="#001-dockercli-docker-run--a"><code>docker run -a</code></a></li>
<li><a href="#001-dockercli-docker-run--d"><code>docker run -d</code></a></li>
<li><a href="#001-dockercli-docker-run--it"><code>docker run -it</code></a></li>
<li><a href="#001-dockercli-docker-run--name"><code>docker run -name</code></a></li>
<li><a href="#001-dockercli-docker-run--p"><code>docker run -p</code></a></li>
<li><a href="#001-dockercli-docker-run-command"><code>docker run &lt;command&gt;</code></a></li>
<li><a href="#001-dockercli-docker-start"><code>docker start</code></a></li>
<li><a href="#001-dockercli-docker-stats"><code>docker stats</code></a></li>
<li><a href="#001-dockercli-docker-stop"><code>docker stop</code></a></li>
<li><a href="#001-dockercli-docker-top"><code>docker top</code></a></li>
<li><a href="#001-dockercli-docker-unpause"><code>docker unpause</code></a></li>
<li><a href="#001-dockercli-docker-wait"><code>docker wait</code></a></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-attach"><code>docker attach</code><a class="headerlink" href="#001-dockercli-docker-attach" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker attach</code> is used to attach your terminal to a running container.</li>
<li>This is useful when you want to interact with a container that is already running.</li>
<li>For example, if you have a container running a shell or an application that accepts input, you can use <code>docker attach</code> to connect to it.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#001-dockercli-__codelineno-0-1"></a><span class="c1"># Spin an alpine image and start it in the background</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#001-dockercli-__codelineno-0-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>alpine001<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">10000</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#001-dockercli-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#001-dockercli-__codelineno-0-4"></a><span class="c1"># Attach to the container and start a shell inside it</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#001-dockercli-__codelineno-0-5"></a>docker<span class="w"> </span>attach<span class="w"> </span>alpine001
</span></code></pre></div>
<div class="admonition debug">
<p class="admonition-title">Detaching from a Container</p>
<ul>
<li>To detach from the container without stopping it, you can use the <kbd>CTRL + P</kbd> followed by <kbd>CTRL + Q</kbd> key combination.    </li>
<li>This will leave the container running in the background while you return to your terminal.  <ul>
<li><strong>This detach sequence only works if the container was started with the <code>-it</code> flags (interactive with a TTY)</strong></li>
</ul>
</li>
</ul>
</div>
<hr />
<h3 id="001-dockercli-docker-build"><code>docker build</code><a class="headerlink" href="#001-dockercli-docker-build" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker build</code> creates a Docker image from a Dockerfile.</li>
<li>
<p>This is one of the most important commands for creating custom images.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#001-dockercli-__codelineno-1-1"></a><span class="c1"># Create a simple Dockerfile</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#001-dockercli-__codelineno-1-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/tmp/docker-build-example
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#001-dockercli-__codelineno-1-3"></a><span class="nb">cd</span><span class="w"> </span>/tmp/docker-build-example
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#001-dockercli-__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#001-dockercli-__codelineno-1-5"></a>cat<span class="w"> </span><span class="s">&lt;&lt;&#39;EOF&#39; &gt; Dockerfile</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#001-dockercli-__codelineno-1-6"></a><span class="s">FROM alpine:latest</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#001-dockercli-__codelineno-1-7"></a><span class="s">RUN apk add --no-cache curl</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#001-dockercli-__codelineno-1-8"></a><span class="s">CMD [&quot;echo&quot;, &quot;Hello from custom image&quot;]</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#001-dockercli-__codelineno-1-9"></a><span class="s">EOF</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#001-dockercli-__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#001-dockercli-__codelineno-1-11"></a><span class="c1"># Build the image with a tag</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#001-dockercli-__codelineno-1-12"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-custom-alpine:v1.0<span class="w"> </span>.
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#001-dockercli-__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#001-dockercli-__codelineno-1-14"></a><span class="c1"># Build with a different tag</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#001-dockercli-__codelineno-1-15"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-custom-alpine:latest<span class="w"> </span>.
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#001-dockercli-__codelineno-1-16"></a>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#001-dockercli-__codelineno-1-17"></a><span class="c1"># Build without using cache</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#001-dockercli-__codelineno-1-18"></a>docker<span class="w"> </span>build<span class="w"> </span>--no-cache<span class="w"> </span>-t<span class="w"> </span>my-custom-alpine:v1.0<span class="w"> </span>.
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#001-dockercli-__codelineno-1-19"></a>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#001-dockercli-__codelineno-1-20"></a><span class="c1"># Test the built image</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#001-dockercli-__codelineno-1-21"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>my-custom-alpine:v1.0
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#001-dockercli-__codelineno-1-22"></a>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#001-dockercli-__codelineno-1-23"></a><span class="c1"># Clean up</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#001-dockercli-__codelineno-1-24"></a><span class="nb">cd</span><span class="w"> </span>-
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#001-dockercli-__codelineno-1-25"></a>rm<span class="w"> </span>-rf<span class="w"> </span>/tmp/docker-build-example
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="001-dockercli-docker-commit"><code>docker commit</code><a class="headerlink" href="#001-dockercli-docker-commit" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>docker commit</code> will create a new images out of an existing container.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#001-dockercli-__codelineno-2-1"></a><span class="c1"># Clean up and remove the container</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#001-dockercli-__codelineno-2-2"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#001-dockercli-__codelineno-2-3"></a>docker<span class="w"> </span>rm<span class="w">   </span>nginx
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#001-dockercli-__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#001-dockercli-__codelineno-2-5"></a><span class="c1"># Spin the container</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#001-dockercli-__codelineno-2-6"></a>docker<span class="w">  </span>run<span class="w">  </span>-it<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:80<span class="w"> </span>--name<span class="w"> </span>nginx<span class="w"> </span>nginx
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#001-dockercli-__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#001-dockercli-__codelineno-2-8"></a><span class="c1"># Wait for the container to start</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#001-dockercli-__codelineno-2-9"></a>sleep<span class="w"> </span><span class="m">5</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#001-dockercli-__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#001-dockercli-__codelineno-2-11"></a><span class="c1"># Prepare the desired welcome page</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#001-dockercli-__codelineno-2-12"></a>docker<span class="w">  </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>nginx<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;                  \</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#001-dockercli-__codelineno-2-13"></a><span class="s2">        echo &#39;This is a custom message ... &#39; &gt;  \</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#001-dockercli-__codelineno-2-14"></a><span class="s2">        /usr/share/nginx/html/index.html&quot;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#001-dockercli-__codelineno-2-15"></a>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#001-dockercli-__codelineno-2-16"></a><span class="c1"># Verify the changes</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#001-dockercli-__codelineno-2-17"></a>curl<span class="w"> </span>-s<span class="w"> </span>localhost:8888
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#001-dockercli-__codelineno-2-18"></a>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#001-dockercli-__codelineno-2-19"></a><span class="c1"># Create the custom image</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#001-dockercli-__codelineno-2-20"></a>docker<span class="w"> </span>commit<span class="w"> </span>nginx<span class="w"> </span>nirgeier/custom-nginx-image
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#001-dockercli-__codelineno-2-21"></a>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#001-dockercli-__codelineno-2-22"></a><span class="c1"># Clean up and remove the container</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#001-dockercli-__codelineno-2-23"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#001-dockercli-__codelineno-2-24"></a>docker<span class="w"> </span>rm<span class="w">   </span>nginx
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#001-dockercli-__codelineno-2-25"></a>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#001-dockercli-__codelineno-2-26"></a><span class="c1"># Push to the registry</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#001-dockercli-__codelineno-2-27"></a>docker<span class="w"> </span>push<span class="w"> </span>nirgeier/custom-nginx-image
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#001-dockercli-__codelineno-2-28"></a>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#001-dockercli-__codelineno-2-29"></a><span class="c1"># Clean up and remove the container</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#001-dockercli-__codelineno-2-30"></a>docker<span class="w"> </span>stop<span class="w"> </span>custom-nginx
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#001-dockercli-__codelineno-2-31"></a>docker<span class="w"> </span>rm<span class="w">   </span>custom-nginx
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#001-dockercli-__codelineno-2-32"></a>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#001-dockercli-__codelineno-2-33"></a><span class="c1"># Push to the registry</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#001-dockercli-__codelineno-2-34"></a>docker<span class="w">  </span>run<span class="w"> </span>-it<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>custom-nginx<span class="w">  </span><span class="se">\</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#001-dockercli-__codelineno-2-35"></a><span class="w">        </span>-p<span class="w"> </span><span class="m">8888</span>:80<span class="w">                      </span><span class="se">\</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#001-dockercli-__codelineno-2-36"></a><span class="w">        </span>nirgeier/custom-nginx-image
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#001-dockercli-__codelineno-2-37"></a>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#001-dockercli-__codelineno-2-38"></a><span class="c1"># Wait for the container to start</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#001-dockercli-__codelineno-2-39"></a>sleep<span class="w"> </span><span class="m">5</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#001-dockercli-__codelineno-2-40"></a>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#001-dockercli-__codelineno-2-41"></a><span class="c1"># Verify the changes</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#001-dockercli-__codelineno-2-42"></a>curl<span class="w"> </span>-s<span class="w"> </span>localhost:8888
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#001-dockercli-__codelineno-2-43"></a>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#001-dockercli-__codelineno-2-44"></a><span class="c1"># Clean up and remove the container</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45" href="#001-dockercli-__codelineno-2-45"></a>docker<span class="w"> </span>stop<span class="w"> </span>custom-nginx
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46" href="#001-dockercli-__codelineno-2-46"></a>docker<span class="w"> </span>rm<span class="w">   </span>custom-nginx
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="001-dockercli-docker-cp"><code>docker cp</code><a class="headerlink" href="#001-dockercli-docker-cp" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker cp</code> is used to copy files between the container and the host</li>
<li>Lets spin a container and then lets grab the logs of this container to our host</li>
</ul>
<div class="admonition debug">
<p class="admonition-title">Copying files from and to a Container</p>
<p>Since container are &ldquo;file system&rdquo; we can grab files even when the container is stopped.</p>
</div>
<ul>
<li>
<p>Example 1 - Copy file from Container to Host</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#001-dockercli-__codelineno-3-1"></a><span class="c1"># Spin a container</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#001-dockercli-__codelineno-3-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>nginx<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:80<span class="w"> </span>nginx
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#001-dockercli-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#001-dockercli-__codelineno-3-4"></a><span class="c1"># grab the nginx default configuration </span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#001-dockercli-__codelineno-3-5"></a>docker<span class="w"> </span>cp<span class="w"> </span>nginx:/etc/nginx/nginx.conf<span class="w"> </span>nginx.conf<span class="w"> </span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#001-dockercli-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#001-dockercli-__codelineno-3-7"></a><span class="c1"># Verify that the file exists locally</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#001-dockercli-__codelineno-3-8"></a>cat<span class="w"> </span>nginx.conf<span class="w"> </span>
</span></code></pre></div>
</li>
<li>
<p>Example 2 - Copy file from Host to Container</p>
<ul>
<li>In the second example we will upload file to our container</li>
<li>We will change the default nginx welcome page with our own page</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#001-dockercli-__codelineno-4-1"></a><span class="c1"># Prepare the desired welcome page</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#001-dockercli-__codelineno-4-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;Welcome to the world of Docker&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>index.html
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#001-dockercli-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#001-dockercli-__codelineno-4-4"></a><span class="c1"># Copy the file to the container </span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#001-dockercli-__codelineno-4-5"></a>docker<span class="w"> </span>cp<span class="w"> </span>index.html<span class="w"> </span>nginx:/usr/share/nginx/html
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#001-dockercli-__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#001-dockercli-__codelineno-4-7"></a><span class="c1"># Test the changes to the container</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#001-dockercli-__codelineno-4-8"></a>curl<span class="w"> </span>-s<span class="w"> </span>localhost:8888
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#001-dockercli-__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#001-dockercli-__codelineno-4-10"></a><span class="c1"># Clean up and remove the container</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#001-dockercli-__codelineno-4-11"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#001-dockercli-__codelineno-4-12"></a>docker<span class="w"> </span>rm<span class="w">   </span>nginx
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="001-dockercli-docker-create"><code>docker create</code><a class="headerlink" href="#001-dockercli-docker-create" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker create</code> creates a new container but does not start it.</li>
<li>This is useful when you want to prepare a container and start it later.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#001-dockercli-__codelineno-5-1"></a><span class="c1"># Create a container without starting it</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#001-dockercli-__codelineno-5-2"></a>docker<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>my-nginx<span class="w"> </span>nginx
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#001-dockercli-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#001-dockercli-__codelineno-5-4"></a><span class="c1"># Verify the container is created but not running</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#001-dockercli-__codelineno-5-5"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>my-nginx
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#001-dockercli-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#001-dockercli-__codelineno-5-7"></a><span class="c1"># Create a container with port mapping</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#001-dockercli-__codelineno-5-8"></a>docker<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>web-server<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>nginx
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#001-dockercli-__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#001-dockercli-__codelineno-5-10"></a><span class="c1"># Create with environment variables</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#001-dockercli-__codelineno-5-11"></a>docker<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>db-container<span class="w"> </span>-e<span class="w"> </span><span class="nv">POSTGRES_PASSWORD</span><span class="o">=</span>secret<span class="w"> </span>postgres
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#001-dockercli-__codelineno-5-12"></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#001-dockercli-__codelineno-5-13"></a><span class="c1"># Create with volume mount</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#001-dockercli-__codelineno-5-14"></a>docker<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>data-container<span class="w"> </span>-v<span class="w"> </span>/data<span class="w"> </span>alpine
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#001-dockercli-__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#001-dockercli-__codelineno-5-16"></a><span class="c1"># Start the created container</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#001-dockercli-__codelineno-5-17"></a>docker<span class="w"> </span>start<span class="w"> </span>my-nginx
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#001-dockercli-__codelineno-5-18"></a>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#001-dockercli-__codelineno-5-19"></a><span class="c1"># Clean up</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#001-dockercli-__codelineno-5-20"></a>docker<span class="w"> </span>stop<span class="w"> </span>my-nginx
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#001-dockercli-__codelineno-5-21"></a>docker<span class="w"> </span>rm<span class="w"> </span>my-nginx<span class="w"> </span>web-server<span class="w"> </span>db-container<span class="w"> </span>data-container
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-exec"><code>docker exec</code><a class="headerlink" href="#001-dockercli-docker-exec" title="Permanent link">&para;</a></h3>
<ul>
<li>Execute a command in a <strong>running</strong> container
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#001-dockercli-__codelineno-6-1"></a><span class="c1"># Remove old containers with the same name</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#001-dockercli-__codelineno-6-2"></a>docker<span class="w"> </span>stop<span class="w"> </span>alpine001
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#001-dockercli-__codelineno-6-3"></a>docker<span class="w"> </span>rm<span class="w">   </span>alpine001
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#001-dockercli-__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#001-dockercli-__codelineno-6-5"></a><span class="c1"># Spin an alpine image</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#001-dockercli-__codelineno-6-6"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>alpine001<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">10000</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#001-dockercli-__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#001-dockercli-__codelineno-6-8"></a><span class="c1"># Test that curl is not installed on the container</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#001-dockercli-__codelineno-6-9"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>alpine001<span class="w"> </span>curl
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#001-dockercli-__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#001-dockercli-__codelineno-6-11"></a><span class="c1"># Install a new package on the container</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#001-dockercli-__codelineno-6-12"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>alpine001<span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>curl
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#001-dockercli-__codelineno-6-13"></a>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#001-dockercli-__codelineno-6-14"></a><span class="c1"># Test that curl is installed</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#001-dockercli-__codelineno-6-15"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>alpine001<span class="w"> </span>curl<span class="w"> </span>codewizard.co.il
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#001-dockercli-__codelineno-6-16"></a>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#001-dockercli-__codelineno-6-17"></a><span class="c1"># Interact with the alpine image and open bash shell</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#001-dockercli-__codelineno-6-18"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>alpine001<span class="w"> </span>sh
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-images"><code>docker images</code><a class="headerlink" href="#001-dockercli-docker-images" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker images</code> lists all Docker images on your system.</li>
<li>
<p>This command helps you see what images you have available locally.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#001-dockercli-__codelineno-7-1"></a><span class="c1"># List all images</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#001-dockercli-__codelineno-7-2"></a>docker<span class="w"> </span>images
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#001-dockercli-__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#001-dockercli-__codelineno-7-4"></a><span class="c1"># List images with specific format</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#001-dockercli-__codelineno-7-5"></a>docker<span class="w"> </span>images<span class="w"> </span>--format<span class="w"> </span><span class="s2">&quot;table {{.Repository}}\t{{.Tag}}\t{{.Size}}&quot;</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#001-dockercli-__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#001-dockercli-__codelineno-7-7"></a><span class="c1"># List all image IDs</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#001-dockercli-__codelineno-7-8"></a>docker<span class="w"> </span>images<span class="w"> </span>-q
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#001-dockercli-__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#001-dockercli-__codelineno-7-10"></a><span class="c1"># List dangling images (images with no tag)</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#001-dockercli-__codelineno-7-11"></a>docker<span class="w"> </span>images<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;dangling=true&quot;</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#001-dockercli-__codelineno-7-12"></a>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#001-dockercli-__codelineno-7-13"></a><span class="c1"># Filter images by name</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#001-dockercli-__codelineno-7-14"></a>docker<span class="w"> </span>images<span class="w"> </span>alpine
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#001-dockercli-__codelineno-7-15"></a>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#001-dockercli-__codelineno-7-16"></a><span class="c1"># Show all images including intermediate layers</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#001-dockercli-__codelineno-7-17"></a>docker<span class="w"> </span>images<span class="w"> </span>-a
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="001-dockercli-docker-inspect"><code>docker inspect</code><a class="headerlink" href="#001-dockercli-docker-inspect" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker inspect</code> provides detailed information about Docker objects (containers, images, volumes, networks).</li>
<li>Returns a JSON array with all the metadata.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#001-dockercli-__codelineno-8-1"></a><span class="c1"># Create a container for inspection</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#001-dockercli-__codelineno-8-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>nginx-inspect<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>nginx
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#001-dockercli-__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#001-dockercli-__codelineno-8-4"></a><span class="c1"># Inspect a container</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#001-dockercli-__codelineno-8-5"></a>docker<span class="w"> </span>inspect<span class="w"> </span>nginx-inspect
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#001-dockercli-__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#001-dockercli-__codelineno-8-7"></a><span class="c1"># Get specific information using format flag</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#001-dockercli-__codelineno-8-8"></a>docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{.State.Running}}&#39;</span><span class="w"> </span>nginx-inspect
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#001-dockercli-__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#001-dockercli-__codelineno-8-10"></a><span class="c1"># Get IP address of container</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#001-dockercli-__codelineno-8-11"></a>docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}&#39;</span><span class="w"> </span>nginx-inspect
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#001-dockercli-__codelineno-8-12"></a>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#001-dockercli-__codelineno-8-13"></a><span class="c1"># Inspect an image</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#001-dockercli-__codelineno-8-14"></a>docker<span class="w"> </span>inspect<span class="w"> </span>nginx:latest
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#001-dockercli-__codelineno-8-15"></a>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#001-dockercli-__codelineno-8-16"></a><span class="c1"># Get image creation date</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#001-dockercli-__codelineno-8-17"></a>docker<span class="w"> </span>inspect<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{.Created}}&#39;</span><span class="w"> </span>nginx:latest
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#001-dockercli-__codelineno-8-18"></a>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#001-dockercli-__codelineno-8-19"></a><span class="c1"># Clean up</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#001-dockercli-__codelineno-8-20"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx-inspect
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#001-dockercli-__codelineno-8-21"></a>docker<span class="w"> </span>rm<span class="w"> </span>nginx-inspect
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-kill"><code>docker kill</code><a class="headerlink" href="#001-dockercli-docker-kill" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker kill</code> immediately terminates a running container.</li>
<li>Unlike <code>docker stop</code>, it sends SIGKILL by default (no graceful shutdown).
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#001-dockercli-__codelineno-9-1"></a><span class="c1"># Create a running container</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#001-dockercli-__codelineno-9-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>kill-test<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">10000</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#001-dockercli-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#001-dockercli-__codelineno-9-4"></a><span class="c1"># Kill the container immediately</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#001-dockercli-__codelineno-9-5"></a>docker<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>kill-test
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#001-dockercli-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#001-dockercli-__codelineno-9-7"></a><span class="c1"># Verify the container is stopped</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#001-dockercli-__codelineno-9-8"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>kill-test
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#001-dockercli-__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#001-dockercli-__codelineno-9-10"></a><span class="c1"># Kill with specific signal</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#001-dockercli-__codelineno-9-11"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>kill-test2<span class="w"> </span>nginx
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#001-dockercli-__codelineno-9-12"></a>docker<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>--signal<span class="o">=</span>SIGTERM<span class="w"> </span>kill-test2
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#001-dockercli-__codelineno-9-13"></a>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#001-dockercli-__codelineno-9-14"></a><span class="c1"># Kill multiple containers</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#001-dockercli-__codelineno-9-15"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>c1<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#001-dockercli-__codelineno-9-16"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>c2<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#001-dockercli-__codelineno-9-17"></a>docker<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>c1<span class="w"> </span>c2
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#001-dockercli-__codelineno-9-18"></a>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#001-dockercli-__codelineno-9-19"></a><span class="c1"># Clean up</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#001-dockercli-__codelineno-9-20"></a>docker<span class="w"> </span>rm<span class="w"> </span>kill-test<span class="w"> </span>kill-test2<span class="w"> </span>c1<span class="w"> </span>c2
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-logs"><code>docker logs</code><a class="headerlink" href="#001-dockercli-docker-logs" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker logs</code> fetches the logs of a container.</li>
<li>Useful for debugging and monitoring container output.</li>
<li>By default, it shows all logs since the container started.</li>
<li>You can use various options to filter and format the logs.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#001-dockercli-__codelineno-10-1"></a><span class="c1"># Create a container that generates logs</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#001-dockercli-__codelineno-10-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>log-example<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;while true; do echo &#39;Hello from container&#39;; sleep 2; done&quot;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#001-dockercli-__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#001-dockercli-__codelineno-10-4"></a><span class="c1"># View container logs</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#001-dockercli-__codelineno-10-5"></a>docker<span class="w"> </span>logs<span class="w"> </span>log-example
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#001-dockercli-__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#001-dockercli-__codelineno-10-7"></a><span class="c1"># Follow log output (like tail -f)</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#001-dockercli-__codelineno-10-8"></a>docker<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>log-example
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#001-dockercli-__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#001-dockercli-__codelineno-10-10"></a><span class="c1"># Show only last 10 lines</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#001-dockercli-__codelineno-10-11"></a>docker<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">10</span><span class="w"> </span>log-example
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#001-dockercli-__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#001-dockercli-__codelineno-10-13"></a><span class="c1"># Show logs with timestamps</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#001-dockercli-__codelineno-10-14"></a>docker<span class="w"> </span>logs<span class="w"> </span>-t<span class="w"> </span>log-example
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#001-dockercli-__codelineno-10-15"></a>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#001-dockercli-__codelineno-10-16"></a><span class="c1"># Show logs since specific time</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#001-dockercli-__codelineno-10-17"></a>docker<span class="w"> </span>logs<span class="w"> </span>--since<span class="w"> </span>5m<span class="w"> </span>log-example
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#001-dockercli-__codelineno-10-18"></a>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#001-dockercli-__codelineno-10-19"></a><span class="c1"># Combine options</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#001-dockercli-__codelineno-10-20"></a>docker<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>--tail<span class="w"> </span><span class="m">5</span><span class="w"> </span>-t<span class="w"> </span>log-example
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#001-dockercli-__codelineno-10-21"></a>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#001-dockercli-__codelineno-10-22"></a><span class="c1"># Clean up (press Ctrl+C to stop following logs)</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#001-dockercli-__codelineno-10-23"></a>docker<span class="w"> </span>stop<span class="w"> </span>log-example
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#001-dockercli-__codelineno-10-24"></a>docker<span class="w"> </span>rm<span class="w"> </span>log-example
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-pause"><code>docker pause</code><a class="headerlink" href="#001-dockercli-docker-pause" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker pause</code> suspends all processes in a container.</li>
<li>
<p>The container continues to exist but is frozen.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#001-dockercli-__codelineno-11-1"></a><span class="c1"># Create a running container</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#001-dockercli-__codelineno-11-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>pause-test<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;while true; do echo &#39;Running&#39;; sleep 1; done&quot;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#001-dockercli-__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#001-dockercli-__codelineno-11-4"></a><span class="c1"># Pause the container</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#001-dockercli-__codelineno-11-5"></a>docker<span class="w"> </span>pause<span class="w"> </span>pause-test
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#001-dockercli-__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#001-dockercli-__codelineno-11-7"></a><span class="c1"># Verify the container is paused</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#001-dockercli-__codelineno-11-8"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>pause-test
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#001-dockercli-__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#001-dockercli-__codelineno-11-10"></a><span class="c1"># Try to see logs (no new logs while paused)</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#001-dockercli-__codelineno-11-11"></a>docker<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">5</span><span class="w"> </span>pause-test
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#001-dockercli-__codelineno-11-12"></a>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#001-dockercli-__codelineno-11-13"></a><span class="c1"># Note: Container remains paused until unpaused</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#001-dockercli-__codelineno-11-14"></a><span class="c1"># See docker unpause to resume</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="001-dockercli-docker-ps"><code>docker ps</code><a class="headerlink" href="#001-dockercli-docker-ps" title="Permanent link">&para;</a></h3>
<ul>
<li>The &ldquo;problem&rdquo; with the previous command is that the container is not removed once it exits.</li>
<li>Lets look at the list of containers that we have right now on the host machine
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#001-dockercli-__codelineno-12-1"></a><span class="c1"># List exiting containers on our host machine</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#001-dockercli-__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#001-dockercli-__codelineno-12-3"></a><span class="c1"># Display running containers</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#001-dockercli-__codelineno-12-4"></a>docker<span class="w"> </span>ps
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#001-dockercli-__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#001-dockercli-__codelineno-12-6"></a><span class="c1"># Display all containers</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#001-dockercli-__codelineno-12-7"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#001-dockercli-__codelineno-12-8"></a>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#001-dockercli-__codelineno-12-9"></a><span class="c1"># Display all containers ids</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#001-dockercli-__codelineno-12-10"></a>docker<span class="w"> </span>ps<span class="w"> </span>-aq
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-pull"><code>docker pull</code><a class="headerlink" href="#001-dockercli-docker-pull" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker pull</code> downloads an image from a Docker registry (like Docker Hub).</li>
<li>This command is useful when you want to download an image without running it immediately.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#001-dockercli-__codelineno-13-1"></a><span class="c1"># Pull the latest version of an image</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#001-dockercli-__codelineno-13-2"></a>docker<span class="w"> </span>pull<span class="w"> </span>alpine:latest
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#001-dockercli-__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#001-dockercli-__codelineno-13-4"></a><span class="c1"># Pull a specific version</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#001-dockercli-__codelineno-13-5"></a>docker<span class="w"> </span>pull<span class="w"> </span>nginx:1.21
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#001-dockercli-__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#001-dockercli-__codelineno-13-7"></a><span class="c1"># Pull from a specific registry</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#001-dockercli-__codelineno-13-8"></a>docker<span class="w"> </span>pull<span class="w"> </span>gcr.io/google-containers/busybox
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#001-dockercli-__codelineno-13-9"></a>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#001-dockercli-__codelineno-13-10"></a><span class="c1"># Pull all tags of a repository</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#001-dockercli-__codelineno-13-11"></a>docker<span class="w"> </span>pull<span class="w"> </span>--all-tags<span class="w"> </span>alpine
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#001-dockercli-__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#001-dockercli-__codelineno-13-13"></a><span class="c1"># Verify the pulled image</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#001-dockercli-__codelineno-13-14"></a>docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>alpine
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-push"><code>docker push</code><a class="headerlink" href="#001-dockercli-docker-push" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker push</code> uploads an image to a Docker registry.</li>
<li>You need to be logged in to the registry and have proper permissions.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#001-dockercli-__codelineno-14-1"></a><span class="c1"># Tag an image for pushing (replace &#39;yourusername&#39; with your Docker Hub username)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#001-dockercli-__codelineno-14-2"></a>docker<span class="w"> </span>tag<span class="w"> </span>alpine:latest<span class="w"> </span>yourusername/my-alpine:v1.0
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#001-dockercli-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#001-dockercli-__codelineno-14-4"></a><span class="c1"># Login to Docker Hub (you&#39;ll be prompted for credentials)</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#001-dockercli-__codelineno-14-5"></a><span class="c1"># docker login</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#001-dockercli-__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#001-dockercli-__codelineno-14-7"></a><span class="c1"># Push the image to Docker Hub</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#001-dockercli-__codelineno-14-8"></a><span class="c1"># docker push yourusername/my-alpine:v1.0</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#001-dockercli-__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#001-dockercli-__codelineno-14-10"></a><span class="c1"># Push all tags</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#001-dockercli-__codelineno-14-11"></a><span class="c1"># docker push --all-tags yourusername/my-alpine</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#001-dockercli-__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#001-dockercli-__codelineno-14-13"></a><span class="c1"># Note: The push commands are commented out to prevent accidental pushes</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#001-dockercli-__codelineno-14-14"></a><span class="c1"># Uncomment and replace &#39;yourusername&#39; with your actual username when ready to use</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-rename"><code>docker rename</code><a class="headerlink" href="#001-dockercli-docker-rename" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker rename</code> changes the name of an existing container.</li>
<li>
<p>Useful for organizing or clarifying container purposes.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#001-dockercli-__codelineno-15-1"></a><span class="c1"># Create a container with a generic name</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#001-dockercli-__codelineno-15-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>old-name<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">10000</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#001-dockercli-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#001-dockercli-__codelineno-15-4"></a><span class="c1"># Rename the container</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#001-dockercli-__codelineno-15-5"></a>docker<span class="w"> </span>rename<span class="w"> </span>old-name<span class="w"> </span>new-name
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#001-dockercli-__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#001-dockercli-__codelineno-15-7"></a><span class="c1"># Verify the new name</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#001-dockercli-__codelineno-15-8"></a>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>new-name
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#001-dockercli-__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#001-dockercli-__codelineno-15-10"></a><span class="c1"># Clean up</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#001-dockercli-__codelineno-15-11"></a>docker<span class="w"> </span>stop<span class="w"> </span>new-name
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#001-dockercli-__codelineno-15-12"></a>docker<span class="w"> </span>rm<span class="w"> </span>new-name
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="001-dockercli-docker-restart"><code>docker restart</code><a class="headerlink" href="#001-dockercli-docker-restart" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker restart</code> stops and then starts a container.</li>
<li>
<p>Combines <code>docker stop</code> and <code>docker start</code> in one command.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#001-dockercli-__codelineno-16-1"></a><span class="c1"># Create a running container</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#001-dockercli-__codelineno-16-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>restart-test<span class="w"> </span>nginx
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#001-dockercli-__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#001-dockercli-__codelineno-16-4"></a><span class="c1"># Restart the container (default 10 second grace period)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#001-dockercli-__codelineno-16-5"></a>docker<span class="w"> </span>restart<span class="w"> </span>restart-test
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#001-dockercli-__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#001-dockercli-__codelineno-16-7"></a><span class="c1"># Restart with custom timeout</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#001-dockercli-__codelineno-16-8"></a>docker<span class="w"> </span>restart<span class="w"> </span>-t<span class="w"> </span><span class="m">30</span><span class="w"> </span>restart-test
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#001-dockercli-__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#001-dockercli-__codelineno-16-10"></a><span class="c1"># Restart multiple containers</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#001-dockercli-__codelineno-16-11"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>r1<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#001-dockercli-__codelineno-16-12"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>r2<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#001-dockercli-__codelineno-16-13"></a>docker<span class="w"> </span>restart<span class="w"> </span>r1<span class="w"> </span>r2
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#001-dockercli-__codelineno-16-14"></a>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#001-dockercli-__codelineno-16-15"></a><span class="c1"># Clean up</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#001-dockercli-__codelineno-16-16"></a>docker<span class="w"> </span>stop<span class="w"> </span>restart-test<span class="w"> </span>r1<span class="w"> </span>r2
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#001-dockercli-__codelineno-16-17"></a>docker<span class="w"> </span>rm<span class="w"> </span>restart-test<span class="w"> </span>r1<span class="w"> </span>r2
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="001-dockercli-docker-rm"><code>docker rm</code><a class="headerlink" href="#001-dockercli-docker-rm" title="Permanent link">&para;</a></h3>
<ul>
<li>Lets clean and remove the containers which are not running anymore</li>
<li><code>docker rm</code> removes one or more stopped containers from your system.</li>
<li>This helps free up system resources by deleting containers that are no longer needed.</li>
</ul>
<div class="admonition debug">
<p class="admonition-title">Removing Containers</p>
<ul>
<li>You <code>cannot</code> remove a running container without stopping it first.</li>
<li>Use <code>docker ps -a</code> to list all containers (including stopped ones) before removing them.</li>
<li><strong>Warning:</strong> This action is irreversible.</li>
</ul>
</div>
<ul>
<li>Example:
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#001-dockercli-__codelineno-17-1"></a><span class="c1"># Remove all stopped containers</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#001-dockercli-__codelineno-17-2"></a><span class="c1"># We use docker rm with the previous command we learned docker ps</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#001-dockercli-__codelineno-17-3"></a>docker<span class="w"> </span>rm<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-aq<span class="k">)</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#001-dockercli-__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#001-dockercli-__codelineno-17-5"></a><span class="c1"># Verify that only running containers are still running</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#001-dockercli-__codelineno-17-6"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#001-dockercli-__codelineno-17-7"></a>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#001-dockercli-__codelineno-17-8"></a><span class="c1"># Remove a specific container (must be stopped first)</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#001-dockercli-__codelineno-17-9"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#001-dockercli-__codelineno-17-10"></a>docker<span class="w"> </span>rm<span class="w"> </span>nginx
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#001-dockercli-__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#001-dockercli-__codelineno-17-12"></a><span class="c1"># Force remove a running container</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#001-dockercli-__codelineno-17-13"></a>docker<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>nginx
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#001-dockercli-__codelineno-17-14"></a>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#001-dockercli-__codelineno-17-15"></a><span class="c1"># Remove multiple containers</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#001-dockercli-__codelineno-17-16"></a>docker<span class="w"> </span>rm<span class="w"> </span>container1<span class="w"> </span>container2<span class="w"> </span>container3
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-rmi"><code>docker rmi</code><a class="headerlink" href="#001-dockercli-docker-rmi" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker rmi</code> removes one or more Docker images from your system.</li>
<li>This helps free up disk space by removing unused images.</li>
<li>You cannot remove an image that is being used by a running container.</li>
<li>If you need to remove such an image, you must stop and remove the container using it first.</li>
<li><strong>Tip:</strong> Use <code>docker ps -a</code> to list all containers (including stopped ones) before removing them.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#001-dockercli-__codelineno-18-1"></a><span class="c1"># Remove a specific image</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#001-dockercli-__codelineno-18-2"></a>docker<span class="w"> </span>rmi<span class="w"> </span>alpine:latest
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#001-dockercli-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#001-dockercli-__codelineno-18-4"></a><span class="c1"># Remove multiple images</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#001-dockercli-__codelineno-18-5"></a>docker<span class="w"> </span>rmi<span class="w"> </span>image1:tag1<span class="w"> </span>image2:tag2
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#001-dockercli-__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#001-dockercli-__codelineno-18-7"></a><span class="c1"># Remove image by ID</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#001-dockercli-__codelineno-18-8"></a>docker<span class="w"> </span>rmi<span class="w"> </span>abc123def456
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#001-dockercli-__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#001-dockercli-__codelineno-18-10"></a><span class="c1"># Force remove an image (even if containers are using it)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#001-dockercli-__codelineno-18-11"></a>docker<span class="w"> </span>rmi<span class="w"> </span>-f<span class="w"> </span>nginx:latest
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#001-dockercli-__codelineno-18-12"></a>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#001-dockercli-__codelineno-18-13"></a><span class="c1"># Remove all dangling images (untagged images)</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#001-dockercli-__codelineno-18-14"></a>docker<span class="w"> </span>rmi<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>images<span class="w"> </span>-f<span class="w"> </span><span class="s2">&quot;dangling=true&quot;</span><span class="w"> </span>-q<span class="k">)</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#001-dockercli-__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#001-dockercli-__codelineno-18-16"></a><span class="c1"># Remove all images</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#001-dockercli-__codelineno-18-17"></a><span class="c1"># WARNING: This removes ALL images on your system</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#001-dockercli-__codelineno-18-18"></a><span class="c1"># docker rmi $(docker images -q)</span>
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-run"><code>docker run</code><a class="headerlink" href="#001-dockercli-docker-run" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>run</code> command container many options (flags), we will not cover all of them</li>
<li><a href="https://docs.docker.com/reference/cli/docker/container/run/">docs.docker.com - run</a></li>
<li>Run your first container: 
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#001-dockercli-__codelineno-19-1"></a><span class="c1"># Run the first container</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#001-dockercli-__codelineno-19-2"></a>docker<span class="w"> </span>run<span class="w"> </span>hello-world
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#001-dockercli-__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#001-dockercli-__codelineno-19-4"></a><span class="c1">### Output:</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#001-dockercli-__codelineno-19-5"></a>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#001-dockercli-__codelineno-19-6"></a>Hello<span class="w"> </span>from<span class="w"> </span>Docker!
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#001-dockercli-__codelineno-19-7"></a>This<span class="w"> </span>message<span class="w"> </span>shows<span class="w"> </span>that<span class="w"> </span>your<span class="w"> </span>installation<span class="w"> </span>appears<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>working<span class="w"> </span>correctly.
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#001-dockercli-__codelineno-19-8"></a>...
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-run-a"><code>docker run -a</code><a class="headerlink" href="#001-dockercli-docker-run-a" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>--attach</code> [<code>-a</code>] flag tells docker run to <strong>bind</strong> to the container&rsquo;s <code>STDIN</code>, <code>STDOUT</code> or <code>STDERR</code>. 
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#001-dockercli-__codelineno-20-1"></a><span class="c1"># Pass input from stdin to container</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#001-dockercli-__codelineno-20-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-a<span class="w"> </span>stdout<span class="w"> </span>alpine<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Docker rocks !!&quot;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#001-dockercli-__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#001-dockercli-__codelineno-20-4"></a><span class="c1"># Redirect stdout logs to a file</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#001-dockercli-__codelineno-20-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-a<span class="w"> </span>stdout<span class="w"> </span>-a<span class="w"> </span>stderr<span class="w"> </span>alpine<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;Docker rocks again !!&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>log.txt<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#001-dockercli-__codelineno-20-6"></a>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#001-dockercli-__codelineno-20-7"></a><span class="c1"># Print the log content</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#001-dockercli-__codelineno-20-8"></a>cat<span class="w"> </span>log.txt
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-run-d"><code>docker run -d</code><a class="headerlink" href="#001-dockercli-docker-run-d" title="Permanent link">&para;</a></h3>
<ul>
<li>Spin up the container which will run in the background</li>
<li>By default when you spin a docker container it will attach itself to the current terminal.</li>
<li>In order to avoid it we will use the -d flag to specify that the container should be running in the background.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#001-dockercli-__codelineno-21-1"></a><span class="c1"># Spin an nginx in the background.</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#001-dockercli-__codelineno-21-2"></a><span class="c1"># Add a sleep timeout so that the container will not exit immediately</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#001-dockercli-__codelineno-21-3"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">10000</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#001-dockercli-__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#001-dockercli-__codelineno-21-5"></a><span class="c1"># Verify that the container is still running</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#001-dockercli-__codelineno-21-6"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-run-it"><code>docker run -it</code><a class="headerlink" href="#001-dockercli-docker-run-it" title="Permanent link">&para;</a></h3>
<div class="admonition debug">
<p class="admonition-title">Interactive Terminal</p>
<ul>
<li>The flags <code>-it</code> stands for: <br />
<code>-i</code> [<code>--interactive</code>]
  keeps the container&rsquo;s STDIN open, and lets you send input to the container through standard input.
  <code>-t</code> [<code>--tty</code>]<br />
  Attaches a pseudo-TTY to the container, connecting your terminal to the I/O streams of the container.</li>
</ul>
</div>
<ul>
<li>Example - Run an interactive shell inside an alpine container
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#001-dockercli-__codelineno-22-1"></a><span class="c1"># Execute a command on the container and interact with the container</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#001-dockercli-__codelineno-22-2"></a><span class="c1"># This command will change the password for root user</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#001-dockercli-__codelineno-22-3"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>alpine<span class="w"> </span>passwd<span class="w"> </span>root
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-run-name"><code>docker run -name</code><a class="headerlink" href="#001-dockercli-docker-run-name" title="Permanent link">&para;</a></h3>
<ul>
<li>By default the container will be assigned a semi-random name based upon the following code:
<a href="https://github.com/docker/docker-ce/blob/master/components/engine/pkg/namesgenerator/names-generator.go">docker-ce/names-generator.go</a></li>
<li>We can assign our desired name to the container with the <code>--name</code> option
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#001-dockercli-__codelineno-23-1"></a><span class="c1"># Spin an nginx in the background.</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#001-dockercli-__codelineno-23-2"></a><span class="c1"># Add a sleep timeout so that the container will not exit immediately</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#001-dockercli-__codelineno-23-3"></a>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>alpine001<span class="w"> </span>alpine
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#001-dockercli-__codelineno-23-4"></a>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#001-dockercli-__codelineno-23-5"></a><span class="c1"># Verify that the container has been created with the given name</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#001-dockercli-__codelineno-23-6"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w">  </span>grep<span class="w"> </span>alpine001
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-run-p"><code>docker run -p</code><a class="headerlink" href="#001-dockercli-docker-run-p" title="Permanent link">&para;</a></h3>
<div class="admonition debug">
<p class="admonition-title">Port Mapping</p>
<ul>
<li>We can specify the exact ports we wish to open <code>-p</code> or open them all <code>-P</code> </li>
</ul>
</div>
<ul>
<li>Run a container and connect to a port on the host which will be used to connect to the container
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#001-dockercli-__codelineno-24-1"></a><span class="c1"># Execute an nginx container and test the container</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#001-dockercli-__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#001-dockercli-__codelineno-24-3"></a><span class="c1"># Remove any containers with the same name</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#001-dockercli-__codelineno-24-4"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#001-dockercli-__codelineno-24-5"></a>docker<span class="w"> </span>rm<span class="w">   </span>nginx
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#001-dockercli-__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#001-dockercli-__codelineno-24-7"></a><span class="c1"># We will combine few flags here</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#001-dockercli-__codelineno-24-8"></a>docker<span class="w">  </span>run<span class="w">   </span>-it<span class="w">  </span>--rm<span class="w">     </span><span class="se">\</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#001-dockercli-__codelineno-24-9"></a><span class="w">              </span>-d<span class="w">            </span><span class="se">\</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#001-dockercli-__codelineno-24-10"></a><span class="w">              </span>-p<span class="w"> </span><span class="m">8888</span>:80<span class="w">    </span><span class="se">\</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#001-dockercli-__codelineno-24-11"></a><span class="w">              </span>--name<span class="w"> </span>nginx<span class="w">  </span><span class="se">\</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#001-dockercli-__codelineno-24-12"></a><span class="w">              </span>nginx
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#001-dockercli-__codelineno-24-13"></a>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#001-dockercli-__codelineno-24-14"></a><span class="c1"># Wait for the container to be created</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#001-dockercli-__codelineno-24-15"></a>sleep<span class="w"> </span><span class="m">3</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#001-dockercli-__codelineno-24-16"></a>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#001-dockercli-__codelineno-24-17"></a><span class="c1"># test the container</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#001-dockercli-__codelineno-24-18"></a>curl<span class="w"> </span>-s<span class="w"> </span>localhost:8888
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#001-dockercli-__codelineno-24-19"></a>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#001-dockercli-__codelineno-24-20"></a><span class="c1"># Remove the container</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#001-dockercli-__codelineno-24-21"></a>docker<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>nginx
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-start"><code>docker start</code><a class="headerlink" href="#001-dockercli-docker-start" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker start</code> starts one or more stopped containers.</li>
<li>Unlike <code>docker run</code>, this command starts an existing container.</li>
<li>It does not create a new container.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#001-dockercli-__codelineno-25-1"></a><span class="c1"># Create a container but don&#39;t start it immediately</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#001-dockercli-__codelineno-25-2"></a>docker<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>my-alpine<span class="w"> </span>alpine<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello World&quot;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#001-dockercli-__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#001-dockercli-__codelineno-25-4"></a><span class="c1"># Start the container</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#001-dockercli-__codelineno-25-5"></a>docker<span class="w"> </span>start<span class="w"> </span>my-alpine
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#001-dockercli-__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#001-dockercli-__codelineno-25-7"></a><span class="c1"># Start and attach to container output</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#001-dockercli-__codelineno-25-8"></a>docker<span class="w"> </span>start<span class="w"> </span>-a<span class="w"> </span>my-alpine
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#001-dockercli-__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#001-dockercli-__codelineno-25-10"></a><span class="c1"># Start multiple containers</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#001-dockercli-__codelineno-25-11"></a>docker<span class="w"> </span>start<span class="w"> </span>container1<span class="w"> </span>container2<span class="w"> </span>container3
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#001-dockercli-__codelineno-25-12"></a>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#001-dockercli-__codelineno-25-13"></a><span class="c1"># Start a stopped container interactively</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#001-dockercli-__codelineno-25-14"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--name<span class="w"> </span>interactive-alpine<span class="w"> </span>alpine<span class="w"> </span>sh
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#001-dockercli-__codelineno-25-15"></a><span class="c1"># (exit the shell to stop the container)</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#001-dockercli-__codelineno-25-16"></a>docker<span class="w"> </span>start<span class="w"> </span>-ai<span class="w"> </span>interactive-alpine
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#001-dockercli-__codelineno-25-17"></a>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#001-dockercli-__codelineno-25-18"></a><span class="c1"># Clean up</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#001-dockercli-__codelineno-25-19"></a>docker<span class="w"> </span>rm<span class="w"> </span>my-alpine<span class="w"> </span>interactive-alpine
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-stats"><code>docker stats</code><a class="headerlink" href="#001-dockercli-docker-stats" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker stats</code> displays a live stream of resource usage statistics for containers.</li>
<li>Shows CPU, memory, network I/O, and disk I/O usage.</li>
<li>Useful for monitoring container performance in real-time.</li>
<li>Can be used to identify resource bottlenecks and optimize container performance.</li>
<li>Supports filtering and formatting options for customized output.
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#001-dockercli-__codelineno-26-1"></a><span class="c1"># Create some containers</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#001-dockercli-__codelineno-26-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>stats-test1<span class="w"> </span>nginx
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#001-dockercli-__codelineno-26-3"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>stats-test2<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">10000</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#001-dockercli-__codelineno-26-4"></a>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#001-dockercli-__codelineno-26-5"></a><span class="c1"># Display stats for all running containers (live stream)</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#001-dockercli-__codelineno-26-6"></a><span class="c1"># Press Ctrl+C to exit</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#001-dockercli-__codelineno-26-7"></a>docker<span class="w"> </span>stats
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#001-dockercli-__codelineno-26-8"></a>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#001-dockercli-__codelineno-26-9"></a><span class="c1"># Display stats for specific containers</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#001-dockercli-__codelineno-26-10"></a>docker<span class="w"> </span>stats<span class="w"> </span>stats-test1<span class="w"> </span>stats-test2
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#001-dockercli-__codelineno-26-11"></a>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#001-dockercli-__codelineno-26-12"></a><span class="c1"># Display stats without streaming (single snapshot)</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#001-dockercli-__codelineno-26-13"></a>docker<span class="w"> </span>stats<span class="w"> </span>--no-stream
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#001-dockercli-__codelineno-26-14"></a>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#001-dockercli-__codelineno-26-15"></a><span class="c1"># Custom format</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#001-dockercli-__codelineno-26-16"></a>docker<span class="w"> </span>stats<span class="w"> </span>--format<span class="w"> </span><span class="s2">&quot;table {{.Container}}\t{{.CPUPerc}}\t{{.MemUsage}}&quot;</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#001-dockercli-__codelineno-26-17"></a>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#001-dockercli-__codelineno-26-18"></a><span class="c1"># Clean up</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#001-dockercli-__codelineno-26-19"></a>docker<span class="w"> </span>stop<span class="w"> </span>stats-test1<span class="w"> </span>stats-test2
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#001-dockercli-__codelineno-26-20"></a>docker<span class="w"> </span>rm<span class="w"> </span>stats-test1<span class="w"> </span>stats-test2
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-stop"><code>docker stop</code><a class="headerlink" href="#001-dockercli-docker-stop" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker stop</code> stops one or more running containers gracefully.</li>
<li>
<p>Sends SIGTERM signal first, then SIGKILL after grace period.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#001-dockercli-__codelineno-27-1"></a><span class="c1"># Create a running container</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#001-dockercli-__codelineno-27-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>test-nginx<span class="w"> </span>nginx
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#001-dockercli-__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#001-dockercli-__codelineno-27-4"></a><span class="c1"># Stop the container (default 10 second grace period)</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#001-dockercli-__codelineno-27-5"></a>docker<span class="w"> </span>stop<span class="w"> </span>test-nginx
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#001-dockercli-__codelineno-27-6"></a>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#001-dockercli-__codelineno-27-7"></a><span class="c1"># Stop with custom timeout</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#001-dockercli-__codelineno-27-8"></a>docker<span class="w"> </span>stop<span class="w"> </span>-t<span class="w"> </span><span class="m">30</span><span class="w"> </span>test-nginx
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#001-dockercli-__codelineno-27-9"></a>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#001-dockercli-__codelineno-27-10"></a><span class="c1"># Stop multiple containers</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#001-dockercli-__codelineno-27-11"></a>docker<span class="w"> </span>stop<span class="w"> </span>container1<span class="w"> </span>container2<span class="w"> </span>container3
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#001-dockercli-__codelineno-27-12"></a>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#001-dockercli-__codelineno-27-13"></a><span class="c1"># Stop all running containers</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#001-dockercli-__codelineno-27-14"></a>docker<span class="w"> </span>stop<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="k">)</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#001-dockercli-__codelineno-27-15"></a>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#001-dockercli-__codelineno-27-16"></a><span class="c1"># Verify container is stopped</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#001-dockercli-__codelineno-27-17"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>test-nginx
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#001-dockercli-__codelineno-27-18"></a>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#001-dockercli-__codelineno-27-19"></a><span class="c1"># Clean up</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#001-dockercli-__codelineno-27-20"></a>docker<span class="w"> </span>rm<span class="w"> </span>test-nginx
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="001-dockercli-docker-top"><code>docker top</code><a class="headerlink" href="#001-dockercli-docker-top" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker top</code> displays the running processes inside a container.</li>
<li>Similar to the Linux <code>top</code> command but for containers.
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#001-dockercli-__codelineno-28-1"></a><span class="c1"># Create a running container</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#001-dockercli-__codelineno-28-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>top-test<span class="w"> </span>nginx
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#001-dockercli-__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#001-dockercli-__codelineno-28-4"></a><span class="c1"># Display running processes in the container</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#001-dockercli-__codelineno-28-5"></a>docker<span class="w"> </span>top<span class="w"> </span>top-test
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#001-dockercli-__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#001-dockercli-__codelineno-28-7"></a><span class="c1"># Display with custom ps options</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#001-dockercli-__codelineno-28-8"></a>docker<span class="w"> </span>top<span class="w"> </span>top-test<span class="w"> </span>aux
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#001-dockercli-__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#001-dockercli-__codelineno-28-10"></a><span class="c1"># Display specific columns</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#001-dockercli-__codelineno-28-11"></a>docker<span class="w"> </span>top<span class="w"> </span>top-test<span class="w"> </span>-eo<span class="w"> </span>pid,comm
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#001-dockercli-__codelineno-28-12"></a>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#001-dockercli-__codelineno-28-13"></a><span class="c1"># Create a busier container to see more processes</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#001-dockercli-__codelineno-28-14"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>busy-container<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;sleep 100 &amp; sleep 200 &amp; sleep 300 &amp; wait&quot;</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#001-dockercli-__codelineno-28-15"></a>docker<span class="w"> </span>top<span class="w"> </span>busy-container
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#001-dockercli-__codelineno-28-16"></a>
</span><span id="__span-28-17"><a id="__codelineno-28-17" name="__codelineno-28-17" href="#001-dockercli-__codelineno-28-17"></a><span class="c1"># Clean up</span>
</span><span id="__span-28-18"><a id="__codelineno-28-18" name="__codelineno-28-18" href="#001-dockercli-__codelineno-28-18"></a>docker<span class="w"> </span>stop<span class="w"> </span>top-test<span class="w"> </span>busy-container
</span><span id="__span-28-19"><a id="__codelineno-28-19" name="__codelineno-28-19" href="#001-dockercli-__codelineno-28-19"></a>docker<span class="w"> </span>rm<span class="w"> </span>top-test<span class="w"> </span>busy-container
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-unpause"><code>docker unpause</code><a class="headerlink" href="#001-dockercli-docker-unpause" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker unpause</code> resumes all processes in a paused container.</li>
<li>Used in conjunction with <code>docker pause</code>.
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#001-dockercli-__codelineno-29-1"></a><span class="c1"># Create and pause a container</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#001-dockercli-__codelineno-29-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>unpause-test<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;while true; do echo &#39;Running&#39;; sleep 1; done&quot;</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#001-dockercli-__codelineno-29-3"></a>docker<span class="w"> </span>pause<span class="w"> </span>unpause-test
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#001-dockercli-__codelineno-29-4"></a>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#001-dockercli-__codelineno-29-5"></a><span class="c1"># Verify container is paused</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#001-dockercli-__codelineno-29-6"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>unpause-test
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#001-dockercli-__codelineno-29-7"></a>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#001-dockercli-__codelineno-29-8"></a><span class="c1"># Unpause the container</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#001-dockercli-__codelineno-29-9"></a>docker<span class="w"> </span>unpause<span class="w"> </span>unpause-test
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#001-dockercli-__codelineno-29-10"></a>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#001-dockercli-__codelineno-29-11"></a><span class="c1"># Verify container is running again</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#001-dockercli-__codelineno-29-12"></a>docker<span class="w"> </span>ps<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>unpause-test
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#001-dockercli-__codelineno-29-13"></a>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#001-dockercli-__codelineno-29-14"></a><span class="c1"># Check logs to see it resumed</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#001-dockercli-__codelineno-29-15"></a>docker<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">5</span><span class="w"> </span>unpause-test
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#001-dockercli-__codelineno-29-16"></a>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#001-dockercli-__codelineno-29-17"></a><span class="c1"># Clean up</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#001-dockercli-__codelineno-29-18"></a>docker<span class="w"> </span>stop<span class="w"> </span>unpause-test
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#001-dockercli-__codelineno-29-19"></a>docker<span class="w"> </span>rm<span class="w"> </span>unpause-test
</span></code></pre></div></li>
</ul>
<hr />
<h3 id="001-dockercli-docker-wait"><code>docker wait</code><a class="headerlink" href="#001-dockercli-docker-wait" title="Permanent link">&para;</a></h3>
<ul>
<li><code>docker wait</code> blocks until one or more containers stop.</li>
<li>
<p>Returns the exit code of the container.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#001-dockercli-__codelineno-30-1"></a><span class="c1"># Create a container that will exit after 5 seconds</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#001-dockercli-__codelineno-30-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>wait-test<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;sleep 5; exit 42&quot;</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#001-dockercli-__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#001-dockercli-__codelineno-30-4"></a><span class="c1"># Wait for the container to exit and get the exit code</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#001-dockercli-__codelineno-30-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Waiting for container to exit...&quot;</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#001-dockercli-__codelineno-30-6"></a>docker<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>wait-test
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#001-dockercli-__codelineno-30-7"></a><span class="c1"># This will return 42 after 5 seconds</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#001-dockercli-__codelineno-30-8"></a>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#001-dockercli-__codelineno-30-9"></a><span class="c1"># Wait for multiple containers</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#001-dockercli-__codelineno-30-10"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>w1<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;sleep 3; exit 0&quot;</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#001-dockercli-__codelineno-30-11"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>w2<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;sleep 2; exit 1&quot;</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#001-dockercli-__codelineno-30-12"></a>docker<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>w1<span class="w"> </span>w2
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#001-dockercli-__codelineno-30-13"></a>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#001-dockercli-__codelineno-30-14"></a><span class="c1"># Clean up</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#001-dockercli-__codelineno-30-15"></a>docker<span class="w"> </span>rm<span class="w"> </span>wait-test<span class="w"> </span>w1<span class="w"> </span>w2
</span></code></pre></div>
</li>
</ul></section><section class="print-page" id="002-dockerfile" heading-number="1.3"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="002-dockerfile-lab-002-create-a-basic-container-using-dockerfile">Lab 002 - Create a basic container using Dockerfile<a class="headerlink" href="#002-dockerfile-lab-002-create-a-basic-container-using-dockerfile" title="Permanent link">&para;</a></h1>
<ul>
<li>In this lab we will create our first container using <code>Dockerfile</code></li>
<li>The container will be used to serve a simple <code>NodeJs</code> web server</li>
<li>No NodeJs knowledge is required</li>
<li>You will need to create, build, tag &amp; push your container to DockerHub</li>
<li>
<p>The lab is divided into the several tasks.</p>
<ul>
<li><a href="#002-dockerfile-01-prepare-the-server-code">01. Prepare the server code</a></li>
<li><a href="#002-dockerfile-02-test-the-serverjs-code">02. Test the <code>server.js</code> code</a></li>
<li><a href="#002-dockerfile-03-write-the-dockerfile">03. Write the <code>Dockerfile</code></a></li>
<li><a href="#002-dockerfile-04---build-the-image">04. Build the image</a></li>
<li><a href="#002-dockerfile-05-login-to-dockerhub">05. Login to DockerHub</a></li>
<li><a href="#002-dockerfile-06---push-the-image-to-dockerhub">06. Push the image to DockerHub</a></li>
<li><a href="#002-dockerfile-07-verify-the-push">07. Verify the push</a></li>
<li><a href="#002-dockerfile-08---test-the-image">08. Test the image</a></li>
<li><a href="#002-dockerfile-09-test-the-server">09. Test the server</a></li>
<li><a href="#002-dockerfile-10-clean-up">10. Clean up</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="002-dockerfile-01-prepare-the-server-code">01. Prepare the server code<a class="headerlink" href="#002-dockerfile-01-prepare-the-server-code" title="Permanent link">&para;</a></h2>
<ul>
<li>Our container will include the following NodeJs simple web server</li>
<li>Copy the code below and save it to a file named <code>server.js</code>
    <div class="language-js highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#002-dockerfile-__codelineno-0-1"></a><span class="c1">//</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#002-dockerfile-__codelineno-0-2"></a><span class="c1">// Filename: server.js</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#002-dockerfile-__codelineno-0-3"></a><span class="c1">//</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#002-dockerfile-__codelineno-0-4"></a><span class="c1">// Simple NodeJs Server</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#002-dockerfile-__codelineno-0-5"></a><span class="c1">// The server is listening by default to port 8888</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#002-dockerfile-__codelineno-0-6"></a><span class="c1">//</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#002-dockerfile-__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#002-dockerfile-__codelineno-0-8"></a><span class="c1">// import the HTTP module</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#002-dockerfile-__codelineno-0-9"></a><span class="kd">var</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#002-dockerfile-__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#002-dockerfile-__codelineno-0-11"></a><span class="c1">// Define a port we want to listen to</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#002-dockerfile-__codelineno-0-12"></a><span class="c1">// Later on we will pass the port as env parameter</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#002-dockerfile-__codelineno-0-13"></a><span class="c1">// Default port is set to 8888</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#002-dockerfile-__codelineno-0-14"></a><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">8888</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#002-dockerfile-__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#002-dockerfile-__codelineno-0-16"></a><span class="c1">// Create the server and listen for requests</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#002-dockerfile-__codelineno-0-17"></a><span class="c1">// Create the server and listen for requests</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#002-dockerfile-__codelineno-0-18"></a><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)=&gt;{</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#002-dockerfile-__codelineno-0-19"></a><span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Server is running.!! You asked for: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#002-dockerfile-__codelineno-0-20"></a><span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">()=&gt;{</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#002-dockerfile-__codelineno-0-21"></a><span class="w">    </span><span class="c1">// Callback is triggered when server is getting a request</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#002-dockerfile-__codelineno-0-22"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Server listening on: http://localhost:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">PORT</span><span class="p">);</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#002-dockerfile-__codelineno-0-23"></a><span class="p">});</span>
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="002-dockerfile-02-test-the-serverjs-code">02. Test the <code>server.js</code> code<a class="headerlink" href="#002-dockerfile-02-test-the-serverjs-code" title="Permanent link">&para;</a></h2>
<ul>
<li>Before we &ldquo;pack&rdquo; our code in Docker image lets test the code</li>
<li>We will test the code inside <code>nodejs</code> docker 
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#002-dockerfile-__codelineno-1-1"></a><span class="c1"># Test the node code</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#002-dockerfile-__codelineno-1-2"></a><span class="c1">#   --rm            =   remove the container when done</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#002-dockerfile-__codelineno-1-3"></a><span class="c1">#   -d              =   run in detached mode</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#002-dockerfile-__codelineno-1-4"></a><span class="c1">#   -p              =   open the required ports</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#002-dockerfile-__codelineno-1-5"></a><span class="c1">#   -v              =   volume</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#002-dockerfile-__codelineno-1-6"></a><span class="c1">#   -w              =   workdir</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#002-dockerfile-__codelineno-1-7"></a><span class="c1">#   --name          =   the container name</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#002-dockerfile-__codelineno-1-8"></a><span class="c1">#   node            =   Execute a nodejs container to test our code</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#002-dockerfile-__codelineno-1-9"></a><span class="c1">#   node server.js  =   Execute the code</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#002-dockerfile-__codelineno-1-10"></a>docker<span class="w">   </span>run<span class="w"> </span>--rm<span class="w"> </span>-d<span class="w">       </span><span class="se">\</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#002-dockerfile-__codelineno-1-11"></a><span class="w">  </span>-v<span class="w">     </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/usr/src<span class="w">  </span><span class="se">\</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#002-dockerfile-__codelineno-1-12"></a><span class="w">  </span>-w<span class="w">     </span>/usr/src<span class="w">         </span><span class="se">\</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#002-dockerfile-__codelineno-1-13"></a><span class="w">  </span>-p<span class="w">     </span><span class="m">8888</span>:8888<span class="w">        </span><span class="se">\</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#002-dockerfile-__codelineno-1-14"></a><span class="w">  </span>--name<span class="w"> </span>node_server<span class="w">      </span><span class="se">\</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#002-dockerfile-__codelineno-1-15"></a><span class="w">  </span>node<span class="w">                    </span><span class="se">\</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#002-dockerfile-__codelineno-1-16"></a><span class="w">  </span>node<span class="w"> </span>server.js<span class="w">   </span>
</span></code></pre></div></li>
</ul>
<h2 id="002-dockerfile-03-write-the-dockerfile">03. Write the <code>Dockerfile</code><a class="headerlink" href="#002-dockerfile-03-write-the-dockerfile" title="Permanent link">&para;</a></h2>
<ul>
<li>Now lets create a <code>Dockerfile</code> with the code we just created above</li>
<li>The <code>Dockerfile</code> will be based upon <code>nodejs</code> image and will include our <code>server.js</code>
    <div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#002-dockerfile-__codelineno-2-1"></a><span class="c">#</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#002-dockerfile-__codelineno-2-2"></a><span class="c"># Filename: Dockerfile</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#002-dockerfile-__codelineno-2-3"></a><span class="c">#</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#002-dockerfile-__codelineno-2-4"></a><span class="c"># Use node as our base image</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#002-dockerfile-__codelineno-2-5"></a><span class="k">FROM</span><span class="w">      </span><span class="s">node</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#002-dockerfile-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#002-dockerfile-__codelineno-2-7"></a><span class="c"># Optional: Set working directory</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#002-dockerfile-__codelineno-2-8"></a><span class="k">WORKDIR</span><span class="w">   </span><span class="s">/usr/src</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#002-dockerfile-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#002-dockerfile-__codelineno-2-10"></a><span class="c"># Copy the server code to our working directory [.]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#002-dockerfile-__codelineno-2-11"></a><span class="k">COPY</span><span class="w">      </span>server.js<span class="w"> </span>.
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#002-dockerfile-__codelineno-2-12"></a>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#002-dockerfile-__codelineno-2-13"></a><span class="c"># Mark the port which will required for the server</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#002-dockerfile-__codelineno-2-14"></a><span class="k">EXPOSE</span><span class="w">    </span><span class="s">8888</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#002-dockerfile-__codelineno-2-15"></a>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#002-dockerfile-__codelineno-2-16"></a><span class="c"># Start the server when the container is started</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#002-dockerfile-__codelineno-2-17"></a><span class="k">CMD</span><span class="w">       </span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;./server.js&quot;</span><span class="p">]</span>
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="002-dockerfile-04-build-the-image">04 - Build the image<a class="headerlink" href="#002-dockerfile-04-build-the-image" title="Permanent link">&para;</a></h2>
<ul>
<li>Once we have the docker file we can build the image</li>
<li>Once the image is ready we will push it to DockerHub so you will need an account.</li>
<li>We will name the image: &ldquo;Your Dockerhub username/repository:version&rdquo;
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#002-dockerfile-__codelineno-3-1"></a><span class="c1">###</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#002-dockerfile-__codelineno-3-2"></a><span class="c1">### Build the image</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#002-dockerfile-__codelineno-3-3"></a><span class="c1">### Tag the image with the following </span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#002-dockerfile-__codelineno-3-4"></a><span class="c1">###     DockerHub username/repository:version</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#002-dockerfile-__codelineno-3-5"></a><span class="c1">###</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#002-dockerfile-__codelineno-3-6"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>nirgeier/docker-labs-002<span class="w"> </span>.
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="002-dockerfile-05-login-to-dockerhub">05. Login to DockerHub<a class="headerlink" href="#002-dockerfile-05-login-to-dockerhub" title="Permanent link">&para;</a></h2>
<ul>
<li>Login to DockerHub</li>
<li>Execute <code>docker login</code> and enter your Docker Hub credentials when prompted</li>
<li>If you don&rsquo;t have a DockerHub account, create one at https://hub.docker.com/signup</li>
<li>You will need to push the image to DockerHub in the next step</li>
</ul>
<hr />
<h2 id="002-dockerfile-06-push-the-image-to-dockerhub">06. - Push the image to DockerHub<a class="headerlink" href="#002-dockerfile-06-push-the-image-to-dockerhub" title="Permanent link">&para;</a></h2>
<div class="admonition danger">
<p class="admonition-title">Docker Login Required</p>
<p>You must login to Docker Hub before you can push to DockerHub</p>
</div>
<ul>
<li>Example: <code>docker push username/image:tag</code> </li>
</ul>
<hr />
<h2 id="002-dockerfile-07-verify-the-push">07. Verify the push<a class="headerlink" href="#002-dockerfile-07-verify-the-push" title="Permanent link">&para;</a></h2>
<ul>
<li>Login to your DockerHub account and verify that the image exists under your DockerHub account.</li>
</ul>
<hr />
<h2 id="002-dockerfile-08-test-the-image">08 - Test the image<a class="headerlink" href="#002-dockerfile-08-test-the-image" title="Permanent link">&para;</a></h2>
<ul>
<li>Last step is to test our image</li>
<li>To do so we will pull and run the image from DockerHub</li>
<li>Once the container is started we will test the server
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#002-dockerfile-__codelineno-4-1"></a><span class="c1">###</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#002-dockerfile-__codelineno-4-2"></a><span class="c1">### Pull the image from DockerHub</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#002-dockerfile-__codelineno-4-3"></a><span class="c1">###  Replace the image tag with your image tag</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#002-dockerfile-__codelineno-4-4"></a><span class="c1">### </span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#002-dockerfile-__codelineno-4-5"></a>docker<span class="w">   </span>run<span class="w"> </span>-d<span class="w">               </span><span class="se">\</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#002-dockerfile-__codelineno-4-6"></a><span class="w">        </span>--name<span class="w"> </span><span class="m">002</span>-container<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#002-dockerfile-__codelineno-4-7"></a><span class="w">        </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w">         </span><span class="se">\</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#002-dockerfile-__codelineno-4-8"></a><span class="w">        </span>nirgeier/docker-labs-002
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#002-dockerfile-__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#002-dockerfile-__codelineno-4-10"></a><span class="c1">### Check that the container is working as expected</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#002-dockerfile-__codelineno-4-11"></a>docker<span class="w"> </span>logs<span class="w"> </span><span class="m">002</span>-container<span class="w">         </span>
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="002-dockerfile-09-test-the-server">09. Test the server<a class="headerlink" href="#002-dockerfile-09-test-the-server" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Test the server that he is running on docker.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#002-dockerfile-__codelineno-5-1"></a><span class="c1"># Test the server that he is running on docker</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#002-dockerfile-__codelineno-5-2"></a>curl<span class="w"> </span>-s<span class="w"> </span>localhost:8888
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#002-dockerfile-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#002-dockerfile-__codelineno-5-4"></a><span class="c1">### ExpectedOutput:</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#002-dockerfile-__codelineno-5-5"></a>Server<span class="w"> </span>is<span class="w"> </span>running.!!<span class="w"> </span>You<span class="w"> </span>asked<span class="w"> </span><span class="k">for</span>:<span class="w"> </span>/
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="002-dockerfile-10-clean-up">10. Clean up<a class="headerlink" href="#002-dockerfile-10-clean-up" title="Permanent link">&para;</a></h2>
<ul>
<li>Stop and remove the container
    <div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#002-dockerfile-__codelineno-6-1"></a><span class="c1"># Stop the container</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#002-dockerfile-__codelineno-6-2"></a><span class="c1"># If we used --rm the container should remove itself</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#002-dockerfile-__codelineno-6-3"></a>docker<span class="w"> </span>stop<span class="w"> </span><span class="m">002</span>-container
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#002-dockerfile-__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#002-dockerfile-__codelineno-6-5"></a><span class="c1"># If not used --rm - remove the container</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#002-dockerfile-__codelineno-6-6"></a>docker<span class="w"> </span>rm<span class="w"> </span><span class="m">002</span>-container
</span></code></pre></div></li>
</ul>
<hr />
<p><img alt="Well Done" src="../assets/images/well-done.png" /></p></section><section class="print-page" id="003-dockerfile-multistage" heading-number="1.4"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="003-dockerfile-multistage-lab-003-writing-docker-multi-stage-build">Lab 003 - Writing Docker multi-stage build<a class="headerlink" href="#003-dockerfile-multistage-lab-003-writing-docker-multi-stage-build" title="Permanent link">&para;</a></h1>
<ul>
<li>In this lab we will learn how to write a multi-stage Docker file</li>
<li>A multistage build allows you to use <strong>multiple images</strong> to build a final product. </li>
<li>In a multistage build, you have a <strong>single</strong> Dockerfile which build up multiple images inside it to help build the final image.</li>
</ul>
<hr />
<h2 id="003-dockerfile-multistage-why-use-multistage-builds">Why Use Multistage Builds?<a class="headerlink" href="#003-dockerfile-multistage-why-use-multistage-builds" title="Permanent link">&para;</a></h2>
<div class="grid cards">
<ul>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10.59 12 4-4H11V6h7v7h-2V9.41l-4 4V16h8V4H8v8zM22 2v16H12v4H2V12h4V2zM10 14H4v6h6z"/></svg></span> <strong>Reduce Image Size</strong></p>
<hr />
<ul>
<li>Use a minimal base image for the final stage</li>
<li>Only copy necessary artifacts to the final image</li>
<li>Exclude build tools and intermediate files from production image</li>
</ul>
</li>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m10 17-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9m-6-8L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5z"/></svg></span> <strong>Improve Security</strong></p>
<hr />
<ul>
<li>Exclude build tools and secrets from the runtime image</li>
<li>Limit the attack surface by using a smaller final image</li>
<li>Use a non-root user in the final stage</li>
<li>Reduce vulnerabilities by minimizing installed packages</li>
</ul>
</li>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 16a3 3 0 0 1-3-3c0-1.12.61-2.1 1.5-2.61l9.71-5.62-5.53 9.58c-.5.98-1.51 1.65-2.68 1.65m0-13c1.81 0 3.5.5 4.97 1.32l-2.1 1.21C14 5.19 13 5 12 5a8 8 0 0 0-8 8c0 2.21.89 4.21 2.34 5.65h.01c.39.39.39 1.02 0 1.41s-1.03.39-1.42.01A9.97 9.97 0 0 1 2 13 10 10 0 0 1 12 3m10 10c0 2.76-1.12 5.26-2.93 7.07-.39.38-1.02.38-1.41-.01a.996.996 0 0 1 0-1.41A7.95 7.95 0 0 0 20 13c0-1-.19-2-.54-2.9L20.67 8C21.5 9.5 22 11.18 22 13"/></svg></span> <strong>Better Build Performance</strong></p>
<hr />
<ul>
<li>Leverage Docker&rsquo;s layer caching mechanism to speed up builds</li>
<li>Only rebuild stages that have changed</li>
<li>Each stage can be built and tested independently</li>
<li>Parallel stage execution when possible</li>
</ul>
</li>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 9h5.5L13 3.5zM6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m.12 13.5 3.74 3.74 1.42-1.41-2.33-2.33 2.33-2.33-1.42-1.41zm11.16 0-3.74-3.74-1.42 1.41 2.33 2.33-2.33 2.33 1.42 1.41z"/></svg></span> <strong>Cleaner and More Maintainable Dockerfiles</strong></p>
<hr />
<ul>
<li>Separate concerns by using multiple named stages</li>
<li>No need for manual cleanup of build dependencies</li>
<li>Easier to read and maintain with clear stage purposes</li>
<li>Use meaningful stage names for better clarity</li>
<li>Add comments to explain each stage&rsquo;s role</li>
</ul>
</li>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2 10.96a.985.985 0 0 1-.37-1.37L3.13 7c.11-.2.28-.34.47-.42l7.83-4.4c.16-.12.36-.18.57-.18s.41.06.57.18l7.9 4.44c.19.1.35.26.44.46l1.45 2.52c.28.48.11 1.09-.36 1.36l-1 .58v4.96c0 .38-.21.71-.53.88l-7.9 4.44c-.16.12-.36.18-.57.18s-.41-.06-.57-.18l-7.9-4.44A.99.99 0 0 1 3 16.5v-5.54c-.3.17-.68.18-1 0m10-6.81v6.7l5.96-3.35zM5 15.91l6 3.38v-6.71L5 9.21zm14 0v-3.22l-5 2.9c-.33.18-.7.17-1 .01v3.69zm-5.15-2.55 6.28-3.63-.58-1.01-6.28 3.63z"/></svg></span> <strong>Flexible Dependency Management</strong></p>
<hr />
<ul>
<li>Install build dependencies in one stage and runtime dependencies in another</li>
<li>Use different base images optimized for each stage (e.g., <code>golang:alpine</code> for build, <code>alpine</code> for runtime)</li>
<li>Use the best-suited image for each stage without bloating the final image</li>
</ul>
</li>
<li>
<p><span class="twemoji lg middle"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 14h-2v2h-6v-3h2v-2h-2V6a2 2 0 0 0-2-2H4V2H2v8h2V8h6v3H8v2h2v5a2 2 0 0 0 2 2h8v2h2"/></svg></span> <strong>Simplified CI/CD Pipelines</strong></p>
<hr />
<ul>
<li>Combine build, test, and deploy stages in a single Dockerfile</li>
<li>Use <code>--target</code> flag to build specific stages for different environments</li>
<li>Consistent build process across development and production</li>
</ul>
</li>
</ul>
</div>
<hr />
<h2 id="003-dockerfile-multistage-01-create-multi-stage-docker-file">01. Create multi-stage docker file<a class="headerlink" href="#003-dockerfile-multistage-01-create-multi-stage-docker-file" title="Permanent link">&para;</a></h2>
<ul>
<li>The first step is to create a Dockerfile.</li>
<li>Later on we will pass build time arguments to this file to build the desired image</li>
<li><code>Dockerfile</code>
    <div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#003-dockerfile-multistage-__codelineno-0-1"></a><span class="c"># Get the value of the desired image to build</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#003-dockerfile-multistage-__codelineno-0-2"></a><span class="k">ARG</span><span class="w">     </span><span class="nv">BASE_IMG</span><span class="o">=</span>curl
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#003-dockerfile-multistage-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#003-dockerfile-multistage-__codelineno-0-4"></a><span class="c"># Build the base image </span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#003-dockerfile-multistage-__codelineno-0-5"></a><span class="k">FROM</span><span class="w">    </span><span class="s">alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base_image</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#003-dockerfile-multistage-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#003-dockerfile-multistage-__codelineno-0-7"></a><span class="c"># Add some content to the 2nd image</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#003-dockerfile-multistage-__codelineno-0-8"></a><span class="k">FROM</span><span class="w">    </span><span class="s">base_image</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="s">build-curl</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#003-dockerfile-multistage-__codelineno-0-9"></a><span class="k">RUN</span><span class="w">     </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;This file is from curl image&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>image.txt
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#003-dockerfile-multistage-__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#003-dockerfile-multistage-__codelineno-0-11"></a><span class="c"># Add some content to the 3rd image</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#003-dockerfile-multistage-__codelineno-0-12"></a><span class="k">FROM</span><span class="w">    </span><span class="s">base_image</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="s">build-bash</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#003-dockerfile-multistage-__codelineno-0-13"></a><span class="k">RUN</span><span class="w">     </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;This file is from bash image&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>image.txt
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#003-dockerfile-multistage-__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#003-dockerfile-multistage-__codelineno-0-15"></a><span class="c"># Build the desired image</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#003-dockerfile-multistage-__codelineno-0-16"></a><span class="k">FROM</span><span class="w">    </span><span class="s">build-${BASE_IMG}</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#003-dockerfile-multistage-__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#003-dockerfile-multistage-__codelineno-0-18"></a><span class="c"># We can use the FROM command as we see in the previous line or use the</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#003-dockerfile-multistage-__codelineno-0-19"></a><span class="c"># We can also use image index instead</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#003-dockerfile-multistage-__codelineno-0-20"></a><span class="c"># COPY  --from=build-${BASE_IMG} image.txt . to copy a specific content</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#003-dockerfile-multistage-__codelineno-0-21"></a><span class="k">RUN</span><span class="w">     </span>cat<span class="w"> </span>image.txt
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#003-dockerfile-multistage-__codelineno-0-22"></a><span class="k">CMD</span><span class="w">     </span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;image.txt&quot;</span><span class="p">]</span>
</span></code></pre></div></li>
</ul>
<h2 id="003-dockerfile-multistage-02-build-the-desired-images">02. Build the desired images<a class="headerlink" href="#003-dockerfile-multistage-02-build-the-desired-images" title="Permanent link">&para;</a></h2>
<ul>
<li>We will use the following script to build multiple images and to test the results
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#003-dockerfile-multistage-__codelineno-1-1"></a><span class="ch">#!/bin/bash -x</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#003-dockerfile-multistage-__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#003-dockerfile-multistage-__codelineno-1-3"></a><span class="c1"># Build The curl based image (no-cache)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#003-dockerfile-multistage-__codelineno-1-4"></a>docker<span class="w"> </span>build<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">BASE_IMG</span><span class="o">=</span>curl<span class="w"> </span>--no-cache<span class="w"> </span>-t<span class="w"> </span>curl1<span class="w"> </span>.
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#003-dockerfile-multistage-__codelineno-1-5"></a>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#003-dockerfile-multistage-__codelineno-1-6"></a><span class="c1"># Build The bash based image (no-cache)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#003-dockerfile-multistage-__codelineno-1-7"></a>docker<span class="w"> </span>build<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">BASE_IMG</span><span class="o">=</span>bash<span class="w"> </span>--no-cache<span class="w"> </span>-t<span class="w"> </span>bash1<span class="w"> </span>.
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#003-dockerfile-multistage-__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#003-dockerfile-multistage-__codelineno-1-9"></a><span class="c1">### Build with cache</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#003-dockerfile-multistage-__codelineno-1-10"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#003-dockerfile-multistage-__codelineno-1-11"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;---------------------------------&quot;</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#003-dockerfile-multistage-__codelineno-1-12"></a><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;&quot;</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#003-dockerfile-multistage-__codelineno-1-13"></a><span class="c1"># Build The curl based image (with cache)</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#003-dockerfile-multistage-__codelineno-1-14"></a>docker<span class="w"> </span>build<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">BASE_IMG</span><span class="o">=</span>curl<span class="w"> </span>-t<span class="w"> </span>curl2<span class="w"> </span>.
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#003-dockerfile-multistage-__codelineno-1-15"></a>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#003-dockerfile-multistage-__codelineno-1-16"></a><span class="c1"># Build The bash based image (with cache)</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#003-dockerfile-multistage-__codelineno-1-17"></a>docker<span class="w"> </span>build<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">BASE_IMG</span><span class="o">=</span>bash<span class="w"> </span>-t<span class="w"> </span>bash2<span class="w"> </span>.
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="003-dockerfile-multistage-03-test-the-images">03. Test the images<a class="headerlink" href="#003-dockerfile-multistage-03-test-the-images" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>We will now test the 4 images we build perviously
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#003-dockerfile-multistage-__codelineno-2-1"></a><span class="c1"># Debug mode</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#003-dockerfile-multistage-__codelineno-2-2"></a><span class="nb">set</span><span class="w"> </span>-x
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#003-dockerfile-multistage-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#003-dockerfile-multistage-__codelineno-2-4"></a><span class="c1"># Test the output images</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#003-dockerfile-multistage-__codelineno-2-5"></a>docker<span class="w"> </span>run<span class="w"> </span>curl1
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#003-dockerfile-multistage-__codelineno-2-6"></a>docker<span class="w"> </span>run<span class="w"> </span>curl2
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#003-dockerfile-multistage-__codelineno-2-7"></a>docker<span class="w"> </span>run<span class="w"> </span>bash1
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#003-dockerfile-multistage-__codelineno-2-8"></a>docker<span class="w"> </span>run<span class="w"> </span>bash2
</span></code></pre></div></p>
</li>
<li>
<p>You should see output similar to this one:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#003-dockerfile-multistage-__codelineno-3-1"></a>+<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>curl1
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#003-dockerfile-multistage-__codelineno-3-2"></a>This<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>from<span class="w"> </span>curl<span class="w"> </span>image
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#003-dockerfile-multistage-__codelineno-3-3"></a>+<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>curl2
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#003-dockerfile-multistage-__codelineno-3-4"></a>This<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>from<span class="w"> </span>curl<span class="w"> </span>image
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#003-dockerfile-multistage-__codelineno-3-5"></a>+<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>bash1
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#003-dockerfile-multistage-__codelineno-3-6"></a>This<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>from<span class="w"> </span>bash<span class="w"> </span>image
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#003-dockerfile-multistage-__codelineno-3-7"></a>+<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>bash2
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#003-dockerfile-multistage-__codelineno-3-8"></a>This<span class="w"> </span>file<span class="w"> </span>is<span class="w"> </span>from<span class="w"> </span>bash<span class="w"> </span>image
</span></code></pre></div></p>
</li>
</ul>
<hr />
<h2 id="003-dockerfile-multistage-04-quiz">04. Quiz<a class="headerlink" href="#003-dockerfile-multistage-04-quiz" title="Permanent link">&para;</a></h2>
<ul>
<li>What will be the results of this docker file?</li>
<li>Try to answer and then build the following <code>Dockerfile</code> to see the results
        <div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#003-dockerfile-multistage-__codelineno-4-1"></a><span class="c"># Build the base image</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#003-dockerfile-multistage-__codelineno-4-2"></a><span class="k">FROM</span><span class="w">    </span><span class="s">alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base_image</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#003-dockerfile-multistage-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#003-dockerfile-multistage-__codelineno-4-4"></a><span class="c"># Add some packages to the base image</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#003-dockerfile-multistage-__codelineno-4-5"></a><span class="k">FROM</span><span class="w">    </span><span class="s">base_image</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="s">build-curl</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#003-dockerfile-multistage-__codelineno-4-6"></a><span class="k">RUN</span><span class="w">     </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\033[1;33mThis file is from curl image\033[0m&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>image.txt
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#003-dockerfile-multistage-__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#003-dockerfile-multistage-__codelineno-4-8"></a><span class="c"># Add some packages to the base image</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#003-dockerfile-multistage-__codelineno-4-9"></a><span class="k">FROM</span><span class="w">    </span><span class="s">base_image</span><span class="w">  </span><span class="k">AS</span><span class="w"> </span><span class="s">build-bash</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#003-dockerfile-multistage-__codelineno-4-10"></a><span class="k">RUN</span><span class="w">     </span><span class="nb">echo</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;\033[1;32mThis file is from bash image\033[0m&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>image.txt
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#003-dockerfile-multistage-__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#003-dockerfile-multistage-__codelineno-4-12"></a><span class="c">#   Build the desired image</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#003-dockerfile-multistage-__codelineno-4-13"></a><span class="k">FROM</span><span class="w">    </span><span class="s">build-curl</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#003-dockerfile-multistage-__codelineno-4-14"></a><span class="k">COPY</span><span class="w">    </span>--from<span class="o">=</span><span class="m">2</span><span class="w"> </span>image.txt<span class="w"> </span>.
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#003-dockerfile-multistage-__codelineno-4-15"></a><span class="k">RUN</span><span class="w"> </span>cat<span class="w"> </span>image.txt
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#003-dockerfile-multistage-__codelineno-4-16"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;image.txt&quot;</span><span class="p">]</span>
</span></code></pre></div></li>
<li>
<p>Test your answer with the following command</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#003-dockerfile-multistage-__codelineno-5-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile2<span class="w"> </span>.
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="003-dockerfile-multistage-05-build-a-specific-target">05. Build a specific target<a class="headerlink" href="#003-dockerfile-multistage-05-build-a-specific-target" title="Permanent link">&para;</a></h2>
<ul>
<li>We can build our specific image and stop at the desired stage</li>
<li>
<p>In other words we don&rsquo;t need to build all the images within the docker file</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#003-dockerfile-multistage-__codelineno-6-1"></a>docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>build-curl<span class="w"> </span>-f<span class="w"> </span>Dockerfile2<span class="w"> </span>.
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="003-dockerfile-multistage-06-in-class-exercise">06. In-Class Exercise<a class="headerlink" href="#003-dockerfile-multistage-06-in-class-exercise" title="Permanent link">&para;</a></h2>
<ul>
<li>Create a <code>multi-stage</code> docker file that will build 2 images</li>
<li>The first image will be based on <code>alpine</code> and will create a file named <code>alpine.txt</code> with the content: <code>This is alpine image</code></li>
<li>The second image will be based on <code>node</code> and will create a file named <code>node.txt</code> with the content: <code>This is node image</code></li>
<li>The final image should be based on <code>alpine</code> and should copy the files which you created from the previous stages and display their content when the container will run.</li>
<li>Hint: Use the <code>COPY --from=</code> command to copy files from previous stages</li>
</ul>
<details>
<summary>Solution</summary>

### Dockerfile Solution

Create a file named `Dockerfile-exercise`:

<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#003-dockerfile-multistage-__codelineno-7-1"></a><span class="c"># First stage: Alpine image</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#003-dockerfile-multistage-__codelineno-7-2"></a><span class="k">FROM</span><span class="w">  </span><span class="s">alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">alpine-stage</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#003-dockerfile-multistage-__codelineno-7-3"></a><span class="k">RUN</span><span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This is alpine image&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>alpine.txt
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#003-dockerfile-multistage-__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#003-dockerfile-multistage-__codelineno-7-5"></a><span class="c"># Second stage: Node image</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#003-dockerfile-multistage-__codelineno-7-6"></a><span class="k">FROM</span><span class="w">  </span><span class="s">node</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">node-stage</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#003-dockerfile-multistage-__codelineno-7-7"></a><span class="k">RUN</span><span class="w">   </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;This is node image&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>node.txt
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#003-dockerfile-multistage-__codelineno-7-8"></a>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#003-dockerfile-multistage-__codelineno-7-9"></a><span class="c"># Final stage: Alpine with files from previous stages</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#003-dockerfile-multistage-__codelineno-7-10"></a><span class="k">FROM</span><span class="w">  </span><span class="s">alpine</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#003-dockerfile-multistage-__codelineno-7-11"></a><span class="k">COPY</span><span class="w">  </span>--from<span class="o">=</span>alpine-stage<span class="w"> </span>alpine.txt<span class="w">  </span>.
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#003-dockerfile-multistage-__codelineno-7-12"></a><span class="k">COPY</span><span class="w">  </span>--from<span class="o">=</span>node-stage<span class="w"> </span>node.txt<span class="w">      </span>.
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#003-dockerfile-multistage-__codelineno-7-13"></a>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#003-dockerfile-multistage-__codelineno-7-14"></a><span class="c"># Run the command to display contents</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#003-dockerfile-multistage-__codelineno-7-15"></a><span class="k">CMD</span><span class="w">   </span>cat<span class="w"> </span>alpine.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>cat<span class="w"> </span>node.txt
</span></code></pre></div>

### Build and Test

Build the image:

<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#003-dockerfile-multistage-__codelineno-8-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile-exercise<span class="w"> </span>-t<span class="w"> </span>exercise-solution<span class="w"> </span>.
</span></code></pre></div>

Run the container:

<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#003-dockerfile-multistage-__codelineno-9-1"></a>docker<span class="w"> </span>run<span class="w"> </span>exercise-solution
</span></code></pre></div>

Expected output:

<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#003-dockerfile-multistage-__codelineno-10-1"></a>This is alpine image
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#003-dockerfile-multistage-__codelineno-10-2"></a>This is node image
</span></code></pre></div>

### Explanation

1. **First Stage (alpine-stage)**: Based on `alpine`, creates `alpine.txt` with the required content
2. **Second Stage (node-stage)**: Based on `node`, creates `node.txt` with the required content
3. **Final Stage**: Based on `alpine` (lightweight), copies both files from previous stages using `COPY --from=<stage-name>` and displays their content when run

</details></section><section class="print-page" id="004-localregistry" heading-number="1.5"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="004-localregistry-lab-004-local-docker-registry">Lab 004 - Local Docker Registry<a class="headerlink" href="#004-localregistry-lab-004-local-docker-registry" title="Permanent link">&para;</a></h1>
<ul>
<li>A collection of Hands-on Docker labs.</li>
<li>Each lab is a standalone lab and does not require to complete the previous labs.</li>
</ul>
<h4 id="004-localregistry-pre-requirements">Pre-Requirements <!-- omit in toc --><a class="headerlink" href="#004-localregistry-pre-requirements" title="Permanent link">&para;</a></h4>
<ul>
<li>Docker installed</li>
<li>Dockerfile knowledge </li>
<li>DockerHub account</li>
</ul>
<hr />
<h1 id="004-localregistry-lab-setup-basic-local-docker-registry">Lab: Setup Basic Local Docker Registry <!-- omit in toc --><a class="headerlink" href="#004-localregistry-lab-setup-basic-local-docker-registry" title="Permanent link">&para;</a></h1>
<ul>
<li>In this lab we will learn how to create a local Docker registry.</li>
<li>In this lab we will learn how to push and pull images from the local registry.</li>
<li>in this lab we will be using the default configuration, but of course you can change it as you wish.</li>
<li>Configuration docs: <a href="https://docs.docker.com/registry/configuration/">https://docs.docker.com/registry/configuration</a></li>
</ul>
<hr />
<ul>
<li><a href="#004-localregistry-01-create-a-basic-local-registry">01. Create a basic local registry</a></li>
<li><a href="#004-localregistry-02-prepare-the-local-images">02. Prepare the local images</a></li>
<li><a href="#004-localregistry-0201-download-busybox-image">02.01. Download busybox image</a></li>
<li><a href="#004-localregistry-0201-tag-the-image-with-the-local-registry-prefix">02.01. Tag the image with the local registry prefix</a></li>
<li><a href="#004-localregistry-0202-push-the-image-to-the-local-registry">02.02. Push the image to the local registry</a></li>
<li><a href="#004-localregistry-03-test-local-images">03. Test local images</a></li>
</ul>
<hr />
<h3 id="004-localregistry-01-create-a-basic-local-registry">01. Create a basic local registry<a class="headerlink" href="#004-localregistry-01-create-a-basic-local-registry" title="Permanent link">&para;</a></h3>
<ul>
<li>The first step is to create a local registry.</li>
<li>For this we will use the <code>docker run</code> command with the docker <code>registry</code>- https://hub.docker.com/_/registry image.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#004-localregistry-__codelineno-0-1"></a><span class="c1"># Run the registry container</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#004-localregistry-__codelineno-0-2"></a>docker<span class="w">  </span>run<span class="w">                     </span><span class="se">\</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#004-localregistry-__codelineno-0-3"></a><span class="w">        </span>-d<span class="w">                      </span><span class="se">\</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#004-localregistry-__codelineno-0-4"></a><span class="w">        </span>-p<span class="w"> </span><span class="m">5000</span>:5000<span class="w">            </span><span class="se">\</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#004-localregistry-__codelineno-0-5"></a><span class="w">        </span>--restart<span class="w"> </span>always<span class="w">        </span><span class="se">\</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#004-localregistry-__codelineno-0-6"></a><span class="w">        </span>--name<span class="w"> </span>registry<span class="w">         </span><span class="se">\</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#004-localregistry-__codelineno-0-7"></a><span class="w">        </span>registry:latest
</span></code></pre></div>
<h3 id="004-localregistry-02-prepare-the-local-images">02. Prepare the local images<a class="headerlink" href="#004-localregistry-02-prepare-the-local-images" title="Permanent link">&para;</a></h3>
<ul>
<li>We will download the images from DockerHub and push them to the local registry.</li>
</ul>
<h3 id="004-localregistry-0201-download-busybox-image">02.01. Download busybox image<a class="headerlink" href="#004-localregistry-0201-download-busybox-image" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#004-localregistry-__codelineno-1-1"></a><span class="c1"># download busybox image from docker-hub</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#004-localregistry-__codelineno-1-2"></a>docker<span class="w"> </span>pull<span class="w"> </span>busybox
</span></code></pre></div>
<h3 id="004-localregistry-0201-tag-the-image-with-the-local-registry-prefix">02.01. Tag the image with the local registry prefix<a class="headerlink" href="#004-localregistry-0201-tag-the-image-with-the-local-registry-prefix" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#004-localregistry-__codelineno-2-1"></a><span class="c1"># Tag the busybox image with the local registry prefix</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#004-localregistry-__codelineno-2-2"></a>docker<span class="w"> </span>tag<span class="w"> </span>busybox<span class="w"> </span>localhost:5000/busybox
</span></code></pre></div>
<h3 id="004-localregistry-0202-push-the-image-to-the-local-registry">02.02. Push the image to the local registry<a class="headerlink" href="#004-localregistry-0202-push-the-image-to-the-local-registry" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#004-localregistry-__codelineno-3-1"></a><span class="c1"># Once we have the appropriate tag, we can push the image to the local registry</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#004-localregistry-__codelineno-3-2"></a>docker<span class="w"> </span>push<span class="w"> </span>localhost:5000/busybox
</span></code></pre></div>
<h3 id="004-localregistry-03-test-local-images">03. Test local images<a class="headerlink" href="#004-localregistry-03-test-local-images" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#004-localregistry-__codelineno-4-1"></a><span class="c1"># List all local repositories</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#004-localregistry-__codelineno-4-2"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>http://localhost:5000/v2/_catalog
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#004-localregistry-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#004-localregistry-__codelineno-4-4"></a><span class="c1"># List all tags for a repository</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#004-localregistry-__codelineno-4-5"></a>curl<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span>https://myregistry:5000/v2/ubuntu/tags/list
</span></code></pre></div></section><section class="print-page" id="005-dockercompose-basics" heading-number="1.6"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="005-dockercompose-basics-lab-005-docker-compose-wordpress-mariadb">Lab 005 - Docker Compose - WordPress &amp; MariaDB<a class="headerlink" href="#005-dockercompose-basics-lab-005-docker-compose-wordpress-mariadb" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab demonstrates how to use Docker Compose to orchestrate a simple multi-container application: WordPress with a MariaDB database backend.</li>
</ul>
<h2 id="005-dockercompose-basics-overview">Overview<a class="headerlink" href="#005-dockercompose-basics-overview" title="Permanent link">&para;</a></h2>
<ul>
<li>The provided <code>docker-compose.yaml</code> file defines two main services:<ul>
<li><strong>db</strong>: Runs a MariaDB database (can be switched to MySQL if desired).</li>
<li><strong>wordpress</strong>: Runs the latest WordPress application, connected to the database.</li>
</ul>
</li>
<li>A named volume <code>db_data</code> is used to persist database data.</li>
</ul>
<h4 id="005-dockercompose-basics-docker-composeyaml-breakdown">docker-compose.yaml Breakdown<a class="headerlink" href="#005-dockercompose-basics-docker-composeyaml-breakdown" title="Permanent link">&para;</a></h4>
<h5 id="005-dockercompose-basics-db-service"><strong>db service</strong><a class="headerlink" href="#005-dockercompose-basics-db-service" title="Permanent link">&para;</a></h5>
<ul>
<li>Uses the <code>mariadb:10.6.4-focal</code> image (or optionally MySQL).</li>
<li>Sets up environment variables for root password, database, user, and password.</li>
<li>Persists data in a Docker volume.</li>
<li>Exposes ports 3306 and 33060 (internal only).</li>
</ul>
<h5 id="005-dockercompose-basics-wordpress-service"><strong>wordpress service</strong><a class="headerlink" href="#005-dockercompose-basics-wordpress-service" title="Permanent link">&para;</a></h5>
<ul>
<li>Uses the latest WordPress image.</li>
<li>Maps port 80 on the host to port 80 in the container.</li>
<li>Configures environment variables to connect to the database.</li>
</ul>
<h5 id="005-dockercompose-basics-volumes"><strong>volumes</strong><a class="headerlink" href="#005-dockercompose-basics-volumes" title="Permanent link">&para;</a></h5>
<ul>
<li><code>db_data</code>: Persists MariaDB data between container restarts.</li>
</ul>
<h5 id="005-dockercompose-basics-bonus-demo">Bonus Demo<a class="headerlink" href="#005-dockercompose-basics-bonus-demo" title="Permanent link">&para;</a></h5>
<ul>
<li>I prepared a demo of this lab, which you can view on KillerCoda: <a href="https://killercoda.com/codewizard/scenario/Portainer">Portainder Demo</a>.</li>
<li>The demo is showcases for setting and running multuple containers using Docker Compose</li>
<li>The demo is available on <a href="https://killercoda.com/codewizard/scenario/Portainer">KillerCoda</a>.</li>
</ul>
<hr />
<h2 id="005-dockercompose-basics-how-to-run-the-lab">How to Run the Lab<a class="headerlink" href="#005-dockercompose-basics-how-to-run-the-lab" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Navigate to the lab directory:</strong>
   <div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#005-dockercompose-basics-__codelineno-0-1"></a><span class="nb">cd</span><span class="w"> </span>Labs/005-DockerCompose
</span></code></pre></div></p>
</li>
<li>
<p><strong>Start the services:</strong>
   <div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#005-dockercompose-basics-__codelineno-1-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div></p>
</li>
<li>
<p>This will pull the required images (if not already present) and start both the database and WordPress containers in detached mode.</p>
</li>
<li>
<p><strong>Access WordPress:</strong></p>
</li>
<li>Open your browser and go to <a href="http://localhost">http://localhost</a></li>
<li>
<p>Complete the WordPress setup wizard.</p>
</li>
<li>
<p><strong>Stop the services:</strong>
   <div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#005-dockercompose-basics-__codelineno-2-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>down
</span></code></pre></div>
   This will stop and remove the containers, but the database data will persist in the <code>db_data</code> volume.</p>
</li>
</ol>
<h2 id="005-dockercompose-basics-notes">Notes<a class="headerlink" href="#005-dockercompose-basics-notes" title="Permanent link">&para;</a></h2>
<ul>
<li>To use MySQL instead of MariaDB, uncomment the relevant line in the compose file and comment out the MariaDB image line.</li>
<li>The database credentials are set for demonstration purposes. For production, use secure passwords.</li>
<li>The <code>db</code> service is only accessible to the <code>wordpress</code> service (not exposed to the host).</li>
</ul>
<h2 id="005-dockercompose-basics-advanced-concepts">Advanced Concepts<a class="headerlink" href="#005-dockercompose-basics-advanced-concepts" title="Permanent link">&para;</a></h2>
<h3 id="005-dockercompose-basics-docker-compose-networks">Docker Compose Networks<a class="headerlink" href="#005-dockercompose-basics-docker-compose-networks" title="Permanent link">&para;</a></h3>
<p>Docker Compose automatically creates a default network for your services. However, you can define custom networks for better isolation and control:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#005-dockercompose-basics-__codelineno-3-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#005-dockercompose-basics-__codelineno-3-2"></a><span class="w">  </span><span class="nt">wordpress</span><span class="p">:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#005-dockercompose-basics-__codelineno-3-3"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#005-dockercompose-basics-__codelineno-3-4"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#005-dockercompose-basics-__codelineno-3-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#005-dockercompose-basics-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#005-dockercompose-basics-__codelineno-3-7"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#005-dockercompose-basics-__codelineno-3-8"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#005-dockercompose-basics-__codelineno-3-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#005-dockercompose-basics-__codelineno-3-10"></a>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#005-dockercompose-basics-__codelineno-3-11"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#005-dockercompose-basics-__codelineno-3-12"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#005-dockercompose-basics-__codelineno-3-13"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#005-dockercompose-basics-__codelineno-3-14"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#005-dockercompose-basics-__codelineno-3-15"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#005-dockercompose-basics-__codelineno-3-16"></a><span class="w">    </span><span class="nt">internal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># No external access</span>
</span></code></pre></div>
<p><strong>Network Types:</strong>
- <code>bridge</code>: Default network driver for standalone containers
- <code>host</code>: Use the host&rsquo;s network directly
- <code>overlay</code>: For multi-host networking (Docker Swarm)
- <code>macvlan</code>: Assign MAC addresses to containers
- <code>none</code>: Disable networking</p>
<h3 id="005-dockercompose-basics-volume-management">Volume Management<a class="headerlink" href="#005-dockercompose-basics-volume-management" title="Permanent link">&para;</a></h3>
<p><strong>Named Volumes vs Bind Mounts:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#005-dockercompose-basics-__codelineno-4-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#005-dockercompose-basics-__codelineno-4-2"></a><span class="w">  </span><span class="nt">wordpress</span><span class="p">:</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#005-dockercompose-basics-__codelineno-4-3"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#005-dockercompose-basics-__codelineno-4-4"></a><span class="w">      </span><span class="c1"># Named volume (managed by Docker)</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#005-dockercompose-basics-__codelineno-4-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">wp_data:/var/www/html</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#005-dockercompose-basics-__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#005-dockercompose-basics-__codelineno-4-7"></a><span class="w">      </span><span class="c1"># Bind mount (host directory)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#005-dockercompose-basics-__codelineno-4-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./my-theme:/var/www/html/wp-content/themes/my-theme</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#005-dockercompose-basics-__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#005-dockercompose-basics-__codelineno-4-10"></a><span class="w">      </span><span class="c1"># Anonymous volume</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#005-dockercompose-basics-__codelineno-4-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/www/html/tmp</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#005-dockercompose-basics-__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#005-dockercompose-basics-__codelineno-4-13"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#005-dockercompose-basics-__codelineno-4-14"></a><span class="w">  </span><span class="nt">wp_data</span><span class="p">:</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#005-dockercompose-basics-__codelineno-4-15"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#005-dockercompose-basics-__codelineno-4-16"></a><span class="w">    </span><span class="nt">driver_opts</span><span class="p">:</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#005-dockercompose-basics-__codelineno-4-17"></a><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">none</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#005-dockercompose-basics-__codelineno-4-18"></a><span class="w">      </span><span class="nt">o</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bind</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#005-dockercompose-basics-__codelineno-4-19"></a><span class="w">      </span><span class="nt">device</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/on/host</span>
</span></code></pre></div>
<p><strong>Volume Best Practices:</strong>
- Use named volumes for data persistence
- Use bind mounts for development (live code updates)
- Use anonymous volumes for temporary data
- Always backup volumes before major updates</p>
<h3 id="005-dockercompose-basics-health-checks">Health Checks<a class="headerlink" href="#005-dockercompose-basics-health-checks" title="Permanent link">&para;</a></h3>
<p>Add health checks to ensure services are running correctly:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#005-dockercompose-basics-__codelineno-5-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#005-dockercompose-basics-__codelineno-5-2"></a><span class="w">  </span><span class="nt">wordpress</span><span class="p">:</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#005-dockercompose-basics-__codelineno-5-3"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#005-dockercompose-basics-__codelineno-5-4"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#005-dockercompose-basics-__codelineno-5-5"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#005-dockercompose-basics-__codelineno-5-6"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#005-dockercompose-basics-__codelineno-5-7"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#005-dockercompose-basics-__codelineno-5-8"></a><span class="w">      </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40s</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#005-dockercompose-basics-__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#005-dockercompose-basics-__codelineno-5-10"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#005-dockercompose-basics-__codelineno-5-11"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#005-dockercompose-basics-__codelineno-5-12"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;mysqladmin&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ping&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-h&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;localhost&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#005-dockercompose-basics-__codelineno-5-13"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#005-dockercompose-basics-__codelineno-5-14"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#005-dockercompose-basics-__codelineno-5-15"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span></code></pre></div>
<h3 id="005-dockercompose-basics-resource-limits">Resource Limits<a class="headerlink" href="#005-dockercompose-basics-resource-limits" title="Permanent link">&para;</a></h3>
<p>Control resource allocation to prevent any service from consuming all resources:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#005-dockercompose-basics-__codelineno-6-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#005-dockercompose-basics-__codelineno-6-2"></a><span class="w">  </span><span class="nt">wordpress</span><span class="p">:</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#005-dockercompose-basics-__codelineno-6-3"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#005-dockercompose-basics-__codelineno-6-4"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#005-dockercompose-basics-__codelineno-6-5"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#005-dockercompose-basics-__codelineno-6-6"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.50&#39;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#005-dockercompose-basics-__codelineno-6-7"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#005-dockercompose-basics-__codelineno-6-8"></a><span class="w">        </span><span class="nt">reservations</span><span class="p">:</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#005-dockercompose-basics-__codelineno-6-9"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#005-dockercompose-basics-__codelineno-6-10"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span></code></pre></div>
<h3 id="005-dockercompose-basics-restart-policies">Restart Policies<a class="headerlink" href="#005-dockercompose-basics-restart-policies" title="Permanent link">&para;</a></h3>
<p>Configure how containers should restart:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#005-dockercompose-basics-__codelineno-7-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#005-dockercompose-basics-__codelineno-7-2"></a><span class="w">  </span><span class="nt">wordpress</span><span class="p">:</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#005-dockercompose-basics-__codelineno-7-3"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span><span class="w">  </span><span class="c1"># Options: no, always, on-failure, unless-stopped</span>
</span></code></pre></div>
<h3 id="005-dockercompose-basics-dependency-management">Dependency Management<a class="headerlink" href="#005-dockercompose-basics-dependency-management" title="Permanent link">&para;</a></h3>
<p>Control startup order with <code>depends_on</code>:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#005-dockercompose-basics-__codelineno-8-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#005-dockercompose-basics-__codelineno-8-2"></a><span class="w">  </span><span class="nt">wordpress</span><span class="p">:</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#005-dockercompose-basics-__codelineno-8-3"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#005-dockercompose-basics-__codelineno-8-4"></a><span class="w">      </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#005-dockercompose-basics-__codelineno-8-5"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span><span class="w">  </span><span class="c1"># Wait for db to be healthy</span>
</span></code></pre></div>
<h3 id="005-dockercompose-basics-logging-configuration">Logging Configuration<a class="headerlink" href="#005-dockercompose-basics-logging-configuration" title="Permanent link">&para;</a></h3>
<p>Configure log drivers and options:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#005-dockercompose-basics-__codelineno-9-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#005-dockercompose-basics-__codelineno-9-2"></a><span class="w">  </span><span class="nt">wordpress</span><span class="p">:</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#005-dockercompose-basics-__codelineno-9-3"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#005-dockercompose-basics-__codelineno-9-4"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;json-file&quot;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#005-dockercompose-basics-__codelineno-9-5"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#005-dockercompose-basics-__codelineno-9-6"></a><span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#005-dockercompose-basics-__codelineno-9-7"></a><span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span></code></pre></div>
<h2 id="005-dockercompose-basics-best-practices">Best Practices<a class="headerlink" href="#005-dockercompose-basics-best-practices" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Use Environment Variables</strong>: Store configuration in <code>.env</code> files
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#005-dockercompose-basics-__codelineno-10-1"></a><span class="c1"># .env file</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#005-dockercompose-basics-__codelineno-10-2"></a><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>secure_password
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#005-dockercompose-basics-__codelineno-10-3"></a><span class="nv">MYSQL_DATABASE</span><span class="o">=</span>wordpress
</span></code></pre></div></p>
</li>
<li>
<p><strong>Version Your Compose Files</strong>: Always specify the Compose version
   <div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#005-dockercompose-basics-__codelineno-11-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Use Specific Image Tags</strong>: Avoid <code>latest</code> tag in production
   <div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#005-dockercompose-basics-__codelineno-12-1"></a><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mariadb:10.6.4-focal</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Organize Services Logically</strong>: Group related services</p>
</li>
<li>Frontend services</li>
<li>Backend services</li>
<li>Database services</li>
<li>
<p>Cache services</p>
</li>
<li>
<p><strong>Use Multi-Stage Builds</strong>: For custom images, use multi-stage Dockerfiles</p>
</li>
<li>
<p><strong>Implement Health Checks</strong>: Always add health checks for critical services</p>
</li>
<li>
<p><strong>Secure Secrets</strong>: Use Docker secrets or external secret management
   <div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#005-dockercompose-basics-__codelineno-13-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#005-dockercompose-basics-__codelineno-13-2"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#005-dockercompose-basics-__codelineno-13-3"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#005-dockercompose-basics-__codelineno-13-4"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_password</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#005-dockercompose-basics-__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#005-dockercompose-basics-__codelineno-13-6"></a><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#005-dockercompose-basics-__codelineno-13-7"></a><span class="w">  </span><span class="nt">db_password</span><span class="p">:</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#005-dockercompose-basics-__codelineno-13-8"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/db_password.txt</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Use .dockerignore</strong>: Exclude unnecessary files from build context</p>
</li>
<li>
<p><strong>Network Isolation</strong>: Use custom networks to isolate services</p>
</li>
<li>
<p><strong>Monitor Resources</strong>: Set resource limits to prevent resource exhaustion</p>
</li>
</ol>
<h2 id="005-dockercompose-basics-useful-docker-compose-commands">Useful Docker Compose Commands<a class="headerlink" href="#005-dockercompose-basics-useful-docker-compose-commands" title="Permanent link">&para;</a></h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#005-dockercompose-basics-__codelineno-14-1"></a><span class="c1"># View configuration (merged from all compose files)</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#005-dockercompose-basics-__codelineno-14-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>config
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#005-dockercompose-basics-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#005-dockercompose-basics-__codelineno-14-4"></a><span class="c1"># Validate compose file</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#005-dockercompose-basics-__codelineno-14-5"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--quiet
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#005-dockercompose-basics-__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#005-dockercompose-basics-__codelineno-14-7"></a><span class="c1"># Pull all images</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#005-dockercompose-basics-__codelineno-14-8"></a>docker<span class="w"> </span>compose<span class="w"> </span>pull
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#005-dockercompose-basics-__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#005-dockercompose-basics-__codelineno-14-10"></a><span class="c1"># Build services</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#005-dockercompose-basics-__codelineno-14-11"></a>docker<span class="w"> </span>compose<span class="w"> </span>build
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#005-dockercompose-basics-__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#005-dockercompose-basics-__codelineno-14-13"></a><span class="c1"># Start services</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#005-dockercompose-basics-__codelineno-14-14"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#005-dockercompose-basics-__codelineno-14-15"></a>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#005-dockercompose-basics-__codelineno-14-16"></a><span class="c1"># View running services</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#005-dockercompose-basics-__codelineno-14-17"></a>docker<span class="w"> </span>compose<span class="w"> </span>ps
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#005-dockercompose-basics-__codelineno-14-18"></a>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#005-dockercompose-basics-__codelineno-14-19"></a><span class="c1"># View logs</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#005-dockercompose-basics-__codelineno-14-20"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span><span class="o">[</span>service_name<span class="o">]</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#005-dockercompose-basics-__codelineno-14-21"></a>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#005-dockercompose-basics-__codelineno-14-22"></a><span class="c1"># Execute command in running container</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#005-dockercompose-basics-__codelineno-14-23"></a>docker<span class="w"> </span>compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>wordpress<span class="w"> </span>bash
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#005-dockercompose-basics-__codelineno-14-24"></a>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#005-dockercompose-basics-__codelineno-14-25"></a><span class="c1"># Scale services</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#005-dockercompose-basics-__codelineno-14-26"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">wordpress</span><span class="o">=</span><span class="m">3</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#005-dockercompose-basics-__codelineno-14-27"></a>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#005-dockercompose-basics-__codelineno-14-28"></a><span class="c1"># Stop services</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#005-dockercompose-basics-__codelineno-14-29"></a>docker<span class="w"> </span>compose<span class="w"> </span>stop
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#005-dockercompose-basics-__codelineno-14-30"></a>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#005-dockercompose-basics-__codelineno-14-31"></a><span class="c1"># Stop and remove containers</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#005-dockercompose-basics-__codelineno-14-32"></a>docker<span class="w"> </span>compose<span class="w"> </span>down
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#005-dockercompose-basics-__codelineno-14-33"></a>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#005-dockercompose-basics-__codelineno-14-34"></a><span class="c1"># Stop, remove containers and volumes</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#005-dockercompose-basics-__codelineno-14-35"></a>docker<span class="w"> </span>compose<span class="w"> </span>down<span class="w"> </span>-v
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#005-dockercompose-basics-__codelineno-14-36"></a>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#005-dockercompose-basics-__codelineno-14-37"></a><span class="c1"># Restart services</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#005-dockercompose-basics-__codelineno-14-38"></a>docker<span class="w"> </span>compose<span class="w"> </span>restart
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#005-dockercompose-basics-__codelineno-14-39"></a>
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#005-dockercompose-basics-__codelineno-14-40"></a><span class="c1"># Pause services</span>
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#005-dockercompose-basics-__codelineno-14-41"></a>docker<span class="w"> </span>compose<span class="w"> </span>pause
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#005-dockercompose-basics-__codelineno-14-42"></a>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#005-dockercompose-basics-__codelineno-14-43"></a><span class="c1"># Unpause services</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#005-dockercompose-basics-__codelineno-14-44"></a>docker<span class="w"> </span>compose<span class="w"> </span>unpause
</span><span id="__span-14-45"><a id="__codelineno-14-45" name="__codelineno-14-45" href="#005-dockercompose-basics-__codelineno-14-45"></a>
</span><span id="__span-14-46"><a id="__codelineno-14-46" name="__codelineno-14-46" href="#005-dockercompose-basics-__codelineno-14-46"></a><span class="c1"># View resource usage</span>
</span><span id="__span-14-47"><a id="__codelineno-14-47" name="__codelineno-14-47" href="#005-dockercompose-basics-__codelineno-14-47"></a>docker<span class="w"> </span>compose<span class="w"> </span>top
</span></code></pre></div>
<h2 id="005-dockercompose-basics-troubleshooting">Troubleshooting<a class="headerlink" href="#005-dockercompose-basics-troubleshooting" title="Permanent link">&para;</a></h2>
<ul>
<li>If you encounter port conflicts, ensure nothing else is running on port 80.</li>
<li>To view logs for a service:
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#005-dockercompose-basics-__codelineno-15-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>wordpress
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#005-dockercompose-basics-__codelineno-15-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>db
</span></code></pre></div></li>
<li>Check service health:
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#005-dockercompose-basics-__codelineno-16-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>ps
</span></code></pre></div></li>
<li>Inspect network connectivity:
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#005-dockercompose-basics-__codelineno-17-1"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span><span class="m">005</span>-dockercompose_default
</span></code></pre></div></li>
<li>Debug startup issues:
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#005-dockercompose-basics-__codelineno-18-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>--no-start
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#005-dockercompose-basics-__codelineno-18-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>start
</span></code></pre></div></li>
</ul>
<hr />
<p>This lab is part of the DockerLabs series. See other labs for more Docker scenarios and hands-on exercises.</p></section><section class="print-page" id="006-dockercompose-env" heading-number="1.7"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="006-dockercompose-env-lab-006-multi-environment-docker-compose-setup">Lab 006 - Multi-Environment Docker Compose Setup<a class="headerlink" href="#006-dockercompose-env-lab-006-multi-environment-docker-compose-setup" title="Permanent link">&para;</a></h1>
<ul>
<li>A comprehensive example of structuring Docker Compose files for multiple environments</li>
<li>Demonstrates environment-specific overrides and configuration management</li>
<li>Each environment is fully isolated with its own configuration and services</li>
</ul>
<h3 id="006-dockercompose-env-pre-requirements">Pre-Requirements <!-- omit in toc --><a class="headerlink" href="#006-dockercompose-env-pre-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li>Docker installed</li>
<li>Docker Compose knowledge</li>
<li>Basic understanding of environment variables</li>
</ul>
<hr />
<ul>
<li><a href="#006-dockercompose-env-overview">Overview</a></li>
<li><a href="#006-dockercompose-env-project-structure">Project Structure</a></li>
<li><a href="#006-dockercompose-env-step-01---understanding-the-base-configuration">Step 01 - Understanding the Base Configuration</a></li>
<li><a href="#006-dockercompose-env-step-02---development-environment">Step 02 - Development Environment</a></li>
<li><a href="#006-dockercompose-env-step-03---production-environment">Step 03 - Production Environment</a></li>
<li><a href="#006-dockercompose-env-step-04---environment-variables">Step 04 - Environment Variables</a></li>
<li><a href="#006-dockercompose-env-shared-variables-env">Shared Variables (<code>.env</code>)</a></li>
<li><a href="#006-dockercompose-env-development-variables-envdev">Development Variables (<code>.env.dev</code>)</a></li>
<li><a href="#006-dockercompose-env-production-variables-envprod">Production Variables (<code>.env.prod</code>)</a></li>
<li><a href="#006-dockercompose-env-step-05---quick-start-with-scripts">Step 05 - Quick Start with Scripts</a></li>
<li><a href="#006-dockercompose-env-using-the-runsh-script">Using the run.sh Script</a></li>
<li><a href="#006-dockercompose-env-step-06---manual-commands">Step 06 - Manual Commands</a></li>
<li><a href="#006-dockercompose-env-start-specific-environment">Start Specific Environment</a></li>
<li><a href="#006-dockercompose-env-stop-services">Stop Services</a></li>
<li><a href="#006-dockercompose-env-view-logs">View Logs</a></li>
<li><a href="#006-dockercompose-env-scale-services-production">Scale Services (Production)</a></li>
<li><a href="#006-dockercompose-env-step-07---testing-the-setup">Step 07 - Testing the Setup</a></li>
<li><a href="#006-dockercompose-env-interactive-demo">Interactive Demo</a></li>
<li><a href="#006-dockercompose-env-manual-testing">Manual Testing</a></li>
<li><a href="#006-dockercompose-env-step-08---clean-up">Step 08 - Clean Up</a></li>
<li><a href="#006-dockercompose-env-best-practices">Best Practices</a></li>
<li><a href="#006-dockercompose-env-troubleshooting">Troubleshooting</a></li>
<li><a href="#006-dockercompose-env-common-issues">Common Issues</a></li>
<li><a href="#006-dockercompose-env-debugging-commands">Debugging Commands</a></li>
<li><a href="#006-dockercompose-env-environment-specific-notes">Environment-Specific Notes</a></li>
</ul>
<h2 id="006-dockercompose-env-overview">Overview<a class="headerlink" href="#006-dockercompose-env-overview" title="Permanent link">&para;</a></h2>
<p>This lab demonstrates how to structure Docker Compose files for multiple environments using:</p>
<ul>
<li><strong>Base Configuration</strong>: Common services shared across environments</li>
<li><strong>Environment Overrides</strong>: Specific configurations for development and production</li>
<li><strong>Environment Variables</strong>: Centralized configuration management</li>
<li><strong>Utility Scripts</strong>: Easy environment management</li>
</ul>
<h2 id="006-dockercompose-env-project-structure">Project Structure<a class="headerlink" href="#006-dockercompose-env-project-structure" title="Permanent link">&para;</a></h2>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#006-dockercompose-env-__codelineno-0-1"></a>Labs/006-DockerCompose-env/
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#006-dockercompose-env-__codelineno-0-2"></a>‚îú‚îÄ‚îÄ docker-compose.yml          # Base services configuration
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#006-dockercompose-env-__codelineno-0-3"></a>‚îú‚îÄ‚îÄ docker-compose.dev.yml      # Development overrides
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#006-dockercompose-env-__codelineno-0-4"></a>‚îú‚îÄ‚îÄ docker-compose.prod.yml     # Production overrides
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#006-dockercompose-env-__codelineno-0-5"></a>‚îú‚îÄ‚îÄ .env                        # Shared environment variables
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#006-dockercompose-env-__codelineno-0-6"></a>‚îú‚îÄ‚îÄ .env.dev                    # Development-specific variables
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#006-dockercompose-env-__codelineno-0-7"></a>‚îú‚îÄ‚îÄ .env.prod                   # Production-specific variables
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#006-dockercompose-env-__codelineno-0-8"></a>‚îú‚îÄ‚îÄ README.md                   # This documentation
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#006-dockercompose-env-__codelineno-0-9"></a>‚îú‚îÄ‚îÄ run.sh                      # Bash script for environment management
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#006-dockercompose-env-__codelineno-0-10"></a>‚îú‚îÄ‚îÄ demo.sh                     # Interactive demonstration
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#006-dockercompose-env-__codelineno-0-11"></a>‚îú‚îÄ‚îÄ init.sql                    # Database initialization
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#006-dockercompose-env-__codelineno-0-12"></a>‚îú‚îÄ‚îÄ html/
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#006-dockercompose-env-__codelineno-0-13"></a>‚îÇ   ‚îî‚îÄ‚îÄ index.html             # Sample web application
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#006-dockercompose-env-__codelineno-0-14"></a>‚îî‚îÄ‚îÄ api/
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#006-dockercompose-env-__codelineno-0-15"></a>    ‚îú‚îÄ‚îÄ package.json           # Node.js API dependencies
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#006-dockercompose-env-__codelineno-0-16"></a>    ‚îî‚îÄ‚îÄ server.js              # Sample API server
</span></code></pre></div>
<h2 id="006-dockercompose-env-step-01-understanding-the-base-configuration">Step 01 - Understanding the Base Configuration<a class="headerlink" href="#006-dockercompose-env-step-01-understanding-the-base-configuration" title="Permanent link">&para;</a></h2>
<p>The <code>docker-compose.yml</code> file contains the core service definitions that are common across all environments:</p>
<ul>
<li><strong>Web Service</strong>: Nginx web server</li>
<li><strong>API Service</strong>: Node.js backend application  </li>
<li><strong>Database Service</strong>: PostgreSQL database</li>
<li><strong>Cache Service</strong>: Redis caching layer</li>
</ul>
<p>All services use environment variables with default values using the <code>${VARIABLE:-default}</code> syntax for flexibility.</p>
<h2 id="006-dockercompose-env-step-02-development-environment">Step 02 - Development Environment<a class="headerlink" href="#006-dockercompose-env-step-02-development-environment" title="Permanent link">&para;</a></h2>
<p>The development environment (<code>docker-compose.dev.yml</code>) provides developer-friendly features:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#006-dockercompose-env-__codelineno-1-1"></a><span class="c1"># Start development environment</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#006-dockercompose-env-__codelineno-1-2"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div>
<p><strong>Development Features:</strong></p>
<ul>
<li>Hot reload enabled for API service (nodemon)</li>
<li>Debug ports exposed (9229 for Node.js debugging)</li>
<li>Additional development tools:</li>
<li>Adminer for database management</li>
<li>MailCatcher for email testing</li>
<li>Read-write volumes for live code editing</li>
<li>Detailed logging enabled</li>
<li>Non-standard ports to avoid conflicts (8000, 3001, 5433, 6380)</li>
</ul>
<p><strong>Development Services Access:</strong></p>
<ul>
<li>Web Application: <code>http://localhost:8000</code></li>
<li>API: <code>http://localhost:3001</code></li>
<li>Database Admin (Adminer): <code>http://localhost:8080</code></li>
<li>Mail Catcher: <code>http://localhost:1080</code></li>
</ul>
<h2 id="006-dockercompose-env-step-03-production-environment">Step 03 - Production Environment<a class="headerlink" href="#006-dockercompose-env-step-03-production-environment" title="Permanent link">&para;</a></h2>
<p>The production environment (<code>docker-compose.prod.yml</code>) focuses on performance and security:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#006-dockercompose-env-__codelineno-2-1"></a><span class="c1"># Start production environment</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#006-dockercompose-env-__codelineno-2-2"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.prod<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.prod.yml<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div>
<p><strong>Production Features:</strong></p>
<ul>
<li>Multiple service replicas for high availability</li>
<li>Read-only volumes for security</li>
<li>Optimized restart policies</li>
<li>Structured logging with rotation</li>
<li>Monitoring with Prometheus</li>
<li>Standard service ports (80, 3000, 5432, 6379)</li>
</ul>
<p><strong>Production Services Access:</strong></p>
<ul>
<li>Web Application: <code>http://localhost:80</code></li>
<li>API: <code>http://localhost:3000</code></li>
<li>Monitoring (Prometheus): <code>http://localhost:9090</code></li>
</ul>
<h2 id="006-dockercompose-env-step-04-environment-variables">Step 04 - Environment Variables<a class="headerlink" href="#006-dockercompose-env-step-04-environment-variables" title="Permanent link">&para;</a></h2>
<h3 id="006-dockercompose-env-shared-variables-env">Shared Variables (<code>.env</code>)<a class="headerlink" href="#006-dockercompose-env-shared-variables-env" title="Permanent link">&para;</a></h3>
<p>Common configuration across all environments:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>APP_NAME</code></td>
<td>Application name for container naming</td>
</tr>
<tr>
<td><code>ENVIRONMENT</code></td>
<td>Current environment identifier</td>
</tr>
<tr>
<td><code>DB_NAME</code></td>
<td>Database name</td>
</tr>
<tr>
<td><code>DB_USER</code></td>
<td>Database user</td>
</tr>
<tr>
<td><code>API_SECRET</code></td>
<td>API authentication secret</td>
</tr>
<tr>
<td><code>LOG_LEVEL</code></td>
<td>Logging verbosity</td>
</tr>
</tbody>
</table>
<h3 id="006-dockercompose-env-development-variables-envdev">Development Variables (<code>.env.dev</code>)<a class="headerlink" href="#006-dockercompose-env-development-variables-envdev" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Variable/Setting</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Non-standard ports</td>
<td>Avoid conflicts with other services</td>
</tr>
<tr>
<td>Debug-friendly config</td>
<td>Enables debug mode and verbose logging</td>
</tr>
<tr>
<td>Dev DB credentials</td>
<td>Uses development database credentials</td>
</tr>
<tr>
<td>Enhanced logging</td>
<td>More detailed logs for debugging</td>
</tr>
</tbody>
</table>
<h3 id="006-dockercompose-env-production-variables-envprod">Production Variables (<code>.env.prod</code>)<a class="headerlink" href="#006-dockercompose-env-production-variables-envprod" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Variable/Setting</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Standard service ports</td>
<td>Uses standard ports for production</td>
</tr>
<tr>
<td>Strong, secure passwords</td>
<td>Enforces strong credentials</td>
</tr>
<tr>
<td>Optimized timeouts</td>
<td>Sets timeouts suitable for production</td>
</tr>
<tr>
<td>Security-focused config</td>
<td>Enables production security best practices</td>
</tr>
</tbody>
</table>
<h2 id="006-dockercompose-env-step-05-quick-start-with-scripts">Step 05 - Quick Start with Scripts<a class="headerlink" href="#006-dockercompose-env-step-05-quick-start-with-scripts" title="Permanent link">&para;</a></h2>
<h3 id="006-dockercompose-env-using-the-runsh-script">Using the run.sh Script<a class="headerlink" href="#006-dockercompose-env-using-the-runsh-script" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#006-dockercompose-env-__codelineno-3-1"></a><span class="c1"># Development environment</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#006-dockercompose-env-__codelineno-3-2"></a>./run.sh<span class="w"> </span>dev<span class="w"> </span>up<span class="w">        </span><span class="c1"># Start development</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#006-dockercompose-env-__codelineno-3-3"></a>./run.sh<span class="w"> </span>dev<span class="w"> </span>down<span class="w">      </span><span class="c1"># Stop development</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#006-dockercompose-env-__codelineno-3-4"></a>./run.sh<span class="w"> </span>dev<span class="w"> </span>logs<span class="w">      </span><span class="c1"># View development logs</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#006-dockercompose-env-__codelineno-3-5"></a>./run.sh<span class="w"> </span>dev<span class="w"> </span>ps<span class="w">        </span><span class="c1"># Show service status</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#006-dockercompose-env-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#006-dockercompose-env-__codelineno-3-7"></a><span class="c1"># Production environment</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#006-dockercompose-env-__codelineno-3-8"></a>./run.sh<span class="w"> </span>prod<span class="w"> </span>up<span class="w">       </span><span class="c1"># Start production</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#006-dockercompose-env-__codelineno-3-9"></a>./run.sh<span class="w"> </span>prod<span class="w"> </span>down<span class="w">     </span><span class="c1"># Stop production</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#006-dockercompose-env-__codelineno-3-10"></a>./run.sh<span class="w"> </span>prod<span class="w"> </span>logs<span class="w">     </span><span class="c1"># View production logs</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#006-dockercompose-env-__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#006-dockercompose-env-__codelineno-3-12"></a><span class="c1"># Help</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#006-dockercompose-env-__codelineno-3-13"></a>./run.sh<span class="w"> </span><span class="nb">help</span><span class="w">          </span><span class="c1"># Show usage information</span>
</span></code></pre></div>
<h2 id="006-dockercompose-env-step-06-manual-commands">Step 06 - Manual Commands<a class="headerlink" href="#006-dockercompose-env-step-06-manual-commands" title="Permanent link">&para;</a></h2>
<h3 id="006-dockercompose-env-start-specific-environment">Start Specific Environment<a class="headerlink" href="#006-dockercompose-env-start-specific-environment" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#006-dockercompose-env-__codelineno-4-1"></a><span class="c1"># Development</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#006-dockercompose-env-__codelineno-4-2"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#006-dockercompose-env-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#006-dockercompose-env-__codelineno-4-4"></a><span class="c1"># Production</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#006-dockercompose-env-__codelineno-4-5"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.prod<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.prod.yml<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div>
<h3 id="006-dockercompose-env-stop-services">Stop Services<a class="headerlink" href="#006-dockercompose-env-stop-services" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#006-dockercompose-env-__codelineno-5-1"></a><span class="c1"># Development</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#006-dockercompose-env-__codelineno-5-2"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>down
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#006-dockercompose-env-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#006-dockercompose-env-__codelineno-5-4"></a><span class="c1"># Production  </span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#006-dockercompose-env-__codelineno-5-5"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.prod<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.prod.yml<span class="w"> </span>down
</span></code></pre></div>
<h3 id="006-dockercompose-env-view-logs">View Logs<a class="headerlink" href="#006-dockercompose-env-view-logs" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#006-dockercompose-env-__codelineno-6-1"></a><span class="c1"># All services logs</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#006-dockercompose-env-__codelineno-6-2"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>logs<span class="w"> </span>-f
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#006-dockercompose-env-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#006-dockercompose-env-__codelineno-6-4"></a><span class="c1"># Specific service logs</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#006-dockercompose-env-__codelineno-6-5"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>api
</span></code></pre></div>
<h3 id="006-dockercompose-env-scale-services-production">Scale Services (Production)<a class="headerlink" href="#006-dockercompose-env-scale-services-production" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#006-dockercompose-env-__codelineno-7-1"></a><span class="c1"># Scale API service to 5 replicas</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#006-dockercompose-env-__codelineno-7-2"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.prod<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.prod.yml<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">api</span><span class="o">=</span><span class="m">5</span>
</span></code></pre></div>
<h2 id="006-dockercompose-env-step-07-testing-the-setup">Step 07 - Testing the Setup<a class="headerlink" href="#006-dockercompose-env-step-07-testing-the-setup" title="Permanent link">&para;</a></h2>
<h3 id="006-dockercompose-env-interactive-demo">Interactive Demo<a class="headerlink" href="#006-dockercompose-env-interactive-demo" title="Permanent link">&para;</a></h3>
<p>Run the complete demonstration:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#006-dockercompose-env-__codelineno-8-1"></a><span class="c1"># Run the interactive demo</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#006-dockercompose-env-__codelineno-8-2"></a>./demo.sh
</span></code></pre></div>
<p>The demo will:</p>
<ol>
<li>Start development environment</li>
<li>Test the application</li>
<li>Switch to production environment  </li>
<li>Show differences between environments</li>
<li>Clean up</li>
</ol>
<h3 id="006-dockercompose-env-manual-testing">Manual Testing<a class="headerlink" href="#006-dockercompose-env-manual-testing" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#006-dockercompose-env-__codelineno-9-1"></a><span class="c1"># Start development environment</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#006-dockercompose-env-__codelineno-9-2"></a>./run.sh<span class="w"> </span>dev<span class="w"> </span>up
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#006-dockercompose-env-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#006-dockercompose-env-__codelineno-9-4"></a><span class="c1"># Test the API</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#006-dockercompose-env-__codelineno-9-5"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:3001/health<span class="w"> </span><span class="p">|</span><span class="w"> </span>python3<span class="w"> </span>-m<span class="w"> </span>json.tool
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#006-dockercompose-env-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#006-dockercompose-env-__codelineno-9-7"></a><span class="c1"># Test the web application</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#006-dockercompose-env-__codelineno-9-8"></a>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:8000
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#006-dockercompose-env-__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#006-dockercompose-env-__codelineno-9-10"></a><span class="c1"># Check service status</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#006-dockercompose-env-__codelineno-9-11"></a>./run.sh<span class="w"> </span>dev<span class="w"> </span>ps
</span></code></pre></div>
<h2 id="006-dockercompose-env-step-08-clean-up">Step 08 - Clean Up<a class="headerlink" href="#006-dockercompose-env-step-08-clean-up" title="Permanent link">&para;</a></h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#006-dockercompose-env-__codelineno-10-1"></a><span class="c1"># Stop current environment</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#006-dockercompose-env-__codelineno-10-2"></a>./run.sh<span class="w"> </span>dev<span class="w"> </span>down<span class="w">     </span><span class="c1"># or ./run.sh prod down</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#006-dockercompose-env-__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#006-dockercompose-env-__codelineno-10-4"></a><span class="c1"># Complete cleanup (removes volumes)</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#006-dockercompose-env-__codelineno-10-5"></a>./run.sh<span class="w"> </span>dev<span class="w"> </span>down<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./run.sh<span class="w"> </span>prod<span class="w"> </span>down
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#006-dockercompose-env-__codelineno-10-6"></a>docker<span class="w"> </span>system<span class="w"> </span>prune<span class="w"> </span>-f
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#006-dockercompose-env-__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#006-dockercompose-env-__codelineno-10-8"></a><span class="c1"># Or manually</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#006-dockercompose-env-__codelineno-10-9"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>down<span class="w"> </span>-v
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#006-dockercompose-env-__codelineno-10-10"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.prod<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.prod.yml<span class="w"> </span>down<span class="w"> </span>-v
</span></code></pre></div>
<h2 id="006-dockercompose-env-best-practices">Best Practices<a class="headerlink" href="#006-dockercompose-env-best-practices" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>Environment Separation</strong>: Clear separation between dev, staging, and production configurations</li>
<li><strong>Security</strong>: Different secrets and passwords per environment</li>
<li><strong>Scalability</strong>: Production setup with multiple replicas and monitoring</li>
<li><strong>Development Experience</strong>: Hot reload, debugging ports, and development tools</li>
<li><strong>Configuration Management</strong>: Centralized environment variable management</li>
<li><strong>Volume Management</strong>: Read-only volumes in production, read-write in development</li>
<li><strong>Logging</strong>: Environment-appropriate logging levels and rotation</li>
<li><strong>Networking</strong>: Consistent network setup across environments</li>
</ol>
<h2 id="006-dockercompose-env-advanced-docker-compose-techniques">Advanced Docker Compose Techniques<a class="headerlink" href="#006-dockercompose-env-advanced-docker-compose-techniques" title="Permanent link">&para;</a></h2>
<h3 id="006-dockercompose-env-yaml-anchors-and-aliases">YAML Anchors and Aliases<a class="headerlink" href="#006-dockercompose-env-yaml-anchors-and-aliases" title="Permanent link">&para;</a></h3>
<p>Docker Compose supports YAML anchors (<code>&amp;</code>) and aliases (<code>*</code>) to reduce duplication in your compose files. This is particularly useful when multiple services share common configuration.</p>
<p><strong>Basic Anchors Example:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#006-dockercompose-env-__codelineno-11-1"></a><span class="c1"># Define reusable configuration blocks</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#006-dockercompose-env-__codelineno-11-2"></a><span class="nt">x-logging</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;default-logging</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#006-dockercompose-env-__codelineno-11-3"></a><span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#006-dockercompose-env-__codelineno-11-4"></a><span class="w">  </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#006-dockercompose-env-__codelineno-11-5"></a><span class="w">    </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#006-dockercompose-env-__codelineno-11-6"></a><span class="w">    </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#006-dockercompose-env-__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#006-dockercompose-env-__codelineno-11-8"></a><span class="nt">x-healthcheck</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;default-healthcheck</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#006-dockercompose-env-__codelineno-11-9"></a><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#006-dockercompose-env-__codelineno-11-10"></a><span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#006-dockercompose-env-__codelineno-11-11"></a><span class="w">  </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#006-dockercompose-env-__codelineno-11-12"></a><span class="w">  </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40s</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#006-dockercompose-env-__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#006-dockercompose-env-__codelineno-11-14"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#006-dockercompose-env-__codelineno-11-15"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#006-dockercompose-env-__codelineno-11-16"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#006-dockercompose-env-__codelineno-11-17"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-logging</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#006-dockercompose-env-__codelineno-11-18"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#006-dockercompose-env-__codelineno-11-19"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-healthcheck</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#006-dockercompose-env-__codelineno-11-20"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#006-dockercompose-env-__codelineno-11-21"></a>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#006-dockercompose-env-__codelineno-11-22"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#006-dockercompose-env-__codelineno-11-23"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#006-dockercompose-env-__codelineno-11-24"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-logging</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#006-dockercompose-env-__codelineno-11-25"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#006-dockercompose-env-__codelineno-11-26"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-healthcheck</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#006-dockercompose-env-__codelineno-11-27"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:3000/health&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div>
<h3 id="006-dockercompose-env-extension-fields-x-">Extension Fields (x-*)<a class="headerlink" href="#006-dockercompose-env-extension-fields-x-" title="Permanent link">&para;</a></h3>
<p>Extension fields are special YAML keys that start with <code>x-</code> and are ignored by Docker Compose. They&rsquo;re perfect for defining reusable configuration fragments.</p>
<p><strong>Common Configuration Patterns:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#006-dockercompose-env-__codelineno-12-1"></a><span class="c1"># Define common configurations as extension fields</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#006-dockercompose-env-__codelineno-12-2"></a><span class="nt">x-common-variables</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-vars</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#006-dockercompose-env-__codelineno-12-3"></a><span class="w">  </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#006-dockercompose-env-__codelineno-12-4"></a><span class="w">  </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#006-dockercompose-env-__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#006-dockercompose-env-__codelineno-12-6"></a><span class="nt">x-restart-policy</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;restart-policy</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#006-dockercompose-env-__codelineno-12-7"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#006-dockercompose-env-__codelineno-12-8"></a>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#006-dockercompose-env-__codelineno-12-9"></a><span class="nt">x-resource-limits</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;resource-limits</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#006-dockercompose-env-__codelineno-12-10"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#006-dockercompose-env-__codelineno-12-11"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#006-dockercompose-env-__codelineno-12-12"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#006-dockercompose-env-__codelineno-12-13"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.50&#39;</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#006-dockercompose-env-__codelineno-12-14"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#006-dockercompose-env-__codelineno-12-15"></a><span class="w">      </span><span class="nt">reservations</span><span class="p">:</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#006-dockercompose-env-__codelineno-12-16"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#006-dockercompose-env-__codelineno-12-17"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#006-dockercompose-env-__codelineno-12-18"></a>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#006-dockercompose-env-__codelineno-12-19"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#006-dockercompose-env-__codelineno-12-20"></a><span class="w">  </span><span class="nt">service1</span><span class="p">:</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#006-dockercompose-env-__codelineno-12-21"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*restart-policy</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#006-dockercompose-env-__codelineno-12-22"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*resource-limits</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#006-dockercompose-env-__codelineno-12-23"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#006-dockercompose-env-__codelineno-12-24"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-vars</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#006-dockercompose-env-__codelineno-12-25"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service1</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#006-dockercompose-env-__codelineno-12-26"></a>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#006-dockercompose-env-__codelineno-12-27"></a><span class="w">  </span><span class="nt">service2</span><span class="p">:</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#006-dockercompose-env-__codelineno-12-28"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*restart-policy</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#006-dockercompose-env-__codelineno-12-29"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*resource-limits</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#006-dockercompose-env-__codelineno-12-30"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#006-dockercompose-env-__codelineno-12-31"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-vars</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#006-dockercompose-env-__codelineno-12-32"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service2</span>
</span></code></pre></div>
<h3 id="006-dockercompose-env-merge-keys">Merge Keys (&lt;&lt;:)<a class="headerlink" href="#006-dockercompose-env-merge-keys" title="Permanent link">&para;</a></h3>
<p>The merge key <code>&lt;&lt;:</code> allows you to merge one or more mappings into the current mapping. You can merge multiple anchors:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#006-dockercompose-env-__codelineno-13-1"></a><span class="nt">x-base-service</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;base-service</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#006-dockercompose-env-__codelineno-13-2"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#006-dockercompose-env-__codelineno-13-3"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#006-dockercompose-env-__codelineno-13-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#006-dockercompose-env-__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#006-dockercompose-env-__codelineno-13-6"></a><span class="nt">x-logging-config</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;logging-config</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#006-dockercompose-env-__codelineno-13-7"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#006-dockercompose-env-__codelineno-13-8"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#006-dockercompose-env-__codelineno-13-9"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#006-dockercompose-env-__codelineno-13-10"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#006-dockercompose-env-__codelineno-13-11"></a>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#006-dockercompose-env-__codelineno-13-12"></a><span class="nt">x-health-config</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;health-config</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#006-dockercompose-env-__codelineno-13-13"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#006-dockercompose-env-__codelineno-13-14"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#006-dockercompose-env-__codelineno-13-15"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#006-dockercompose-env-__codelineno-13-16"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#006-dockercompose-env-__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#006-dockercompose-env-__codelineno-13-18"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#006-dockercompose-env-__codelineno-13-19"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#006-dockercompose-env-__codelineno-13-20"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*base-service</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*logging-config</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*health-config</span><span class="p p-Indicator">]</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#006-dockercompose-env-__codelineno-13-21"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#006-dockercompose-env-__codelineno-13-22"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#006-dockercompose-env-__codelineno-13-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#006-dockercompose-env-__codelineno-13-24"></a>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#006-dockercompose-env-__codelineno-13-25"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#006-dockercompose-env-__codelineno-13-26"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*base-service</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*logging-config</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*health-config</span><span class="p p-Indicator">]</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#006-dockercompose-env-__codelineno-13-27"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#006-dockercompose-env-__codelineno-13-28"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#006-dockercompose-env-__codelineno-13-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span></code></pre></div>
<h3 id="006-dockercompose-env-complex-fragment-patterns">Complex Fragment Patterns<a class="headerlink" href="#006-dockercompose-env-complex-fragment-patterns" title="Permanent link">&para;</a></h3>
<p><strong>Service Templates:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#006-dockercompose-env-__codelineno-14-1"></a><span class="c1"># Define a complete service template</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#006-dockercompose-env-__codelineno-14-2"></a><span class="nt">x-app-template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;app-template</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#006-dockercompose-env-__codelineno-14-3"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#006-dockercompose-env-__codelineno-14-4"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#006-dockercompose-env-__codelineno-14-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#006-dockercompose-env-__codelineno-14-6"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#006-dockercompose-env-__codelineno-14-7"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#006-dockercompose-env-__codelineno-14-8"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#006-dockercompose-env-__codelineno-14-9"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#006-dockercompose-env-__codelineno-14-10"></a><span class="w">      </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#006-dockercompose-env-__codelineno-14-11"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#006-dockercompose-env-__codelineno-14-12"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#006-dockercompose-env-__codelineno-14-13"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#006-dockercompose-env-__codelineno-14-14"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#006-dockercompose-env-__codelineno-14-15"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#006-dockercompose-env-__codelineno-14-16"></a>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#006-dockercompose-env-__codelineno-14-17"></a><span class="c1"># Define environment-specific configurations</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#006-dockercompose-env-__codelineno-14-18"></a><span class="nt">x-dev-config</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;dev-config</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#006-dockercompose-env-__codelineno-14-19"></a><span class="w">  </span><span class="nt">build</span><span class="p">:</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#006-dockercompose-env-__codelineno-14-20"></a><span class="w">    </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#006-dockercompose-env-__codelineno-14-21"></a><span class="w">    </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#006-dockercompose-env-__codelineno-14-22"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#006-dockercompose-env-__codelineno-14-23"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src:/app/src</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#006-dockercompose-env-__codelineno-14-24"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#006-dockercompose-env-__codelineno-14-25"></a><span class="w">    </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#006-dockercompose-env-__codelineno-14-26"></a>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#006-dockercompose-env-__codelineno-14-27"></a><span class="nt">x-prod-config</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;prod-config</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#006-dockercompose-env-__codelineno-14-28"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp:latest</span>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#006-dockercompose-env-__codelineno-14-29"></a><span class="w">  </span><span class="nt">read_only</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#006-dockercompose-env-__codelineno-14-30"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#006-dockercompose-env-__codelineno-14-31"></a><span class="w">    </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-14-32"><a id="__codelineno-14-32" name="__codelineno-14-32" href="#006-dockercompose-env-__codelineno-14-32"></a>
</span><span id="__span-14-33"><a id="__codelineno-14-33" name="__codelineno-14-33" href="#006-dockercompose-env-__codelineno-14-33"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-14-34"><a id="__codelineno-14-34" name="__codelineno-14-34" href="#006-dockercompose-env-__codelineno-14-34"></a><span class="w">  </span><span class="c1"># Development service</span>
</span><span id="__span-14-35"><a id="__codelineno-14-35" name="__codelineno-14-35" href="#006-dockercompose-env-__codelineno-14-35"></a><span class="w">  </span><span class="nt">app-dev</span><span class="p">:</span>
</span><span id="__span-14-36"><a id="__codelineno-14-36" name="__codelineno-14-36" href="#006-dockercompose-env-__codelineno-14-36"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*app-template</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*dev-config</span><span class="p p-Indicator">]</span>
</span><span id="__span-14-37"><a id="__codelineno-14-37" name="__codelineno-14-37" href="#006-dockercompose-env-__codelineno-14-37"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-14-38"><a id="__codelineno-14-38" name="__codelineno-14-38" href="#006-dockercompose-env-__codelineno-14-38"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3001:3000&quot;</span>
</span><span id="__span-14-39"><a id="__codelineno-14-39" name="__codelineno-14-39" href="#006-dockercompose-env-__codelineno-14-39"></a>
</span><span id="__span-14-40"><a id="__codelineno-14-40" name="__codelineno-14-40" href="#006-dockercompose-env-__codelineno-14-40"></a><span class="w">  </span><span class="c1"># Production service</span>
</span><span id="__span-14-41"><a id="__codelineno-14-41" name="__codelineno-14-41" href="#006-dockercompose-env-__codelineno-14-41"></a><span class="w">  </span><span class="nt">app-prod</span><span class="p">:</span>
</span><span id="__span-14-42"><a id="__codelineno-14-42" name="__codelineno-14-42" href="#006-dockercompose-env-__codelineno-14-42"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*app-template</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*prod-config</span><span class="p p-Indicator">]</span>
</span><span id="__span-14-43"><a id="__codelineno-14-43" name="__codelineno-14-43" href="#006-dockercompose-env-__codelineno-14-43"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-14-44"><a id="__codelineno-14-44" name="__codelineno-14-44" href="#006-dockercompose-env-__codelineno-14-44"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span></code></pre></div>
<h3 id="006-dockercompose-env-combining-anchors-with-override">Combining Anchors with Override<a class="headerlink" href="#006-dockercompose-env-combining-anchors-with-override" title="Permanent link">&para;</a></h3>
<p>You can override specific values from anchors:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#006-dockercompose-env-__codelineno-15-1"></a><span class="nt">x-database</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;database-config</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#006-dockercompose-env-__codelineno-15-2"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15-alpine</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#006-dockercompose-env-__codelineno-15-3"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#006-dockercompose-env-__codelineno-15-4"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#006-dockercompose-env-__codelineno-15-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db-network</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#006-dockercompose-env-__codelineno-15-6"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#006-dockercompose-env-__codelineno-15-7"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#006-dockercompose-env-__codelineno-15-8"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#006-dockercompose-env-__codelineno-15-9"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#006-dockercompose-env-__codelineno-15-10"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#006-dockercompose-env-__codelineno-15-11"></a>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#006-dockercompose-env-__codelineno-15-12"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#006-dockercompose-env-__codelineno-15-13"></a><span class="w">  </span><span class="nt">main-db</span><span class="p">:</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#006-dockercompose-env-__codelineno-15-14"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*database-config</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#006-dockercompose-env-__codelineno-15-15"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main-database</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#006-dockercompose-env-__codelineno-15-16"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#006-dockercompose-env-__codelineno-15-17"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">maindb</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#006-dockercompose-env-__codelineno-15-18"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#006-dockercompose-env-__codelineno-15-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">main-db-data:/var/lib/postgresql/data</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#006-dockercompose-env-__codelineno-15-20"></a>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#006-dockercompose-env-__codelineno-15-21"></a><span class="w">  </span><span class="nt">test-db</span><span class="p">:</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#006-dockercompose-env-__codelineno-15-22"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*database-config</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#006-dockercompose-env-__codelineno-15-23"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-database</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#006-dockercompose-env-__codelineno-15-24"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#006-dockercompose-env-__codelineno-15-25"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testdb</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#006-dockercompose-env-__codelineno-15-26"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#006-dockercompose-env-__codelineno-15-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-db-data:/var/lib/postgresql/data</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#006-dockercompose-env-__codelineno-15-28"></a><span class="w">    </span><span class="c1"># Override the restart policy for test db</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#006-dockercompose-env-__codelineno-15-29"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;no&quot;</span>
</span></code></pre></div>
<h3 id="006-dockercompose-env-real-world-example-microservices">Real-World Example: Microservices<a class="headerlink" href="#006-dockercompose-env-real-world-example-microservices" title="Permanent link">&para;</a></h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#006-dockercompose-env-__codelineno-16-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#006-dockercompose-env-__codelineno-16-2"></a>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#006-dockercompose-env-__codelineno-16-3"></a><span class="c1"># Common configurations</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#006-dockercompose-env-__codelineno-16-4"></a><span class="nt">x-service-defaults</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;service-defaults</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#006-dockercompose-env-__codelineno-16-5"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#006-dockercompose-env-__codelineno-16-6"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#006-dockercompose-env-__codelineno-16-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#006-dockercompose-env-__codelineno-16-8"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;logging-config</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#006-dockercompose-env-__codelineno-16-9"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#006-dockercompose-env-__codelineno-16-10"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#006-dockercompose-env-__codelineno-16-11"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#006-dockercompose-env-__codelineno-16-12"></a><span class="w">      </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#006-dockercompose-env-__codelineno-16-13"></a>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#006-dockercompose-env-__codelineno-16-14"></a><span class="nt">x-node-service</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;node-service</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#006-dockercompose-env-__codelineno-16-15"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-defaults</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#006-dockercompose-env-__codelineno-16-16"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#006-dockercompose-env-__codelineno-16-17"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#006-dockercompose-env-__codelineno-16-18"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#006-dockercompose-env-__codelineno-16-19"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#006-dockercompose-env-__codelineno-16-20"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#006-dockercompose-env-__codelineno-16-21"></a>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#006-dockercompose-env-__codelineno-16-22"></a><span class="nt">x-environment-common</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;env-common</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#006-dockercompose-env-__codelineno-16-23"></a><span class="w">  </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${NODE_ENV:-production}</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#006-dockercompose-env-__codelineno-16-24"></a><span class="w">  </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${LOG_LEVEL:-info}</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#006-dockercompose-env-__codelineno-16-25"></a><span class="w">  </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/${DB_NAME}</span>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#006-dockercompose-env-__codelineno-16-26"></a>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#006-dockercompose-env-__codelineno-16-27"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#006-dockercompose-env-__codelineno-16-28"></a><span class="w">  </span><span class="nt">user-service</span><span class="p">:</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#006-dockercompose-env-__codelineno-16-29"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*node-service</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#006-dockercompose-env-__codelineno-16-30"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-service</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#006-dockercompose-env-__codelineno-16-31"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#006-dockercompose-env-__codelineno-16-32"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*env-common</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#006-dockercompose-env-__codelineno-16-33"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-service</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#006-dockercompose-env-__codelineno-16-34"></a><span class="w">      </span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3001</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35" href="#006-dockercompose-env-__codelineno-16-35"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36" href="#006-dockercompose-env-__codelineno-16-36"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-q&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-O&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:3001/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37" href="#006-dockercompose-env-__codelineno-16-37"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38" href="#006-dockercompose-env-__codelineno-16-38"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3001:3001&quot;</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39" href="#006-dockercompose-env-__codelineno-16-39"></a>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40" href="#006-dockercompose-env-__codelineno-16-40"></a><span class="w">  </span><span class="nt">order-service</span><span class="p">:</span>
</span><span id="__span-16-41"><a id="__codelineno-16-41" name="__codelineno-16-41" href="#006-dockercompose-env-__codelineno-16-41"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*node-service</span>
</span><span id="__span-16-42"><a id="__codelineno-16-42" name="__codelineno-16-42" href="#006-dockercompose-env-__codelineno-16-42"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order-service</span>
</span><span id="__span-16-43"><a id="__codelineno-16-43" name="__codelineno-16-43" href="#006-dockercompose-env-__codelineno-16-43"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-16-44"><a id="__codelineno-16-44" name="__codelineno-16-44" href="#006-dockercompose-env-__codelineno-16-44"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*env-common</span>
</span><span id="__span-16-45"><a id="__codelineno-16-45" name="__codelineno-16-45" href="#006-dockercompose-env-__codelineno-16-45"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order-service</span>
</span><span id="__span-16-46"><a id="__codelineno-16-46" name="__codelineno-16-46" href="#006-dockercompose-env-__codelineno-16-46"></a><span class="w">      </span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3002</span>
</span><span id="__span-16-47"><a id="__codelineno-16-47" name="__codelineno-16-47" href="#006-dockercompose-env-__codelineno-16-47"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-16-48"><a id="__codelineno-16-48" name="__codelineno-16-48" href="#006-dockercompose-env-__codelineno-16-48"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-q&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-O&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:3002/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-16-49"><a id="__codelineno-16-49" name="__codelineno-16-49" href="#006-dockercompose-env-__codelineno-16-49"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-16-50"><a id="__codelineno-16-50" name="__codelineno-16-50" href="#006-dockercompose-env-__codelineno-16-50"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3002:3002&quot;</span>
</span><span id="__span-16-51"><a id="__codelineno-16-51" name="__codelineno-16-51" href="#006-dockercompose-env-__codelineno-16-51"></a>
</span><span id="__span-16-52"><a id="__codelineno-16-52" name="__codelineno-16-52" href="#006-dockercompose-env-__codelineno-16-52"></a><span class="w">  </span><span class="nt">payment-service</span><span class="p">:</span>
</span><span id="__span-16-53"><a id="__codelineno-16-53" name="__codelineno-16-53" href="#006-dockercompose-env-__codelineno-16-53"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*node-service</span>
</span><span id="__span-16-54"><a id="__codelineno-16-54" name="__codelineno-16-54" href="#006-dockercompose-env-__codelineno-16-54"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">payment-service</span>
</span><span id="__span-16-55"><a id="__codelineno-16-55" name="__codelineno-16-55" href="#006-dockercompose-env-__codelineno-16-55"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-16-56"><a id="__codelineno-16-56" name="__codelineno-16-56" href="#006-dockercompose-env-__codelineno-16-56"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*env-common</span>
</span><span id="__span-16-57"><a id="__codelineno-16-57" name="__codelineno-16-57" href="#006-dockercompose-env-__codelineno-16-57"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">payment-service</span>
</span><span id="__span-16-58"><a id="__codelineno-16-58" name="__codelineno-16-58" href="#006-dockercompose-env-__codelineno-16-58"></a><span class="w">      </span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3003</span>
</span><span id="__span-16-59"><a id="__codelineno-16-59" name="__codelineno-16-59" href="#006-dockercompose-env-__codelineno-16-59"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-16-60"><a id="__codelineno-16-60" name="__codelineno-16-60" href="#006-dockercompose-env-__codelineno-16-60"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-q&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-O&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:3003/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-16-61"><a id="__codelineno-16-61" name="__codelineno-16-61" href="#006-dockercompose-env-__codelineno-16-61"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-16-62"><a id="__codelineno-16-62" name="__codelineno-16-62" href="#006-dockercompose-env-__codelineno-16-62"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3003:3003&quot;</span>
</span><span id="__span-16-63"><a id="__codelineno-16-63" name="__codelineno-16-63" href="#006-dockercompose-env-__codelineno-16-63"></a>
</span><span id="__span-16-64"><a id="__codelineno-16-64" name="__codelineno-16-64" href="#006-dockercompose-env-__codelineno-16-64"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-16-65"><a id="__codelineno-16-65" name="__codelineno-16-65" href="#006-dockercompose-env-__codelineno-16-65"></a><span class="w">  </span><span class="nt">app-network</span><span class="p">:</span>
</span><span id="__span-16-66"><a id="__codelineno-16-66" name="__codelineno-16-66" href="#006-dockercompose-env-__codelineno-16-66"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-16-67"><a id="__codelineno-16-67" name="__codelineno-16-67" href="#006-dockercompose-env-__codelineno-16-67"></a>
</span><span id="__span-16-68"><a id="__codelineno-16-68" name="__codelineno-16-68" href="#006-dockercompose-env-__codelineno-16-68"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-16-69"><a id="__codelineno-16-69" name="__codelineno-16-69" href="#006-dockercompose-env-__codelineno-16-69"></a><span class="w">  </span><span class="nt">db-data</span><span class="p">:</span>
</span></code></pre></div>
<h3 id="006-dockercompose-env-benefits-of-using-fragments">Benefits of Using Fragments<a class="headerlink" href="#006-dockercompose-env-benefits-of-using-fragments" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>DRY Principle</strong>: Don&rsquo;t Repeat Yourself - define common configuration once</li>
<li><strong>Consistency</strong>: Ensure all services use the same base configuration</li>
<li><strong>Maintainability</strong>: Update configuration in one place</li>
<li><strong>Readability</strong>: Cleaner, more organized compose files</li>
<li><strong>Scalability</strong>: Easy to add new services with standard configuration</li>
</ol>
<h3 id="006-dockercompose-env-tips-for-using-fragments">Tips for Using Fragments<a class="headerlink" href="#006-dockercompose-env-tips-for-using-fragments" title="Permanent link">&para;</a></h3>
<ul>
<li>Use meaningful names for your anchors (e.g., <code>&amp;common-logging</code>, <code>&amp;base-service</code>)</li>
<li>Group related configuration into logical fragments</li>
<li>Place extension fields at the top of your compose file</li>
<li>Document what each fragment contains</li>
<li>Test your merged configuration with <code>docker compose config</code></li>
<li>Use fragments for environment-specific configurations</li>
<li>Combine fragments with environment variables for maximum flexibility</li>
</ul>
<h2 id="006-dockercompose-env-troubleshooting">Troubleshooting<a class="headerlink" href="#006-dockercompose-env-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="006-dockercompose-env-common-issues">Common Issues<a class="headerlink" href="#006-dockercompose-env-common-issues" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Port conflicts</strong>: Ensure no other services are using the same ports</li>
<li><strong>Environment variables</strong>: Verify all required variables are set in <code>.env</code> files</li>
<li><strong>Docker daemon</strong>: Ensure Docker is running and accessible</li>
</ul>
<h3 id="006-dockercompose-env-debugging-commands">Debugging Commands<a class="headerlink" href="#006-dockercompose-env-debugging-commands" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#006-dockercompose-env-__codelineno-17-1"></a><span class="c1"># Check service logs</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#006-dockercompose-env-__codelineno-17-2"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>logs<span class="w"> </span>service_name
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#006-dockercompose-env-__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#006-dockercompose-env-__codelineno-17-4"></a><span class="c1"># Check service status</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#006-dockercompose-env-__codelineno-17-5"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span>ps
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#006-dockercompose-env-__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#006-dockercompose-env-__codelineno-17-7"></a><span class="c1"># Inspect container</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#006-dockercompose-env-__codelineno-17-8"></a>docker<span class="w"> </span>inspect<span class="w"> </span>container_name
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#006-dockercompose-env-__codelineno-17-9"></a>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#006-dockercompose-env-__codelineno-17-10"></a><span class="c1"># Execute command in container</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#006-dockercompose-env-__codelineno-17-11"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.dev<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.dev.yml<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>service_name<span class="w"> </span>bash
</span></code></pre></div>
<h3 id="006-dockercompose-env-environment-specific-notes">Environment-Specific Notes<a class="headerlink" href="#006-dockercompose-env-environment-specific-notes" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Environment/Aspect</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Development</td>
<td>Services may take longer to start due to volume mounts</td>
</tr>
<tr>
<td>Production</td>
<td>Services use restart policies and may auto-restart on failure</td>
</tr>
<tr>
<td>Networking</td>
<td>All services communicate through Docker networks</td>
</tr>
</tbody>
</table>
<hr />
<p><img alt="" src="../../resources/well-done.png" /></p></section><section class="print-page" id="007-dockercompose-fragments" heading-number="1.8"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="007-dockercompose-fragments-lab-007-advanced-docker-compose-fragments-includes-extends">Lab 007 - Advanced Docker Compose - Fragments, Includes &amp; Extends <!-- omit in toc --><a class="headerlink" href="#007-dockercompose-fragments-lab-007-advanced-docker-compose-fragments-includes-extends" title="Permanent link">&para;</a></h1>
<p>This lab covers advanced Docker Compose techniques including YAML fragments, composition patterns, includes, and the extends keyword. Learn how to build maintainable, reusable, and DRY (Don&rsquo;t Repeat Yourself) Docker Compose configurations.</p>
<h2 id="007-dockercompose-fragments-table-of-contents">Table of Contents<a class="headerlink" href="#007-dockercompose-fragments-table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#007-dockercompose-fragments-table-of-contents">Table of Contents</a></li>
<li><a href="#007-dockercompose-fragments-overview">Overview</a></li>
<li><a href="#007-dockercompose-fragments-prerequisites">Prerequisites</a></li>
<li><a href="#007-dockercompose-fragments-yaml-anchors-and-aliases">YAML Anchors and Aliases</a></li>
<li><a href="#007-dockercompose-fragments-basic-anchors">Basic Anchors</a></li>
<li><a href="#007-dockercompose-fragments-extension-fields">Extension Fields</a></li>
<li><a href="#007-dockercompose-fragments-merge-keys">Merge Keys</a></li>
<li><a href="#007-dockercompose-fragments-docker-compose-include">Docker Compose Include</a></li>
<li><a href="#007-dockercompose-fragments-basic-include-syntax">Basic Include Syntax</a></li>
<li><a href="#007-dockercompose-fragments-include-with-path">Include with Path</a></li>
<li><a href="#007-dockercompose-fragments-include-best-practices">Include Best Practices</a></li>
<li><a href="#007-dockercompose-fragments-docker-compose-extends-legacy">Docker Compose Extends (Legacy)</a></li>
<li><a href="#007-dockercompose-fragments-extends-syntax">Extends Syntax</a></li>
<li><a href="#007-dockercompose-fragments-when-to-use-extends">When to Use Extends</a></li>
<li><a href="#007-dockercompose-fragments-real-world-examples">Real-World Examples</a></li>
<li><a href="#007-dockercompose-fragments-example-1-microservices-architecture">Example 1: Microservices Architecture</a></li>
<li><a href="#007-dockercompose-fragments-example-2-multi-environment-setup">Example 2: Multi-Environment Setup</a></li>
<li><a href="#007-dockercompose-fragments-example-3-modular-configuration">Example 3: Modular Configuration</a></li>
<li><a href="#007-dockercompose-fragments-best-practices">Best Practices</a></li>
<li><a href="#007-dockercompose-fragments-common-patterns">Common Patterns</a></li>
<li><a href="#007-dockercompose-fragments-pattern-1-base-service-template">Pattern 1: Base Service Template</a></li>
<li><a href="#007-dockercompose-fragments-pattern-2-environment-overrides">Pattern 2: Environment Overrides</a></li>
<li><a href="#007-dockercompose-fragments-pattern-3-multi-container-application">Pattern 3: Multi-Container Application</a></li>
<li><a href="#007-dockercompose-fragments-troubleshooting">Troubleshooting</a></li>
<li><a href="#007-dockercompose-fragments-common-issues-and-solutions">Common Issues and Solutions</a></li>
<li><a href="#007-dockercompose-fragments-debugging-commands">Debugging Commands</a></li>
<li><a href="#007-dockercompose-fragments-hands-on-exercises">Hands-On Exercises</a></li>
<li><a href="#007-dockercompose-fragments-exercise-1-create-a-microservices-setup">Exercise 1: Create a Microservices Setup</a></li>
<li><a href="#007-dockercompose-fragments-exercise-2-multi-environment-configuration">Exercise 2: Multi-Environment Configuration</a></li>
<li><a href="#007-dockercompose-fragments-exercise-3-modular-infrastructure">Exercise 3: Modular Infrastructure</a></li>
<li><a href="#007-dockercompose-fragments-useful-commands">Useful Commands</a></li>
</ul>
<hr />
<h2 id="007-dockercompose-fragments-overview">Overview<a class="headerlink" href="#007-dockercompose-fragments-overview" title="Permanent link">&para;</a></h2>
<p>As Docker Compose configurations grow, managing multiple services with similar configurations becomes challenging. This lab teaches you advanced composition techniques to:</p>
<ul>
<li><strong>Reduce duplication</strong> using YAML anchors and fragments</li>
<li><strong>Modularize configurations</strong> with includes</li>
<li><strong>Share common settings</strong> across services</li>
<li><strong>Manage multi-environment setups</strong> efficiently</li>
<li><strong>Create reusable templates</strong> for services</li>
</ul>
<h2 id="007-dockercompose-fragments-prerequisites">Prerequisites<a class="headerlink" href="#007-dockercompose-fragments-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Docker installed (version 20.10+)</li>
<li>Docker Compose V2 (docker compose, not docker-compose)</li>
<li>Basic understanding of YAML syntax</li>
<li>Familiarity with basic Docker Compose concepts</li>
</ul>
<p>Verify your setup:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#007-dockercompose-fragments-__codelineno-0-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>version
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#007-dockercompose-fragments-__codelineno-0-2"></a><span class="c1"># Should show: Docker Compose version v2.x.x or higher</span>
</span></code></pre></div>
<hr />
<h2 id="007-dockercompose-fragments-yaml-anchors-and-aliases">YAML Anchors and Aliases<a class="headerlink" href="#007-dockercompose-fragments-yaml-anchors-and-aliases" title="Permanent link">&para;</a></h2>
<p>YAML anchors (<code>&amp;</code>) and aliases (<code>*</code>) allow you to define reusable configuration blocks within a single YAML file.</p>
<h3 id="007-dockercompose-fragments-basic-anchors">Basic Anchors<a class="headerlink" href="#007-dockercompose-fragments-basic-anchors" title="Permanent link">&para;</a></h3>
<p><strong>Syntax:</strong></p>
<ul>
<li><code>&amp;anchor-name</code> - Define an anchor</li>
<li><code>*anchor-name</code> - Reference an anchor</li>
<li><code>&lt;&lt;: *anchor-name</code> - Merge an anchor</li>
</ul>
<p><strong>Simple Example:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#007-dockercompose-fragments-__codelineno-1-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#007-dockercompose-fragments-__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#007-dockercompose-fragments-__codelineno-1-3"></a><span class="c1"># Define a logging configuration anchor</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#007-dockercompose-fragments-__codelineno-1-4"></a><span class="nt">x-logging</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;default-logging</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#007-dockercompose-fragments-__codelineno-1-5"></a><span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#007-dockercompose-fragments-__codelineno-1-6"></a><span class="w">  </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#007-dockercompose-fragments-__codelineno-1-7"></a><span class="w">    </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#007-dockercompose-fragments-__codelineno-1-8"></a><span class="w">    </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#007-dockercompose-fragments-__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#007-dockercompose-fragments-__codelineno-1-10"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#007-dockercompose-fragments-__codelineno-1-11"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#007-dockercompose-fragments-__codelineno-1-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#007-dockercompose-fragments-__codelineno-1-13"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-logging</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#007-dockercompose-fragments-__codelineno-1-14"></a>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#007-dockercompose-fragments-__codelineno-1-15"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#007-dockercompose-fragments-__codelineno-1-16"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#007-dockercompose-fragments-__codelineno-1-17"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-logging</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#007-dockercompose-fragments-__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#007-dockercompose-fragments-__codelineno-1-19"></a><span class="w">  </span><span class="nt">worker</span><span class="p">:</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#007-dockercompose-fragments-__codelineno-1-20"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:3.11-alpine</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#007-dockercompose-fragments-__codelineno-1-21"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-logging</span>
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-extension-fields">Extension Fields<a class="headerlink" href="#007-dockercompose-fragments-extension-fields" title="Permanent link">&para;</a></h3>
<p>Extension fields start with <code>x-</code> and are ignored by Docker Compose but can be used as anchors. This keeps your configuration organized.</p>
<p><strong>Complete Service Template:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#007-dockercompose-fragments-__codelineno-2-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#007-dockercompose-fragments-__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#007-dockercompose-fragments-__codelineno-2-3"></a><span class="c1"># Extension fields - ignored by Docker Compose</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#007-dockercompose-fragments-__codelineno-2-4"></a><span class="nt">x-common-variables</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-vars</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#007-dockercompose-fragments-__codelineno-2-5"></a><span class="w">  </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#007-dockercompose-fragments-__codelineno-2-6"></a><span class="w">  </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${LOG_LEVEL:-info}</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#007-dockercompose-fragments-__codelineno-2-7"></a><span class="w">  </span><span class="nt">ENVIRONMENT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${ENVIRONMENT:-production}</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#007-dockercompose-fragments-__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#007-dockercompose-fragments-__codelineno-2-9"></a><span class="nt">x-restart-policy</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;restart-policy</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#007-dockercompose-fragments-__codelineno-2-10"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#007-dockercompose-fragments-__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#007-dockercompose-fragments-__codelineno-2-12"></a><span class="nt">x-healthcheck-defaults</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;healthcheck-defaults</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#007-dockercompose-fragments-__codelineno-2-13"></a><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#007-dockercompose-fragments-__codelineno-2-14"></a><span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#007-dockercompose-fragments-__codelineno-2-15"></a><span class="w">  </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#007-dockercompose-fragments-__codelineno-2-16"></a><span class="w">  </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40s</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#007-dockercompose-fragments-__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#007-dockercompose-fragments-__codelineno-2-18"></a><span class="nt">x-resource-limits</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;resource-limits</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#007-dockercompose-fragments-__codelineno-2-19"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#007-dockercompose-fragments-__codelineno-2-20"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#007-dockercompose-fragments-__codelineno-2-21"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#007-dockercompose-fragments-__codelineno-2-22"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#007-dockercompose-fragments-__codelineno-2-23"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#007-dockercompose-fragments-__codelineno-2-24"></a><span class="w">      </span><span class="nt">reservations</span><span class="p">:</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#007-dockercompose-fragments-__codelineno-2-25"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#007-dockercompose-fragments-__codelineno-2-26"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#007-dockercompose-fragments-__codelineno-2-27"></a>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#007-dockercompose-fragments-__codelineno-2-28"></a><span class="nt">x-logging-config</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;logging-config</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#007-dockercompose-fragments-__codelineno-2-29"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#007-dockercompose-fragments-__codelineno-2-30"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#007-dockercompose-fragments-__codelineno-2-31"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#007-dockercompose-fragments-__codelineno-2-32"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#007-dockercompose-fragments-__codelineno-2-33"></a><span class="w">      </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#007-dockercompose-fragments-__codelineno-2-34"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;service&quot;</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#007-dockercompose-fragments-__codelineno-2-35"></a>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#007-dockercompose-fragments-__codelineno-2-36"></a><span class="c1"># Actual services using the fragments</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#007-dockercompose-fragments-__codelineno-2-37"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#007-dockercompose-fragments-__codelineno-2-38"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#007-dockercompose-fragments-__codelineno-2-39"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-2-40"><a id="__codelineno-2-40" name="__codelineno-2-40" href="#007-dockercompose-fragments-__codelineno-2-40"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*restart-policy</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*logging-config</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*resource-limits</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-41"><a id="__codelineno-2-41" name="__codelineno-2-41" href="#007-dockercompose-fragments-__codelineno-2-41"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-2-42"><a id="__codelineno-2-42" name="__codelineno-2-42" href="#007-dockercompose-fragments-__codelineno-2-42"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-vars</span>
</span><span id="__span-2-43"><a id="__codelineno-2-43" name="__codelineno-2-43" href="#007-dockercompose-fragments-__codelineno-2-43"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-2-44"><a id="__codelineno-2-44" name="__codelineno-2-44" href="#007-dockercompose-fragments-__codelineno-2-44"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-2-45"><a id="__codelineno-2-45" name="__codelineno-2-45" href="#007-dockercompose-fragments-__codelineno-2-45"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*healthcheck-defaults</span>
</span><span id="__span-2-46"><a id="__codelineno-2-46" name="__codelineno-2-46" href="#007-dockercompose-fragments-__codelineno-2-46"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-47"><a id="__codelineno-2-47" name="__codelineno-2-47" href="#007-dockercompose-fragments-__codelineno-2-47"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-2-48"><a id="__codelineno-2-48" name="__codelineno-2-48" href="#007-dockercompose-fragments-__codelineno-2-48"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
</span><span id="__span-2-49"><a id="__codelineno-2-49" name="__codelineno-2-49" href="#007-dockercompose-fragments-__codelineno-2-49"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-2-50"><a id="__codelineno-2-50" name="__codelineno-2-50" href="#007-dockercompose-fragments-__codelineno-2-50"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-2-51"><a id="__codelineno-2-51" name="__codelineno-2-51" href="#007-dockercompose-fragments-__codelineno-2-51"></a>
</span><span id="__span-2-52"><a id="__codelineno-2-52" name="__codelineno-2-52" href="#007-dockercompose-fragments-__codelineno-2-52"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-2-53"><a id="__codelineno-2-53" name="__codelineno-2-53" href="#007-dockercompose-fragments-__codelineno-2-53"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-2-54"><a id="__codelineno-2-54" name="__codelineno-2-54" href="#007-dockercompose-fragments-__codelineno-2-54"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*restart-policy</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*logging-config</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*resource-limits</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-55"><a id="__codelineno-2-55" name="__codelineno-2-55" href="#007-dockercompose-fragments-__codelineno-2-55"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-2-56"><a id="__codelineno-2-56" name="__codelineno-2-56" href="#007-dockercompose-fragments-__codelineno-2-56"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-vars</span>
</span><span id="__span-2-57"><a id="__codelineno-2-57" name="__codelineno-2-57" href="#007-dockercompose-fragments-__codelineno-2-57"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-2-58"><a id="__codelineno-2-58" name="__codelineno-2-58" href="#007-dockercompose-fragments-__codelineno-2-58"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-2-59"><a id="__codelineno-2-59" name="__codelineno-2-59" href="#007-dockercompose-fragments-__codelineno-2-59"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*healthcheck-defaults</span>
</span><span id="__span-2-60"><a id="__codelineno-2-60" name="__codelineno-2-60" href="#007-dockercompose-fragments-__codelineno-2-60"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-q&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-O&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:3000/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-2-61"><a id="__codelineno-2-61" name="__codelineno-2-61" href="#007-dockercompose-fragments-__codelineno-2-61"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-2-62"><a id="__codelineno-2-62" name="__codelineno-2-62" href="#007-dockercompose-fragments-__codelineno-2-62"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-2-63"><a id="__codelineno-2-63" name="__codelineno-2-63" href="#007-dockercompose-fragments-__codelineno-2-63"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-2-64"><a id="__codelineno-2-64" name="__codelineno-2-64" href="#007-dockercompose-fragments-__codelineno-2-64"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-2-65"><a id="__codelineno-2-65" name="__codelineno-2-65" href="#007-dockercompose-fragments-__codelineno-2-65"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-2-66"><a id="__codelineno-2-66" name="__codelineno-2-66" href="#007-dockercompose-fragments-__codelineno-2-66"></a>
</span><span id="__span-2-67"><a id="__codelineno-2-67" name="__codelineno-2-67" href="#007-dockercompose-fragments-__codelineno-2-67"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-2-68"><a id="__codelineno-2-68" name="__codelineno-2-68" href="#007-dockercompose-fragments-__codelineno-2-68"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-2-69"><a id="__codelineno-2-69" name="__codelineno-2-69" href="#007-dockercompose-fragments-__codelineno-2-69"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-merge-keys">Merge Keys<a class="headerlink" href="#007-dockercompose-fragments-merge-keys" title="Permanent link">&para;</a></h3>
<p>The merge key (<code>&lt;&lt;:</code>) allows combining multiple anchors:</p>
<p><strong>Multiple Anchor Merging:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#007-dockercompose-fragments-__codelineno-3-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#007-dockercompose-fragments-__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#007-dockercompose-fragments-__codelineno-3-3"></a><span class="c1"># Define separate configuration aspects</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#007-dockercompose-fragments-__codelineno-3-4"></a><span class="nt">x-base-config</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;base-config</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#007-dockercompose-fragments-__codelineno-3-5"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#007-dockercompose-fragments-__codelineno-3-6"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#007-dockercompose-fragments-__codelineno-3-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#007-dockercompose-fragments-__codelineno-3-8"></a>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#007-dockercompose-fragments-__codelineno-3-9"></a><span class="nt">x-monitoring</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;monitoring</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#007-dockercompose-fragments-__codelineno-3-10"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#007-dockercompose-fragments-__codelineno-3-11"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;prometheus.scrape=true&quot;</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#007-dockercompose-fragments-__codelineno-3-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;prometheus.port=9090&quot;</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#007-dockercompose-fragments-__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#007-dockercompose-fragments-__codelineno-3-14"></a><span class="nt">x-security</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;security</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#007-dockercompose-fragments-__codelineno-3-15"></a><span class="w">  </span><span class="nt">security_opt</span><span class="p">:</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#007-dockercompose-fragments-__codelineno-3-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no-new-privileges:true</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#007-dockercompose-fragments-__codelineno-3-17"></a><span class="w">  </span><span class="nt">read_only</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#007-dockercompose-fragments-__codelineno-3-18"></a>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#007-dockercompose-fragments-__codelineno-3-19"></a><span class="nt">x-node-service</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;node-service</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#007-dockercompose-fragments-__codelineno-3-20"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#007-dockercompose-fragments-__codelineno-3-21"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#007-dockercompose-fragments-__codelineno-3-22"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;node&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--version&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#007-dockercompose-fragments-__codelineno-3-23"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#007-dockercompose-fragments-__codelineno-3-24"></a>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#007-dockercompose-fragments-__codelineno-3-25"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#007-dockercompose-fragments-__codelineno-3-26"></a><span class="w">  </span><span class="c1"># Merge multiple fragments</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#007-dockercompose-fragments-__codelineno-3-27"></a><span class="w">  </span><span class="nt">user-service</span><span class="p">:</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#007-dockercompose-fragments-__codelineno-3-28"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*base-config</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*monitoring</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*security</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*node-service</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#007-dockercompose-fragments-__codelineno-3-29"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-service</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#007-dockercompose-fragments-__codelineno-3-30"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#007-dockercompose-fragments-__codelineno-3-31"></a><span class="w">      </span><span class="nt">SERVICE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">users</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#007-dockercompose-fragments-__codelineno-3-32"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#007-dockercompose-fragments-__codelineno-3-33"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3001:3000&quot;</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#007-dockercompose-fragments-__codelineno-3-34"></a>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#007-dockercompose-fragments-__codelineno-3-35"></a><span class="w">  </span><span class="nt">order-service</span><span class="p">:</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#007-dockercompose-fragments-__codelineno-3-36"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*base-config</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*monitoring</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*security</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*node-service</span><span class="p p-Indicator">]</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#007-dockercompose-fragments-__codelineno-3-37"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">order-service</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#007-dockercompose-fragments-__codelineno-3-38"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#007-dockercompose-fragments-__codelineno-3-39"></a><span class="w">      </span><span class="nt">SERVICE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">orders</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#007-dockercompose-fragments-__codelineno-3-40"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#007-dockercompose-fragments-__codelineno-3-41"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3002:3000&quot;</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#007-dockercompose-fragments-__codelineno-3-42"></a>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#007-dockercompose-fragments-__codelineno-3-43"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#007-dockercompose-fragments-__codelineno-3-44"></a><span class="w">  </span><span class="nt">app-network</span><span class="p">:</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#007-dockercompose-fragments-__codelineno-3-45"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span></code></pre></div>
<hr />
<h2 id="007-dockercompose-fragments-docker-compose-include">Docker Compose Include<a class="headerlink" href="#007-dockercompose-fragments-docker-compose-include" title="Permanent link">&para;</a></h2>
<p>The <code>include</code> directive (Compose V2.20+) allows you to split your configuration across multiple files and combine them at runtime.</p>
<h3 id="007-dockercompose-fragments-basic-include-syntax">Basic Include Syntax<a class="headerlink" href="#007-dockercompose-fragments-basic-include-syntax" title="Permanent link">&para;</a></h3>
<p><strong>Main compose file (<code>docker-compose.yml</code>):</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#007-dockercompose-fragments-__codelineno-4-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#007-dockercompose-fragments-__codelineno-4-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose-services.yml</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#007-dockercompose-fragments-__codelineno-4-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose-networks.yml</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#007-dockercompose-fragments-__codelineno-4-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose-volumes.yml</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#007-dockercompose-fragments-__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#007-dockercompose-fragments-__codelineno-4-6"></a><span class="c1"># You can still define additional services here</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#007-dockercompose-fragments-__codelineno-4-7"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#007-dockercompose-fragments-__codelineno-4-8"></a><span class="w">  </span><span class="nt">gateway</span><span class="p">:</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#007-dockercompose-fragments-__codelineno-4-9"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#007-dockercompose-fragments-__codelineno-4-10"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#007-dockercompose-fragments-__codelineno-4-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
</span></code></pre></div>
<p><strong>Separate service file (<code>compose-services.yml</code>):</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#007-dockercompose-fragments-__codelineno-5-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#007-dockercompose-fragments-__codelineno-5-2"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#007-dockercompose-fragments-__codelineno-5-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#007-dockercompose-fragments-__codelineno-5-4"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#007-dockercompose-fragments-__codelineno-5-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#007-dockercompose-fragments-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#007-dockercompose-fragments-__codelineno-5-7"></a><span class="w">  </span><span class="nt">worker</span><span class="p">:</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#007-dockercompose-fragments-__codelineno-5-8"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:3.11-alpine</span>
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-include-with-path">Include with Path<a class="headerlink" href="#007-dockercompose-fragments-include-with-path" title="Permanent link">&para;</a></h3>
<p>You can organize includes in subdirectories:</p>
<p><strong>Project Structure:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#007-dockercompose-fragments-__codelineno-6-1"></a>project/
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#007-dockercompose-fragments-__codelineno-6-2"></a>‚îú‚îÄ‚îÄ docker-compose.yml
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#007-dockercompose-fragments-__codelineno-6-3"></a>‚îú‚îÄ‚îÄ compose/
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#007-dockercompose-fragments-__codelineno-6-4"></a>‚îÇ   ‚îú‚îÄ‚îÄ databases.yml
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#007-dockercompose-fragments-__codelineno-6-5"></a>‚îÇ   ‚îú‚îÄ‚îÄ services.yml
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#007-dockercompose-fragments-__codelineno-6-6"></a>‚îÇ   ‚îú‚îÄ‚îÄ monitoring.yml
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#007-dockercompose-fragments-__codelineno-6-7"></a>‚îÇ   ‚îî‚îÄ‚îÄ dev/
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#007-dockercompose-fragments-__codelineno-6-8"></a>‚îÇ       ‚îú‚îÄ‚îÄ overrides.yml
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#007-dockercompose-fragments-__codelineno-6-9"></a>‚îÇ       ‚îî‚îÄ‚îÄ debug.yml
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#007-dockercompose-fragments-__codelineno-6-10"></a>‚îî‚îÄ‚îÄ .env
</span></code></pre></div>
<p><strong>docker-compose.yml:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#007-dockercompose-fragments-__codelineno-7-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#007-dockercompose-fragments-__codelineno-7-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose/databases.yml</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#007-dockercompose-fragments-__codelineno-7-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose/services.yml</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#007-dockercompose-fragments-__codelineno-7-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose/monitoring.yml</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#007-dockercompose-fragments-__codelineno-7-5"></a><span class="w">  </span><span class="c1"># Conditional includes based on environment</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#007-dockercompose-fragments-__codelineno-7-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./compose/dev/overrides.yml</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#007-dockercompose-fragments-__codelineno-7-7"></a><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env.dev</span>
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-include-best-practices">Include Best Practices<a class="headerlink" href="#007-dockercompose-fragments-include-best-practices" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Logical Separation:</strong></li>
</ol>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#007-dockercompose-fragments-__codelineno-8-1"></a><span class="c1"># docker-compose.yml - Main orchestration</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#007-dockercompose-fragments-__codelineno-8-2"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#007-dockercompose-fragments-__codelineno-8-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/databases.yml</span><span class="w">      </span><span class="c1"># All database services</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#007-dockercompose-fragments-__codelineno-8-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/cache.yml</span><span class="w">          </span><span class="c1"># Redis, Memcached, etc.</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#007-dockercompose-fragments-__codelineno-8-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/queues.yml</span><span class="w">         </span><span class="c1"># RabbitMQ, Kafka, etc.</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#007-dockercompose-fragments-__codelineno-8-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./application/backend-services.yml</span><span class="w">  </span><span class="c1"># Backend microservices</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#007-dockercompose-fragments-__codelineno-8-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./application/frontend-services.yml</span><span class="w"> </span><span class="c1"># Frontend services</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#007-dockercompose-fragments-__codelineno-8-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/observability.yml</span><span class="w">      </span><span class="c1"># Prometheus, Grafana, etc.</span>
</span></code></pre></div>
<ol>
<li><strong>Environment-Specific Includes:</strong></li>
</ol>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#007-dockercompose-fragments-__codelineno-9-1"></a><span class="c1"># docker-compose.yml</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#007-dockercompose-fragments-__codelineno-9-2"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#007-dockercompose-fragments-__codelineno-9-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./base/services.yml</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#007-dockercompose-fragments-__codelineno-9-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./envs/${ENVIRONMENT:-dev}.yml</span>
</span></code></pre></div>
<ol>
<li><strong>Shared Fragments Across Includes:</strong></li>
</ol>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#007-dockercompose-fragments-__codelineno-10-1"></a><span class="c1"># shared/fragments.yml</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#007-dockercompose-fragments-__codelineno-10-2"></a><span class="nt">x-logging</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;default-logging</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#007-dockercompose-fragments-__codelineno-10-3"></a><span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#007-dockercompose-fragments-__codelineno-10-4"></a><span class="w">  </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#007-dockercompose-fragments-__codelineno-10-5"></a><span class="w">    </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#007-dockercompose-fragments-__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#007-dockercompose-fragments-__codelineno-10-7"></a><span class="c1"># services/api.yml</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#007-dockercompose-fragments-__codelineno-10-8"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#007-dockercompose-fragments-__codelineno-10-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../shared/fragments.yml</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#007-dockercompose-fragments-__codelineno-10-10"></a>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#007-dockercompose-fragments-__codelineno-10-11"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#007-dockercompose-fragments-__codelineno-10-12"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#007-dockercompose-fragments-__codelineno-10-13"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#007-dockercompose-fragments-__codelineno-10-14"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nv">*default-logging</span>
</span></code></pre></div>
<hr />
<h2 id="007-dockercompose-fragments-docker-compose-extends-legacy">Docker Compose Extends (Legacy)<a class="headerlink" href="#007-dockercompose-fragments-docker-compose-extends-legacy" title="Permanent link">&para;</a></h2>
<blockquote>
<p><strong>Note:</strong> The <code>extends</code> keyword is considered legacy. Modern Docker Compose recommends using <code>include</code> and YAML anchors instead. However, it&rsquo;s still supported for backward compatibility.</p>
</blockquote>
<h3 id="007-dockercompose-fragments-extends-syntax">Extends Syntax<a class="headerlink" href="#007-dockercompose-fragments-extends-syntax" title="Permanent link">&para;</a></h3>
<p><strong>Base service file (<code>common.yml</code>):</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#007-dockercompose-fragments-__codelineno-11-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#007-dockercompose-fragments-__codelineno-11-2"></a><span class="w">  </span><span class="nt">base-service</span><span class="p">:</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#007-dockercompose-fragments-__codelineno-11-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#007-dockercompose-fragments-__codelineno-11-4"></a><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#007-dockercompose-fragments-__codelineno-11-5"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#007-dockercompose-fragments-__codelineno-11-6"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#007-dockercompose-fragments-__codelineno-11-7"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#007-dockercompose-fragments-__codelineno-11-8"></a><span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span></code></pre></div>
<p><strong>Main compose file:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#007-dockercompose-fragments-__codelineno-12-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#007-dockercompose-fragments-__codelineno-12-2"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#007-dockercompose-fragments-__codelineno-12-3"></a><span class="w">    </span><span class="nt">extends</span><span class="p">:</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#007-dockercompose-fragments-__codelineno-12-4"></a><span class="w">      </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common.yml</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#007-dockercompose-fragments-__codelineno-12-5"></a><span class="w">      </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">base-service</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#007-dockercompose-fragments-__codelineno-12-6"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-service</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#007-dockercompose-fragments-__codelineno-12-7"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#007-dockercompose-fragments-__codelineno-12-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#007-dockercompose-fragments-__codelineno-12-9"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#007-dockercompose-fragments-__codelineno-12-10"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-when-to-use-extends">When to Use Extends<a class="headerlink" href="#007-dockercompose-fragments-when-to-use-extends" title="Permanent link">&para;</a></h3>
<p>Use <code>extends</code> when:</p>
<ul>
<li>Working with legacy Compose files</li>
<li>Sharing configuration between different Compose files</li>
<li>Need to override specific service configurations</li>
</ul>
<p><strong>Prefer <code>include</code> and YAML anchors</strong> for new projects as they provide:</p>
<ul>
<li>Better performance</li>
<li>Clearer composition</li>
<li>More flexibility</li>
<li>Better tooling support</li>
</ul>
<hr />
<h2 id="007-dockercompose-fragments-real-world-examples">Real-World Examples<a class="headerlink" href="#007-dockercompose-fragments-real-world-examples" title="Permanent link">&para;</a></h2>
<h3 id="007-dockercompose-fragments-example-1-microservices-architecture">Example 1: Microservices Architecture<a class="headerlink" href="#007-dockercompose-fragments-example-1-microservices-architecture" title="Permanent link">&para;</a></h3>
<p><strong>File Structure:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#007-dockercompose-fragments-__codelineno-13-1"></a>microservices/
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#007-dockercompose-fragments-__codelineno-13-2"></a>‚îú‚îÄ‚îÄ docker-compose.yml
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#007-dockercompose-fragments-__codelineno-13-3"></a>‚îú‚îÄ‚îÄ fragments/
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#007-dockercompose-fragments-__codelineno-13-4"></a>‚îÇ   ‚îî‚îÄ‚îÄ common.yml
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#007-dockercompose-fragments-__codelineno-13-5"></a>‚îú‚îÄ‚îÄ infrastructure/
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#007-dockercompose-fragments-__codelineno-13-6"></a>‚îÇ   ‚îú‚îÄ‚îÄ databases.yml
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#007-dockercompose-fragments-__codelineno-13-7"></a>‚îÇ   ‚îú‚îÄ‚îÄ cache.yml
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#007-dockercompose-fragments-__codelineno-13-8"></a>‚îÇ   ‚îî‚îÄ‚îÄ messaging.yml
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#007-dockercompose-fragments-__codelineno-13-9"></a>‚îî‚îÄ‚îÄ services/
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#007-dockercompose-fragments-__codelineno-13-10"></a>    ‚îú‚îÄ‚îÄ user-service.yml
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#007-dockercompose-fragments-__codelineno-13-11"></a>    ‚îú‚îÄ‚îÄ order-service.yml
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#007-dockercompose-fragments-__codelineno-13-12"></a>    ‚îî‚îÄ‚îÄ payment-service.yml
</span></code></pre></div>
<p><strong>fragments/common.yml:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#007-dockercompose-fragments-__codelineno-14-1"></a><span class="c1"># Common configurations as extension fields</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#007-dockercompose-fragments-__codelineno-14-2"></a><span class="nt">x-service-defaults</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;service-defaults</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#007-dockercompose-fragments-__codelineno-14-3"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#007-dockercompose-fragments-__codelineno-14-4"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#007-dockercompose-fragments-__codelineno-14-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">microservices</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#007-dockercompose-fragments-__codelineno-14-6"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;logging</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#007-dockercompose-fragments-__codelineno-14-7"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#007-dockercompose-fragments-__codelineno-14-8"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#007-dockercompose-fragments-__codelineno-14-9"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#007-dockercompose-fragments-__codelineno-14-10"></a><span class="w">      </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#007-dockercompose-fragments-__codelineno-14-11"></a>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#007-dockercompose-fragments-__codelineno-14-12"></a><span class="nt">x-healthcheck</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;healthcheck</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#007-dockercompose-fragments-__codelineno-14-13"></a><span class="w">  </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#007-dockercompose-fragments-__codelineno-14-14"></a><span class="w">  </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#007-dockercompose-fragments-__codelineno-14-15"></a><span class="w">  </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#007-dockercompose-fragments-__codelineno-14-16"></a><span class="w">  </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40s</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#007-dockercompose-fragments-__codelineno-14-17"></a>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#007-dockercompose-fragments-__codelineno-14-18"></a><span class="nt">x-node-service</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;node-service</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#007-dockercompose-fragments-__codelineno-14-19"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-defaults</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#007-dockercompose-fragments-__codelineno-14-20"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#007-dockercompose-fragments-__codelineno-14-21"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#007-dockercompose-fragments-__codelineno-14-22"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*healthcheck</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#007-dockercompose-fragments-__codelineno-14-23"></a>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#007-dockercompose-fragments-__codelineno-14-24"></a><span class="nt">x-environment-common</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;env-common</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#007-dockercompose-fragments-__codelineno-14-25"></a><span class="w">  </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${NODE_ENV:-production}</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#007-dockercompose-fragments-__codelineno-14-26"></a><span class="w">  </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${LOG_LEVEL:-info}</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#007-dockercompose-fragments-__codelineno-14-27"></a><span class="w">  </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis://cache:6379</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#007-dockercompose-fragments-__codelineno-14-28"></a><span class="w">  </span><span class="nt">DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span></code></pre></div>
<p><strong>infrastructure/databases.yml:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#007-dockercompose-fragments-__codelineno-15-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#007-dockercompose-fragments-__codelineno-15-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../fragments/common.yml</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#007-dockercompose-fragments-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#007-dockercompose-fragments-__codelineno-15-4"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#007-dockercompose-fragments-__codelineno-15-5"></a><span class="w">  </span><span class="nt">postgres</span><span class="p">:</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#007-dockercompose-fragments-__codelineno-15-6"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-defaults</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#007-dockercompose-fragments-__codelineno-15-7"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15-alpine</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#007-dockercompose-fragments-__codelineno-15-8"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#007-dockercompose-fragments-__codelineno-15-9"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_NAME:-appdb}</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#007-dockercompose-fragments-__codelineno-15-10"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_USER:-admin}</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#007-dockercompose-fragments-__codelineno-15-11"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#007-dockercompose-fragments-__codelineno-15-12"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#007-dockercompose-fragments-__codelineno-15-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-data:/var/lib/postgresql/data</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#007-dockercompose-fragments-__codelineno-15-14"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#007-dockercompose-fragments-__codelineno-15-15"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">${DB_USER:-admin}&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#007-dockercompose-fragments-__codelineno-15-16"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*healthcheck</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#007-dockercompose-fragments-__codelineno-15-17"></a>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#007-dockercompose-fragments-__codelineno-15-18"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#007-dockercompose-fragments-__codelineno-15-19"></a><span class="w">  </span><span class="nt">postgres-data</span><span class="p">:</span>
</span></code></pre></div>
<p><strong>services/user-service.yml:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#007-dockercompose-fragments-__codelineno-16-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#007-dockercompose-fragments-__codelineno-16-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../fragments/common.yml</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#007-dockercompose-fragments-__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#007-dockercompose-fragments-__codelineno-16-4"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#007-dockercompose-fragments-__codelineno-16-5"></a><span class="w">  </span><span class="nt">user-service</span><span class="p">:</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#007-dockercompose-fragments-__codelineno-16-6"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*node-service</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#007-dockercompose-fragments-__codelineno-16-7"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#007-dockercompose-fragments-__codelineno-16-8"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./user-service</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#007-dockercompose-fragments-__codelineno-16-9"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#007-dockercompose-fragments-__codelineno-16-10"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#007-dockercompose-fragments-__codelineno-16-11"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*env-common</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#007-dockercompose-fragments-__codelineno-16-12"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user-service</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#007-dockercompose-fragments-__codelineno-16-13"></a><span class="w">      </span><span class="nt">PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3001</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#007-dockercompose-fragments-__codelineno-16-14"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#007-dockercompose-fragments-__codelineno-16-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3001:3001&quot;</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#007-dockercompose-fragments-__codelineno-16-16"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#007-dockercompose-fragments-__codelineno-16-17"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-q&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-O&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:3001/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#007-dockercompose-fragments-__codelineno-16-18"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*healthcheck</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#007-dockercompose-fragments-__codelineno-16-19"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#007-dockercompose-fragments-__codelineno-16-20"></a><span class="w">      </span><span class="nt">postgres</span><span class="p">:</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#007-dockercompose-fragments-__codelineno-16-21"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span></code></pre></div>
<p><strong>docker-compose.yml (Main):</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#007-dockercompose-fragments-__codelineno-17-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#007-dockercompose-fragments-__codelineno-17-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/databases.yml</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#007-dockercompose-fragments-__codelineno-17-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/cache.yml</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#007-dockercompose-fragments-__codelineno-17-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/messaging.yml</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#007-dockercompose-fragments-__codelineno-17-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./services/user-service.yml</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#007-dockercompose-fragments-__codelineno-17-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./services/order-service.yml</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#007-dockercompose-fragments-__codelineno-17-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./services/payment-service.yml</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#007-dockercompose-fragments-__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#007-dockercompose-fragments-__codelineno-17-9"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#007-dockercompose-fragments-__codelineno-17-10"></a><span class="w">  </span><span class="nt">microservices</span><span class="p">:</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#007-dockercompose-fragments-__codelineno-17-11"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-example-2-multi-environment-setup">Example 2: Multi-Environment Setup<a class="headerlink" href="#007-dockercompose-fragments-example-2-multi-environment-setup" title="Permanent link">&para;</a></h3>
<p><strong>Structure:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#007-dockercompose-fragments-__codelineno-18-1"></a>project/
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#007-dockercompose-fragments-__codelineno-18-2"></a>‚îú‚îÄ‚îÄ docker-compose.yml
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#007-dockercompose-fragments-__codelineno-18-3"></a>‚îú‚îÄ‚îÄ compose/
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#007-dockercompose-fragments-__codelineno-18-4"></a>‚îÇ   ‚îú‚îÄ‚îÄ base.yml
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#007-dockercompose-fragments-__codelineno-18-5"></a>‚îÇ   ‚îú‚îÄ‚îÄ fragments.yml
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#007-dockercompose-fragments-__codelineno-18-6"></a>‚îÇ   ‚îú‚îÄ‚îÄ dev.yml
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#007-dockercompose-fragments-__codelineno-18-7"></a>‚îÇ   ‚îî‚îÄ‚îÄ prod.yml
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#007-dockercompose-fragments-__codelineno-18-8"></a>‚îî‚îÄ‚îÄ .env
</span></code></pre></div>
<p><strong>compose/fragments.yml:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#007-dockercompose-fragments-__codelineno-19-1"></a><span class="nt">x-app-base</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;app-base</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#007-dockercompose-fragments-__codelineno-19-2"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#007-dockercompose-fragments-__codelineno-19-3"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#007-dockercompose-fragments-__codelineno-19-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-net</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#007-dockercompose-fragments-__codelineno-19-5"></a>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#007-dockercompose-fragments-__codelineno-19-6"></a><span class="nt">x-dev-settings</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;dev-settings</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#007-dockercompose-fragments-__codelineno-19-7"></a><span class="w">  </span><span class="nt">build</span><span class="p">:</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#007-dockercompose-fragments-__codelineno-19-8"></a><span class="w">    </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#007-dockercompose-fragments-__codelineno-19-9"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#007-dockercompose-fragments-__codelineno-19-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src:/app/src:rw</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#007-dockercompose-fragments-__codelineno-19-11"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#007-dockercompose-fragments-__codelineno-19-12"></a><span class="w">    </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#007-dockercompose-fragments-__codelineno-19-13"></a><span class="w">    </span><span class="nt">DEBUG</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*&quot;</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#007-dockercompose-fragments-__codelineno-19-14"></a>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#007-dockercompose-fragments-__codelineno-19-15"></a><span class="nt">x-prod-settings</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;prod-settings</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#007-dockercompose-fragments-__codelineno-19-16"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${REGISTRY}/app:${VERSION}</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#007-dockercompose-fragments-__codelineno-19-17"></a><span class="w">  </span><span class="nt">read_only</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#007-dockercompose-fragments-__codelineno-19-18"></a><span class="w">  </span><span class="nt">security_opt</span><span class="p">:</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#007-dockercompose-fragments-__codelineno-19-19"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no-new-privileges:true</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#007-dockercompose-fragments-__codelineno-19-20"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#007-dockercompose-fragments-__codelineno-19-21"></a><span class="w">    </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span></code></pre></div>
<p><strong>compose/dev.yml:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#007-dockercompose-fragments-__codelineno-20-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#007-dockercompose-fragments-__codelineno-20-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./fragments.yml</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#007-dockercompose-fragments-__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#007-dockercompose-fragments-__codelineno-20-4"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#007-dockercompose-fragments-__codelineno-20-5"></a><span class="w">  </span><span class="nt">app-dev</span><span class="p">:</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#007-dockercompose-fragments-__codelineno-20-6"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*app-base</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*dev-settings</span><span class="p p-Indicator">]</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#007-dockercompose-fragments-__codelineno-20-7"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-dev</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#007-dockercompose-fragments-__codelineno-20-8"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#007-dockercompose-fragments-__codelineno-20-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3001:3000&quot;</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#007-dockercompose-fragments-__codelineno-20-10"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run dev</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#007-dockercompose-fragments-__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#007-dockercompose-fragments-__codelineno-20-12"></a><span class="w">  </span><span class="c1"># Development tools</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#007-dockercompose-fragments-__codelineno-20-13"></a><span class="w">  </span><span class="nt">adminer</span><span class="p">:</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#007-dockercompose-fragments-__codelineno-20-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">adminer:latest</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#007-dockercompose-fragments-__codelineno-20-15"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#007-dockercompose-fragments-__codelineno-20-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#007-dockercompose-fragments-__codelineno-20-17"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#007-dockercompose-fragments-__codelineno-20-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-net</span>
</span></code></pre></div>
<p><strong>compose/prod.yml:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#007-dockercompose-fragments-__codelineno-21-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#007-dockercompose-fragments-__codelineno-21-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./fragments.yml</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#007-dockercompose-fragments-__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#007-dockercompose-fragments-__codelineno-21-4"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#007-dockercompose-fragments-__codelineno-21-5"></a><span class="w">  </span><span class="nt">app-prod</span><span class="p">:</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#007-dockercompose-fragments-__codelineno-21-6"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">*app-base</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">*prod-settings</span><span class="p p-Indicator">]</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#007-dockercompose-fragments-__codelineno-21-7"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#007-dockercompose-fragments-__codelineno-21-8"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#007-dockercompose-fragments-__codelineno-21-9"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#007-dockercompose-fragments-__codelineno-21-10"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#007-dockercompose-fragments-__codelineno-21-11"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#007-dockercompose-fragments-__codelineno-21-12"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#007-dockercompose-fragments-__codelineno-21-13"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#007-dockercompose-fragments-__codelineno-21-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#007-dockercompose-fragments-__codelineno-21-15"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm start</span>
</span></code></pre></div>
<p><strong>docker-compose.yml:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#007-dockercompose-fragments-__codelineno-22-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#007-dockercompose-fragments-__codelineno-22-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compose/base.yml</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#007-dockercompose-fragments-__codelineno-22-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compose/${ENVIRONMENT:-dev}.yml</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#007-dockercompose-fragments-__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#007-dockercompose-fragments-__codelineno-22-5"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#007-dockercompose-fragments-__codelineno-22-6"></a><span class="w">  </span><span class="nt">app-net</span><span class="p">:</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#007-dockercompose-fragments-__codelineno-22-7"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span></code></pre></div>
<p><strong>Usage:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#007-dockercompose-fragments-__codelineno-23-1"></a><span class="c1"># Development</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#007-dockercompose-fragments-__codelineno-23-2"></a><span class="nv">ENVIRONMENT</span><span class="o">=</span>dev<span class="w"> </span>docker<span class="w"> </span>compose<span class="w"> </span>up
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#007-dockercompose-fragments-__codelineno-23-3"></a>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#007-dockercompose-fragments-__codelineno-23-4"></a><span class="c1"># Production</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#007-dockercompose-fragments-__codelineno-23-5"></a><span class="nv">ENVIRONMENT</span><span class="o">=</span>prod<span class="w"> </span>docker<span class="w"> </span>compose<span class="w"> </span>up
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-example-3-modular-configuration">Example 3: Modular Configuration<a class="headerlink" href="#007-dockercompose-fragments-example-3-modular-configuration" title="Permanent link">&para;</a></h3>
<p><strong>Complete modular setup with fragments and includes:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#007-dockercompose-fragments-__codelineno-24-1"></a><span class="c1"># docker-compose.yml</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#007-dockercompose-fragments-__codelineno-24-2"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#007-dockercompose-fragments-__codelineno-24-3"></a><span class="w">  </span><span class="c1"># Core infrastructure</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#007-dockercompose-fragments-__codelineno-24-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/postgres.yml</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#007-dockercompose-fragments-__codelineno-24-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/redis.yml</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#007-dockercompose-fragments-__codelineno-24-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./infrastructure/nginx.yml</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#007-dockercompose-fragments-__codelineno-24-7"></a>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#007-dockercompose-fragments-__codelineno-24-8"></a><span class="w">  </span><span class="c1"># Application services</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#007-dockercompose-fragments-__codelineno-24-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./services/api.yml</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#007-dockercompose-fragments-__codelineno-24-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./services/worker.yml</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#007-dockercompose-fragments-__codelineno-24-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./services/scheduler.yml</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#007-dockercompose-fragments-__codelineno-24-12"></a>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#007-dockercompose-fragments-__codelineno-24-13"></a><span class="w">  </span><span class="c1"># Monitoring stack</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#007-dockercompose-fragments-__codelineno-24-14"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/prometheus.yml</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#007-dockercompose-fragments-__codelineno-24-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/grafana.yml</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#007-dockercompose-fragments-__codelineno-24-16"></a>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#007-dockercompose-fragments-__codelineno-24-17"></a><span class="w">  </span><span class="c1"># Environment-specific overrides</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#007-dockercompose-fragments-__codelineno-24-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./overrides/${ENV:-development}.yml</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#007-dockercompose-fragments-__codelineno-24-19"></a><span class="w">    </span><span class="nt">env_file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env.${ENV:-development}</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#007-dockercompose-fragments-__codelineno-24-20"></a>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#007-dockercompose-fragments-__codelineno-24-21"></a><span class="c1"># Global networks</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#007-dockercompose-fragments-__codelineno-24-22"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#007-dockercompose-fragments-__codelineno-24-23"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#007-dockercompose-fragments-__codelineno-24-24"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#007-dockercompose-fragments-__codelineno-24-25"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#007-dockercompose-fragments-__codelineno-24-26"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#007-dockercompose-fragments-__codelineno-24-27"></a><span class="w">    </span><span class="nt">internal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#007-dockercompose-fragments-__codelineno-24-28"></a><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#007-dockercompose-fragments-__codelineno-24-29"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#007-dockercompose-fragments-__codelineno-24-30"></a>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#007-dockercompose-fragments-__codelineno-24-31"></a><span class="c1"># Global volumes</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#007-dockercompose-fragments-__codelineno-24-32"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#007-dockercompose-fragments-__codelineno-24-33"></a><span class="w">  </span><span class="nt">postgres_data</span><span class="p">:</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#007-dockercompose-fragments-__codelineno-24-34"></a><span class="w">  </span><span class="nt">redis_data</span><span class="p">:</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#007-dockercompose-fragments-__codelineno-24-35"></a><span class="w">  </span><span class="nt">prometheus_data</span><span class="p">:</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#007-dockercompose-fragments-__codelineno-24-36"></a><span class="w">  </span><span class="nt">grafana_data</span><span class="p">:</span>
</span></code></pre></div>
<hr />
<h2 id="007-dockercompose-fragments-best-practices">Best Practices<a class="headerlink" href="#007-dockercompose-fragments-best-practices" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Use Extension Fields for Reusable Fragments:</strong>
   <div class="language-yaml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#007-dockercompose-fragments-__codelineno-25-1"></a><span class="nt">x-logging</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;logging</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#007-dockercompose-fragments-__codelineno-25-2"></a><span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#007-dockercompose-fragments-__codelineno-25-3"></a><span class="w">  </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#007-dockercompose-fragments-__codelineno-25-4"></a><span class="w">    </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Organize Includes Logically:</strong></p>
<ul>
<li>Group by function (infrastructure, services, monitoring)</li>
<li>Separate environment-specific configurations</li>
<li>Use subdirectories for clarity</li>
</ul>
</li>
<li>
<p><strong>Name Anchors Descriptively:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#007-dockercompose-fragments-__codelineno-26-1"></a><span class="nt">x-node-service-defaults</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;node-service-defaults</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#007-dockercompose-fragments-__codelineno-26-2"></a><span class="nt">x-python-service-defaults</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;python-service-defaults</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#007-dockercompose-fragments-__codelineno-26-3"></a><span class="nt">x-database-healthcheck</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;database-healthcheck</span>
</span></code></pre></div>
</li>
<li>
<p><strong>Validate Merged Configuration:</strong></p>
<ul>
<li>Use Docker Compose Config Command:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#007-dockercompose-fragments-__codelineno-27-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>config
</span></code></pre></div>
</li>
<li>
<p><strong>Use Environment Variables:</strong></p>
<ul>
<li>Use Common Environment Variables:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#007-dockercompose-fragments-__codelineno-28-1"></a><span class="nt">x-common-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-env</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#007-dockercompose-fragments-__codelineno-28-2"></a><span class="w">  </span><span class="nt">ENVIRONMENT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${ENVIRONMENT:-production}</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#007-dockercompose-fragments-__codelineno-28-3"></a><span class="w">  </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${LOG_LEVEL:-info}</span>
</span></code></pre></div>
</li>
<li>
<p><strong>Document Your Fragments:</strong></p>
<ul>
<li>Include comments in your fragment files to explain their purpose and usage.</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#007-dockercompose-fragments-__codelineno-29-1"></a><span class="c1"># Logging configuration - 10MB max size, 3 file rotation</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#007-dockercompose-fragments-__codelineno-29-2"></a><span class="nt">x-logging</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;logging</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#007-dockercompose-fragments-__codelineno-29-3"></a><span class="w">  </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#007-dockercompose-fragments-__codelineno-29-4"></a><span class="w">  </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#007-dockercompose-fragments-__codelineno-29-5"></a><span class="w">    </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#007-dockercompose-fragments-__codelineno-29-6"></a><span class="w">    </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span></code></pre></div>
</li>
<li>
<p><strong>Keep Fragments DRY but Readable:</strong></p>
<ul>
<li>Don&rsquo;t over-fragment</li>
<li>Balance reusability with readability</li>
<li>Use fragments for truly common configurations</li>
</ul>
</li>
<li>
<p><strong>Version Control:</strong></p>
<ul>
<li>Commit all fragment files</li>
<li>Document the composition structure in README</li>
<li>Use <code>.env.example</code> for required variables</li>
</ul>
</li>
</ol>
<hr />
<h2 id="007-dockercompose-fragments-common-patterns">Common Patterns<a class="headerlink" href="#007-dockercompose-fragments-common-patterns" title="Permanent link">&para;</a></h2>
<h3 id="007-dockercompose-fragments-pattern-1-base-service-template">Pattern 1: Base Service Template<a class="headerlink" href="#007-dockercompose-fragments-pattern-1-base-service-template" title="Permanent link">&para;</a></h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#007-dockercompose-fragments-__codelineno-30-1"></a><span class="nt">x-app-template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;app</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#007-dockercompose-fragments-__codelineno-30-2"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#007-dockercompose-fragments-__codelineno-30-3"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#007-dockercompose-fragments-__codelineno-30-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#007-dockercompose-fragments-__codelineno-30-5"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#007-dockercompose-fragments-__codelineno-30-6"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#007-dockercompose-fragments-__codelineno-30-7"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#007-dockercompose-fragments-__codelineno-30-8"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#007-dockercompose-fragments-__codelineno-30-9"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#007-dockercompose-fragments-__codelineno-30-10"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#007-dockercompose-fragments-__codelineno-30-11"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#007-dockercompose-fragments-__codelineno-30-12"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#007-dockercompose-fragments-__codelineno-30-13"></a>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#007-dockercompose-fragments-__codelineno-30-14"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#007-dockercompose-fragments-__codelineno-30-15"></a><span class="w">  </span><span class="nt">service1</span><span class="p">:</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#007-dockercompose-fragments-__codelineno-30-16"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*app</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#007-dockercompose-fragments-__codelineno-30-17"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service1:latest</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#007-dockercompose-fragments-__codelineno-30-18"></a>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#007-dockercompose-fragments-__codelineno-30-19"></a><span class="w">  </span><span class="nt">service2</span><span class="p">:</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#007-dockercompose-fragments-__codelineno-30-20"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*app</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#007-dockercompose-fragments-__codelineno-30-21"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service2:latest</span>
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-pattern-2-environment-overrides">Pattern 2: Environment Overrides<a class="headerlink" href="#007-dockercompose-fragments-pattern-2-environment-overrides" title="Permanent link">&para;</a></h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#007-dockercompose-fragments-__codelineno-31-1"></a><span class="nt">x-base</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;base</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#007-dockercompose-fragments-__codelineno-31-2"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app:latest</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#007-dockercompose-fragments-__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#007-dockercompose-fragments-__codelineno-31-4"></a><span class="nt">x-dev</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;dev</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#007-dockercompose-fragments-__codelineno-31-5"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#007-dockercompose-fragments-__codelineno-31-6"></a><span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#007-dockercompose-fragments-__codelineno-31-7"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./src:/app/src</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#007-dockercompose-fragments-__codelineno-31-8"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#007-dockercompose-fragments-__codelineno-31-9"></a><span class="w">    </span><span class="nt">DEBUG</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#007-dockercompose-fragments-__codelineno-31-10"></a>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#007-dockercompose-fragments-__codelineno-31-11"></a><span class="nt">x-prod</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;prod</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#007-dockercompose-fragments-__codelineno-31-12"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#007-dockercompose-fragments-__codelineno-31-13"></a><span class="w">  </span><span class="nt">read_only</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#007-dockercompose-fragments-__codelineno-31-14"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#007-dockercompose-fragments-__codelineno-31-15"></a><span class="w">    </span><span class="nt">DEBUG</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;false&quot;</span>
</span></code></pre></div>
<h3 id="007-dockercompose-fragments-pattern-3-multi-container-application">Pattern 3: Multi-Container Application<a class="headerlink" href="#007-dockercompose-fragments-pattern-3-multi-container-application" title="Permanent link">&para;</a></h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#007-dockercompose-fragments-__codelineno-32-1"></a><span class="nt">x-defaults</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;defaults</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#007-dockercompose-fragments-__codelineno-32-2"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#007-dockercompose-fragments-__codelineno-32-3"></a><span class="w">  </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#007-dockercompose-fragments-__codelineno-32-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#007-dockercompose-fragments-__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#007-dockercompose-fragments-__codelineno-32-6"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#007-dockercompose-fragments-__codelineno-32-7"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#007-dockercompose-fragments-__codelineno-32-8"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*defaults</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#007-dockercompose-fragments-__codelineno-32-9"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#007-dockercompose-fragments-__codelineno-32-10"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#007-dockercompose-fragments-__codelineno-32-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#007-dockercompose-fragments-__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#007-dockercompose-fragments-__codelineno-32-13"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#007-dockercompose-fragments-__codelineno-32-14"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*defaults</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#007-dockercompose-fragments-__codelineno-32-15"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#007-dockercompose-fragments-__codelineno-32-16"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#007-dockercompose-fragments-__codelineno-32-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#007-dockercompose-fragments-__codelineno-32-18"></a>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#007-dockercompose-fragments-__codelineno-32-19"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#007-dockercompose-fragments-__codelineno-32-20"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*defaults</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#007-dockercompose-fragments-__codelineno-32-21"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span></code></pre></div>
<hr />
<h2 id="007-dockercompose-fragments-troubleshooting">Troubleshooting<a class="headerlink" href="#007-dockercompose-fragments-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="007-dockercompose-fragments-common-issues-and-solutions">Common Issues and Solutions<a class="headerlink" href="#007-dockercompose-fragments-common-issues-and-solutions" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Anchor Not Found:</strong></p>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#007-dockercompose-fragments-__codelineno-33-1"></a>Error:<span class="w"> </span>Unknown<span class="w"> </span>anchor<span class="w"> </span><span class="s1">&#39;service-defaults&#39;</span>
</span></code></pre></div>
<strong>Solution:</strong> Ensure the anchor is defined before it&rsquo;s referenced. Anchors must be defined in the same file or in an included file that&rsquo;s loaded first.</p>
</li>
<li>
<p><strong>Merge Conflicts:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#007-dockercompose-fragments-__codelineno-34-1"></a><span class="c1"># This will override, not merge</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#007-dockercompose-fragments-__codelineno-34-2"></a><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#007-dockercompose-fragments-__codelineno-34-3"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#007-dockercompose-fragments-__codelineno-34-4"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span><span class="w">  </span><span class="c1"># This replaces entire environment from *base</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#007-dockercompose-fragments-__codelineno-34-5"></a><span class="w">    </span><span class="nt">NEW_VAR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#007-dockercompose-fragments-__codelineno-34-6"></a>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#007-dockercompose-fragments-__codelineno-34-7"></a><span class="c1"># Correct way to merge:</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#007-dockercompose-fragments-__codelineno-34-8"></a><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#007-dockercompose-fragments-__codelineno-34-9"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#007-dockercompose-fragments-__codelineno-34-10"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#007-dockercompose-fragments-__codelineno-34-11"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base-env</span><span class="w">  </span><span class="c1"># Merge base environment</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#007-dockercompose-fragments-__codelineno-34-12"></a><span class="w">    </span><span class="nt">NEW_VAR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value</span><span class="w"> </span><span class="c1"># Add new variable</span>
</span></code></pre></div>
</li>
<li>
<p><strong>Include Path Issues:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#007-dockercompose-fragments-__codelineno-35-1"></a>Error:<span class="w"> </span>include<span class="w"> </span>path<span class="w"> </span>not<span class="w"> </span>found:<span class="w"> </span>./compose/services.yml
</span></code></pre></div>
<p><strong>Solution:</strong> Use paths relative to the main compose file location.</p>
</li>
<li>
<p><strong>Circular Dependencies:</strong></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#007-dockercompose-fragments-__codelineno-36-1"></a><span class="c1"># Avoid this</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#007-dockercompose-fragments-__codelineno-36-2"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#007-dockercompose-fragments-__codelineno-36-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">a.yml</span><span class="w">  </span><span class="c1"># includes b.yml</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#007-dockercompose-fragments-__codelineno-36-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">b.yml</span><span class="w">  </span><span class="c1"># includes a.yml</span>
</span></code></pre></div>
</li>
<li>
<p><strong>Validation Errors:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#007-dockercompose-fragments-__codelineno-37-1"></a><span class="c1"># Validate your configuration</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#007-dockercompose-fragments-__codelineno-37-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--quiet
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#007-dockercompose-fragments-__codelineno-37-3"></a>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#007-dockercompose-fragments-__codelineno-37-4"></a><span class="c1"># View merged configuration</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#007-dockercompose-fragments-__codelineno-37-5"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>&gt;<span class="w"> </span>merged-config.yml
</span></code></pre></div>
</li>
</ol>
<h3 id="007-dockercompose-fragments-debugging-commands">Debugging Commands<a class="headerlink" href="#007-dockercompose-fragments-debugging-commands" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Debug with Docker Compose Config:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#007-dockercompose-fragments-__codelineno-38-1"></a><span class="c1"># Show final merged configuration</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#007-dockercompose-fragments-__codelineno-38-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>config
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#007-dockercompose-fragments-__codelineno-38-3"></a>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#007-dockercompose-fragments-__codelineno-38-4"></a><span class="c1"># Validate without starting services</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#007-dockercompose-fragments-__codelineno-38-5"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--quiet
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#007-dockercompose-fragments-__codelineno-38-6"></a>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#007-dockercompose-fragments-__codelineno-38-7"></a><span class="c1"># Show configuration for specific service</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#007-dockercompose-fragments-__codelineno-38-8"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>api
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#007-dockercompose-fragments-__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#007-dockercompose-fragments-__codelineno-38-10"></a><span class="c1"># List all services</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#007-dockercompose-fragments-__codelineno-38-11"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--services
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#007-dockercompose-fragments-__codelineno-38-12"></a>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#007-dockercompose-fragments-__codelineno-38-13"></a><span class="c1"># Show volumes</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#007-dockercompose-fragments-__codelineno-38-14"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--volumes
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#007-dockercompose-fragments-__codelineno-38-15"></a>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#007-dockercompose-fragments-__codelineno-38-16"></a><span class="c1"># Show networks</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#007-dockercompose-fragments-__codelineno-38-17"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--networks
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#007-dockercompose-fragments-__codelineno-38-18"></a>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#007-dockercompose-fragments-__codelineno-38-19"></a><span class="c1"># Resolve environment variables</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#007-dockercompose-fragments-__codelineno-38-20"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--resolve-image-digests
</span></code></pre></div>
</li>
</ul>
<hr />
<h2 id="007-dockercompose-fragments-hands-on-exercises">Hands-On Exercises<a class="headerlink" href="#007-dockercompose-fragments-hands-on-exercises" title="Permanent link">&para;</a></h2>
<h3 id="007-dockercompose-fragments-exercise-1-create-a-microservices-setup">Exercise 1: Create a Microservices Setup<a class="headerlink" href="#007-dockercompose-fragments-exercise-1-create-a-microservices-setup" title="Permanent link">&para;</a></h3>
<p>Create a compose configuration with:</p>
<ul>
<li>3 microservices using the same base template</li>
<li>Shared logging configuration</li>
<li>Individual health checks</li>
<li>Common environment variables</li>
</ul>
<h3 id="007-dockercompose-fragments-exercise-2-multi-environment-configuration">Exercise 2: Multi-Environment Configuration<a class="headerlink" href="#007-dockercompose-fragments-exercise-2-multi-environment-configuration" title="Permanent link">&para;</a></h3>
<p>Build a setup that supports:</p>
<ul>
<li>Development environment with hot-reload</li>
<li>Staging environment with production-like settings</li>
<li>Production environment with security hardening</li>
<li>All using shared base configuration</li>
</ul>
<h3 id="007-dockercompose-fragments-exercise-3-modular-infrastructure">Exercise 3: Modular Infrastructure<a class="headerlink" href="#007-dockercompose-fragments-exercise-3-modular-infrastructure" title="Permanent link">&para;</a></h3>
<p>Design a modular compose setup:</p>
<ul>
<li>Separate files for databases, caching, messaging</li>
<li>Include-based composition</li>
<li>Environment-specific overrides</li>
<li>Shared network and volume definitions</li>
</ul>
<hr />
<h2 id="007-dockercompose-fragments-useful-commands">Useful Commands<a class="headerlink" href="#007-dockercompose-fragments-useful-commands" title="Permanent link">&para;</a></h2>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#007-dockercompose-fragments-__codelineno-39-1"></a><span class="c1"># View merged configuration</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#007-dockercompose-fragments-__codelineno-39-2"></a>docker<span class="w"> </span>compose<span class="w"> </span>config
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#007-dockercompose-fragments-__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#007-dockercompose-fragments-__codelineno-39-4"></a><span class="c1"># Validate compose file</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#007-dockercompose-fragments-__codelineno-39-5"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--quiet
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#007-dockercompose-fragments-__codelineno-39-6"></a>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#007-dockercompose-fragments-__codelineno-39-7"></a><span class="c1"># Start with specific environment</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#007-dockercompose-fragments-__codelineno-39-8"></a><span class="nv">ENV</span><span class="o">=</span>production<span class="w"> </span>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#007-dockercompose-fragments-__codelineno-39-9"></a>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#007-dockercompose-fragments-__codelineno-39-10"></a><span class="c1"># View specific service configuration</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#007-dockercompose-fragments-__codelineno-39-11"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>service-name
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#007-dockercompose-fragments-__codelineno-39-12"></a>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#007-dockercompose-fragments-__codelineno-39-13"></a><span class="c1"># List all services</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#007-dockercompose-fragments-__codelineno-39-14"></a>docker<span class="w"> </span>compose<span class="w"> </span>config<span class="w"> </span>--services
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#007-dockercompose-fragments-__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#007-dockercompose-fragments-__codelineno-39-16"></a><span class="c1"># Pull all images</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#007-dockercompose-fragments-__codelineno-39-17"></a>docker<span class="w"> </span>compose<span class="w"> </span>pull
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#007-dockercompose-fragments-__codelineno-39-18"></a>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#007-dockercompose-fragments-__codelineno-39-19"></a><span class="c1"># Build all services</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#007-dockercompose-fragments-__codelineno-39-20"></a>docker<span class="w"> </span>compose<span class="w"> </span>build
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#007-dockercompose-fragments-__codelineno-39-21"></a>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#007-dockercompose-fragments-__codelineno-39-22"></a><span class="c1"># Up with build</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#007-dockercompose-fragments-__codelineno-39-23"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>--build
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#007-dockercompose-fragments-__codelineno-39-24"></a>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#007-dockercompose-fragments-__codelineno-39-25"></a><span class="c1"># Scale specific service</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#007-dockercompose-fragments-__codelineno-39-26"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">api</span><span class="o">=</span><span class="m">3</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#007-dockercompose-fragments-__codelineno-39-27"></a>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28" href="#007-dockercompose-fragments-__codelineno-39-28"></a><span class="c1"># View logs</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29" href="#007-dockercompose-fragments-__codelineno-39-29"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>service-name
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30" href="#007-dockercompose-fragments-__codelineno-39-30"></a>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31" href="#007-dockercompose-fragments-__codelineno-39-31"></a><span class="c1"># Stop all services</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32" href="#007-dockercompose-fragments-__codelineno-39-32"></a>docker<span class="w"> </span>compose<span class="w"> </span>down
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33" href="#007-dockercompose-fragments-__codelineno-39-33"></a>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34" href="#007-dockercompose-fragments-__codelineno-39-34"></a><span class="c1"># Remove volumes</span>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35" href="#007-dockercompose-fragments-__codelineno-39-35"></a>docker<span class="w"> </span>compose<span class="w"> </span>down<span class="w"> </span>-v
</span></code></pre></div>
<hr />
<p><img alt="Well Done" src="../assets/images/well-done.png" /></p></section><section class="print-page" id="008-crictl" heading-number="1.9"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="008-crictl-lab-008-debugging-containers-with-crictl">Lab 008 - Debugging Containers with crictl<a class="headerlink" href="#008-crictl-lab-008-debugging-containers-with-crictl" title="Permanent link">&para;</a></h1>
<ul>
<li>In this lab we will explore <code>crictl</code>, a command-line interface for CRI-compatible container runtimes</li>
<li><code>crictl</code> is designed for debugging and inspecting containers and images on Kubernetes nodes</li>
<li>We will learn how to install, configure, and use <code>crictl</code> to debug Docker containers</li>
<li>This tool is essential for troubleshooting container issues in Kubernetes environments</li>
<li>
<p>The lab is divided into several tasks:</p>
</li>
<li>
<p><a href="#008-crictl-01-what-is-crictl">01. What is crictl?</a></p>
</li>
<li><a href="#008-crictl-02-prerequisites">02. Prerequisites</a></li>
<li><a href="#008-crictl-03-installation">03. Installation</a></li>
<li><a href="#008-crictl-04-basic-configuration">04. Basic Configuration</a></li>
<li><a href="#008-crictl-05-working-with-container-images">05. Working with Container Images</a></li>
<li><a href="#008-crictl-06-container-operations">06. Container Operations</a></li>
<li><a href="#008-crictl-07-pod-operations">07. Pod Operations</a></li>
<li><a href="#008-crictl-08-debugging-containers">08. Debugging Containers</a></li>
<li><a href="#008-crictl-09-inspecting-container-resources">09. Inspecting Container Resources</a></li>
<li><a href="#008-crictl-10-logs-and-troubleshooting">10. Logs and Troubleshooting</a></li>
<li><a href="#008-crictl-11-advanced-debugging-techniques">11. Advanced Debugging Techniques</a></li>
<li><a href="#008-crictl-12-clean-up">12. Clean up</a></li>
</ul>
<hr />
<h2 id="008-crictl-01-what-is-crictl">01. What is crictl?<a class="headerlink" href="#008-crictl-01-what-is-crictl" title="Permanent link">&para;</a></h2>
<p><strong>crictl</strong> (CRI CLI) is a command-line interface for interacting with CRI-compatible container runtimes. It provides:</p>
<ul>
<li><strong>Container Runtime Interface (CRI)</strong>: Direct interaction with container runtimes like containerd, CRI-O, and Docker (via dockershim)</li>
<li><strong>Debugging Tool</strong>: Designed specifically for debugging containers in Kubernetes environments</li>
<li><strong>Inspection Capabilities</strong>: Detailed inspection of containers, pods, and images</li>
<li><strong>Troubleshooting</strong>: Essential for diagnosing container issues on Kubernetes nodes</li>
</ul>
<h3 id="008-crictl-key-features">Key Features<a class="headerlink" href="#008-crictl-key-features" title="Permanent link">&para;</a></h3>
<ul>
<li>‚úÖ List and inspect containers and pods</li>
<li>‚úÖ View container logs and execute commands</li>
<li>‚úÖ Pull and manage container images</li>
<li>‚úÖ Monitor container resource usage</li>
<li>‚úÖ Debug container networking and storage</li>
<li>‚úÖ Compatible with multiple container runtimes</li>
</ul>
<h3 id="008-crictl-crictl-vs-docker-cli">crictl vs docker CLI<a class="headerlink" href="#008-crictl-crictl-vs-docker-cli" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>crictl</th>
<th>docker</th>
</tr>
</thead>
<tbody>
<tr>
<td>Purpose</td>
<td>Kubernetes debugging</td>
<td>General container management</td>
</tr>
<tr>
<td>Scope</td>
<td>CRI-compatible runtimes</td>
<td>Docker Engine only</td>
</tr>
<tr>
<td>Pod Support</td>
<td>Native</td>
<td>No</td>
</tr>
<tr>
<td>Use Case</td>
<td>K8s troubleshooting</td>
<td>Development &amp; production</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="008-crictl-02-prerequisites">02. Prerequisites<a class="headerlink" href="#008-crictl-02-prerequisites" title="Permanent link">&para;</a></h2>
<p>Before installing <code>crictl</code>, ensure you have:</p>
<ul>
<li><strong>Operating System</strong>: Linux or macOS</li>
<li><strong>Container Runtime</strong>: One of the following:</li>
<li>containerd (standalone or via Kubernetes)</li>
<li>CRI-O</li>
<li>Docker Desktop (macOS/Windows)</li>
<li>Minikube, kind, or k3s (with containerd)</li>
<li><strong>Root/Sudo Access</strong>: Required for most operations</li>
<li><strong>curl or wget</strong>: For downloading the binary</li>
</ul>
<div class="admonition important">
<p class="admonition-title">OrbStack Users</p>
<p>OrbStack doesn&rsquo;t expose containerd&rsquo;s CRI socket directly. To use crictl:</p>
<ol>
<li><strong>Option 1</strong>: Use Minikube, kind, or k3s which provide CRI access</li>
<li><strong>Option 2</strong>: Use Docker CLI for container debugging instead</li>
<li><strong>Option 3</strong>: Use a Kubernetes cluster (local or remote)</li>
</ol>
<p>This lab is designed for environments with direct CRI access.</p>
</div>
<h3 id="008-crictl-check-existing-runtime">Check Existing Runtime<a class="headerlink" href="#008-crictl-check-existing-runtime" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#008-crictl-__codelineno-0-1"></a><span class="c1"># Check if containerd is running</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#008-crictl-__codelineno-0-2"></a>systemctl<span class="w"> </span>status<span class="w"> </span>containerd
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#008-crictl-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#008-crictl-__codelineno-0-4"></a><span class="c1"># Check if Docker is running</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#008-crictl-__codelineno-0-5"></a>systemctl<span class="w"> </span>status<span class="w"> </span>docker
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#008-crictl-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#008-crictl-__codelineno-0-7"></a><span class="c1"># Check runtime socket locations</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#008-crictl-__codelineno-0-8"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/run/containerd/containerd.sock
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#008-crictl-__codelineno-0-9"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/run/dockershim.sock
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#008-crictl-__codelineno-0-10"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/run/crio/crio.sock
</span></code></pre></div>
<hr />
<h2 id="008-crictl-03-installation">03. Installation<a class="headerlink" href="#008-crictl-03-installation" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-option-1-download-pre-built-binary-recommended">Option 1: Download Pre-built Binary (Recommended)<a class="headerlink" href="#008-crictl-option-1-download-pre-built-binary-recommended" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#008-crictl-__codelineno-1-1"></a><span class="c1"># Set the version</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#008-crictl-__codelineno-1-2"></a><span class="nv">VERSION</span><span class="o">=</span><span class="s2">&quot;v1.28.0&quot;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#008-crictl-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#008-crictl-__codelineno-1-4"></a><span class="c1"># Download crictl</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#008-crictl-__codelineno-1-5"></a>wget<span class="w"> </span>https://github.com/kubernetes-sigs/cri-tools/releases/download/<span class="nv">$VERSION</span>/crictl-<span class="nv">$VERSION</span>-linux-amd64.tar.gz
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#008-crictl-__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#008-crictl-__codelineno-1-7"></a><span class="c1"># Extract the binary</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#008-crictl-__codelineno-1-8"></a>sudo<span class="w"> </span>tar<span class="w"> </span>zxvf<span class="w"> </span>crictl-<span class="nv">$VERSION</span>-linux-amd64.tar.gz<span class="w"> </span>-C<span class="w"> </span>/usr/local/bin
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#008-crictl-__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#008-crictl-__codelineno-1-10"></a><span class="c1"># Remove the archive</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#008-crictl-__codelineno-1-11"></a>rm<span class="w"> </span>-f<span class="w"> </span>crictl-<span class="nv">$VERSION</span>-linux-amd64.tar.gz
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#008-crictl-__codelineno-1-12"></a>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#008-crictl-__codelineno-1-13"></a><span class="c1"># Verify installation</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#008-crictl-__codelineno-1-14"></a>crictl<span class="w"> </span>--version
</span></code></pre></div>
<h3 id="008-crictl-option-2-install-via-package-manager">Option 2: Install via Package Manager<a class="headerlink" href="#008-crictl-option-2-install-via-package-manager" title="Permanent link">&para;</a></h3>
<p><strong>On Ubuntu/Debian:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#008-crictl-__codelineno-2-1"></a><span class="c1"># Install dependencies</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#008-crictl-__codelineno-2-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#008-crictl-__codelineno-2-3"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#008-crictl-__codelineno-2-4"></a>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#008-crictl-__codelineno-2-5"></a><span class="c1"># Add Kubernetes repository</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#008-crictl-__codelineno-2-6"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://packages.cloud.google.com/apt/doc/apt-key.gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#008-crictl-__codelineno-2-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb https://apt.kubernetes.io/ kubernetes-xenial main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/kubernetes.list
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#008-crictl-__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#008-crictl-__codelineno-2-9"></a><span class="c1"># Install cri-tools</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#008-crictl-__codelineno-2-10"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#008-crictl-__codelineno-2-11"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>cri-tools
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#008-crictl-__codelineno-2-12"></a>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#008-crictl-__codelineno-2-13"></a><span class="c1"># Verify installation</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#008-crictl-__codelineno-2-14"></a>crictl<span class="w"> </span>--version
</span></code></pre></div>
<p><strong>On macOS:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#008-crictl-__codelineno-3-1"></a><span class="c1"># Using Homebrew</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#008-crictl-__codelineno-3-2"></a>brew<span class="w"> </span>install<span class="w"> </span>crictl
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#008-crictl-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#008-crictl-__codelineno-3-4"></a><span class="c1"># Verify installation</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#008-crictl-__codelineno-3-5"></a>crictl<span class="w"> </span>--version
</span></code></pre></div>
<h3 id="008-crictl-option-3-build-from-source">Option 3: Build from Source<a class="headerlink" href="#008-crictl-option-3-build-from-source" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#008-crictl-__codelineno-4-1"></a><span class="c1"># Install Go (if not already installed)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#008-crictl-__codelineno-4-2"></a>wget<span class="w"> </span>https://go.dev/dl/go1.21.0.linux-amd64.tar.gz
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#008-crictl-__codelineno-4-3"></a>sudo<span class="w"> </span>tar<span class="w"> </span>-C<span class="w"> </span>/usr/local<span class="w"> </span>-xzf<span class="w"> </span>go1.21.0.linux-amd64.tar.gz
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#008-crictl-__codelineno-4-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/usr/local/go/bin
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#008-crictl-__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#008-crictl-__codelineno-4-6"></a><span class="c1"># Clone the repository</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#008-crictl-__codelineno-4-7"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/kubernetes-sigs/cri-tools.git
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#008-crictl-__codelineno-4-8"></a><span class="nb">cd</span><span class="w"> </span>cri-tools
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#008-crictl-__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#008-crictl-__codelineno-4-10"></a><span class="c1"># Build crictl</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#008-crictl-__codelineno-4-11"></a>make
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#008-crictl-__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#008-crictl-__codelineno-4-13"></a><span class="c1"># Install the binary</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#008-crictl-__codelineno-4-14"></a>sudo<span class="w"> </span>install<span class="w"> </span>-m<span class="w"> </span><span class="m">755</span><span class="w"> </span>build/bin/linux/amd64/crictl<span class="w"> </span>/usr/local/bin/crictl
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#008-crictl-__codelineno-4-15"></a>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#008-crictl-__codelineno-4-16"></a><span class="c1"># Verify installation</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#008-crictl-__codelineno-4-17"></a>crictl<span class="w"> </span>--version
</span></code></pre></div>
<hr />
<h2 id="008-crictl-04-basic-configuration">04. Basic Configuration<a class="headerlink" href="#008-crictl-04-basic-configuration" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-create-configuration-file">Create Configuration File<a class="headerlink" href="#008-crictl-create-configuration-file" title="Permanent link">&para;</a></h3>
<p><code>crictl</code> uses a configuration file to determine which runtime socket to connect to:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#008-crictl-__codelineno-5-1"></a><span class="c1"># Create the config directory</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#008-crictl-__codelineno-5-2"></a>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/crictl
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#008-crictl-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#008-crictl-__codelineno-5-4"></a><span class="c1"># Create the configuration file</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#008-crictl-__codelineno-5-5"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/crictl/crictl.yaml<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#008-crictl-__codelineno-5-6"></a><span class="s">runtime-endpoint: unix:///var/run/containerd/containerd.sock</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#008-crictl-__codelineno-5-7"></a><span class="s">image-endpoint: unix:///var/run/containerd/containerd.sock</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#008-crictl-__codelineno-5-8"></a><span class="s">timeout: 10</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#008-crictl-__codelineno-5-9"></a><span class="s">debug: false</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#008-crictl-__codelineno-5-10"></a><span class="s">pull-image-on-create: false</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#008-crictl-__codelineno-5-11"></a><span class="s">EOF</span>
</span></code></pre></div>
<h3 id="008-crictl-configuration-for-different-runtimes">Configuration for Different Runtimes<a class="headerlink" href="#008-crictl-configuration-for-different-runtimes" title="Permanent link">&para;</a></h3>
<p><strong>For Docker Desktop (macOS/Windows):</strong></p>
<div class="admonition warning">
<p class="admonition-title">Docker Desktop Uses Containerd</p>
<p>Docker Desktop uses containerd as its runtime. Use the containerd socket, not the Docker socket.</p>
</div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#008-crictl-__codelineno-6-1"></a><span class="c1"># For macOS with Docker Desktop</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#008-crictl-__codelineno-6-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.config/crictl
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#008-crictl-__codelineno-6-3"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>~/.config/crictl/crictl.yaml<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#008-crictl-__codelineno-6-4"></a><span class="s">runtime-endpoint: unix:///var/run/containerd/containerd.sock</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#008-crictl-__codelineno-6-5"></a><span class="s">image-endpoint: unix:///var/run/containerd/containerd.sock</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#008-crictl-__codelineno-6-6"></a><span class="s">timeout: 10</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#008-crictl-__codelineno-6-7"></a><span class="s">debug: false</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#008-crictl-__codelineno-6-8"></a><span class="s">EOF</span>
</span></code></pre></div>
<p><strong>For Docker Engine on Linux (using containerd):</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#008-crictl-__codelineno-7-1"></a><span class="c1"># Docker Engine uses containerd, not CRI directly</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#008-crictl-__codelineno-7-2"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/crictl/crictl.yaml<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#008-crictl-__codelineno-7-3"></a><span class="s">runtime-endpoint: unix:///run/containerd/containerd.sock</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#008-crictl-__codelineno-7-4"></a><span class="s">image-endpoint: unix:///run/containerd/containerd.sock</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#008-crictl-__codelineno-7-5"></a><span class="s">timeout: 10</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#008-crictl-__codelineno-7-6"></a><span class="s">EOF</span>
</span></code></pre></div>
<p><strong>For CRI-O:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#008-crictl-__codelineno-8-1"></a>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/crictl/crictl.yaml<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#008-crictl-__codelineno-8-2"></a><span class="s">runtime-endpoint: unix:///var/run/crio/crio.sock</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#008-crictl-__codelineno-8-3"></a><span class="s">image-endpoint: unix:///var/run/crio/crio.sock</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#008-crictl-__codelineno-8-4"></a><span class="s">timeout: 10</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#008-crictl-__codelineno-8-5"></a><span class="s">EOF</span>
</span></code></pre></div>
<h3 id="008-crictl-using-runtime-endpoint-flag">Using Runtime Endpoint Flag<a class="headerlink" href="#008-crictl-using-runtime-endpoint-flag" title="Permanent link">&para;</a></h3>
<p>Instead of configuration file, you can specify the runtime endpoint directly:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#008-crictl-__codelineno-9-1"></a><span class="c1"># Using containerd (Docker Desktop on macOS)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#008-crictl-__codelineno-9-2"></a>crictl<span class="w"> </span>--runtime-endpoint<span class="w"> </span>unix:///var/run/containerd/containerd.sock<span class="w"> </span>version
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#008-crictl-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#008-crictl-__codelineno-9-4"></a><span class="c1"># Using containerd (Linux)</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#008-crictl-__codelineno-9-5"></a>crictl<span class="w"> </span>--runtime-endpoint<span class="w"> </span>unix:///run/containerd/containerd.sock<span class="w"> </span>version
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#008-crictl-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#008-crictl-__codelineno-9-7"></a><span class="c1"># Set as environment variable (macOS/Docker Desktop)</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#008-crictl-__codelineno-9-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONTAINER_RUNTIME_ENDPOINT</span><span class="o">=</span>unix:///var/run/containerd/containerd.sock
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#008-crictl-__codelineno-9-9"></a>crictl<span class="w"> </span>version
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#008-crictl-__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#008-crictl-__codelineno-9-11"></a><span class="c1"># Set as environment variable (Linux)</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#008-crictl-__codelineno-9-12"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONTAINER_RUNTIME_ENDPOINT</span><span class="o">=</span>unix:///run/containerd/containerd.sock
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#008-crictl-__codelineno-9-13"></a>crictl<span class="w"> </span>version
</span></code></pre></div>
<h3 id="008-crictl-find-your-container-runtime-socket">Find Your Container Runtime Socket<a class="headerlink" href="#008-crictl-find-your-container-runtime-socket" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#008-crictl-__codelineno-10-1"></a><span class="c1"># List all potential runtime sockets</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#008-crictl-__codelineno-10-2"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/run/containerd/*.sock<span class="w"> </span><span class="m">2</span>&gt;/dev/null
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#008-crictl-__codelineno-10-3"></a>ls<span class="w"> </span>-la<span class="w"> </span>/run/containerd/*.sock<span class="w"> </span><span class="m">2</span>&gt;/dev/null
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#008-crictl-__codelineno-10-4"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/run/crio/*.sock<span class="w"> </span><span class="m">2</span>&gt;/dev/null
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#008-crictl-__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#008-crictl-__codelineno-10-6"></a><span class="c1"># For Docker Desktop on macOS</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#008-crictl-__codelineno-10-7"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/run/containerd/containerd.sock
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#008-crictl-__codelineno-10-8"></a>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#008-crictl-__codelineno-10-9"></a><span class="c1"># Test connectivity</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#008-crictl-__codelineno-10-10"></a>crictl<span class="w"> </span>--runtime-endpoint<span class="w"> </span>unix:///var/run/containerd/containerd.sock<span class="w"> </span>version
</span></code></pre></div>
<h3 id="008-crictl-verify-configuration">Verify Configuration<a class="headerlink" href="#008-crictl-verify-configuration" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#008-crictl-__codelineno-11-1"></a><span class="c1"># Check runtime version</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#008-crictl-__codelineno-11-2"></a>crictl<span class="w"> </span>version
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#008-crictl-__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#008-crictl-__codelineno-11-4"></a><span class="c1"># Get runtime info</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#008-crictl-__codelineno-11-5"></a>crictl<span class="w"> </span>info
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#008-crictl-__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#008-crictl-__codelineno-11-7"></a><span class="c1">### Expected Output:</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#008-crictl-__codelineno-11-8"></a><span class="c1"># {</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#008-crictl-__codelineno-11-9"></a><span class="c1">#   &quot;status&quot;: {</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#008-crictl-__codelineno-11-10"></a><span class="c1">#     &quot;conditions&quot;: [</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#008-crictl-__codelineno-11-11"></a><span class="c1">#       {</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#008-crictl-__codelineno-11-12"></a><span class="c1">#         &quot;type&quot;: &quot;RuntimeReady&quot;,</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#008-crictl-__codelineno-11-13"></a><span class="c1">#         &quot;status&quot;: true,</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#008-crictl-__codelineno-11-14"></a><span class="c1">#         &quot;message&quot;: &quot;&quot;</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#008-crictl-__codelineno-11-15"></a><span class="c1">#       }</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#008-crictl-__codelineno-11-16"></a><span class="c1">#     ]</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#008-crictl-__codelineno-11-17"></a><span class="c1">#   }</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#008-crictl-__codelineno-11-18"></a><span class="c1"># }</span>
</span></code></pre></div>
<h3 id="008-crictl-alternative-using-crictl-with-minikube">Alternative: Using crictl with Minikube<a class="headerlink" href="#008-crictl-alternative-using-crictl-with-minikube" title="Permanent link">&para;</a></h3>
<p>If you&rsquo;re using OrbStack or another runtime without direct CRI access, you can use Minikube:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#008-crictl-__codelineno-12-1"></a><span class="c1"># Start Minikube with containerd</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#008-crictl-__codelineno-12-2"></a>minikube<span class="w"> </span>start<span class="w"> </span>--container-runtime<span class="o">=</span>containerd
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#008-crictl-__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#008-crictl-__codelineno-12-4"></a><span class="c1"># Get the socket path</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#008-crictl-__codelineno-12-5"></a>minikube<span class="w"> </span>ssh<span class="w"> </span><span class="s2">&quot;ls -la /run/containerd/containerd.sock&quot;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#008-crictl-__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#008-crictl-__codelineno-12-7"></a><span class="c1"># Configure crictl to use Minikube</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#008-crictl-__codelineno-12-8"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>~/.config/crictl/crictl.yaml<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#008-crictl-__codelineno-12-9"></a><span class="s">runtime-endpoint: unix:///run/containerd/containerd.sock</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#008-crictl-__codelineno-12-10"></a><span class="s">image-endpoint: unix:///run/containerd/containerd.sock</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#008-crictl-__codelineno-12-11"></a><span class="s">timeout: 10</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#008-crictl-__codelineno-12-12"></a><span class="s">EOF</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#008-crictl-__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#008-crictl-__codelineno-12-14"></a><span class="c1"># SSH into Minikube and use crictl</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#008-crictl-__codelineno-12-15"></a>minikube<span class="w"> </span>ssh
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#008-crictl-__codelineno-12-16"></a>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#008-crictl-__codelineno-12-17"></a><span class="c1"># Now inside Minikube VM:</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#008-crictl-__codelineno-12-18"></a>crictl<span class="w"> </span>version
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#008-crictl-__codelineno-12-19"></a>crictl<span class="w"> </span>images
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#008-crictl-__codelineno-12-20"></a>crictl<span class="w"> </span>ps
</span></code></pre></div>
<h3 id="008-crictl-alternative-using-crictl-with-kind">Alternative: Using crictl with kind<a class="headerlink" href="#008-crictl-alternative-using-crictl-with-kind" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#008-crictl-__codelineno-13-1"></a><span class="c1"># Create a kind cluster</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#008-crictl-__codelineno-13-2"></a>kind<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>--name<span class="w"> </span>crictl-demo
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#008-crictl-__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#008-crictl-__codelineno-13-4"></a><span class="c1"># Get the container ID of the kind control plane</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#008-crictl-__codelineno-13-5"></a><span class="nv">KIND_CONTAINER</span><span class="o">=</span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>--filter<span class="w"> </span><span class="s2">&quot;name=crictl-demo-control-plane&quot;</span><span class="w"> </span>-q<span class="k">)</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#008-crictl-__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#008-crictl-__codelineno-13-7"></a><span class="c1"># Execute crictl commands in the kind container</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#008-crictl-__codelineno-13-8"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$KIND_CONTAINER</span><span class="w"> </span>crictl<span class="w"> </span>version
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#008-crictl-__codelineno-13-9"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$KIND_CONTAINER</span><span class="w"> </span>crictl<span class="w"> </span>images
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#008-crictl-__codelineno-13-10"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$KIND_CONTAINER</span><span class="w"> </span>crictl<span class="w"> </span>ps<span class="w"> </span>-a
</span></code></pre></div>
<hr />
<h2 id="008-crictl-05-working-with-container-images">05. Working with Container Images<a class="headerlink" href="#008-crictl-05-working-with-container-images" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-list-images">List Images<a class="headerlink" href="#008-crictl-list-images" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#008-crictl-__codelineno-14-1"></a><span class="c1"># List all images</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#008-crictl-__codelineno-14-2"></a>crictl<span class="w"> </span>images
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#008-crictl-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#008-crictl-__codelineno-14-4"></a><span class="c1"># List images with detailed output</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#008-crictl-__codelineno-14-5"></a>crictl<span class="w"> </span>images<span class="w"> </span>-v
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#008-crictl-__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#008-crictl-__codelineno-14-7"></a><span class="c1"># List specific image</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#008-crictl-__codelineno-14-8"></a>crictl<span class="w"> </span>images<span class="w"> </span>nginx
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#008-crictl-__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#008-crictl-__codelineno-14-10"></a><span class="c1"># List images in JSON format</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#008-crictl-__codelineno-14-11"></a>crictl<span class="w"> </span>images<span class="w"> </span>-o<span class="w"> </span>json
</span></code></pre></div>
<h3 id="008-crictl-pull-images">Pull Images<a class="headerlink" href="#008-crictl-pull-images" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#008-crictl-__codelineno-15-1"></a><span class="c1"># Pull an image</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#008-crictl-__codelineno-15-2"></a>crictl<span class="w"> </span>pull<span class="w"> </span>nginx:latest
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#008-crictl-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#008-crictl-__codelineno-15-4"></a><span class="c1"># Pull with specific registry</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#008-crictl-__codelineno-15-5"></a>crictl<span class="w"> </span>pull<span class="w"> </span>docker.io/library/alpine:latest
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#008-crictl-__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#008-crictl-__codelineno-15-7"></a><span class="c1"># Pull from private registry (requires authentication)</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#008-crictl-__codelineno-15-8"></a>crictl<span class="w"> </span>pull<span class="w"> </span>myregistry.com/myimage:v1.0
</span></code></pre></div>
<h3 id="008-crictl-inspect-images">Inspect Images<a class="headerlink" href="#008-crictl-inspect-images" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#008-crictl-__codelineno-16-1"></a><span class="c1"># Get detailed image information</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#008-crictl-__codelineno-16-2"></a>crictl<span class="w"> </span>inspecti<span class="w"> </span>nginx:latest
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#008-crictl-__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#008-crictl-__codelineno-16-4"></a><span class="c1"># Get image in JSON format</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#008-crictl-__codelineno-16-5"></a>crictl<span class="w"> </span>inspecti<span class="w"> </span>--output<span class="w"> </span>json<span class="w"> </span>nginx:latest<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#008-crictl-__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#008-crictl-__codelineno-16-7"></a><span class="c1"># Check image size and layers</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#008-crictl-__codelineno-16-8"></a>crictl<span class="w"> </span>inspecti<span class="w"> </span>nginx:latest<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">&#39;size|layer&#39;</span>
</span></code></pre></div>
<h3 id="008-crictl-remove-images">Remove Images<a class="headerlink" href="#008-crictl-remove-images" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#008-crictl-__codelineno-17-1"></a><span class="c1"># Remove image by name</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#008-crictl-__codelineno-17-2"></a>crictl<span class="w"> </span>rmi<span class="w"> </span>nginx:latest
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#008-crictl-__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#008-crictl-__codelineno-17-4"></a><span class="c1"># Remove image by ID</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#008-crictl-__codelineno-17-5"></a>crictl<span class="w"> </span>rmi<span class="w"> </span>a1b2c3d4e5f6
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#008-crictl-__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#008-crictl-__codelineno-17-7"></a><span class="c1"># Remove all unused images</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#008-crictl-__codelineno-17-8"></a>crictl<span class="w"> </span>rmi<span class="w"> </span>--prune
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#008-crictl-__codelineno-17-9"></a>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#008-crictl-__codelineno-17-10"></a><span class="c1"># Force remove image</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#008-crictl-__codelineno-17-11"></a>crictl<span class="w"> </span>rmi<span class="w"> </span>-f<span class="w"> </span>nginx:latest
</span></code></pre></div>
<hr />
<h2 id="008-crictl-06-container-operations">06. Container Operations<a class="headerlink" href="#008-crictl-06-container-operations" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-list-containers">List Containers<a class="headerlink" href="#008-crictl-list-containers" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#008-crictl-__codelineno-18-1"></a><span class="c1"># List all running containers</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#008-crictl-__codelineno-18-2"></a>crictl<span class="w"> </span>ps
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#008-crictl-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#008-crictl-__codelineno-18-4"></a><span class="c1"># List all containers (including stopped)</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#008-crictl-__codelineno-18-5"></a>crictl<span class="w"> </span>ps<span class="w"> </span>-a
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#008-crictl-__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#008-crictl-__codelineno-18-7"></a><span class="c1"># List containers with detailed information</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#008-crictl-__codelineno-18-8"></a>crictl<span class="w"> </span>ps<span class="w"> </span>-v
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#008-crictl-__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#008-crictl-__codelineno-18-10"></a><span class="c1"># Filter containers by state</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#008-crictl-__codelineno-18-11"></a>crictl<span class="w"> </span>ps<span class="w"> </span>--state<span class="w"> </span>running
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#008-crictl-__codelineno-18-12"></a>crictl<span class="w"> </span>ps<span class="w"> </span>--state<span class="w"> </span>exited
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#008-crictl-__codelineno-18-13"></a>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#008-crictl-__codelineno-18-14"></a><span class="c1"># Filter by name</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#008-crictl-__codelineno-18-15"></a>crictl<span class="w"> </span>ps<span class="w"> </span>--name<span class="w"> </span>nginx
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#008-crictl-__codelineno-18-16"></a>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#008-crictl-__codelineno-18-17"></a><span class="c1"># Filter by pod</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#008-crictl-__codelineno-18-18"></a>crictl<span class="w"> </span>ps<span class="w"> </span>--pod<span class="w"> </span>mypod
</span></code></pre></div>
<h3 id="008-crictl-create-and-run-containers">Create and Run Containers<a class="headerlink" href="#008-crictl-create-and-run-containers" title="Permanent link">&para;</a></h3>
<p>First, we need to create a pod sandbox, then create containers within it:</p>
<p><strong>Step 1: Create Pod Configuration</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#008-crictl-__codelineno-19-1"></a><span class="c1"># Create pod config file</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#008-crictl-__codelineno-19-2"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>pod-config.json<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#008-crictl-__codelineno-19-3"></a><span class="s">{</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#008-crictl-__codelineno-19-4"></a><span class="s">    &quot;metadata&quot;: {</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#008-crictl-__codelineno-19-5"></a><span class="s">        &quot;name&quot;: &quot;debug-pod&quot;,</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#008-crictl-__codelineno-19-6"></a><span class="s">        &quot;namespace&quot;: &quot;default&quot;,</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#008-crictl-__codelineno-19-7"></a><span class="s">        &quot;uid&quot;: &quot;debug-pod-uid&quot;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#008-crictl-__codelineno-19-8"></a><span class="s">    },</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#008-crictl-__codelineno-19-9"></a><span class="s">    &quot;log_directory&quot;: &quot;/tmp&quot;,</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#008-crictl-__codelineno-19-10"></a><span class="s">    &quot;linux&quot;: {}</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#008-crictl-__codelineno-19-11"></a><span class="s">}</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#008-crictl-__codelineno-19-12"></a><span class="s">EOF</span>
</span></code></pre></div>
<p><strong>Step 2: Create Container Configuration</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#008-crictl-__codelineno-20-1"></a><span class="c1"># Create container config file</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#008-crictl-__codelineno-20-2"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>container-config.json<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#008-crictl-__codelineno-20-3"></a><span class="s">{</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#008-crictl-__codelineno-20-4"></a><span class="s">    &quot;metadata&quot;: {</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#008-crictl-__codelineno-20-5"></a><span class="s">        &quot;name&quot;: &quot;debug-container&quot;</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#008-crictl-__codelineno-20-6"></a><span class="s">    },</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#008-crictl-__codelineno-20-7"></a><span class="s">    &quot;image&quot;: {</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#008-crictl-__codelineno-20-8"></a><span class="s">        &quot;image&quot;: &quot;nginx:latest&quot;</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#008-crictl-__codelineno-20-9"></a><span class="s">    },</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#008-crictl-__codelineno-20-10"></a><span class="s">    &quot;command&quot;: [</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#008-crictl-__codelineno-20-11"></a><span class="s">        &quot;nginx&quot;,</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#008-crictl-__codelineno-20-12"></a><span class="s">        &quot;-g&quot;,</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#008-crictl-__codelineno-20-13"></a><span class="s">        &quot;daemon off;&quot;</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#008-crictl-__codelineno-20-14"></a><span class="s">    ],</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#008-crictl-__codelineno-20-15"></a><span class="s">    &quot;log_path&quot;: &quot;debug-container.log&quot;,</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#008-crictl-__codelineno-20-16"></a><span class="s">    &quot;linux&quot;: {}</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#008-crictl-__codelineno-20-17"></a><span class="s">}</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#008-crictl-__codelineno-20-18"></a><span class="s">EOF</span>
</span></code></pre></div>
<p><strong>Step 3: Create Pod and Container</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#008-crictl-__codelineno-21-1"></a><span class="c1"># Create the pod sandbox</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#008-crictl-__codelineno-21-2"></a><span class="nv">POD_ID</span><span class="o">=</span><span class="k">$(</span>crictl<span class="w"> </span>runp<span class="w"> </span>pod-config.json<span class="k">)</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#008-crictl-__codelineno-21-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Pod ID: </span><span class="nv">$POD_ID</span><span class="s2">&quot;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#008-crictl-__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#008-crictl-__codelineno-21-5"></a><span class="c1"># Create the container</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#008-crictl-__codelineno-21-6"></a><span class="nv">CONTAINER_ID</span><span class="o">=</span><span class="k">$(</span>crictl<span class="w"> </span>create<span class="w"> </span><span class="nv">$POD_ID</span><span class="w"> </span>container-config.json<span class="w"> </span>pod-config.json<span class="k">)</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#008-crictl-__codelineno-21-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Container ID: </span><span class="nv">$CONTAINER_ID</span><span class="s2">&quot;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#008-crictl-__codelineno-21-8"></a>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#008-crictl-__codelineno-21-9"></a><span class="c1"># Start the container</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#008-crictl-__codelineno-21-10"></a>crictl<span class="w"> </span>start<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#008-crictl-__codelineno-21-11"></a>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#008-crictl-__codelineno-21-12"></a><span class="c1"># Verify the container is running</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#008-crictl-__codelineno-21-13"></a>crictl<span class="w"> </span>ps
</span></code></pre></div>
<h3 id="008-crictl-stop-and-remove-containers">Stop and Remove Containers<a class="headerlink" href="#008-crictl-stop-and-remove-containers" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#008-crictl-__codelineno-22-1"></a><span class="c1"># Stop a container</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#008-crictl-__codelineno-22-2"></a>crictl<span class="w"> </span>stop<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#008-crictl-__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#008-crictl-__codelineno-22-4"></a><span class="c1"># Stop with timeout</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#008-crictl-__codelineno-22-5"></a>crictl<span class="w"> </span>stop<span class="w"> </span>--timeout<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#008-crictl-__codelineno-22-6"></a>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#008-crictl-__codelineno-22-7"></a><span class="c1"># Remove a container</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#008-crictl-__codelineno-22-8"></a>crictl<span class="w"> </span>rm<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#008-crictl-__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#008-crictl-__codelineno-22-10"></a><span class="c1"># Force remove a running container</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#008-crictl-__codelineno-22-11"></a>crictl<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#008-crictl-__codelineno-22-12"></a>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#008-crictl-__codelineno-22-13"></a><span class="c1"># Remove all stopped containers</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#008-crictl-__codelineno-22-14"></a>crictl<span class="w"> </span>rm<span class="w"> </span><span class="k">$(</span>crictl<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span>-q<span class="w"> </span>--state<span class="w"> </span>exited<span class="k">)</span>
</span></code></pre></div>
<hr />
<h2 id="008-crictl-07-pod-operations">07. Pod Operations<a class="headerlink" href="#008-crictl-07-pod-operations" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-list-pods">List Pods<a class="headerlink" href="#008-crictl-list-pods" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#008-crictl-__codelineno-23-1"></a><span class="c1"># List all pods</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#008-crictl-__codelineno-23-2"></a>crictl<span class="w"> </span>pods
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#008-crictl-__codelineno-23-3"></a>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#008-crictl-__codelineno-23-4"></a><span class="c1"># List pods with details</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#008-crictl-__codelineno-23-5"></a>crictl<span class="w"> </span>pods<span class="w"> </span>-v
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#008-crictl-__codelineno-23-6"></a>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#008-crictl-__codelineno-23-7"></a><span class="c1"># List pods in specific namespace</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#008-crictl-__codelineno-23-8"></a>crictl<span class="w"> </span>pods<span class="w"> </span>--namespace<span class="w"> </span>default
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#008-crictl-__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#008-crictl-__codelineno-23-10"></a><span class="c1"># Filter by pod state</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#008-crictl-__codelineno-23-11"></a>crictl<span class="w"> </span>pods<span class="w"> </span>--state<span class="w"> </span>ready
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#008-crictl-__codelineno-23-12"></a>crictl<span class="w"> </span>pods<span class="w"> </span>--state<span class="w"> </span>notready
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#008-crictl-__codelineno-23-13"></a>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#008-crictl-__codelineno-23-14"></a><span class="c1"># Get pod in JSON format</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#008-crictl-__codelineno-23-15"></a>crictl<span class="w"> </span>pods<span class="w"> </span>-o<span class="w"> </span>json
</span></code></pre></div>
<h3 id="008-crictl-inspect-pods">Inspect Pods<a class="headerlink" href="#008-crictl-inspect-pods" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#008-crictl-__codelineno-24-1"></a><span class="c1"># Inspect specific pod</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#008-crictl-__codelineno-24-2"></a>crictl<span class="w"> </span>inspectp<span class="w"> </span><span class="nv">$POD_ID</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#008-crictl-__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#008-crictl-__codelineno-24-4"></a><span class="c1"># Get pod details in JSON</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#008-crictl-__codelineno-24-5"></a>crictl<span class="w"> </span>inspectp<span class="w"> </span>--output<span class="w"> </span>json<span class="w"> </span><span class="nv">$POD_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#008-crictl-__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#008-crictl-__codelineno-24-7"></a><span class="c1"># Check pod metadata</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#008-crictl-__codelineno-24-8"></a>crictl<span class="w"> </span>inspectp<span class="w"> </span><span class="nv">$POD_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span>metadata
</span></code></pre></div>
<h3 id="008-crictl-pod-lifecycle-management">Pod Lifecycle Management<a class="headerlink" href="#008-crictl-pod-lifecycle-management" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#008-crictl-__codelineno-25-1"></a><span class="c1"># Create pod from config</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#008-crictl-__codelineno-25-2"></a>crictl<span class="w"> </span>runp<span class="w"> </span>pod-config.json
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#008-crictl-__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#008-crictl-__codelineno-25-4"></a><span class="c1"># Stop a pod (stops all containers in the pod)</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#008-crictl-__codelineno-25-5"></a>crictl<span class="w"> </span>stopp<span class="w"> </span><span class="nv">$POD_ID</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#008-crictl-__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#008-crictl-__codelineno-25-7"></a><span class="c1"># Remove a pod</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#008-crictl-__codelineno-25-8"></a>crictl<span class="w"> </span>rmp<span class="w"> </span><span class="nv">$POD_ID</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#008-crictl-__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#008-crictl-__codelineno-25-10"></a><span class="c1"># Force remove a pod</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#008-crictl-__codelineno-25-11"></a>crictl<span class="w"> </span>rmp<span class="w"> </span>-f<span class="w"> </span><span class="nv">$POD_ID</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#008-crictl-__codelineno-25-12"></a>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#008-crictl-__codelineno-25-13"></a><span class="c1"># Remove all stopped pods</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#008-crictl-__codelineno-25-14"></a>crictl<span class="w"> </span>rmp<span class="w"> </span><span class="k">$(</span>crictl<span class="w"> </span>pods<span class="w"> </span>-q<span class="w"> </span>--state<span class="w"> </span>notready<span class="k">)</span>
</span></code></pre></div>
<hr />
<h2 id="008-crictl-08-debugging-containers">08. Debugging Containers<a class="headerlink" href="#008-crictl-08-debugging-containers" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-execute-commands-in-containers">Execute Commands in Containers<a class="headerlink" href="#008-crictl-execute-commands-in-containers" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#008-crictl-__codelineno-26-1"></a><span class="c1"># Execute command in running container</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#008-crictl-__codelineno-26-2"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>/bin/sh
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#008-crictl-__codelineno-26-3"></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#008-crictl-__codelineno-26-4"></a><span class="c1"># Execute specific command</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#008-crictl-__codelineno-26-5"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>ls<span class="w"> </span>-la<span class="w"> </span>/etc
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#008-crictl-__codelineno-26-6"></a>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#008-crictl-__codelineno-26-7"></a><span class="c1"># Execute with environment variables</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#008-crictl-__codelineno-26-8"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">ENV_VAR</span><span class="o">=</span>value<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>env
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#008-crictl-__codelineno-26-9"></a>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#008-crictl-__codelineno-26-10"></a><span class="c1"># Execute as specific user</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#008-crictl-__codelineno-26-11"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-u<span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>whoami
</span></code></pre></div>
<h3 id="008-crictl-interactive-debugging-session">Interactive Debugging Session<a class="headerlink" href="#008-crictl-interactive-debugging-session" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#008-crictl-__codelineno-27-1"></a><span class="c1"># Start interactive shell</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#008-crictl-__codelineno-27-2"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>/bin/bash
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#008-crictl-__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#008-crictl-__codelineno-27-4"></a><span class="c1"># Once inside, you can:</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#008-crictl-__codelineno-27-5"></a><span class="c1"># - Check running processes</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#008-crictl-__codelineno-27-6"></a>ps<span class="w"> </span>aux
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#008-crictl-__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#008-crictl-__codelineno-27-8"></a><span class="c1"># - Check network configuration</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#008-crictl-__codelineno-27-9"></a>ip<span class="w"> </span>addr
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#008-crictl-__codelineno-27-10"></a>netstat<span class="w"> </span>-tulpn
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#008-crictl-__codelineno-27-11"></a>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#008-crictl-__codelineno-27-12"></a><span class="c1"># - Check file system</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#008-crictl-__codelineno-27-13"></a>df<span class="w"> </span>-h
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#008-crictl-__codelineno-27-14"></a>ls<span class="w"> </span>-la<span class="w"> </span>/
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#008-crictl-__codelineno-27-15"></a>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#008-crictl-__codelineno-27-16"></a><span class="c1"># - Check environment variables</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#008-crictl-__codelineno-27-17"></a>env
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#008-crictl-__codelineno-27-18"></a>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#008-crictl-__codelineno-27-19"></a><span class="c1"># - Install debugging tools (if writable)</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#008-crictl-__codelineno-27-20"></a>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>procps<span class="w"> </span>net-tools
</span></code></pre></div>
<h3 id="008-crictl-container-stats-and-resources">Container Stats and Resources<a class="headerlink" href="#008-crictl-container-stats-and-resources" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#008-crictl-__codelineno-28-1"></a><span class="c1"># Get container stats (CPU, Memory, etc.)</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#008-crictl-__codelineno-28-2"></a>crictl<span class="w"> </span>stats
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#008-crictl-__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#008-crictl-__codelineno-28-4"></a><span class="c1"># Get stats for specific container</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#008-crictl-__codelineno-28-5"></a>crictl<span class="w"> </span>stats<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#008-crictl-__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#008-crictl-__codelineno-28-7"></a><span class="c1"># Continuous monitoring</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#008-crictl-__codelineno-28-8"></a>watch<span class="w"> </span>-n<span class="w"> </span><span class="m">2</span><span class="w"> </span>crictl<span class="w"> </span>stats
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#008-crictl-__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#008-crictl-__codelineno-28-10"></a><span class="c1"># Get stats in JSON format</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#008-crictl-__codelineno-28-11"></a>crictl<span class="w"> </span>stats<span class="w"> </span>-o<span class="w"> </span>json
</span></code></pre></div>
<hr />
<h2 id="008-crictl-09-inspecting-container-resources">09. Inspecting Container Resources<a class="headerlink" href="#008-crictl-09-inspecting-container-resources" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-inspect-container-details">Inspect Container Details<a class="headerlink" href="#008-crictl-inspect-container-details" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#008-crictl-__codelineno-29-1"></a><span class="c1"># Full container inspection</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#008-crictl-__codelineno-29-2"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#008-crictl-__codelineno-29-3"></a>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#008-crictl-__codelineno-29-4"></a><span class="c1"># Get specific fields using JSON query</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#008-crictl-__codelineno-29-5"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.info.config&#39;</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#008-crictl-__codelineno-29-6"></a>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#008-crictl-__codelineno-29-7"></a><span class="c1"># Check container mounts</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#008-crictl-__codelineno-29-8"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.info.mounts&#39;</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#008-crictl-__codelineno-29-9"></a>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#008-crictl-__codelineno-29-10"></a><span class="c1"># Check container environment</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#008-crictl-__codelineno-29-11"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.info.config.envs&#39;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#008-crictl-__codelineno-29-12"></a>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#008-crictl-__codelineno-29-13"></a><span class="c1"># Check container labels</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#008-crictl-__codelineno-29-14"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.info.config.labels&#39;</span>
</span></code></pre></div>
<h3 id="008-crictl-check-container-state">Check Container State<a class="headerlink" href="#008-crictl-check-container-state" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#008-crictl-__codelineno-30-1"></a><span class="c1"># Get container state</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#008-crictl-__codelineno-30-2"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.status.state&#39;</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#008-crictl-__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#008-crictl-__codelineno-30-4"></a><span class="c1"># Check exit code</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#008-crictl-__codelineno-30-5"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.status.exitCode&#39;</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#008-crictl-__codelineno-30-6"></a>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#008-crictl-__codelineno-30-7"></a><span class="c1"># Check started and finished times</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#008-crictl-__codelineno-30-8"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.status | {started: .startedAt, finished: .finishedAt}&#39;</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#008-crictl-__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#008-crictl-__codelineno-30-10"></a><span class="c1"># Check container PID</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#008-crictl-__codelineno-30-11"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.info.pid&#39;</span>
</span></code></pre></div>
<h3 id="008-crictl-inspect-container-networking">Inspect Container Networking<a class="headerlink" href="#008-crictl-inspect-container-networking" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#008-crictl-__codelineno-31-1"></a><span class="c1"># Get container IP address</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#008-crictl-__codelineno-31-2"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.status.network.ip&#39;</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#008-crictl-__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#008-crictl-__codelineno-31-4"></a><span class="c1"># Check network namespace</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#008-crictl-__codelineno-31-5"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.info.runtimeSpec.linux.namespaces[] | select(.type == &quot;network&quot;)&#39;</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#008-crictl-__codelineno-31-6"></a>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#008-crictl-__codelineno-31-7"></a><span class="c1"># List network interfaces</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#008-crictl-__codelineno-31-8"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>ip<span class="w"> </span>link<span class="w"> </span>show
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#008-crictl-__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#008-crictl-__codelineno-31-10"></a><span class="c1"># Check DNS configuration</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#008-crictl-__codelineno-31-11"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>cat<span class="w"> </span>/etc/resolv.conf
</span></code></pre></div>
<hr />
<h2 id="008-crictl-10-logs-and-troubleshooting">10. Logs and Troubleshooting<a class="headerlink" href="#008-crictl-10-logs-and-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-view-container-logs">View Container Logs<a class="headerlink" href="#008-crictl-view-container-logs" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#008-crictl-__codelineno-32-1"></a><span class="c1"># View container logs</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#008-crictl-__codelineno-32-2"></a>crictl<span class="w"> </span>logs<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#008-crictl-__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#008-crictl-__codelineno-32-4"></a><span class="c1"># Follow logs in real-time</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#008-crictl-__codelineno-32-5"></a>crictl<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#008-crictl-__codelineno-32-6"></a>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#008-crictl-__codelineno-32-7"></a><span class="c1"># Get last N lines</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#008-crictl-__codelineno-32-8"></a>crictl<span class="w"> </span>logs<span class="w"> </span>--tail<span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#008-crictl-__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#008-crictl-__codelineno-32-10"></a><span class="c1"># Show timestamps</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#008-crictl-__codelineno-32-11"></a>crictl<span class="w"> </span>logs<span class="w"> </span>--timestamps<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#008-crictl-__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#008-crictl-__codelineno-32-13"></a><span class="c1"># Logs since specific time</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#008-crictl-__codelineno-32-14"></a>crictl<span class="w"> </span>logs<span class="w"> </span>--since<span class="w"> </span>1h<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span></code></pre></div>
<h3 id="008-crictl-common-debugging-scenarios">Common Debugging Scenarios<a class="headerlink" href="#008-crictl-common-debugging-scenarios" title="Permanent link">&para;</a></h3>
<p><strong>Scenario 1: Container Keeps Restarting</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#008-crictl-__codelineno-33-1"></a><span class="c1"># Check container status</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#008-crictl-__codelineno-33-2"></a>crictl<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>mycontainer
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#008-crictl-__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#008-crictl-__codelineno-33-4"></a><span class="c1"># Get container ID</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#008-crictl-__codelineno-33-5"></a><span class="nv">CONTAINER_ID</span><span class="o">=</span><span class="k">$(</span>crictl<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span>--name<span class="w"> </span>mycontainer<span class="w"> </span>-q<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#008-crictl-__codelineno-33-6"></a>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#008-crictl-__codelineno-33-7"></a><span class="c1"># Check logs for errors</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#008-crictl-__codelineno-33-8"></a>crictl<span class="w"> </span>logs<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#008-crictl-__codelineno-33-9"></a>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#008-crictl-__codelineno-33-10"></a><span class="c1"># Inspect exit code</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#008-crictl-__codelineno-33-11"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.status.exitCode&#39;</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#008-crictl-__codelineno-33-12"></a>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#008-crictl-__codelineno-33-13"></a><span class="c1"># Check restart count (from pod perspective)</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#008-crictl-__codelineno-33-14"></a>crictl<span class="w"> </span>inspectp<span class="w"> </span><span class="k">$(</span>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.info.sandboxID&#39;</span><span class="k">)</span>
</span></code></pre></div>
<p><strong>Scenario 2: Container Network Issues</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#008-crictl-__codelineno-34-1"></a><span class="c1"># Check container IP</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#008-crictl-__codelineno-34-2"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>ip<span class="w"> </span>addr
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#008-crictl-__codelineno-34-3"></a>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#008-crictl-__codelineno-34-4"></a><span class="c1"># Test connectivity from container</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#008-crictl-__codelineno-34-5"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span><span class="m">8</span>.8.8.8
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#008-crictl-__codelineno-34-6"></a>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#008-crictl-__codelineno-34-7"></a><span class="c1"># Check DNS resolution</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#008-crictl-__codelineno-34-8"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>nslookup<span class="w"> </span>google.com
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#008-crictl-__codelineno-34-9"></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#008-crictl-__codelineno-34-10"></a><span class="c1"># Check listening ports</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#008-crictl-__codelineno-34-11"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>netstat<span class="w"> </span>-tuln
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#008-crictl-__codelineno-34-12"></a>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#008-crictl-__codelineno-34-13"></a><span class="c1"># Inspect network configuration</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#008-crictl-__codelineno-34-14"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.info.runtimeSpec.linux.namespaces&#39;</span>
</span></code></pre></div>
<p><strong>Scenario 3: Container Storage Issues</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#008-crictl-__codelineno-35-1"></a><span class="c1"># Check disk usage in container</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#008-crictl-__codelineno-35-2"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>df<span class="w"> </span>-h
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#008-crictl-__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#008-crictl-__codelineno-35-4"></a><span class="c1"># List mounts</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#008-crictl-__codelineno-35-5"></a>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.info.mounts&#39;</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#008-crictl-__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#008-crictl-__codelineno-35-7"></a><span class="c1"># Check for read-only file systems</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#008-crictl-__codelineno-35-8"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>mount<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ro
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#008-crictl-__codelineno-35-9"></a>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#008-crictl-__codelineno-35-10"></a><span class="c1"># Inspect volume mounts</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#008-crictl-__codelineno-35-11"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>ls<span class="w"> </span>-la<span class="w"> </span>/var/lib/
</span></code></pre></div>
<p><strong>Scenario 4: High Resource Usage</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#008-crictl-__codelineno-36-1"></a><span class="c1"># Check container resource usage</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#008-crictl-__codelineno-36-2"></a>crictl<span class="w"> </span>stats<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#008-crictl-__codelineno-36-3"></a>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#008-crictl-__codelineno-36-4"></a><span class="c1"># Check processes inside container</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#008-crictl-__codelineno-36-5"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>ps<span class="w"> </span>aux
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#008-crictl-__codelineno-36-6"></a>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#008-crictl-__codelineno-36-7"></a><span class="c1"># Check memory usage</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#008-crictl-__codelineno-36-8"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>free<span class="w"> </span>-h
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#008-crictl-__codelineno-36-9"></a>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#008-crictl-__codelineno-36-10"></a><span class="c1"># Check for memory leaks</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#008-crictl-__codelineno-36-11"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>top<span class="w"> </span>-b<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span>
</span></code></pre></div>
<hr />
<h2 id="008-crictl-11-advanced-debugging-techniques">11. Advanced Debugging Techniques<a class="headerlink" href="#008-crictl-11-advanced-debugging-techniques" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-attach-to-running-container">Attach to Running Container<a class="headerlink" href="#008-crictl-attach-to-running-container" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#008-crictl-__codelineno-37-1"></a><span class="c1"># Attach to container&#39;s main process</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#008-crictl-__codelineno-37-2"></a>crictl<span class="w"> </span>attach<span class="w"> </span><span class="nv">$CONTAINER_ID</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#008-crictl-__codelineno-37-3"></a>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#008-crictl-__codelineno-37-4"></a><span class="c1"># Note: This attaches to the main process (PID 1)</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#008-crictl-__codelineno-37-5"></a><span class="c1"># Use Ctrl+P, Ctrl+Q to detach without stopping</span>
</span></code></pre></div>
<h3 id="008-crictl-port-forwarding-for-debugging">Port Forwarding for Debugging<a class="headerlink" href="#008-crictl-port-forwarding-for-debugging" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#008-crictl-__codelineno-38-1"></a><span class="c1"># Get container IP</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#008-crictl-__codelineno-38-2"></a><span class="nv">CONTAINER_IP</span><span class="o">=</span><span class="k">$(</span>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.status.network.ip&#39;</span><span class="k">)</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#008-crictl-__codelineno-38-3"></a>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#008-crictl-__codelineno-38-4"></a><span class="c1"># Access service from host</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#008-crictl-__codelineno-38-5"></a>curl<span class="w"> </span>http://<span class="nv">$CONTAINER_IP</span>:80
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#008-crictl-__codelineno-38-6"></a>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#008-crictl-__codelineno-38-7"></a><span class="c1"># Check open ports</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#008-crictl-__codelineno-38-8"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>netstat<span class="w"> </span>-tuln
</span></code></pre></div>
<h3 id="008-crictl-debugging-with-nsenter">Debugging with nsenter<a class="headerlink" href="#008-crictl-debugging-with-nsenter" title="Permanent link">&para;</a></h3>
<p>Access container namespaces directly from the host:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#008-crictl-__codelineno-39-1"></a><span class="c1"># Get container PID</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#008-crictl-__codelineno-39-2"></a><span class="nv">PID</span><span class="o">=</span><span class="k">$(</span>crictl<span class="w"> </span>inspect<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.info.pid&#39;</span><span class="k">)</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#008-crictl-__codelineno-39-3"></a>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#008-crictl-__codelineno-39-4"></a><span class="c1"># Enter network namespace</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#008-crictl-__codelineno-39-5"></a>sudo<span class="w"> </span>nsenter<span class="w"> </span>-t<span class="w"> </span><span class="nv">$PID</span><span class="w"> </span>-n<span class="w"> </span>ip<span class="w"> </span>addr
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#008-crictl-__codelineno-39-6"></a>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#008-crictl-__codelineno-39-7"></a><span class="c1"># Enter mount namespace</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#008-crictl-__codelineno-39-8"></a>sudo<span class="w"> </span>nsenter<span class="w"> </span>-t<span class="w"> </span><span class="nv">$PID</span><span class="w"> </span>-m<span class="w"> </span>ls<span class="w"> </span>/
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#008-crictl-__codelineno-39-9"></a>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#008-crictl-__codelineno-39-10"></a><span class="c1"># Enter all namespaces</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#008-crictl-__codelineno-39-11"></a>sudo<span class="w"> </span>nsenter<span class="w"> </span>-t<span class="w"> </span><span class="nv">$PID</span><span class="w"> </span>-a<span class="w"> </span>/bin/bash
</span></code></pre></div>
<h3 id="008-crictl-copy-files-tofrom-containers">Copy Files To/From Containers<a class="headerlink" href="#008-crictl-copy-files-tofrom-containers" title="Permanent link">&para;</a></h3>
<p>While crictl doesn&rsquo;t have a built-in cp command, you can use alternative methods:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#008-crictl-__codelineno-40-1"></a><span class="c1"># Copy file from host to container</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#008-crictl-__codelineno-40-2"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;cat &gt; /tmp/file.txt&#39;</span><span class="w"> </span>&lt;<span class="w"> </span>local-file.txt
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#008-crictl-__codelineno-40-3"></a>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#008-crictl-__codelineno-40-4"></a><span class="c1"># Copy file from container to host</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#008-crictl-__codelineno-40-5"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>cat<span class="w"> </span>/etc/config.yaml<span class="w"> </span>&gt;<span class="w"> </span>local-config.yaml
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#008-crictl-__codelineno-40-6"></a>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#008-crictl-__codelineno-40-7"></a><span class="c1"># Using tar for directories</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#008-crictl-__codelineno-40-8"></a>tar<span class="w"> </span>-cf<span class="w"> </span>-<span class="w"> </span>/local/dir<span class="w"> </span><span class="p">|</span><span class="w"> </span>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-i<span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>tar<span class="w"> </span>-xf<span class="w"> </span>-<span class="w"> </span>-C<span class="w"> </span>/container/path
</span></code></pre></div>
<h3 id="008-crictl-performance-profiling">Performance Profiling<a class="headerlink" href="#008-crictl-performance-profiling" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#008-crictl-__codelineno-41-1"></a><span class="c1"># CPU profile</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#008-crictl-__codelineno-41-2"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>top<span class="w"> </span>-b<span class="w"> </span>-n<span class="w"> </span><span class="m">1</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#008-crictl-__codelineno-41-3"></a>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#008-crictl-__codelineno-41-4"></a><span class="c1"># Memory profile</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#008-crictl-__codelineno-41-5"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>cat<span class="w"> </span>/proc/meminfo
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#008-crictl-__codelineno-41-6"></a>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#008-crictl-__codelineno-41-7"></a><span class="c1"># I/O stats</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#008-crictl-__codelineno-41-8"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>iostat<span class="w"> </span>-x<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">5</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#008-crictl-__codelineno-41-9"></a>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#008-crictl-__codelineno-41-10"></a><span class="c1"># Network stats</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#008-crictl-__codelineno-41-11"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nv">$CONTAINER_ID</span><span class="w"> </span>cat<span class="w"> </span>/proc/net/dev
</span></code></pre></div>
<h3 id="008-crictl-debugging-container-images">Debugging Container Images<a class="headerlink" href="#008-crictl-debugging-container-images" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#008-crictl-__codelineno-42-1"></a><span class="c1"># Create a debug container with custom entrypoint</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#008-crictl-__codelineno-42-2"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>debug-container.json<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#008-crictl-__codelineno-42-3"></a><span class="s">{</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#008-crictl-__codelineno-42-4"></a><span class="s">    &quot;metadata&quot;: {</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#008-crictl-__codelineno-42-5"></a><span class="s">        &quot;name&quot;: &quot;debug-container&quot;</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#008-crictl-__codelineno-42-6"></a><span class="s">    },</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#008-crictl-__codelineno-42-7"></a><span class="s">    &quot;image&quot;: {</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#008-crictl-__codelineno-42-8"></a><span class="s">        &quot;image&quot;: &quot;nginx:latest&quot;</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#008-crictl-__codelineno-42-9"></a><span class="s">    },</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#008-crictl-__codelineno-42-10"></a><span class="s">    &quot;command&quot;: [</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#008-crictl-__codelineno-42-11"></a><span class="s">        &quot;/bin/sh&quot;,</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#008-crictl-__codelineno-42-12"></a><span class="s">        &quot;-c&quot;,</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#008-crictl-__codelineno-42-13"></a><span class="s">        &quot;sleep 3600&quot;</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#008-crictl-__codelineno-42-14"></a><span class="s">    ],</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#008-crictl-__codelineno-42-15"></a><span class="s">    &quot;log_path&quot;: &quot;debug.log&quot;,</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#008-crictl-__codelineno-42-16"></a><span class="s">    &quot;linux&quot;: {}</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#008-crictl-__codelineno-42-17"></a><span class="s">}</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#008-crictl-__codelineno-42-18"></a><span class="s">EOF</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#008-crictl-__codelineno-42-19"></a>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20" href="#008-crictl-__codelineno-42-20"></a><span class="c1"># Create and start debug container</span>
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21" href="#008-crictl-__codelineno-42-21"></a><span class="nv">DEBUG_CONTAINER</span><span class="o">=</span><span class="k">$(</span>crictl<span class="w"> </span>create<span class="w"> </span><span class="nv">$POD_ID</span><span class="w"> </span>debug-container.json<span class="w"> </span>pod-config.json<span class="k">)</span>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22" href="#008-crictl-__codelineno-42-22"></a>crictl<span class="w"> </span>start<span class="w"> </span><span class="nv">$DEBUG_CONTAINER</span>
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23" href="#008-crictl-__codelineno-42-23"></a>
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24" href="#008-crictl-__codelineno-42-24"></a><span class="c1"># Now you can exec into it</span>
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25" href="#008-crictl-__codelineno-42-25"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span><span class="nv">$DEBUG_CONTAINER</span><span class="w"> </span>/bin/sh
</span></code></pre></div>
<hr />
<h2 id="008-crictl-12-clean-up">12. Clean up<a class="headerlink" href="#008-crictl-12-clean-up" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-remove-test-resources">Remove Test Resources<a class="headerlink" href="#008-crictl-remove-test-resources" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#008-crictl-__codelineno-43-1"></a><span class="c1"># Stop and remove containers</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#008-crictl-__codelineno-43-2"></a><span class="k">for</span><span class="w"> </span>container<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>crictl<span class="w"> </span>ps<span class="w"> </span>-q<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#008-crictl-__codelineno-43-3"></a><span class="w">    </span>crictl<span class="w"> </span>stop<span class="w"> </span><span class="nv">$container</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#008-crictl-__codelineno-43-4"></a><span class="w">    </span>crictl<span class="w"> </span>rm<span class="w"> </span><span class="nv">$container</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#008-crictl-__codelineno-43-5"></a><span class="k">done</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#008-crictl-__codelineno-43-6"></a>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#008-crictl-__codelineno-43-7"></a><span class="c1"># Remove all stopped containers</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#008-crictl-__codelineno-43-8"></a>crictl<span class="w"> </span>rm<span class="w"> </span><span class="k">$(</span>crictl<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span>-q<span class="w"> </span>--state<span class="w"> </span>exited<span class="k">)</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#008-crictl-__codelineno-43-9"></a>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#008-crictl-__codelineno-43-10"></a><span class="c1"># Stop and remove pods</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#008-crictl-__codelineno-43-11"></a><span class="k">for</span><span class="w"> </span>pod<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>crictl<span class="w"> </span>pods<span class="w"> </span>-q<span class="k">)</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#008-crictl-__codelineno-43-12"></a><span class="w">    </span>crictl<span class="w"> </span>stopp<span class="w"> </span><span class="nv">$pod</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#008-crictl-__codelineno-43-13"></a><span class="w">    </span>crictl<span class="w"> </span>rmp<span class="w"> </span><span class="nv">$pod</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#008-crictl-__codelineno-43-14"></a><span class="k">done</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#008-crictl-__codelineno-43-15"></a>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#008-crictl-__codelineno-43-16"></a><span class="c1"># Remove unused images</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#008-crictl-__codelineno-43-17"></a>crictl<span class="w"> </span>rmi<span class="w"> </span>--prune
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#008-crictl-__codelineno-43-18"></a>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#008-crictl-__codelineno-43-19"></a><span class="c1"># Clean up test files</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#008-crictl-__codelineno-43-20"></a>rm<span class="w"> </span>-f<span class="w"> </span>pod-config.json<span class="w"> </span>container-config.json<span class="w"> </span>debug-container.json
</span></code></pre></div>
<h3 id="008-crictl-complete-cleanup">Complete Cleanup<a class="headerlink" href="#008-crictl-complete-cleanup" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#008-crictl-__codelineno-44-1"></a><span class="c1"># Remove ALL containers (use with caution)</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#008-crictl-__codelineno-44-2"></a>crictl<span class="w"> </span>rm<span class="w"> </span>-a<span class="w"> </span>-f
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#008-crictl-__codelineno-44-3"></a>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#008-crictl-__codelineno-44-4"></a><span class="c1"># Remove ALL pods (use with caution)</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#008-crictl-__codelineno-44-5"></a>crictl<span class="w"> </span>rmp<span class="w"> </span>-a<span class="w"> </span>-f
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#008-crictl-__codelineno-44-6"></a>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#008-crictl-__codelineno-44-7"></a><span class="c1"># Remove ALL images (use with caution)</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#008-crictl-__codelineno-44-8"></a>crictl<span class="w"> </span>rmi<span class="w"> </span>-a
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#008-crictl-__codelineno-44-9"></a>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#008-crictl-__codelineno-44-10"></a><span class="c1"># Remove crictl config</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#008-crictl-__codelineno-44-11"></a>sudo<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>/etc/crictl/crictl.yaml
</span></code></pre></div>
<hr />
<h2 id="008-crictl-additional-resources">Additional Resources<a class="headerlink" href="#008-crictl-additional-resources" title="Permanent link">&para;</a></h2>
<h3 id="008-crictl-quick-reference-commands">Quick Reference Commands<a class="headerlink" href="#008-crictl-quick-reference-commands" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#008-crictl-__codelineno-45-1"></a><span class="c1"># Images</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#008-crictl-__codelineno-45-2"></a>crictl<span class="w"> </span>images<span class="w">                  </span><span class="c1"># List images</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#008-crictl-__codelineno-45-3"></a>crictl<span class="w"> </span>pull<span class="w"> </span>&lt;image&gt;<span class="w">           </span><span class="c1"># Pull image</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#008-crictl-__codelineno-45-4"></a>crictl<span class="w"> </span>rmi<span class="w"> </span>&lt;image&gt;<span class="w">            </span><span class="c1"># Remove image</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#008-crictl-__codelineno-45-5"></a>crictl<span class="w"> </span>inspecti<span class="w"> </span>&lt;image&gt;<span class="w">       </span><span class="c1"># Inspect image</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#008-crictl-__codelineno-45-6"></a>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#008-crictl-__codelineno-45-7"></a><span class="c1"># Containers</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#008-crictl-__codelineno-45-8"></a>crictl<span class="w"> </span>ps<span class="w">                     </span><span class="c1"># List running containers</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#008-crictl-__codelineno-45-9"></a>crictl<span class="w"> </span>ps<span class="w"> </span>-a<span class="w">                  </span><span class="c1"># List all containers</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#008-crictl-__codelineno-45-10"></a>crictl<span class="w"> </span>inspect<span class="w"> </span>&lt;container&gt;<span class="w">    </span><span class="c1"># Inspect container</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#008-crictl-__codelineno-45-11"></a>crictl<span class="w"> </span>logs<span class="w"> </span>&lt;container&gt;<span class="w">       </span><span class="c1"># View logs</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#008-crictl-__codelineno-45-12"></a>crictl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;container&gt;<span class="w">   </span><span class="c1"># Execute command</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#008-crictl-__codelineno-45-13"></a>crictl<span class="w"> </span>stats<span class="w">                  </span><span class="c1"># Container stats</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#008-crictl-__codelineno-45-14"></a>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#008-crictl-__codelineno-45-15"></a><span class="c1"># Pods</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#008-crictl-__codelineno-45-16"></a>crictl<span class="w"> </span>pods<span class="w">                   </span><span class="c1"># List pods</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#008-crictl-__codelineno-45-17"></a>crictl<span class="w"> </span>runp<span class="w"> </span>&lt;config&gt;<span class="w">          </span><span class="c1"># Create pod</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#008-crictl-__codelineno-45-18"></a>crictl<span class="w"> </span>stopp<span class="w"> </span>&lt;pod&gt;<span class="w">            </span><span class="c1"># Stop pod</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#008-crictl-__codelineno-45-19"></a>crictl<span class="w"> </span>rmp<span class="w"> </span>&lt;pod&gt;<span class="w">              </span><span class="c1"># Remove pod</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#008-crictl-__codelineno-45-20"></a>crictl<span class="w"> </span>inspectp<span class="w"> </span>&lt;pod&gt;<span class="w">         </span><span class="c1"># Inspect pod</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#008-crictl-__codelineno-45-21"></a>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#008-crictl-__codelineno-45-22"></a><span class="c1"># System</span>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#008-crictl-__codelineno-45-23"></a>crictl<span class="w"> </span>version<span class="w">                </span><span class="c1"># Version info</span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#008-crictl-__codelineno-45-24"></a>crictl<span class="w"> </span>info<span class="w">                   </span><span class="c1"># Runtime info</span>
</span></code></pre></div>
<h3 id="008-crictl-useful-debugging-tips">Useful Debugging Tips<a class="headerlink" href="#008-crictl-useful-debugging-tips" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Always check logs first</strong>: <code>crictl logs &lt;container-id&gt;</code></li>
<li><strong>Use <code>-v</code> flag for verbose output</strong>: Provides more details</li>
<li><strong>Combine with jq for JSON parsing</strong>: <code>crictl inspect &lt;id&gt; | jq .</code></li>
<li><strong>Use &ndash;state flag to filter</strong>: Quickly find stopped containers</li>
<li><strong>Export CONTAINER_RUNTIME_ENDPOINT</strong>: Save typing for repeated commands</li>
<li><strong>Use watch for monitoring</strong>: <code>watch -n 2 crictl stats</code></li>
</ol>
<h3 id="008-crictl-common-issues-and-solutions">Common Issues and Solutions<a class="headerlink" href="#008-crictl-common-issues-and-solutions" title="Permanent link">&para;</a></h3>
<p><strong>Issue: &ldquo;error reading server preface: http2: frame too large&rdquo; or &ldquo;CRI v1 image API&rdquo; error</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#008-crictl-__codelineno-46-1"></a><span class="c1"># Problem: Trying to connect to Docker socket instead of containerd</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#008-crictl-__codelineno-46-2"></a><span class="c1"># Docker doesn&#39;t support CRI protocol directly</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#008-crictl-__codelineno-46-3"></a>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#008-crictl-__codelineno-46-4"></a><span class="c1"># Solution 1: Use containerd socket (macOS/Docker Desktop)</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#008-crictl-__codelineno-46-5"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.config/crictl
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#008-crictl-__codelineno-46-6"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>~/.config/crictl/crictl.yaml<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#008-crictl-__codelineno-46-7"></a><span class="s">runtime-endpoint: unix:///var/run/containerd/containerd.sock</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#008-crictl-__codelineno-46-8"></a><span class="s">image-endpoint: unix:///var/run/containerd/containerd.sock</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#008-crictl-__codelineno-46-9"></a><span class="s">timeout: 10</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#008-crictl-__codelineno-46-10"></a><span class="s">EOF</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#008-crictl-__codelineno-46-11"></a>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#008-crictl-__codelineno-46-12"></a><span class="c1"># Solution 2: Find correct socket location</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#008-crictl-__codelineno-46-13"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/run/containerd/containerd.sock
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#008-crictl-__codelineno-46-14"></a>ls<span class="w"> </span>-la<span class="w"> </span>/run/containerd/containerd.sock
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#008-crictl-__codelineno-46-15"></a>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#008-crictl-__codelineno-46-16"></a><span class="c1"># Solution 3: Test with explicit endpoint</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#008-crictl-__codelineno-46-17"></a>crictl<span class="w"> </span>--runtime-endpoint<span class="w"> </span>unix:///var/run/containerd/containerd.sock<span class="w"> </span>version
</span></code></pre></div>
<p><strong>Issue: &ldquo;connection refused&rdquo; error</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#008-crictl-__codelineno-47-1"></a><span class="c1"># Solution: Check runtime socket exists and crictl config</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#008-crictl-__codelineno-47-2"></a>ls<span class="w"> </span>-la<span class="w"> </span>/var/run/containerd/containerd.sock
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#008-crictl-__codelineno-47-3"></a>cat<span class="w"> </span>~/.config/crictl/crictl.yaml
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#008-crictl-__codelineno-47-4"></a>cat<span class="w"> </span>/etc/crictl/crictl.yaml
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#008-crictl-__codelineno-47-5"></a>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#008-crictl-__codelineno-47-6"></a><span class="c1"># Verify containerd is running (macOS/Docker Desktop)</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#008-crictl-__codelineno-47-7"></a>ps<span class="w"> </span>aux<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>containerd
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#008-crictl-__codelineno-47-8"></a>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#008-crictl-__codelineno-47-9"></a><span class="c1"># Check Docker Desktop is running</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#008-crictl-__codelineno-47-10"></a>docker<span class="w"> </span>version
</span></code></pre></div>
<p><strong>Issue: Permission denied</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#008-crictl-__codelineno-48-1"></a><span class="c1"># Solution: Run with sudo or add user to docker/containerd group</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#008-crictl-__codelineno-48-2"></a>sudo<span class="w"> </span>crictl<span class="w"> </span>ps
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#008-crictl-__codelineno-48-3"></a>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#008-crictl-__codelineno-48-4"></a><span class="c1"># Or add user to docker group (Linux)</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#008-crictl-__codelineno-48-5"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USER</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#008-crictl-__codelineno-48-6"></a>newgrp<span class="w"> </span>docker
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#008-crictl-__codelineno-48-7"></a>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#008-crictl-__codelineno-48-8"></a><span class="c1"># On macOS with Docker Desktop, usually no sudo needed</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#008-crictl-__codelineno-48-9"></a><span class="c1"># Just ensure Docker Desktop is running</span>
</span></code></pre></div>
<p><strong>Issue: Container not starting</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#008-crictl-__codelineno-49-1"></a><span class="c1"># Solution: Check logs and inspect container</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#008-crictl-__codelineno-49-2"></a>crictl<span class="w"> </span>logs<span class="w"> </span>&lt;container-id&gt;
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#008-crictl-__codelineno-49-3"></a>crictl<span class="w"> </span>inspect<span class="w"> </span>&lt;container-id&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.status&#39;</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#008-crictl-__codelineno-49-4"></a>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#008-crictl-__codelineno-49-5"></a><span class="c1"># Check if container exists</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#008-crictl-__codelineno-49-6"></a>crictl<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>&lt;container-name&gt;
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#008-crictl-__codelineno-49-7"></a>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#008-crictl-__codelineno-49-8"></a><span class="c1"># Check pod status</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#008-crictl-__codelineno-49-9"></a>crictl<span class="w"> </span>pods
</span></code></pre></div>
<p><strong>Issue: &ldquo;namespace not found&rdquo; on macOS</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#008-crictl-__codelineno-50-1"></a><span class="c1"># crictl shows containers from containerd namespace, not Docker namespace</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#008-crictl-__codelineno-50-2"></a><span class="c1"># To see Docker containers, you need to use Docker CLI</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#008-crictl-__codelineno-50-3"></a>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#008-crictl-__codelineno-50-4"></a><span class="c1"># List containerd namespaces</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#008-crictl-__codelineno-50-5"></a>sudo<span class="w"> </span>ctr<span class="w"> </span>--address<span class="w"> </span>/var/run/containerd/containerd.sock<span class="w"> </span>namespaces<span class="w"> </span>list
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#008-crictl-__codelineno-50-6"></a>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#008-crictl-__codelineno-50-7"></a><span class="c1"># List containers in specific namespace</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#008-crictl-__codelineno-50-8"></a>sudo<span class="w"> </span>ctr<span class="w"> </span>--address<span class="w"> </span>/var/run/containerd/containerd.sock<span class="w"> </span>--namespace<span class="w"> </span>k8s.io<span class="w"> </span>containers<span class="w"> </span>list
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#008-crictl-__codelineno-50-9"></a>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#008-crictl-__codelineno-50-10"></a><span class="c1"># Note: Docker containers run in &#39;moby&#39; namespace usually</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#008-crictl-__codelineno-50-11"></a>sudo<span class="w"> </span>ctr<span class="w"> </span>--address<span class="w"> </span>/var/run/containerd/containerd.sock<span class="w"> </span>--namespace<span class="w"> </span>moby<span class="w"> </span>containers<span class="w"> </span>list
</span></code></pre></div>
<h3 id="008-crictl-documentation-links">Documentation Links<a class="headerlink" href="#008-crictl-documentation-links" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Official Documentation</strong>: https://github.com/kubernetes-sigs/cri-tools</li>
<li><strong>CRI Specification</strong>: https://github.com/kubernetes/cri-api</li>
<li><strong>Containerd</strong>: https://containerd.io/</li>
<li><strong>Kubernetes Debugging</strong>: https://kubernetes.io/docs/tasks/debug/</li>
</ul>
<hr />
<p><img alt="Well Done" src="../assets/images/well-done.png" /></p></section><section class="print-page" id="009-dive-layers" heading-number="1.10"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="009-dive-layers-lab-009-inspect-docker-image-layers-with-dive">Lab 009 - Inspect Docker Image Layers with Dive<a class="headerlink" href="#009-dive-layers-lab-009-inspect-docker-image-layers-with-dive" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab introduces the <code>dive</code> tool for analyzing Docker image layers.</li>
<li><code>dive</code> is a tool for exploring each layer in a Docker image, helping you understand what&rsquo;s changed in each layer and identify ways to optimize your images.</li>
<li>In this lab, we&rsquo;ll create a multi-layer Docker image and use <code>dive</code> to inspect its layers.</li>
<li>By the end of this lab, you&rsquo;ll understand how Docker images are built layer by layer and how to use <code>dive</code> for image analysis.</li>
</ul>
<hr />
<h2 id="009-dive-layers-what-is-dive">What is Dive?<a class="headerlink" href="#009-dive-layers-what-is-dive" title="Permanent link">&para;</a></h2>
<ul>
<li><code>dive</code> is a tool for exploring the contents of Docker images.</li>
<li>It allows you to see what files were added, modified, or removed in each layer.</li>
<li>This is useful for optimizing image size, understanding image composition, and debugging build issues.</li>
<li><code>dive</code> can be run as a Docker container itself or installed locally.</li>
</ul>
<hr />
<h2 id="009-dive-layers-01-setup-dive">01. Setup Dive<a class="headerlink" href="#009-dive-layers-01-setup-dive" title="Permanent link">&para;</a></h2>
<ul>
<li>First, let&rsquo;s pull the <code>dive</code> image from Docker Hub.</li>
<li>If <code>dive</code> is not installed locally, we can use it via Docker.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#009-dive-layers-__codelineno-0-1"></a><span class="c1"># Pull the dive image</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#009-dive-layers-__codelineno-0-2"></a>docker<span class="w"> </span>pull<span class="w"> </span>wagoodman/dive
</span></code></pre></div>
<ul>
<li>Check if <code>dive</code> is installed locally. If not, we&rsquo;ll alias it to run via Docker.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#009-dive-layers-__codelineno-1-1"></a><span class="c1"># Check if dive is installed</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#009-dive-layers-__codelineno-1-2"></a><span class="k">if</span><span class="w"> </span>!<span class="w"> </span><span class="nb">command</span><span class="w"> </span>-v<span class="w"> </span>dive<span class="w"> </span><span class="p">&amp;</span>&gt;<span class="w"> </span>/dev/null
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#009-dive-layers-__codelineno-1-3"></a><span class="k">then</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#009-dive-layers-__codelineno-1-4"></a><span class="w">  </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;dive could not be found, using Docker alias...&quot;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#009-dive-layers-__codelineno-1-5"></a><span class="w">  </span><span class="c1"># Alias dive to run via Docker</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#009-dive-layers-__codelineno-1-6"></a><span class="w">  </span><span class="nb">alias</span><span class="w"> </span><span class="nv">dive</span><span class="o">=</span><span class="s2">&quot;docker run -ti --rm -v /var/run/docker.sock:/var/run/docker.sock docker.io/wagoodman/dive&quot;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#009-dive-layers-__codelineno-1-7"></a><span class="k">fi</span>
</span></code></pre></div>
<hr />
<h2 id="009-dive-layers-02-create-a-multi-layer-dockerfile">02. Create a Multi-Layer Dockerfile<a class="headerlink" href="#009-dive-layers-02-create-a-multi-layer-dockerfile" title="Permanent link">&para;</a></h2>
<ul>
<li>Let&rsquo;s create a Dockerfile with several layers to demonstrate how <code>dive</code> works.</li>
<li>Each <code>RUN</code> command creates a new layer.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#009-dive-layers-__codelineno-2-1"></a><span class="c1"># Create the Dockerfile</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#009-dive-layers-__codelineno-2-2"></a>cat<span class="w"> </span><span class="s">&lt;&lt; EOF &gt; Dockerfile</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#009-dive-layers-__codelineno-2-3"></a><span class="s">### Layer 00</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#009-dive-layers-__codelineno-2-4"></a><span class="s">FROM alpine</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#009-dive-layers-__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#009-dive-layers-__codelineno-2-6"></a><span class="s">## Layer 01</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#009-dive-layers-__codelineno-2-7"></a><span class="s">WORKDIR /__app</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#009-dive-layers-__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#009-dive-layers-__codelineno-2-9"></a><span class="s">## Layer 02</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#009-dive-layers-__codelineno-2-10"></a><span class="s">RUN echo &quot;Hello World&quot; &gt; file1.txt</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#009-dive-layers-__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#009-dive-layers-__codelineno-2-12"></a><span class="s">## Layer 03</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#009-dive-layers-__codelineno-2-13"></a><span class="s">RUN echo &quot;10.10.10.10&quot; &gt; /etc/hosts</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#009-dive-layers-__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#009-dive-layers-__codelineno-2-15"></a><span class="s">## Layer 04</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#009-dive-layers-__codelineno-2-16"></a><span class="s">RUN cat /etc/hosts &gt; hosts.txt</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#009-dive-layers-__codelineno-2-17"></a>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#009-dive-layers-__codelineno-2-18"></a><span class="s">EOF</span>
</span></code></pre></div>
<hr />
<h2 id="009-dive-layers-03-build-the-image">03. Build the Image<a class="headerlink" href="#009-dive-layers-03-build-the-image" title="Permanent link">&para;</a></h2>
<ul>
<li>Build the Docker image from the Dockerfile.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#009-dive-layers-__codelineno-3-1"></a><span class="c1"># Build the image</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#009-dive-layers-__codelineno-3-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>nirgeier/docker-labs-07-dive<span class="w"> </span>-f<span class="w"> </span>Dockerfile<span class="w"> </span>.
</span></code></pre></div>
<hr />
<h2 id="009-dive-layers-04-print-the-dockerfile-layers">04. Print the Dockerfile Layers<a class="headerlink" href="#009-dive-layers-04-print-the-dockerfile-layers" title="Permanent link">&para;</a></h2>
<ul>
<li>Let&rsquo;s review what each layer does:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#009-dive-layers-__codelineno-4-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=== Dockerfile Layers ===&quot;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#009-dive-layers-__codelineno-4-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Layer 00: FROM alpine&quot;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#009-dive-layers-__codelineno-4-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Layer 01: WORKDIR /__app&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#009-dive-layers-__codelineno-4-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Layer 02: RUN echo \&quot;Hello World\&quot; &gt; file1.txt&quot;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#009-dive-layers-__codelineno-4-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Layer 03: RUN echo \&quot;10.10.10.10\&quot; &gt; /etc/hosts&quot;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#009-dive-layers-__codelineno-4-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Layer 04: RUN cat /etc/hosts &gt; hosts.txt&quot;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#009-dive-layers-__codelineno-4-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;=========================&quot;</span>
</span></code></pre></div>
<hr />
<h2 id="009-dive-layers-05-inspect-layers-with-dive">05. Inspect Layers with Dive<a class="headerlink" href="#009-dive-layers-05-inspect-layers-with-dive" title="Permanent link">&para;</a></h2>
<ul>
<li>Now, let&rsquo;s use <code>dive</code> to inspect the image layers.</li>
<li><code>dive</code> will analyze the image and show you what&rsquo;s in each layer.</li>
<li>We&rsquo;ll also generate a JSON output file for further analysis.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#009-dive-layers-__codelineno-5-1"></a><span class="c1"># Run dive on the image and generate JSON output</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#009-dive-layers-__codelineno-5-2"></a>dive<span class="w"> </span>nirgeier/docker-labs-07-dive<span class="w"> </span>--json<span class="w"> </span>output.json
</span></code></pre></div>
<ul>
<li>When <code>dive</code> runs, you&rsquo;ll see an interactive interface showing:</li>
<li>The layers on the left</li>
<li>File changes in each layer on the right</li>
<li>Use arrow keys to navigate, and press <code>Ctrl+C</code> to exit</li>
</ul>
<hr />
<h2 id="009-dive-layers-06-analyze-the-json-output">06. Analyze the JSON Output<a class="headerlink" href="#009-dive-layers-06-analyze-the-json-output" title="Permanent link">&para;</a></h2>
<ul>
<li>After running <code>dive</code>, we can analyze the <code>output.json</code> file.</li>
<li>Let&rsquo;s use <code>jq</code> to extract information about files changed in layers 2 and above.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#009-dive-layers-__codelineno-6-1"></a><span class="c1"># Search for files changed in layers starting from index 2</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#009-dive-layers-__codelineno-6-2"></a>jq<span class="w"> </span><span class="s1">&#39;.layer[] | select(.index &gt;= 2) | &quot;\(.command) -&gt; \(.fileList[]?.path)&quot;&#39;</span><span class="w"> </span>output.json
</span></code></pre></div>
<ul>
<li>This will show you which files were added or modified in each layer.</li>
</ul>
<hr />
<h2 id="009-dive-layers-07-clean-up">07. Clean Up<a class="headerlink" href="#009-dive-layers-07-clean-up" title="Permanent link">&para;</a></h2>
<ul>
<li>Remove the created image and files.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#009-dive-layers-__codelineno-7-1"></a><span class="c1"># Remove the image</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#009-dive-layers-__codelineno-7-2"></a>docker<span class="w"> </span>rmi<span class="w"> </span>nirgeier/docker-labs-07-dive
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#009-dive-layers-__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#009-dive-layers-__codelineno-7-4"></a><span class="c1"># Remove the Dockerfile and output.json</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#009-dive-layers-__codelineno-7-5"></a>rm<span class="w"> </span>-f<span class="w"> </span>Dockerfile<span class="w"> </span>output.json
</span></code></pre></div>
<hr />
<p><img alt="Well Done" src="../assets/images/well-done.png" /></p></section><section class="print-page" id="010-bake" heading-number="1.11"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="010-bake-lab-010-docker-bake">Lab 010 - Docker Bake<a class="headerlink" href="#010-bake-lab-010-docker-bake" title="Permanent link">&para;</a></h1>
<!-- omit in toc -->
<h2 id="010-bake-table-of-contents">Table of Contents<a class="headerlink" href="#010-bake-table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#010-bake-1-introduction">1. Introduction</a></li>
<li><a href="#010-bake-what-is-docker-docker-bake">What is Docker <code>Docker Bake</code>?</a></li>
<li><a href="#010-bake-what-is-docker-buildkit">What is Docker <code>BuildKit</code>?</a></li>
<li><a href="#010-bake-key-features">Key Features</a></li>
<li><a href="#010-bake-comparison-docker-bake-vs-docker-compose">Comparison: Docker Bake vs Docker Compose</a></li>
<li><a href="#010-bake-docker-bake-syntax">Docker Bake syntax</a></li>
<li><a href="#010-bake-common-commands">Common Commands</a></li>
<li><a href="#010-bake-advanced-features">Advanced Features</a></li>
<li><a href="#010-bake-multi-stage-builds-with-matrix">Multi-Stage Builds with Matrix</a></li>
<li><a href="#010-bake-build-secrets">Build Secrets</a></li>
<li><a href="#010-bake-cache-configuration--build-caching">Cache Configuration / Build Caching</a></li>
<li><a href="#010-bake-cache-configuration--build-caching-workflow">Cache Configuration / Build Caching Workflow</a></li>
<li><a href="#010-bake-target-inheritance">Target Inheritance</a></li>
</ul>
<hr />
<h2 id="010-bake-1-introduction">1. Introduction<a class="headerlink" href="#010-bake-1-introduction" title="Permanent link">&para;</a></h2>
<h3 id="010-bake-what-is-docker-docker-bake">What is Docker <a href="https://docs.docker.com/build/bake/"><code>Docker Bake</code></a>?<a class="headerlink" href="#010-bake-what-is-docker-docker-bake" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>üëç <code>Docker Bake</code> is a feature of <a href="https://docs.docker.com/build/buildkit/"><code>BuildKit</code></a> / <a href="https://docs.docker.com/reference/cli/docker/buildx/"><code>Docker Buildx</code></a> that allows you 
  to define and orchestrate complex builds using a high-level build tool that uses to build Docker images defined in configuration files.</p>
</li>
<li>
<p>üëç <code>Docker Bake</code> is written in a declarative language (<code>HCL</code>, <code>JSON</code>, or <code>YAML</code>). </p>
</li>
<li>
<p>üëç <code>Docker Bake</code> is designed for building <strong>multiple images or targets concurrently</strong>, making it ideal for monorepos, microservices, or any project with several <code>Dockerfiles</code>.</p>
</li>
<li>
<p>üëç <code>Docker Bake</code> extends beyond single <code>Dockerfile</code>s to support complex build scenarios with multiple targets, platforms, and configurations.</p>
</li>
<li>
<p>üëç <code>Docker Bake</code> is designed for CI/CD pipelines, multi-platform builds, and complex build workflows.</p>
</li>
</ul>
<hr />
<h3 id="010-bake-what-is-docker-buildkit">What is Docker <a href="https://docs.docker.com/build/buildkit/"><code>BuildKit</code></a>?<a class="headerlink" href="#010-bake-what-is-docker-buildkit" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>üëç <code>BuildKit</code> is a modern build subsystem for Docker that improves performance, storage management, and caching  </p>
</li>
<li>
<p>üëç <code>BuildKit</code> is the engine behind <code>Docker Bake</code>, enabling advanced features like multi-platform builds, caching, and build secrets</p>
</li>
<li>
<p>üëç <code>BuildKit</code> is the default build engine for Docker, replacing the traditional docker build mechanism.</p>
</li>
<li>
<p>üëç <code>BuildKit</code> allows for parallel builds, advanced caching, and better resource utilization.</p>
</li>
<li>
<p>üëç <code>BuildKit</code> supports advanced features like build secrets, SSH forwarding, and more.</p>
</li>
<li>
<p>üëç <code>BuildKit</code> is a key component of the new Docker Engine 20.10 release, which includes the <code>buildkit</code> subcommand and the <code>docker buildx</code> command.</p>
</li>
</ul>
<hr />
<h3 id="010-bake-key-features">Key Features<a class="headerlink" href="#010-bake-key-features" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Advanced BuildKit Features</strong></td>
<td>Leverage BuildKit for caching, multi-platform builds, and advanced outputs.</td>
</tr>
<tr>
<td><strong>Advanced caching</strong></td>
<td>Sophisticated caching strategies for faster builds</td>
</tr>
<tr>
<td><strong>Build matrix</strong></td>
<td>Define multiple build configurations and targets</td>
</tr>
<tr>
<td><strong>Build secrets</strong></td>
<td>Securely pass sensitive information during builds</td>
</tr>
<tr>
<td><strong>Cache configuration</strong></td>
<td>Fine-tune caching strategies for faster builds</td>
</tr>
<tr>
<td><strong>CI/CD integration</strong></td>
<td>Ideal for automated build pipelines and workflows</td>
</tr>
<tr>
<td><strong>Concurrent Builds</strong></td>
<td>Build multiple images in parallel with a single command.</td>
</tr>
<tr>
<td><strong>Custom build arguments</strong></td>
<td>Specify different build arguments for each target</td>
</tr>
<tr>
<td><strong>Custom build contexts</strong></td>
<td>Specify different directories for each target</td>
</tr>
<tr>
<td><strong>Custom Dockerfiles</strong></td>
<td>Use different Dockerfiles for each target</td>
</tr>
<tr>
<td><strong>Declarative Build Configuration</strong></td>
<td>Define build targets, groups, arguments, tags, and more in a single file.</td>
</tr>
<tr>
<td><strong>Declarative syntax</strong></td>
<td>Use HCL, JSON, or YAML to define build configurations</td>
</tr>
<tr>
<td><strong>Extensibility</strong></td>
<td>Supports custom build steps and plugins</td>
</tr>
<tr>
<td><strong>Flexible File Formats</strong></td>
<td>Supports HCL (HashiCorp Configuration Language), JSON, and YAML (Compose extension).</td>
</tr>
<tr>
<td><strong>Group targets</strong></td>
<td>Organize multiple build targets into logical groups</td>
</tr>
<tr>
<td><strong>Inheritance</strong></td>
<td>Reuse common configurations across multiple targets</td>
</tr>
<tr>
<td><strong>Integration with Docker Compose</strong></td>
<td>You can use Compose files as Bake files for seamless migration.</td>
</tr>
<tr>
<td><strong>Matrix Builds</strong></td>
<td>Easily define build matrices for different platforms, versions, or configurations.</td>
</tr>
<tr>
<td><strong>Multi-platform builds</strong></td>
<td>Build for multiple architectures simultaneously (ARM, AMD64, etc.)</td>
</tr>
<tr>
<td><strong>Variable interpolation</strong></td>
<td>Use variables and functions for dynamic configurations</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="010-bake-comparison-docker-bake-vs-docker-compose">Comparison: Docker Bake vs Docker Compose<a class="headerlink" href="#010-bake-comparison-docker-bake-vs-docker-compose" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Docker Bake</th>
<th>Docker Compose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Purpose</strong></td>
<td>Build orchestration</td>
<td>Service orchestration</td>
</tr>
<tr>
<td><strong>File Format</strong></td>
<td>HCL, JSON, YAML (Compose)</td>
<td>YAML</td>
</tr>
<tr>
<td><strong>Parallel Builds</strong></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><strong>Multi-platform</strong></td>
<td>Yes (via BuildKit)</td>
<td>Limited</td>
</tr>
<tr>
<td><strong>Service Deploy</strong></td>
<td>No</td>
<td>Yes</td>
</tr>
<tr>
<td><strong>Caching</strong></td>
<td>Advanced BuildKit caching</td>
<td>Basic</td>
</tr>
<tr>
<td><strong>Inheritance</strong></td>
<td>Yes</td>
<td>No</td>
</tr>
<tr>
<td><strong>CI/CD</strong></td>
<td>Ideal for CI/CD pipelines</td>
<td>Limited</td>
</tr>
<tr>
<td><strong>Extensibility</strong></td>
<td>Supports custom build steps</td>
<td>Limited</td>
</tr>
<tr>
<td><strong>Advanced</strong></td>
<td>Advanced build features</td>
<td>Basic</td>
</tr>
</tbody>
</table>
<hr />
<blockquote>
<p>[!WARNING] 
<code>Docker Bake</code> requires Docker Engine v20.10.0 or higher.<br />
<code>Docker Bake</code> requires BuildKit for advanced build features.</p>
</blockquote>
<hr />
<h2 id="010-bake-docker-bake-syntax">Docker Bake syntax<a class="headerlink" href="#010-bake-docker-bake-syntax" title="Permanent link">&para;</a></h2>
<blockquote>
<p>[!IMPORTANT] 
<code>docker-bake.hcl</code> is a declarative build configuration file format.  </p>
</blockquote>
<ul>
<li>Here&rsquo;s a basic <code>docker-bake.hcl</code> file structure:</li>
<li>It uses the HashiCorp Configuration Language (HCL) syntax for defining build configurations.</li>
<li>This example defines two targets: <code>frontend</code> and <code>backend-api</code>, each with its own context, Dockerfile, tags, platforms, and build arguments.</li>
</ul>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#010-bake-__codelineno-0-1"></a><span class="c1"># Define variables</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#010-bake-__codelineno-0-2"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;TAG&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#010-bake-__codelineno-0-3"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;latest&quot;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#010-bake-__codelineno-0-4"></a><span class="p">}</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#010-bake-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#010-bake-__codelineno-0-6"></a><span class="c1"># Define a user variable for tagging images</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#010-bake-__codelineno-0-7"></a><span class="c1"># This can be your Docker Hub username or any identifier</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#010-bake-__codelineno-0-8"></a><span class="kr">variable</span><span class="w"> </span><span class="nv">&quot;USER&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#010-bake-__codelineno-0-9"></a><span class="w">  </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;username&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#010-bake-__codelineno-0-10"></a><span class="p">}</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#010-bake-__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#010-bake-__codelineno-0-12"></a><span class="c1"># Define a group of targets for default builds</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#010-bake-__codelineno-0-13"></a><span class="err">group</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#010-bake-__codelineno-0-14"></a><span class="w">  </span><span class="na">targets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;frontend&quot;, &quot;backend-api&quot;</span><span class="p">]</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#010-bake-__codelineno-0-15"></a><span class="p">}</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#010-bake-__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#010-bake-__codelineno-0-17"></a><span class="c1"># Frontend service</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#010-bake-__codelineno-0-18"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;frontend&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#010-bake-__codelineno-0-19"></a><span class="c1">  # Directory containing the frontend code</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#010-bake-__codelineno-0-20"></a><span class="w">  </span><span class="na">context</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./frontend&quot;</span><span class="c1">           </span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#010-bake-__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#010-bake-__codelineno-0-22"></a><span class="c1">  # Use a specific Dockerfile for production</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#010-bake-__codelineno-0-23"></a><span class="w">  </span><span class="na">dockerfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dockerfile.prod&quot;</span><span class="c1"> </span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#010-bake-__codelineno-0-24"></a>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#010-bake-__codelineno-0-25"></a><span class="c1">  # Tag the image with user and tag         </span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#010-bake-__codelineno-0-26"></a><span class="w">  </span><span class="na">tags</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;${USER}/frontend:${TAG}&quot;</span><span class="p">]</span><span class="c1">    </span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#010-bake-__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#010-bake-__codelineno-0-28"></a><span class="c1">  # Build for multiple architectures</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#010-bake-__codelineno-0-29"></a><span class="w">  </span><span class="na">platforms</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;linux/amd64&quot;, &quot;linux/arm64&quot;</span><span class="p">]</span><span class="c1">   </span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#010-bake-__codelineno-0-30"></a>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#010-bake-__codelineno-0-31"></a><span class="c1">  # Pass build-time variables to the Dockerfile </span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#010-bake-__codelineno-0-32"></a><span class="w">  </span><span class="nb">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#010-bake-__codelineno-0-33"></a><span class="c1">    # Set Node.js environment to production</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#010-bake-__codelineno-0-34"></a><span class="w">    </span><span class="na">NODE_ENV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;production&quot;</span><span class="c1"> </span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#010-bake-__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#010-bake-__codelineno-0-36"></a><span class="c1">    # Set API URL for the frontend</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#010-bake-__codelineno-0-37"></a><span class="w">    </span><span class="na">API_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://api.codewizard.com&quot;</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#010-bake-__codelineno-0-38"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#010-bake-__codelineno-0-39"></a><span class="p">}</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#010-bake-__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#010-bake-__codelineno-0-41"></a><span class="c1"># Node.js backend service</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#010-bake-__codelineno-0-42"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;backend-api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#010-bake-__codelineno-0-43"></a><span class="w">  </span><span class="na">context</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./backend&quot;</span><span class="w"> </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#010-bake-__codelineno-0-44"></a><span class="w">  </span><span class="na">dockerfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dockerfile&quot;</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#010-bake-__codelineno-0-45"></a><span class="w">  </span><span class="na">tags</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;${USER}/backend:${TAG}&quot;</span><span class="p">]</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#010-bake-__codelineno-0-46"></a><span class="w">  </span><span class="na">platforms</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;linux/amd64&quot;, &quot;linux/arm64&quot;</span><span class="p">]</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#010-bake-__codelineno-0-47"></a><span class="w">   </span><span class="nb">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#010-bake-__codelineno-0-48"></a><span class="w">    </span><span class="na">NODE_ENV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;production&quot;</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#010-bake-__codelineno-0-49"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#010-bake-__codelineno-0-50"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Here is another example of a <code>Docker Bake</code> configuration file: in JSON</li>
</ul>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#010-bake-__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#010-bake-__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;variable&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#010-bake-__codelineno-1-3"></a><span class="w">    </span><span class="nt">&quot;TAG&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#010-bake-__codelineno-1-4"></a><span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;latest&quot;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#010-bake-__codelineno-1-5"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#010-bake-__codelineno-1-6"></a><span class="w">    </span><span class="nt">&quot;USER&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#010-bake-__codelineno-1-7"></a><span class="w">      </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;username&quot;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#010-bake-__codelineno-1-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#010-bake-__codelineno-1-9"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#010-bake-__codelineno-1-10"></a><span class="w">  </span><span class="nt">&quot;group&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#010-bake-__codelineno-1-11"></a><span class="w">    </span><span class="nt">&quot;default&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#010-bake-__codelineno-1-12"></a><span class="w">      </span><span class="nt">&quot;targets&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;frontend&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;backend-api&quot;</span><span class="p">]</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#010-bake-__codelineno-1-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#010-bake-__codelineno-1-14"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#010-bake-__codelineno-1-15"></a><span class="w">  </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#010-bake-__codelineno-1-16"></a><span class="w">    </span><span class="nt">&quot;frontend&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#010-bake-__codelineno-1-17"></a><span class="w">      </span><span class="nt">&quot;context&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./frontend&quot;</span><span class="p">,</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#010-bake-__codelineno-1-18"></a><span class="w">      </span><span class="nt">&quot;dockerfile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dockerfile.prod&quot;</span><span class="p">,</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#010-bake-__codelineno-1-19"></a><span class="w">      </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;${USER}/frontend:${TAG}&quot;</span><span class="p">],</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#010-bake-__codelineno-1-20"></a><span class="w">      </span><span class="nt">&quot;platforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;linux/amd64&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;linux/arm64&quot;</span><span class="p">],</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#010-bake-__codelineno-1-21"></a><span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#010-bake-__codelineno-1-22"></a><span class="w">        </span><span class="nt">&quot;NODE_ENV&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span><span class="p">,</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#010-bake-__codelineno-1-23"></a><span class="w">        </span><span class="nt">&quot;API_URL&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;https://api.codewizard.com&quot;</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#010-bake-__codelineno-1-24"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#010-bake-__codelineno-1-25"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#010-bake-__codelineno-1-26"></a><span class="w">    </span><span class="nt">&quot;backend-api&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#010-bake-__codelineno-1-27"></a><span class="w">      </span><span class="nt">&quot;context&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./backend&quot;</span><span class="p">,</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#010-bake-__codelineno-1-28"></a><span class="w">      </span><span class="nt">&quot;dockerfile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Dockerfile&quot;</span><span class="p">,</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#010-bake-__codelineno-1-29"></a><span class="w">      </span><span class="nt">&quot;tags&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;${USER}/backend:${TAG}&quot;</span><span class="p">],</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#010-bake-__codelineno-1-30"></a><span class="w">      </span><span class="nt">&quot;platforms&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;linux/amd64&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;linux/arm64&quot;</span><span class="p">],</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#010-bake-__codelineno-1-31"></a><span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#010-bake-__codelineno-1-32"></a><span class="w">        </span><span class="nt">&quot;NODE_ENV&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#010-bake-__codelineno-1-33"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#010-bake-__codelineno-1-34"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#010-bake-__codelineno-1-35"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#010-bake-__codelineno-1-36"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="010-bake-common-commands">Common Commands<a class="headerlink" href="#010-bake-common-commands" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Description</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td>Build Default Group</td>
<td>Build all targets in the default group</td>
<td><code>docker buildx bake</code></td>
</tr>
<tr>
<td>Build Specific Target</td>
<td>Build a specific target by name</td>
<td><code>docker buildx bake &lt;target&gt;</code></td>
</tr>
<tr>
<td>Build with Custom Variables</td>
<td>Override variables for a specific build</td>
<td><code>docker buildx bake --set &lt;target&gt;.&lt;var&gt;=&lt;value&gt;</code></td>
</tr>
<tr>
<td>Build and Push</td>
<td>Build images and push them to a registry</td>
<td><code>docker buildx bake --push</code></td>
</tr>
<tr>
<td>Build for Specific Platform</td>
<td>Build images for a specific platform architecture</td>
<td><code>docker buildx bake --platform &lt;platform&gt;</code></td>
</tr>
<tr>
<td>View Build Configuration</td>
<td>Print the effective build configuration</td>
<td><code>docker buildx bake --print</code></td>
</tr>
<tr>
<td>Build with Custom File</td>
<td>Use a custom bake file instead of the default</td>
<td><code>docker buildx bake -f &lt;file&gt;</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="010-bake-advanced-features">Advanced Features<a class="headerlink" href="#010-bake-advanced-features" title="Permanent link">&para;</a></h2>
<h3 id="010-bake-multi-stage-builds-with-matrix">Multi-Stage Builds with Matrix<a class="headerlink" href="#010-bake-multi-stage-builds-with-matrix" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>What is a Build Matrix?</strong></li>
<li>A build matrix allows you to create <strong>multiple image variations from a single configuration</strong>. </li>
<li>This is useful when you need to build multiple versions of your application or service.</li>
<li>For example, you might need to build different versions of your application for different environments (e.g., development, staging, production).</li>
<li>By using a build matrix, you can specify multiple combinations of values for each configuration option.</li>
<li>
<p>Instead of writing separate targets for each combination, Docker Bake automatically generates all possible combinations.</p>
</li>
<li>
<p><strong>Example:</strong> Building multiple Node.js versions for different environments</p>
</li>
</ul>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#010-bake-__codelineno-2-1"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;app&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#010-bake-__codelineno-2-2"></a><span class="w">  </span><span class="nb">matrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#010-bake-__codelineno-2-3"></a><span class="w">    </span><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;18&quot;, &quot;20&quot;</span><span class="p">]</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#010-bake-__codelineno-2-4"></a><span class="w">    </span><span class="na">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;dev&quot;, &quot;prod&quot;</span><span class="p">]</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#010-bake-__codelineno-2-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#010-bake-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#010-bake-__codelineno-2-7"></a><span class="w">  </span><span class="na">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;app-node${version}-${env}&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#010-bake-__codelineno-2-8"></a><span class="w">  </span><span class="na">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#010-bake-__codelineno-2-9"></a><span class="w">  </span><span class="na">dockerfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dockerfile&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#010-bake-__codelineno-2-10"></a><span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myapp:node${version}-${env}&quot;</span><span class="p">]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#010-bake-__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#010-bake-__codelineno-2-12"></a><span class="w">  </span><span class="nb">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#010-bake-__codelineno-2-13"></a><span class="w">    </span><span class="na">NODE_VERSION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${version}&quot;</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#010-bake-__codelineno-2-14"></a><span class="w">    </span><span class="na">NODE_ENV</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${env}&quot;</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#010-bake-__codelineno-2-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#010-bake-__codelineno-2-16"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>Quiz: What will be the output of the above example?</li>
</ul>
<details>
  <summary>Answer</summary>
  <ul>
    <li>app-node18-dev</li>
    <li>app-node18-prod</li>
    <li>app-node20-dev</li>
    <li>app-node20-prod</li>
  </ul>
  <hr/>
  - Each build will use the specified Node.js version and environment.
  - The `name` field dynamically constructs the image name based on the matrix values.
  - The `args` field passes the Node.js version and environment as build arguments to the Dockerfile.
  - The `tags` field tags the built images with the corresponding Node.js version and environment.
  - The `context` and `dockerfile` fields specify the build context and Dockerfile to use for all builds.
  - The `matrix` field defines the combinations of `version` and `env` to build.
</details>

<hr />
<h3 id="010-bake-build-secrets">Build Secrets<a class="headerlink" href="#010-bake-build-secrets" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Build secrets</code> allow you to securely pass sensitive information (like API keys, passwords, or certificates) to your Docker build process without including them in the final image or build history.</li>
<li>This is particularly useful for keeping sensitive data out of your Docker images and ensuring that it is only available during the build process. </li>
<li><code>Build secrets</code> can be stored in a secure location, such as a secure vault or a secret management service, and then referenced during the build process.</li>
<li><code>Build secrets</code> are mounted into the build environment at runtime, allowing you to use them without exposing them in the final image.</li>
<li><code>Build secrets</code> are not stored in the final image layers, ensuring that sensitive information is not leaked.</li>
<li><code>Build secrets</code> are only available during the build process and are not accessible to the final image or container.</li>
<li><code>Build secrets</code> are defined in the <code>docker-bake.hcl</code> file using the <code>secret</code> field.</li>
<li>You can use the <code>--secret</code> flag to pass secrets to the build process.</li>
<li>
<p>Secrets can also be defined in the Dockerfile using the <code>RUN --mount=type=secret</code> syntax.</p>
</li>
<li>
<p><strong>Example:</strong> Using a secret file during build</p>
</li>
</ul>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#010-bake-__codelineno-3-1"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;secure-app&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#010-bake-__codelineno-3-2"></a><span class="w">  </span><span class="na">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#010-bake-__codelineno-3-3"></a><span class="w">  </span><span class="na">dockerfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dockerfile&quot;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#010-bake-__codelineno-3-4"></a><span class="w">  </span><span class="na">secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#010-bake-__codelineno-3-5"></a><span class="w">    </span><span class="s2">&quot;id=mysecret,src=./secret.txt&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#010-bake-__codelineno-3-6"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#010-bake-__codelineno-3-7"></a><span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myapp:secure&quot;</span><span class="p">]</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#010-bake-__codelineno-3-8"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li><strong><code>Dockerfile</code></strong>:</li>
</ul>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#010-bake-__codelineno-4-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#010-bake-__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#010-bake-__codelineno-4-3"></a><span class="c"># Use the secret during build (it wont be in the final image)</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#010-bake-__codelineno-4-4"></a><span class="c"># as mentioned and explained above</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#010-bake-__codelineno-4-5"></a>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#010-bake-__codelineno-4-6"></a><span class="k">RUN</span><span class="w"> </span>--mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>mysecret<span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#010-bake-__codelineno-4-7"></a><span class="w">    </span><span class="nv">API_KEY</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span>/run/secrets/mysecret<span class="k">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#010-bake-__codelineno-4-8"></a><span class="w">    </span>npm<span class="w"> </span>install<span class="w"> </span>--registry<span class="o">=</span>https://registry.example.com
</span></code></pre></div>
<hr />
<h3 id="010-bake-cache-configuration-build-caching">Cache Configuration / Build Caching<a class="headerlink" href="#010-bake-cache-configuration-build-caching" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Docker Bake</code> supports advanced caching strategies to speed up builds and reduce resource usage.</li>
<li>Caching allows you to reuse previously built layers, which can significantly speed up the build process</li>
<li><code>Docker Bake</code> can use different cache sources, such as local files, remote registries, or GitHub Actions cache.</li>
<li>Caching can be configured using the <code>cache-from</code> and <code>cache-to</code> fields in the <code>docker-bake.hcl</code> file.</li>
<li>Caching can also be configured using the <code>--cache-from</code> and <code>--cache-to</code> flags when running the <code>docker buildx bake</code> command.</li>
<li>Caching can be used to speed up builds by reusing previously built layers, which can significantly reduce build times.</li>
<li>Caching can also be used to reduce resource usage by avoiding unnecessary rebuilds of unchanged layers.</li>
<li>Caching can be used to share build layers between different builds, which can further speed up the build process.</li>
<li>Caching can be used to optimize the build process by reusing previously built layers, which can significantly reduce build times.</li>
<li>Caching can reduce build times from minutes to seconds for unchanged code.</li>
<li><strong>Example:</strong> Using GitHub Actions cache</li>
</ul>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#010-bake-__codelineno-5-1"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;cached-app&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#010-bake-__codelineno-5-2"></a><span class="w">  </span><span class="na">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#010-bake-__codelineno-5-3"></a><span class="w">  </span><span class="na">dockerfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dockerfile&quot;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#010-bake-__codelineno-5-4"></a><span class="w">  </span><span class="na">cache-from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;type=gha&quot;</span><span class="p">]</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#010-bake-__codelineno-5-5"></a><span class="w">  </span><span class="na">cache-to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;type=gha,mode=max&quot;</span><span class="p">]</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#010-bake-__codelineno-5-6"></a><span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myapp:cached&quot;</span><span class="p">]</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#010-bake-__codelineno-5-7"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Cache Types:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>type=gha</code></td>
<td>GitHub Actions cache (for CI/CD)</td>
</tr>
<tr>
<td><code>type=local</code></td>
<td>Local filesystem cache</td>
</tr>
<tr>
<td><code>type=registry</code></td>
<td>Docker registry cache</td>
</tr>
</tbody>
</table>
<h3 id="010-bake-cache-configuration-build-caching-workflow">Cache Configuration / Build Caching Workflow<a class="headerlink" href="#010-bake-cache-configuration-build-caching-workflow" title="Permanent link">&para;</a></h3>
<p><code>mermaid
flowchart TD
    A[First build] --&gt;|Takes full time, saves cache| B[Second build]
    B --&gt;|Reuses cached layers, builds only changed parts| C[Result]
    C --&gt;|Significantly faster build times| D[End]</code></p>
<h3 id="010-bake-target-inheritance">Target Inheritance<a class="headerlink" href="#010-bake-target-inheritance" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Docker Bake</code> allows you to create a base configuration and reuse it across multiple targets. </li>
<li>This follows the DRY (Don&rsquo;t Repeat Yourself) principle - define common settings once and inherit them.</li>
</ul>
<p><strong>Example:</strong> Sharing common settings across multiple builds</p>
<table>
<thead>
<tr>
<th>Setting</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>target "base"</code></td>
<td>This is a base target that defines common build settings</td>
</tr>
<tr>
<td><code>context = "."</code></td>
<td>Uses the current directory as the build context</td>
</tr>
<tr>
<td><code>dockerfile = "Dockerfile"</code></td>
<td>Uses the default Dockerfile</td>
</tr>
<tr>
<td><code>platforms = ["linux/amd64", "linux/arm64"]</code></td>
<td>Builds for both AMD64 and ARM64 architectures</td>
</tr>
<tr>
<td><code>tags = ["myapp:latest"]</code></td>
<td>Sets the default tag for the image</td>
</tr>
<tr>
<td><code>cache-from = ["type=gha"]</code></td>
<td>Uses GitHub Actions cache for the build</td>
</tr>
<tr>
<td><code>cache-to = ["type=gha,mode=max"]</code></td>
<td>Saves the cache to GitHub Actions cache with</td>
</tr>
</tbody>
</table>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#010-bake-__codelineno-6-1"></a><span class="c1"># Base target with common settings</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#010-bake-__codelineno-6-2"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;base&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#010-bake-__codelineno-6-3"></a><span class="w">  </span><span class="na">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#010-bake-__codelineno-6-4"></a><span class="w">  </span><span class="na">dockerfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dockerfile&quot;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#010-bake-__codelineno-6-5"></a><span class="w">  </span><span class="na">platforms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;linux/amd64&quot;, &quot;linux/arm64&quot;</span><span class="p">]</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#010-bake-__codelineno-6-6"></a><span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myapp:latest&quot;</span><span class="p">]</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#010-bake-__codelineno-6-7"></a><span class="w">  </span><span class="na">cache-from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;type=gha&quot;</span><span class="p">]</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#010-bake-__codelineno-6-8"></a><span class="w">  </span><span class="na">cache-to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;type=gha,mode=max&quot;</span><span class="p">]</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#010-bake-__codelineno-6-9"></a><span class="p">}</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#010-bake-__codelineno-6-10"></a>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#010-bake-__codelineno-6-11"></a><span class="c1"># Example: Using inheritance to define common settings (1)</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#010-bake-__codelineno-6-12"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;web&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#010-bake-__codelineno-6-13"></a><span class="w">  </span><span class="na">inherits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">]</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#010-bake-__codelineno-6-14"></a><span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myapp/web:latest&quot;</span><span class="p">]</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#010-bake-__codelineno-6-15"></a><span class="w">  </span><span class="na">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;web&quot;</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#010-bake-__codelineno-6-16"></a><span class="p">}</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#010-bake-__codelineno-6-17"></a>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#010-bake-__codelineno-6-18"></a><span class="c1"># Example: Using inheritance to define common settings (2)</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#010-bake-__codelineno-6-19"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;api&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#010-bake-__codelineno-6-20"></a><span class="w">  </span><span class="na">inherits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;base&quot;</span><span class="p">]</span>
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#010-bake-__codelineno-6-21"></a><span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myapp/api:latest&quot;</span><span class="p">]</span>
</span><span id="__span-6-22"><a id="__codelineno-6-22" name="__codelineno-6-22" href="#010-bake-__codelineno-6-22"></a><span class="w">  </span><span class="na">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;api&quot;</span>
</span><span id="__span-6-23"><a id="__codelineno-6-23" name="__codelineno-6-23" href="#010-bake-__codelineno-6-23"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>How it works:</strong></p>
<p><code>mermaid
flowchart TD
    A[Base target] --&gt;|Defines common settings | B[Child targets]
    B --&gt;|Inherit from base and add their specific settings| C[Result]
    C --&gt;|Both web and api targets automatically get the same platforms and build context| D[End]</code></p>
<p><strong>Benefits:</strong></p>
<ul>
<li><strong>Consistency</strong>: Sharing - ensures consistent build configurations</li>
<li><strong>Reusability</strong>: All targets use the same base configuration</li>
<li><strong>Maintainability</strong>: Supports multiple targets with the same settings platforms in one place, affects all children</li>
<li><strong>Cleaner code</strong>: No repetitive configuration</li>
<li><strong>DRY principle</strong>: Avoids duplication of common settings</li>
<li><strong>Flexibility</strong>: Each target can still have its own specific settings</li>
<li><strong>Scalability</strong>: Easily add new targets with shared settings</li>
</ul></section><section class="print-page" id="011-security%26trust" heading-number="1.12"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="011-security%26trust-lab-011-docker-security-trust">Lab 011 - Docker Security &amp; Trust<a class="headerlink" href="#011-security%26trust-lab-011-docker-security-trust" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab covers advanced Docker security features and best practices for container security and privilege management.</li>
<li>You&rsquo;ll learn about reducing the attack surface, implementing the Principle of Least Privilege, and using Docker&rsquo;s security mechanisms to protect your containers.</li>
<li>Topics include non-root user execution, Linux capabilities, security options, and mandatory access control.</li>
<li>By the end of this lab, you&rsquo;ll understand how to build and run secure Docker containers.</li>
</ul>
<hr />
<!-- omit in toc -->
<h2 id="011-security%26trust-table-of-contents">Table of Contents<a class="headerlink" href="#011-security%26trust-table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#011-security%26trust-%F0%9F%9B%A1-non-root-user-execution-with-the-user-instruction">üõ°Ô∏è Non-Root User Execution with the <code>USER</code> Instruction</a></li>
<li><a href="#011-security%26trust-how-to-use-user">How to Use <code>USER</code></a></li>
<li><a href="#011-security%26trust-%F0%9F%94%92-advanced-security-issues-and-features">üîí Advanced Security Issues and Features</a></li>
<li><a href="#011-security%26trust-1-privileged-containers---privileged">1. Privileged Containers (<code>--privileged</code>)</a></li>
<li><a href="#011-security%26trust-2-linux-capabilities---cap-drop---cap-add">2. Linux Capabilities (<code>--cap-drop</code>, <code>--cap-add</code>)</a></li>
<li><a href="#011-security%26trust-3-preventing-privilege-escalation">3. Preventing Privilege Escalation</a></li>
<li><a href="#011-security%26trust-4-mandatory-access-control-mac">4. Mandatory Access Control (MAC)</a></li>
<li><a href="#011-security%26trust-5-user-namespace-remapping-userns">5. User Namespace Remapping (UserNS)</a></li>
<li><a href="#011-security%26trust-%F0%9F%94%91-summary-of-security-best-practices">üîë Summary of Security Best Practices</a></li>
</ul>
<hr />
<ul>
<li>Docker&rsquo;s advanced features offer critical mechanisms for <strong>container security and privilege management</strong>, primarily revolving around reducing the attack surface. </li>
<li>The key is to adhere to the <strong>Principle of Least Privilege (PoLP)</strong>.</li>
</ul>
<h2 id="011-security%26trust-non-root-user-execution-with-the-user-instruction">üõ°Ô∏è Non-Root User Execution with the <code>USER</code> Instruction<a class="headerlink" href="#011-security%26trust-non-root-user-execution-with-the-user-instruction" title="Permanent link">&para;</a></h2>
<ul>
<li>By default, the process inside a Docker container runs as the <code>root user (UID 0)</code>, which is a major security risk. </li>
<li>If an attacker successfully exploits a vulnerability in the application, they gain <strong>root access inside the container</strong>. </li>
<li>Depending on the container&rsquo;s configuration and any underlying kernel vulnerabilities, this could potentially lead to a <strong>container breakout</strong> and <strong>root access to the host machine</strong>.</li>
<li>The <code>USER</code> instruction in a <code>Dockerfile</code> is essential for mitigating this risk:</li>
</ul>
<hr />
<h2 id="011-security%26trust-how-to-use-user">How to Use <code>USER</code><a class="headerlink" href="#011-security%26trust-how-to-use-user" title="Permanent link">&para;</a></h2>
<ol>
<li>Create a Non-Root User</li>
<li>Use a <code>RUN</code> instruction to create a dedicated user and group <em>before</em> switching the user.
    <div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#011-security%26trust-__codelineno-0-1"></a><span class="c"># Create an unprivileged user (e.g., &#39;appuser&#39; with UID 1001)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#011-security%26trust-__codelineno-0-2"></a><span class="k">RUN</span><span class="w"> </span>adduser<span class="w"> </span>-D<span class="w"> </span>appuser
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#011-security%26trust-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#011-security%26trust-__codelineno-0-4"></a><span class="c"># Set the ownership of the application directory to the new user</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#011-security%26trust-__codelineno-0-5"></a><span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>/app<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>appuser:appuser<span class="w"> </span>/app
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#011-security%26trust-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#011-security%26trust-__codelineno-0-7"></a><span class="c"># Switch to the non-root user for all subsequent instructions and runtime</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#011-security%26trust-__codelineno-0-8"></a><span class="k">USER</span><span class="w"> </span><span class="s">appuser </span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#011-security%26trust-__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#011-security%26trust-__codelineno-0-10"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#011-security%26trust-__codelineno-0-11"></a><span class="c"># ... rest of your application commands (e.g., CMD)</span>
</span></code></pre></div></li>
</ol>
<div class="admonition tip">
<p class="admonition-title">adduser -D</p>
<p>Using <code>adduser -D</code> (on Alpine) creates a system user without a password or home directory, which is more secure.</p>
</div>
<hr />
<h2 id="011-security%26trust-best-practices-for-permissions">Best Practices for Permissions:<a class="headerlink" href="#011-security%26trust-best-practices-for-permissions" title="Permanent link">&para;</a></h2>
<div class="grid cards">
<ul>
<li>
<h3 id="011-security%26trust-file-permissions">File Permissions<a class="headerlink" href="#011-security%26trust-file-permissions" title="Permanent link">&para;</a></h3>
<ul>
<li>Ensure the non-root user has the necessary <strong>read, write, and execute permissions</strong> for all files, directories, or temporary spaces the application needs. </li>
<li>This often requires running <code>chown</code> in the Dockerfile.</li>
</ul>
</li>
<li>
<h3 id="011-security%26trust-multi-stage-builds">Multi-Stage Builds<a class="headerlink" href="#011-security%26trust-multi-stage-builds" title="Permanent link">&para;</a></h3>
<ul>
<li>Use <strong>multi-stage builds</strong> to perform privileged operations (like installing system packages with <code>apt</code> or <code>yum</code>) in a &ldquo;builder&rdquo; stage run as root, and then copy only the necessary artifacts into a minimal, non-root &ldquo;runtime&rdquo; stage. </li>
<li>This prevents residual root tools or sensitive build-time files from existing in the final image.</li>
</ul>
</li>
<li>
<h3 id="011-security%26trust-bind-ports-1024">Bind Ports &gt; 1024<a class="headerlink" href="#011-security%26trust-bind-ports-1024" title="Permanent link">&para;</a></h3>
<ul>
<li>Only the root user can bind to privileged ports (0-1023). </li>
<li>If your application runs as non-root, it must bind to ports <strong>1024 or higher</strong> (e.g., port 8080).</li>
</ul>
</li>
<li>
<h3 id="011-security%26trust-user">User<a class="headerlink" href="#011-security%26trust-user" title="Permanent link">&para;</a></h3>
<ul>
<li>Always specify a non-root user with the <code>USER</code> instruction in your Dockerfile to prevent running as root.</li>
<li>Avoid using <code>sudo</code> inside containers; instead, configure permissions properly at build time.</li>
<li>Consider using well-known non-root users like</li>
</ul>
</li>
<li>
<h3 id="011-security%26trust-privileged-containers">Privileged Containers<a class="headerlink" href="#011-security%26trust-privileged-containers" title="Permanent link">&para;</a></h3>
<ul>
<li>Avoid running containers with the <code>--privileged</code> flag, as it grants excessive permissions and can lead to host compromise.</li>
<li>Instead, use specific capability additions (<code>--cap-add</code>) if certain elevated privileges are necessary.</li>
<li>Always review and minimize the capabilities your container needs.</li>
<li>Consider using tools like <code>seccomp</code> to restrict system calls your container can make.</li>
</ul>
</li>
</ul>
</div>
<hr />
<h2 id="011-security%26trust-advanced-security-issues-and-features">üîí Advanced Security Issues and Features<a class="headerlink" href="#011-security%26trust-advanced-security-issues-and-features" title="Permanent link">&para;</a></h2>
<ul>
<li>Beyond running as a non-root user, Docker provides several advanced features to lock down container security:</li>
</ul>
<h3 id="011-security%26trust-1-privileged-containers-privileged">1. Privileged Containers (<code>--privileged</code>)<a class="headerlink" href="#011-security%26trust-1-privileged-containers-privileged" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>A privileged container is the <strong>most dangerous security configuration</strong> and should be avoided at all costs unless absolutely necessary (e.g., for running Docker-in-Docker or a tool that needs to interact directly with the host kernel).</p>
</li>
<li>
<p><strong>Security Issue:</strong> </p>
<ul>
<li>Running a container with the <code>--privileged</code> flag grants it <strong>all Linux Capabilities</strong> (see below) and allows it to access all devices on the host. In a privileged container, the root user inside the container is essentially <strong>equivalent to the root user on the host machine</strong>. A container breakout is almost guaranteed.</li>
<li><strong>Mitigation:</strong> <strong>NEVER</strong> use <code>--privileged</code> in production. <br />
  Instead, identify the specific capabilities your application needs and grant only those using the <code>--cap-add</code> flag.</li>
</ul>
</li>
</ul>
<h3 id="011-security%26trust-2-linux-capabilities-cap-drop-cap-add">2. Linux Capabilities (<code>--cap-drop</code>, <code>--cap-add</code>)<a class="headerlink" href="#011-security%26trust-2-linux-capabilities-cap-drop-cap-add" title="Permanent link">&para;</a></h3>
<ul>
<li>Linux Capabilities are a finer-grained way to manage root permissions. </li>
<li>Traditional Unix divides processes into two categories: <strong>root</strong> (UID 0) and <strong>unprivileged</strong>. </li>
<li>
<p>Capabilities break down the powers of the root user into discrete units.</p>
</li>
<li>
<p>By default, Docker grants a set of &ldquo;safe&rdquo; capabilities and <strong>drops dangerous ones</strong>.</p>
</li>
<li><strong>Best Practice:</strong> Use the <code>--cap-drop=ALL</code> flag to remove <strong>all</strong> capabilities, then use <code>--cap-add</code> to grant only the handful that the application truly requires (PoLP).
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#011-security%26trust-__codelineno-1-1"></a><span class="c1"># Runs the container with no capabilities except NET_BIND_SERVICE</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#011-security%26trust-__codelineno-1-2"></a><span class="c1"># A container that needs to bind to a low-numbered port (e.g., port 80) </span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#011-security%26trust-__codelineno-1-3"></a><span class="c1"># only needs the `NET_BIND_SERVICE` capability.</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#011-security%26trust-__codelineno-1-4"></a>docker<span class="w"> </span>run<span class="w"> </span>--cap-drop<span class="o">=</span>ALL<span class="w"> </span>--cap-add<span class="o">=</span>NET_BIND_SERVICE<span class="w"> </span>my-image
</span></code></pre></div></li>
</ul>
<h3 id="011-security%26trust-3-preventing-privilege-escalation">3. Preventing Privilege Escalation<a class="headerlink" href="#011-security%26trust-3-preventing-privilege-escalation" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Even if a container starts as non-root, a malicious process could attempt to escalate its privileges.</p>
</li>
<li>
<p><strong><code>no-new-privileges</code>:</strong> Use the <code>--security-opt=no-new-privileges</code> flag to prevent a process from gaining new privileges via mechanisms like <code>setuid</code> or <code>setgid</code> binaries. This is a crucial security layer.</p>
</li>
</ul>
<h3 id="011-security%26trust-4-mandatory-access-control-mac">4. Mandatory Access Control (MAC)<a class="headerlink" href="#011-security%26trust-4-mandatory-access-control-mac" title="Permanent link">&para;</a></h3>
<ul>
<li>Docker integrates with two major Linux security modules for deeper kernel-level protection:</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Feature</th>
<th style="text-align: left;">Description</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Seccomp (Secure Computing)</strong></td>
<td style="text-align: left;">Filters which <strong>system calls (syscalls)</strong> a container process can make to the Linux kernel.</td>
<td style="text-align: left;">Blocks dangerous syscalls that could be used for container breakout, even if the process is running as root. Docker uses a restrictive <strong>default profile</strong>.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>AppArmor (Application Armor)</strong></td>
<td style="text-align: left;">Creates <strong>Mandatory Access Control (MAC) profiles</strong> that limit what files, network resources, and other capabilities a container can access.</td>
<td style="text-align: left;">Provides an extra layer of defense-in-depth by confining the container process&rsquo;s access to host resources. Docker loads a moderately protective <code>docker-default</code> profile.</td>
</tr>
</tbody>
</table>
<h3 id="011-security%26trust-5-user-namespace-remapping-userns">5. User Namespace Remapping (UserNS)<a class="headerlink" href="#011-security%26trust-5-user-namespace-remapping-userns" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>This is one of the <strong>strongest isolation features</strong> for mitigating the risk of a container breakout.</p>
</li>
<li>
<p><strong>How it Works:</strong> It maps the <strong>root user (UID 0) inside the container</strong> to an <strong>unprivileged user (a high UID, e.g., 100000)</strong> on the host machine.</p>
</li>
<li><strong>Security Benefit:</strong> If an attacker <em>does</em> manage to escape the container, they only have the privileges of the unprivileged mapped user on the host, <strong>not</strong> actual root access. This significantly reduces the potential for host compromise. This feature can be enabled at the Docker daemon level.</li>
</ul>
<hr />
<h2 id="011-security%26trust-summary-of-security-best-practices">üîë Summary of Security Best Practices<a class="headerlink" href="#011-security%26trust-summary-of-security-best-practices" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th style="text-align: left;">Security Principle</th>
<th style="text-align: left;">Docker Feature/Instruction</th>
<th style="text-align: left;">Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Least Privilege</strong></td>
<td style="text-align: left;"><code>USER non-root</code> in <code>Dockerfile</code></td>
<td style="text-align: left;">Prevents an exploit from gaining root access inside the container.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Runtime Hardening</strong></td>
<td style="text-align: left;"><code>--cap-drop=ALL</code>, <code>--cap-add=&lt;needed-caps&gt;</code></td>
<td style="text-align: left;">Removes unnecessary superuser powers, reducing the attack surface.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Kernel Isolation</strong></td>
<td style="text-align: left;"><strong>Seccomp/AppArmor</strong></td>
<td style="text-align: left;">Limits the dangerous operations (syscalls, file access) a process can perform.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>No Escalation</strong></td>
<td style="text-align: left;"><code>--security-opt=no-new-privileges</code></td>
<td style="text-align: left;">Prevents a non-root process from gaining root powers during execution.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Host Protection</strong></td>
<td style="text-align: left;"><strong>User Namespace Remapping</strong></td>
<td style="text-align: left;">Ensures that an escaped container process runs as an unprivileged user on the host.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="011-security%26trust-running-the-demos">Running the Demos<a class="headerlink" href="#011-security%26trust-running-the-demos" title="Permanent link">&para;</a></h2>
<p>This lab includes individual demo scripts for each security topic:</p>
<table>
<thead>
<tr>
<th>Demo Script</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>demo1-nonroot.sh</code></td>
<td>Demonstrates non-root user execution</td>
</tr>
<tr>
<td><code>demo2-capabilities.sh</code></td>
<td>Shows Linux capabilities management</td>
</tr>
<tr>
<td><code>demo3-security-options.sh</code></td>
<td>Demonstrates security options like no-new-privileges</td>
</tr>
<tr>
<td><code>demo4-mac.sh</code></td>
<td>Checks Mandatory Access Control (Seccomp/AppArmor) status</td>
</tr>
<tr>
<td><code>demo5-userns.sh</code></td>
<td>Explores User Namespace Remapping configuration</td>
</tr>
</tbody>
</table>
<p>To run a demo:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#011-security%26trust-__codelineno-2-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>demo1-nonroot.sh
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#011-security%26trust-__codelineno-2-2"></a>./demo1-nonroot.sh
</span></code></pre></div>
<p>Each demo is self-contained with automatic cleanup.</p></section><section class="print-page" id="012-gvisor" heading-number="1.13"><h1 id="012-gvisor-012-gvisor-lab">012 - gVisor Lab<a class="headerlink" href="#012-gvisor-012-gvisor-lab" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab demonstrates the use of gVisor, a sandbox runtime for containers that provides an additional layer of security by intercepting and filtering system calls.</li>
</ul>
<h2 id="012-gvisor-overview">Overview<a class="headerlink" href="#012-gvisor-overview" title="Permanent link">&para;</a></h2>
<ul>
<li><code>gVisor</code> is an application <code>kernel</code>, written in Go, that implements a substantial portion of the Linux system call interface. </li>
<li>It provides a strong isolation boundary between the application and the host kernel, making it harder for attackers to compromise the host system even if they gain control of a container.</li>
</ul>
<h2 id="012-gvisor-prerequisites">Prerequisites<a class="headerlink" href="#012-gvisor-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Docker installed</li>
<li>gVisor runtime installed (<code>runsc</code>)</li>
<li>Basic understanding of Docker and system calls</li>
</ul>
<h2 id="012-gvisor-installation">Installation<a class="headerlink" href="#012-gvisor-installation" title="Permanent link">&para;</a></h2>
<ul>
<li>To install gVisor:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#012-gvisor-__codelineno-0-1"></a><span class="c1"># Install gVisor</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#012-gvisor-__codelineno-0-2"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://gvisor.dev/archive.key<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/gvisor-archive-keyring.gpg
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#012-gvisor-__codelineno-0-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/gvisor-archive-keyring.gpg] https://storage.googleapis.com/gvisor/releases release main&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/gvisor.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#012-gvisor-__codelineno-0-4"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>runsc
</span></code></pre></div>
<h2 id="012-gvisor-examples">Examples<a class="headerlink" href="#012-gvisor-examples" title="Permanent link">&para;</a></h2>
<h3 id="012-gvisor-example-1-blocking-user-creation">Example 1: Blocking User Creation<a class="headerlink" href="#012-gvisor-example-1-blocking-user-creation" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>This example demonstrates how to use gVisor with a <code>seccomp</code> profile to block user creation syscalls.</p>
<p><strong>Files:</strong></p>
<ul>
<li><code>demo.sh</code>: Script to run the demo</li>
<li><code>block-user-creation.json</code>: Seccomp profile that blocks user-related syscalls</li>
</ul>
<p><strong>Run the demo:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#012-gvisor-__codelineno-1-1"></a>./demo.sh
</span></code></pre></div>
</li>
<li>
<p>This will attempt to create a user inside a container running with gVisor and the seccomp profile. </p>
</li>
<li>The operation should fail, demonstrating the security isolation.</li>
</ul>
<h3 id="012-gvisor-example-2-blocking-mount-operations">Example 2: Blocking Mount Operations<a class="headerlink" href="#012-gvisor-example-2-blocking-mount-operations" title="Permanent link">&para;</a></h3>
<ul>
<li>This example shows how to restrict mount operations using gVisor and seccomp.</li>
</ul>
<p><strong>Files:</strong></p>
<ul>
<li><code>demo-mount.sh</code>: Script to run the mount demo</li>
<li><code>block-mount.json</code>: Seccomp profile that blocks mount-related syscalls</li>
<li><code>Dockerfile</code>: Alpine image that attempts to mount tmpfs</li>
</ul>
<p><strong>Run the demo:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#012-gvisor-__codelineno-2-1"></a>./demo-mount.sh
</span></code></pre></div>
<ul>
<li>This will build an Alpine image and attempt to mount a <code>tmpfs</code> inside the container. </li>
<li>The mount operation should be blocked.</li>
</ul>
<h2 id="012-gvisor-key-concepts">Key Concepts<a class="headerlink" href="#012-gvisor-key-concepts" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Seccomp Profiles:</strong> JSON files that define which syscalls are allowed or blocked</li>
<li><strong>gVisor Runtime:</strong> <code>runsc</code> provides the sandboxed execution environment</li>
<li><strong>System Call Filtering:</strong> Prevents potentially dangerous operations</li>
</ul>
<h2 id="012-gvisor-additional-resources">Additional Resources<a class="headerlink" href="#012-gvisor-additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://gvisor.dev/docs/">gVisor Documentation</a></li>
<li><a href="https://docs.docker.com/engine/security/seccomp/">Seccomp Profiles</a></li>
<li><a href="https://docs.docker.com/engine/reference/run/#runtime-options">Docker Runtime Options</a></li>
</ul></section><section class="print-page" id="013-cgroup" heading-number="1.14"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="013-cgroup-lab-013-resource-isolation-with-linux-cgroups">Lab 013 - Resource Isolation with Linux Cgroups<a class="headerlink" href="#013-cgroup-lab-013-resource-isolation-with-linux-cgroups" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab covers resource isolation using Linux Cgroups in Docker containers.</li>
<li>You will learn how to limit CPU, memory, and other resources for containers to prevent resource contention and ensure fair sharing.</li>
<li>By the end of this lab, you will understand how to use Docker commands to enforce resource constraints.</li>
</ul>
<hr />
<h2 id="013-cgroup-cpu-limits">CPU Limits<a class="headerlink" href="#013-cgroup-cpu-limits" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>--cpus</code> to limit CPU usage as a fraction of available cores.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#013-cgroup-__codelineno-0-1"></a><span class="c1"># Limit container to 0.5 CPU cores</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#013-cgroup-__codelineno-0-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--cpus<span class="o">=</span><span class="m">0</span>.5<span class="w"> </span>--name<span class="w"> </span>cpu-limited<span class="w"> </span>nginx
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#013-cgroup-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#013-cgroup-__codelineno-0-4"></a><span class="c1"># Check resource usage</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#013-cgroup-__codelineno-0-5"></a>docker<span class="w"> </span>stats<span class="w"> </span>cpu-limited
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#013-cgroup-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#013-cgroup-__codelineno-0-7"></a><span class="c1"># Clean up</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#013-cgroup-__codelineno-0-8"></a>docker<span class="w"> </span>stop<span class="w"> </span>cpu-limited
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#013-cgroup-__codelineno-0-9"></a>docker<span class="w"> </span>rm<span class="w"> </span>cpu-limited
</span></code></pre></div>
<h2 id="013-cgroup-memory-limits">Memory Limits<a class="headerlink" href="#013-cgroup-memory-limits" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>--memory</code> to set a hard memory limit.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#013-cgroup-__codelineno-1-1"></a><span class="c1"># Limit container to 128MB RAM</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#013-cgroup-__codelineno-1-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--memory<span class="o">=</span>128m<span class="w"> </span>--name<span class="w"> </span>mem-limited<span class="w"> </span>nginx
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#013-cgroup-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#013-cgroup-__codelineno-1-4"></a><span class="c1"># Check resource usage</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#013-cgroup-__codelineno-1-5"></a>docker<span class="w"> </span>stats<span class="w"> </span>mem-limited
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#013-cgroup-__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#013-cgroup-__codelineno-1-7"></a><span class="c1"># Test memory limit by running a memory-intensive process</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#013-cgroup-__codelineno-1-8"></a>docker<span class="w"> </span>run<span class="w"> </span>--memory<span class="o">=</span>50m<span class="w"> </span>stress<span class="w"> </span>--vm<span class="w"> </span><span class="m">1</span><span class="w"> </span>--vm-bytes<span class="w"> </span>100m
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#013-cgroup-__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#013-cgroup-__codelineno-1-10"></a><span class="c1"># Clean up</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#013-cgroup-__codelineno-1-11"></a>docker<span class="w"> </span>stop<span class="w"> </span>mem-limited
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#013-cgroup-__codelineno-1-12"></a>docker<span class="w"> </span>rm<span class="w"> </span>mem-limited
</span></code></pre></div>
<h2 id="013-cgroup-cpu-sets">CPU Sets<a class="headerlink" href="#013-cgroup-cpu-sets" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>--cpuset-cpus</code> to pin container to specific CPU cores.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#013-cgroup-__codelineno-2-1"></a><span class="c1"># Pin container to CPU cores 0 and 1</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#013-cgroup-__codelineno-2-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--cpuset-cpus<span class="o">=</span><span class="m">0</span>,1<span class="w"> </span>--name<span class="w"> </span>cpu-pinned<span class="w"> </span>nginx
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#013-cgroup-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#013-cgroup-__codelineno-2-4"></a><span class="c1"># Check which CPUs the container is using</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#013-cgroup-__codelineno-2-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>cpu-pinned<span class="w"> </span>cat<span class="w"> </span>/proc/self/status<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Cpus_allowed
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#013-cgroup-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#013-cgroup-__codelineno-2-7"></a><span class="c1"># Clean up</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#013-cgroup-__codelineno-2-8"></a>docker<span class="w"> </span>stop<span class="w"> </span>cpu-pinned
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#013-cgroup-__codelineno-2-9"></a>docker<span class="w"> </span>rm<span class="w"> </span>cpu-pinned
</span></code></pre></div>
<h2 id="013-cgroup-combined-resource-limits">Combined Resource Limits<a class="headerlink" href="#013-cgroup-combined-resource-limits" title="Permanent link">&para;</a></h2>
<ul>
<li>Combine multiple resource constraints for comprehensive control.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#013-cgroup-__codelineno-3-1"></a><span class="c1"># Limit both CPU and memory</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#013-cgroup-__codelineno-3-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--cpus<span class="o">=</span><span class="m">1</span>.0<span class="w"> </span>--memory<span class="o">=</span>256m<span class="w"> </span>--name<span class="w"> </span>combined-limits<span class="w"> </span>nginx
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#013-cgroup-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#013-cgroup-__codelineno-3-4"></a><span class="c1"># Check all resource limits</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#013-cgroup-__codelineno-3-5"></a>docker<span class="w"> </span>inspect<span class="w"> </span>combined-limits<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s2">&quot;HostConfig&quot;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#013-cgroup-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#013-cgroup-__codelineno-3-7"></a><span class="c1"># Clean up</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#013-cgroup-__codelineno-3-8"></a>docker<span class="w"> </span>stop<span class="w"> </span>combined-limits
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#013-cgroup-__codelineno-3-9"></a>docker<span class="w"> </span>rm<span class="w"> </span>combined-limits
</span></code></pre></div>
<h2 id="013-cgroup-monitoring-resource-usage">Monitoring Resource Usage<a class="headerlink" href="#013-cgroup-monitoring-resource-usage" title="Permanent link">&para;</a></h2>
<ul>
<li>Use <code>docker stats</code> to monitor container resource usage in real-time.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#013-cgroup-__codelineno-4-1"></a><span class="c1"># Start multiple containers with different limits</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#013-cgroup-__codelineno-4-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--cpus<span class="o">=</span><span class="m">0</span>.5<span class="w"> </span>--memory<span class="o">=</span>128m<span class="w"> </span>--name<span class="w"> </span>container1<span class="w"> </span>nginx
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#013-cgroup-__codelineno-4-3"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--cpus<span class="o">=</span><span class="m">1</span>.0<span class="w"> </span>--memory<span class="o">=</span>256m<span class="w"> </span>--name<span class="w"> </span>container2<span class="w"> </span>nginx
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#013-cgroup-__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#013-cgroup-__codelineno-4-5"></a><span class="c1"># Monitor resource usage</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#013-cgroup-__codelineno-4-6"></a>docker<span class="w"> </span>stats
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#013-cgroup-__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#013-cgroup-__codelineno-4-8"></a><span class="c1"># Clean up</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#013-cgroup-__codelineno-4-9"></a>docker<span class="w"> </span>stop<span class="w"> </span>container1<span class="w"> </span>container2
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#013-cgroup-__codelineno-4-10"></a>docker<span class="w"> </span>rm<span class="w"> </span>container1<span class="w"> </span>container2
</span></code></pre></div></section><section class="print-page" id="014-dockerdaemon" heading-number="1.15"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="014-dockerdaemon-lab-014-docker-daemon">Lab 014 - Docker Daemon<a class="headerlink" href="#014-dockerdaemon-lab-014-docker-daemon" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab covers the Docker daemon (dockerd), its configuration, and advanced features.</li>
<li>You&rsquo;ll learn how to customize the Docker daemon behavior, configure private registries, enable rootless mode, and implement various security and performance optimizations.</li>
<li>Topics include daemon configuration file, logging options, storage drivers, network settings, and experimental features.</li>
<li>By the end of this lab, you&rsquo;ll understand how to configure and manage the Docker daemon for production environments.</li>
</ul>
<hr />
<!-- omit in toc -->
<h2 id="014-dockerdaemon-table-of-contents">Table of Contents<a class="headerlink" href="#014-dockerdaemon-table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#014-dockerdaemon--understanding-the-docker-daemon">üê≥ Understanding the Docker Daemon</a></li>
<li><a href="#014-dockerdaemon-Ô∏è-docker-daemon-configuration">‚öôÔ∏è Docker Daemon Configuration</a></li>
<li><a href="#014-dockerdaemon-configuration-file-location">Configuration File Location</a></li>
<li><a href="#014-dockerdaemon-basic-configuration-structure">Basic Configuration Structure</a></li>
<li><a href="#014-dockerdaemon--common-daemon-configurations">üîß Common Daemon Configurations</a></li>
<li><a href="#014-dockerdaemon-logging-configuration">Logging Configuration</a></li>
<li><a href="#014-dockerdaemon-storage-configuration">Storage Configuration</a></li>
<li><a href="#014-dockerdaemon-network-configuration">Network Configuration</a></li>
<li><a href="#014-dockerdaemon-security-configuration">Security Configuration</a></li>
<li><a href="#014-dockerdaemon--private-registry-configuration">üè¢ Private Registry Configuration</a></li>
<li><a href="#014-dockerdaemon--rootless-docker">üë§ Rootless Docker</a></li>
<li><a href="#014-dockerdaemon--experimental-features">üöÄ Experimental Features</a></li>
<li><a href="#014-dockerdaemon--monitoring-and-debugging">üìä Monitoring and Debugging</a></li>
<li><a href="#014-dockerdaemon--security-best-practices">üîí Security Best Practices</a></li>
</ul>
<hr />
<h2 id="014-dockerdaemon-understanding-the-docker-daemon">üê≥ Understanding the Docker Daemon<a class="headerlink" href="#014-dockerdaemon-understanding-the-docker-daemon" title="Permanent link">&para;</a></h2>
<p>The Docker daemon (<code>dockerd</code>) is the persistent process that manages Docker containers, images, networks, and volumes. It listens for Docker API requests and manages Docker objects.</p>
<h3 id="014-dockerdaemon-key-responsibilities">Key Responsibilities<a class="headerlink" href="#014-dockerdaemon-key-responsibilities" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Container Management</strong>: Creating, starting, stopping, and monitoring containers</li>
<li><strong>Image Management</strong>: Pulling, pushing, and building images</li>
<li><strong>Network Management</strong>: Creating and managing container networks</li>
<li><strong>Volume Management</strong>: Handling persistent data storage</li>
<li><strong>API Server</strong>: Providing REST API for Docker client communication</li>
</ul>
<h3 id="014-dockerdaemon-daemon-lifecycle">Daemon Lifecycle<a class="headerlink" href="#014-dockerdaemon-daemon-lifecycle" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#014-dockerdaemon-__codelineno-0-1"></a><span class="c1"># Check if daemon is running</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#014-dockerdaemon-__codelineno-0-2"></a>docker<span class="w"> </span>version
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#014-dockerdaemon-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#014-dockerdaemon-__codelineno-0-4"></a><span class="c1"># View daemon info</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#014-dockerdaemon-__codelineno-0-5"></a>docker<span class="w"> </span>info
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#014-dockerdaemon-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#014-dockerdaemon-__codelineno-0-7"></a><span class="c1"># Restart daemon (Linux)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#014-dockerdaemon-__codelineno-0-8"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>docker
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#014-dockerdaemon-__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#014-dockerdaemon-__codelineno-0-10"></a><span class="c1"># View daemon logs (Linux)</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#014-dockerdaemon-__codelineno-0-11"></a>sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>docker<span class="w"> </span>-f
</span></code></pre></div>
<hr />
<h2 id="014-dockerdaemon-docker-daemon-configuration">‚öôÔ∏è Docker Daemon Configuration<a class="headerlink" href="#014-dockerdaemon-docker-daemon-configuration" title="Permanent link">&para;</a></h2>
<h3 id="014-dockerdaemon-configuration-file-location">Configuration File Location<a class="headerlink" href="#014-dockerdaemon-configuration-file-location" title="Permanent link">&para;</a></h3>
<p>The Docker daemon can be configured using a JSON configuration file:</p>
<p><strong>Linux/macOS</strong>: <code>/etc/docker/daemon.json</code>
<strong>Windows</strong>: <code>C:\ProgramData\docker\config\daemon.json</code></p>
<h3 id="014-dockerdaemon-basic-configuration-structure">Basic Configuration Structure<a class="headerlink" href="#014-dockerdaemon-basic-configuration-structure" title="Permanent link">&para;</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#014-dockerdaemon-__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#014-dockerdaemon-__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;debug&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#014-dockerdaemon-__codelineno-1-3"></a><span class="w">  </span><span class="nt">&quot;tls&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#014-dockerdaemon-__codelineno-1-4"></a><span class="w">  </span><span class="nt">&quot;tlscert&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/var/docker/server.pem&quot;</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#014-dockerdaemon-__codelineno-1-5"></a><span class="w">  </span><span class="nt">&quot;tlskey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/var/docker/serverkey.pem&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#014-dockerdaemon-__codelineno-1-6"></a><span class="w">  </span><span class="nt">&quot;hosts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tcp://0.0.0.0:2376&quot;</span><span class="p">],</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#014-dockerdaemon-__codelineno-1-7"></a><span class="w">  </span><span class="nt">&quot;log-driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json-file&quot;</span><span class="p">,</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#014-dockerdaemon-__codelineno-1-8"></a><span class="w">  </span><span class="nt">&quot;log-opts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#014-dockerdaemon-__codelineno-1-9"></a><span class="w">    </span><span class="nt">&quot;max-size&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10m&quot;</span><span class="p">,</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#014-dockerdaemon-__codelineno-1-10"></a><span class="w">    </span><span class="nt">&quot;max-file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3&quot;</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#014-dockerdaemon-__codelineno-1-11"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#014-dockerdaemon-__codelineno-1-12"></a><span class="w">  </span><span class="nt">&quot;storage-driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;overlay2&quot;</span><span class="p">,</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#014-dockerdaemon-__codelineno-1-13"></a><span class="w">  </span><span class="nt">&quot;insecure-registries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myregistry.com:5000&quot;</span><span class="p">],</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#014-dockerdaemon-__codelineno-1-14"></a><span class="w">  </span><span class="nt">&quot;registry-mirrors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://mirror.gcr.io&quot;</span><span class="p">]</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#014-dockerdaemon-__codelineno-1-15"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="014-dockerdaemon-common-daemon-configurations">üîß Common Daemon Configurations<a class="headerlink" href="#014-dockerdaemon-common-daemon-configurations" title="Permanent link">&para;</a></h2>
<h3 id="014-dockerdaemon-logging-configuration">Logging Configuration<a class="headerlink" href="#014-dockerdaemon-logging-configuration" title="Permanent link">&para;</a></h3>
<p>Configure how Docker logs container output and daemon events:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#014-dockerdaemon-__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#014-dockerdaemon-__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;log-driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;json-file&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#014-dockerdaemon-__codelineno-2-3"></a><span class="w">  </span><span class="nt">&quot;log-opts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#014-dockerdaemon-__codelineno-2-4"></a><span class="w">    </span><span class="nt">&quot;max-size&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10m&quot;</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#014-dockerdaemon-__codelineno-2-5"></a><span class="w">    </span><span class="nt">&quot;max-file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3&quot;</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#014-dockerdaemon-__codelineno-2-6"></a><span class="w">    </span><span class="nt">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production_status&quot;</span><span class="p">,</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#014-dockerdaemon-__codelineno-2-7"></a><span class="w">    </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;os,customer&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#014-dockerdaemon-__codelineno-2-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#014-dockerdaemon-__codelineno-2-9"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Available log drivers:</strong></p>
<ul>
<li><code>json-file</code> (default): JSON formatted logs</li>
<li><code>syslog</code>: System logging</li>
<li><code>journald</code>: systemd journal</li>
<li><code>fluentd</code>: Fluentd logging</li>
<li><code>awslogs</code>: Amazon CloudWatch</li>
<li><code>splunk</code>: Splunk logging</li>
</ul>
<h3 id="014-dockerdaemon-storage-configuration">Storage Configuration<a class="headerlink" href="#014-dockerdaemon-storage-configuration" title="Permanent link">&para;</a></h3>
<p>Configure storage driver and options:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#014-dockerdaemon-__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#014-dockerdaemon-__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;storage-driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;overlay2&quot;</span><span class="p">,</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#014-dockerdaemon-__codelineno-3-3"></a><span class="w">  </span><span class="nt">&quot;storage-opts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#014-dockerdaemon-__codelineno-3-4"></a><span class="w">    </span><span class="s2">&quot;overlay2.override_kernel_check=true&quot;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#014-dockerdaemon-__codelineno-3-5"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#014-dockerdaemon-__codelineno-3-6"></a><span class="w">  </span><span class="nt">&quot;data-root&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/var/lib/docker&quot;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#014-dockerdaemon-__codelineno-3-7"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Common storage drivers:</strong></p>
<ul>
<li><code>overlay2</code> (recommended for modern Linux)</li>
<li><code>btrfs</code> (for Btrfs filesystems)</li>
<li><code>zfs</code> (for ZFS filesystems)</li>
<li><code>devicemapper</code> (legacy, device mapper)</li>
</ul>
<h3 id="014-dockerdaemon-network-configuration">Network Configuration<a class="headerlink" href="#014-dockerdaemon-network-configuration" title="Permanent link">&para;</a></h3>
<p>Configure networking options:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#014-dockerdaemon-__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#014-dockerdaemon-__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;bridge&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;docker0&quot;</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#014-dockerdaemon-__codelineno-4-3"></a><span class="w">  </span><span class="nt">&quot;fixed-cidr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.65.0/24&quot;</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#014-dockerdaemon-__codelineno-4-4"></a><span class="w">  </span><span class="nt">&quot;default-gateway&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.65.1&quot;</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#014-dockerdaemon-__codelineno-4-5"></a><span class="w">  </span><span class="nt">&quot;dns&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;8.8.8.8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;8.8.4.4&quot;</span><span class="p">],</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#014-dockerdaemon-__codelineno-4-6"></a><span class="w">  </span><span class="nt">&quot;dns-opts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;timeout:2&quot;</span><span class="p">],</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#014-dockerdaemon-__codelineno-4-7"></a><span class="w">  </span><span class="nt">&quot;dns-search&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;example.com&quot;</span><span class="p">],</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#014-dockerdaemon-__codelineno-4-8"></a><span class="w">  </span><span class="nt">&quot;iptables&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#014-dockerdaemon-__codelineno-4-9"></a><span class="w">  </span><span class="nt">&quot;ip-forward&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#014-dockerdaemon-__codelineno-4-10"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="014-dockerdaemon-security-configuration">Security Configuration<a class="headerlink" href="#014-dockerdaemon-security-configuration" title="Permanent link">&para;</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#014-dockerdaemon-__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#014-dockerdaemon-__codelineno-5-2"></a><span class="w">  </span><span class="nt">&quot;userns-remap&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#014-dockerdaemon-__codelineno-5-3"></a><span class="w">  </span><span class="nt">&quot;no-new-privileges&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#014-dockerdaemon-__codelineno-5-4"></a><span class="w">  </span><span class="nt">&quot;seccomp-profile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/etc/docker/seccomp.json&quot;</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#014-dockerdaemon-__codelineno-5-5"></a><span class="w">  </span><span class="nt">&quot;selinux-enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#014-dockerdaemon-__codelineno-5-6"></a><span class="w">  </span><span class="nt">&quot;live-restore&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#014-dockerdaemon-__codelineno-5-7"></a><span class="w">  </span><span class="nt">&quot;icc&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#014-dockerdaemon-__codelineno-5-8"></a><span class="w">  </span><span class="nt">&quot;userland-proxy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#014-dockerdaemon-__codelineno-5-9"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="014-dockerdaemon-private-registry-configuration">üè¢ Private Registry Configuration<a class="headerlink" href="#014-dockerdaemon-private-registry-configuration" title="Permanent link">&para;</a></h2>
<h3 id="014-dockerdaemon-adding-insecure-registries">Adding Insecure Registries<a class="headerlink" href="#014-dockerdaemon-adding-insecure-registries" title="Permanent link">&para;</a></h3>
<p>For registries without TLS certificates:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#014-dockerdaemon-__codelineno-6-1"></a><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#014-dockerdaemon-__codelineno-6-2"></a><span class="w">  </span><span class="nt">&quot;insecure-registries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#014-dockerdaemon-__codelineno-6-3"></a><span class="w">    </span><span class="s2">&quot;myregistry.com:5000&quot;</span><span class="p">,</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#014-dockerdaemon-__codelineno-6-4"></a><span class="w">    </span><span class="s2">&quot;registry.internal.company.com&quot;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#014-dockerdaemon-__codelineno-6-5"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#014-dockerdaemon-__codelineno-6-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="014-dockerdaemon-registry-mirrors">Registry Mirrors<a class="headerlink" href="#014-dockerdaemon-registry-mirrors" title="Permanent link">&para;</a></h3>
<p>Use registry mirrors to cache images:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#014-dockerdaemon-__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#014-dockerdaemon-__codelineno-7-2"></a><span class="w">  </span><span class="nt">&quot;registry-mirrors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#014-dockerdaemon-__codelineno-7-3"></a><span class="w">    </span><span class="s2">&quot;https://mirror.gcr.io&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#014-dockerdaemon-__codelineno-7-4"></a><span class="w">    </span><span class="s2">&quot;https://dockerhub.mirror.com&quot;</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#014-dockerdaemon-__codelineno-7-5"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#014-dockerdaemon-__codelineno-7-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="014-dockerdaemon-authentication">Authentication<a class="headerlink" href="#014-dockerdaemon-authentication" title="Permanent link">&para;</a></h3>
<p>Configure authentication for private registries:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#014-dockerdaemon-__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#014-dockerdaemon-__codelineno-8-2"></a><span class="w">  </span><span class="nt">&quot;auths&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#014-dockerdaemon-__codelineno-8-3"></a><span class="w">    </span><span class="nt">&quot;https://index.docker.io/v1/&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#014-dockerdaemon-__codelineno-8-4"></a><span class="w">      </span><span class="nt">&quot;auth&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dXNlcjpwYXNzd29yZA==&quot;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#014-dockerdaemon-__codelineno-8-5"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#014-dockerdaemon-__codelineno-8-6"></a><span class="w">    </span><span class="nt">&quot;myregistry.com:5000&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#014-dockerdaemon-__codelineno-8-7"></a><span class="w">      </span><span class="nt">&quot;auth&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dXNlcjpwYXNzd29yZA==&quot;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#014-dockerdaemon-__codelineno-8-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#014-dockerdaemon-__codelineno-8-9"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#014-dockerdaemon-__codelineno-8-10"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="014-dockerdaemon-example-working-with-private-registry">Example: Working with Private Registry<a class="headerlink" href="#014-dockerdaemon-example-working-with-private-registry" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#014-dockerdaemon-__codelineno-9-1"></a><span class="c1"># Tag image for private registry</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#014-dockerdaemon-__codelineno-9-2"></a>docker<span class="w"> </span>tag<span class="w"> </span>myapp:latest<span class="w"> </span>myregistry.com:5000/myapp:v1.0
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#014-dockerdaemon-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#014-dockerdaemon-__codelineno-9-4"></a><span class="c1"># Push to private registry</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#014-dockerdaemon-__codelineno-9-5"></a>docker<span class="w"> </span>push<span class="w"> </span>myregistry.com:5000/myapp:v1.0
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#014-dockerdaemon-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#014-dockerdaemon-__codelineno-9-7"></a><span class="c1"># Pull from private registry</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#014-dockerdaemon-__codelineno-9-8"></a>docker<span class="w"> </span>pull<span class="w"> </span>myregistry.com:5000/myapp:v1.0
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#014-dockerdaemon-__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#014-dockerdaemon-__codelineno-9-10"></a><span class="c1"># Login to registry (if required)</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#014-dockerdaemon-__codelineno-9-11"></a>docker<span class="w"> </span>login<span class="w"> </span>myregistry.com:5000
</span></code></pre></div>
<hr />
<h2 id="014-dockerdaemon-rootless-docker">üë§ Rootless Docker<a class="headerlink" href="#014-dockerdaemon-rootless-docker" title="Permanent link">&para;</a></h2>
<p>Rootless Docker allows running the Docker daemon without root privileges, improving security by reducing the attack surface.</p>
<h3 id="014-dockerdaemon-installation">Installation<a class="headerlink" href="#014-dockerdaemon-installation" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#014-dockerdaemon-__codelineno-10-1"></a><span class="c1"># Install rootless Docker</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#014-dockerdaemon-__codelineno-10-2"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://get.docker.com/rootless<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#014-dockerdaemon-__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#014-dockerdaemon-__codelineno-10-4"></a><span class="c1"># Start rootless Docker</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#014-dockerdaemon-__codelineno-10-5"></a>systemctl<span class="w"> </span>--user<span class="w"> </span>start<span class="w"> </span>docker
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#014-dockerdaemon-__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#014-dockerdaemon-__codelineno-10-7"></a><span class="c1"># Enable on boot</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#014-dockerdaemon-__codelineno-10-8"></a>systemctl<span class="w"> </span>--user<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>docker
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#014-dockerdaemon-__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#014-dockerdaemon-__codelineno-10-10"></a><span class="c1"># Add to PATH</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#014-dockerdaemon-__codelineno-10-11"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/home/<span class="nv">$USER</span>/bin:<span class="nv">$PATH</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#014-dockerdaemon-__codelineno-10-12"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_HOST</span><span class="o">=</span>unix:///run/user/<span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>/docker.sock
</span></code></pre></div>
<h3 id="014-dockerdaemon-configuration">Configuration<a class="headerlink" href="#014-dockerdaemon-configuration" title="Permanent link">&para;</a></h3>
<p>Rootless Docker uses different paths and configurations:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#014-dockerdaemon-__codelineno-11-1"></a><span class="c1"># Rootless Docker socket</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#014-dockerdaemon-__codelineno-11-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_HOST</span><span class="o">=</span>unix:///run/user/<span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>/docker.sock
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#014-dockerdaemon-__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#014-dockerdaemon-__codelineno-11-4"></a><span class="c1"># Rootless Docker data directory</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#014-dockerdaemon-__codelineno-11-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">XDG_DATA_HOME</span><span class="o">=</span>/home/<span class="nv">$USER</span>/.local/share
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#014-dockerdaemon-__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#014-dockerdaemon-__codelineno-11-7"></a><span class="c1"># Rootless Docker config</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#014-dockerdaemon-__codelineno-11-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_CONFIG</span><span class="o">=</span>/home/<span class="nv">$USER</span>/.config/docker
</span></code></pre></div>
<h3 id="014-dockerdaemon-limitations">Limitations<a class="headerlink" href="#014-dockerdaemon-limitations" title="Permanent link">&para;</a></h3>
<ul>
<li>Some features may not work (e.g., AppArmor, checkpoint/restore)</li>
<li>Port binding below 1024 requires additional setup</li>
<li>Some storage drivers may have limitations</li>
<li>Network features may be restricted</li>
</ul>
<h3 id="014-dockerdaemon-benefits">Benefits<a class="headerlink" href="#014-dockerdaemon-benefits" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Security</strong>: No root access required</li>
<li><strong>Isolation</strong>: User-specific Docker environment</li>
<li><strong>Compliance</strong>: Meets security requirements for multi-tenant environments</li>
</ul>
<hr />
<h2 id="014-dockerdaemon-experimental-features">üöÄ Experimental Features<a class="headerlink" href="#014-dockerdaemon-experimental-features" title="Permanent link">&para;</a></h2>
<p>Enable experimental features for cutting-edge functionality:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#014-dockerdaemon-__codelineno-12-1"></a><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#014-dockerdaemon-__codelineno-12-2"></a><span class="w">  </span><span class="nt">&quot;experimental&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#014-dockerdaemon-__codelineno-12-3"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Available experimental features:</strong></p>
<ul>
<li><strong>BuildKit</strong>: Advanced build engine with improved performance</li>
<li><strong>Squash</strong>: Squash layers to reduce image size</li>
<li><strong>Checkpoint/Restore</strong>: Save and restore container state</li>
<li><strong>Rootless mode</strong>: Run daemon without root (now stable)</li>
</ul>
<h3 id="014-dockerdaemon-buildkit-configuration">BuildKit Configuration<a class="headerlink" href="#014-dockerdaemon-buildkit-configuration" title="Permanent link">&para;</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#014-dockerdaemon-__codelineno-13-1"></a><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#014-dockerdaemon-__codelineno-13-2"></a><span class="w">  </span><span class="nt">&quot;experimental&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#014-dockerdaemon-__codelineno-13-3"></a><span class="w">  </span><span class="nt">&quot;features&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#014-dockerdaemon-__codelineno-13-4"></a><span class="w">    </span><span class="nt">&quot;buildkit&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#014-dockerdaemon-__codelineno-13-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#014-dockerdaemon-__codelineno-13-6"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Using BuildKit:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#014-dockerdaemon-__codelineno-14-1"></a><span class="c1"># Enable BuildKit</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#014-dockerdaemon-__codelineno-14-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#014-dockerdaemon-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#014-dockerdaemon-__codelineno-14-4"></a><span class="c1"># Build with BuildKit</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#014-dockerdaemon-__codelineno-14-5"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>myapp<span class="w"> </span>.
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#014-dockerdaemon-__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#014-dockerdaemon-__codelineno-14-7"></a><span class="c1"># Use advanced BuildKit features</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#014-dockerdaemon-__codelineno-14-8"></a>docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>production<span class="w"> </span>-t<span class="w"> </span>myapp<span class="w"> </span>.
</span></code></pre></div>
<hr />
<h2 id="014-dockerdaemon-monitoring-and-debugging">üìä Monitoring and Debugging<a class="headerlink" href="#014-dockerdaemon-monitoring-and-debugging" title="Permanent link">&para;</a></h2>
<h3 id="014-dockerdaemon-daemon-monitoring">Daemon Monitoring<a class="headerlink" href="#014-dockerdaemon-daemon-monitoring" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#014-dockerdaemon-__codelineno-15-1"></a><span class="c1"># View daemon info</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#014-dockerdaemon-__codelineno-15-2"></a>docker<span class="w"> </span>info
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#014-dockerdaemon-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#014-dockerdaemon-__codelineno-15-4"></a><span class="c1"># System-wide information</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#014-dockerdaemon-__codelineno-15-5"></a>docker<span class="w"> </span>system<span class="w"> </span>info
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#014-dockerdaemon-__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#014-dockerdaemon-__codelineno-15-7"></a><span class="c1"># Disk usage</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#014-dockerdaemon-__codelineno-15-8"></a>docker<span class="w"> </span>system<span class="w"> </span>df
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#014-dockerdaemon-__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#014-dockerdaemon-__codelineno-15-10"></a><span class="c1"># Events stream</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#014-dockerdaemon-__codelineno-15-11"></a>docker<span class="w"> </span>events
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#014-dockerdaemon-__codelineno-15-12"></a>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#014-dockerdaemon-__codelineno-15-13"></a><span class="c1"># Daemon logs</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#014-dockerdaemon-__codelineno-15-14"></a>sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>docker<span class="w"> </span>-f
</span></code></pre></div>
<h3 id="014-dockerdaemon-debugging-configuration">Debugging Configuration<a class="headerlink" href="#014-dockerdaemon-debugging-configuration" title="Permanent link">&para;</a></h3>
<div class="language-json highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#014-dockerdaemon-__codelineno-16-1"></a><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#014-dockerdaemon-__codelineno-16-2"></a><span class="w">  </span><span class="nt">&quot;debug&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#014-dockerdaemon-__codelineno-16-3"></a><span class="w">  </span><span class="nt">&quot;log-level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;debug&quot;</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#014-dockerdaemon-__codelineno-16-4"></a><span class="w">  </span><span class="nt">&quot;metrics-addr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;127.0.0.1:9323&quot;</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#014-dockerdaemon-__codelineno-16-5"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="014-dockerdaemon-health-checks">Health Checks<a class="headerlink" href="#014-dockerdaemon-health-checks" title="Permanent link">&para;</a></h3>
<p>Monitor daemon health:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#014-dockerdaemon-__codelineno-17-1"></a><span class="c1"># Check daemon responsiveness</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#014-dockerdaemon-__codelineno-17-2"></a>docker<span class="w"> </span>version
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#014-dockerdaemon-__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#014-dockerdaemon-__codelineno-17-4"></a><span class="c1"># System events</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#014-dockerdaemon-__codelineno-17-5"></a>docker<span class="w"> </span>system<span class="w"> </span>events<span class="w"> </span>--since<span class="w"> </span>1h
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#014-dockerdaemon-__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#014-dockerdaemon-__codelineno-17-7"></a><span class="c1"># Container events</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#014-dockerdaemon-__codelineno-17-8"></a>docker<span class="w"> </span>events<span class="w"> </span>--filter<span class="w"> </span><span class="nv">type</span><span class="o">=</span>container
</span></code></pre></div>
<hr />
<h2 id="014-dockerdaemon-security-best-practices">üîí Security Best Practices<a class="headerlink" href="#014-dockerdaemon-security-best-practices" title="Permanent link">&para;</a></h2>
<ul>
<li>
<h3 id="014-dockerdaemon-tls-configuration">üîê TLS Configuration<a class="headerlink" href="#014-dockerdaemon-tls-configuration" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Always use TLS for daemon communication:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#014-dockerdaemon-__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#014-dockerdaemon-__codelineno-18-2"></a><span class="w">  </span><span class="nt">&quot;tls&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#014-dockerdaemon-__codelineno-18-3"></a><span class="w">  </span><span class="nt">&quot;tlscert&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/etc/docker/server.pem&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#014-dockerdaemon-__codelineno-18-4"></a><span class="w">  </span><span class="nt">&quot;tlskey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/etc/docker/serverkey.pem&quot;</span><span class="p">,</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#014-dockerdaemon-__codelineno-18-5"></a><span class="w">  </span><span class="nt">&quot;tlsverify&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#014-dockerdaemon-__codelineno-18-6"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>
<h3 id="014-dockerdaemon-user-namespace">üë• User Namespace<a class="headerlink" href="#014-dockerdaemon-user-namespace" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Enable user namespace remapping:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#014-dockerdaemon-__codelineno-19-1"></a><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#014-dockerdaemon-__codelineno-19-2"></a><span class="w">  </span><span class="nt">&quot;userns-remap&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;default&quot;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#014-dockerdaemon-__codelineno-19-3"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>
<h3 id="014-dockerdaemon-seccomp-profiles">üõ°Ô∏è Seccomp Profiles<a class="headerlink" href="#014-dockerdaemon-seccomp-profiles" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Use custom seccomp profiles:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#014-dockerdaemon-__codelineno-20-1"></a><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#014-dockerdaemon-__codelineno-20-2"></a><span class="w">  </span><span class="nt">&quot;seccomp-profile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/etc/docker/seccomp.json&quot;</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#014-dockerdaemon-__codelineno-20-3"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>
<h3 id="014-dockerdaemon-selinuxapparmor">üîí SELinux/AppArmor<a class="headerlink" href="#014-dockerdaemon-selinuxapparmor" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Enable mandatory access control:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#014-dockerdaemon-__codelineno-21-1"></a><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#014-dockerdaemon-__codelineno-21-2"></a><span class="w">  </span><span class="nt">&quot;selinux-enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#014-dockerdaemon-__codelineno-21-3"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>
<h3 id="014-dockerdaemon-audit-logging">üìä Audit Logging<a class="headerlink" href="#014-dockerdaemon-audit-logging" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Enable detailed audit logging:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#014-dockerdaemon-__codelineno-22-1"></a><span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#014-dockerdaemon-__codelineno-22-2"></a><span class="w">  </span><span class="nt">&quot;log-driver&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;syslog&quot;</span><span class="p">,</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#014-dockerdaemon-__codelineno-22-3"></a><span class="w">  </span><span class="nt">&quot;log-opts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#014-dockerdaemon-__codelineno-22-4"></a><span class="w">    </span><span class="nt">&quot;syslog-facility&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;daemon&quot;</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#014-dockerdaemon-__codelineno-22-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#014-dockerdaemon-__codelineno-22-6"></a><span class="p">}</span>
</span></code></pre></div>
<ul>
<li>
<h3 id="014-dockerdaemon-disable-insecure-features">üö´ Disable Insecure Features<a class="headerlink" href="#014-dockerdaemon-disable-insecure-features" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Avoid insecure configurations:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#014-dockerdaemon-__codelineno-23-1"></a><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#014-dockerdaemon-__codelineno-23-2"></a><span class="w">  </span><span class="nt">&quot;icc&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#014-dockerdaemon-__codelineno-23-3"></a><span class="w">  </span><span class="nt">&quot;no-new-privileges&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#014-dockerdaemon-__codelineno-23-4"></a><span class="w">  </span><span class="nt">&quot;userland-proxy&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#014-dockerdaemon-__codelineno-23-5"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="014-dockerdaemon-lab-exercises">üìã Lab Exercises<a class="headerlink" href="#014-dockerdaemon-lab-exercises" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Configure Basic Daemon Settings</strong></p>
<ul>
<li>Create <code>/etc/docker/daemon.json</code> with basic configuration</li>
<li>Restart Docker daemon and verify settings</li>
</ul>
</li>
<li>
<p><strong>Set Up Private Registry</strong></p>
<ul>
<li>Configure insecure registry in daemon.json</li>
<li>Push and pull images from private registry</li>
</ul>
</li>
<li>
<p><strong>Enable Rootless Docker</strong></p>
<ul>
<li>Install and configure rootless Docker</li>
<li>Test container operations without root</li>
</ul>
</li>
<li>
<p><strong>Configure Logging</strong></p>
<ul>
<li>Set up JSON logging with rotation</li>
<li>View and analyze container logs</li>
</ul>
</li>
<li>
<p><strong>Security Hardening</strong></p>
<ul>
<li>Enable user namespaces</li>
<li>Configure seccomp profiles</li>
<li>Set up TLS authentication</li>
</ul>
</li>
</ol>
<hr />
<h2 id="014-dockerdaemon-additional-resources">üîó Additional Resources<a class="headerlink" href="#014-dockerdaemon-additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.docker.com/config/daemon/">Docker Daemon Configuration</a></li>
<li><a href="https://docs.docker.com/registry/">Private Registry Setup</a></li>
<li><a href="https://docs.docker.com/engine/security/rootless/">Rootless Docker</a></li>
<li><a href="https://docs.docker.com/develop/dev-best-practices/security/">Docker Security Best Practices</a></li>
<li><a href="https://docs.docker.com/develop/dev-best-practices/">BuildKit Documentation</a></li>
</ul></section><section class="print-page" id="015-networking" heading-number="1.16"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="015-networking-lab-015-docker-networking">Lab 015 - Docker Networking<a class="headerlink" href="#015-networking-lab-015-docker-networking" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab covers Docker networking fundamentals, including network drivers, custom networks, and advanced networking features.</li>
<li>You&rsquo;ll learn how to create and manage container networks, configure network connectivity, and implement service discovery.</li>
<li>Topics include bridge networks, overlay networks, host networking, and network troubleshooting.</li>
<li>By the end of this lab, you&rsquo;ll understand how to design and manage container networking for various deployment scenarios.</li>
</ul>
<hr />
<!-- omit in toc -->
<h2 id="015-networking-table-of-contents">Table of Contents<a class="headerlink" href="#015-networking-table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#015-networking--understanding-docker-networking">üåê Understanding Docker Networking</a></li>
<li><a href="#015-networking--network-drivers">üîó Network Drivers</a></li>
<li><a href="#015-networking-bridge-network">Bridge Network</a></li>
<li><a href="#015-networking-host-network">Host Network</a></li>
<li><a href="#015-networking-none-network">None Network</a></li>
<li><a href="#015-networking-overlay-network">Overlay Network</a></li>
<li><a href="#015-networking-macvlan-network">Macvlan Network</a></li>
<li><a href="#015-networking-Ô∏è-custom-networks">‚öôÔ∏è Custom Networks</a></li>
<li><a href="#015-networking-creating-custom-networks">Creating Custom Networks</a></li>
<li><a href="#015-networking-network-configuration">Network Configuration</a></li>
<li><a href="#015-networking--container-networking">üîå Container Networking</a></li>
<li><a href="#015-networking-connecting-containers">Connecting Containers</a></li>
<li><a href="#015-networking-port-mapping">Port Mapping</a></li>
<li><a href="#015-networking-service-discovery">Service Discovery</a></li>
<li><a href="#015-networking--advanced-networking">üöÄ Advanced Networking</a></li>
<li><a href="#015-networking-network-plugins">Network Plugins</a></li>
<li><a href="#015-networking-dns-configuration">DNS Configuration</a></li>
<li><a href="#015-networking-network-security">Network Security</a></li>
<li><a href="#015-networking--networking-commands">üîß Networking Commands</a></li>
<li><a href="#015-networking--monitoring-and-troubleshooting">üìä Monitoring and Troubleshooting</a></li>
<li><a href="#015-networking--networking-best-practices">üîí Networking Best Practices</a></li>
</ul>
<hr />
<h2 id="015-networking-understanding-docker-networking">üåê Understanding Docker Networking<a class="headerlink" href="#015-networking-understanding-docker-networking" title="Permanent link">&para;</a></h2>
<p>Docker networking enables containers to communicate with each other and external networks. Docker provides several network drivers to suit different use cases.</p>
<h3 id="015-networking-key-concepts">Key Concepts<a class="headerlink" href="#015-networking-key-concepts" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Network Drivers</strong>: Define how containers connect to networks</li>
<li><strong>Bridge Networks</strong>: Default network for single-host communication</li>
<li><strong>Overlay Networks</strong>: Multi-host networking for Swarm clusters</li>
<li><strong>Host Networks</strong>: Direct access to host network stack</li>
<li><strong>None Networks</strong>: Isolated containers with no networking</li>
</ul>
<h3 id="015-networking-default-networks">Default Networks<a class="headerlink" href="#015-networking-default-networks" title="Permanent link">&para;</a></h3>
<p>Docker creates three default networks:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#015-networking-__codelineno-0-1"></a><span class="c1"># List all networks</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#015-networking-__codelineno-0-2"></a>docker<span class="w"> </span>network<span class="w"> </span>ls
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#015-networking-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#015-networking-__codelineno-0-4"></a><span class="c1"># Inspect default bridge network</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#015-networking-__codelineno-0-5"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>bridge
</span></code></pre></div>
<hr />
<h2 id="015-networking-network-drivers">üîó Network Drivers<a class="headerlink" href="#015-networking-network-drivers" title="Permanent link">&para;</a></h2>
<h3 id="015-networking-bridge-network">Bridge Network<a class="headerlink" href="#015-networking-bridge-network" title="Permanent link">&para;</a></h3>
<p>The default network driver for containers. Creates an internal network on the host.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Containers can communicate with each other</li>
<li>Containers get IP addresses from Docker&rsquo;s subnet</li>
<li>Port mapping required for external access</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#015-networking-__codelineno-1-1"></a><span class="c1"># Run container on bridge network</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#015-networking-__codelineno-1-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#015-networking-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#015-networking-__codelineno-1-4"></a><span class="c1"># Inspect container network</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#015-networking-__codelineno-1-5"></a>docker<span class="w"> </span>inspect<span class="w"> </span>web<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span>NetworkSettings
</span></code></pre></div>
<h3 id="015-networking-host-network">Host Network<a class="headerlink" href="#015-networking-host-network" title="Permanent link">&para;</a></h3>
<p>Containers share the host&rsquo;s network stack directly.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>No network isolation</li>
<li>Best performance</li>
<li>No port conflicts</li>
<li>Limited to single host</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#015-networking-__codelineno-2-1"></a><span class="c1"># Run container with host networking</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#015-networking-__codelineno-2-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>host<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span></code></pre></div>
<h3 id="015-networking-none-network">None Network<a class="headerlink" href="#015-networking-none-network" title="Permanent link">&para;</a></h3>
<p>Completely isolated containers with no network access.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>No network interfaces</li>
<li>Maximum isolation</li>
<li>Manual network setup required</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#015-networking-__codelineno-3-1"></a><span class="c1"># Run container with no networking</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#015-networking-__codelineno-3-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>none<span class="w"> </span>--name<span class="w"> </span>isolated<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">3600</span>
</span></code></pre></div>
<h3 id="015-networking-overlay-network">Overlay Network<a class="headerlink" href="#015-networking-overlay-network" title="Permanent link">&para;</a></h3>
<p>Multi-host networking for Docker Swarm clusters.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Spans multiple hosts</li>
<li>Built-in service discovery</li>
<li>Load balancing</li>
<li>Requires Swarm mode</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#015-networking-__codelineno-4-1"></a><span class="c1"># Create overlay network (in Swarm)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#015-networking-__codelineno-4-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>overlay<span class="w"> </span>my-overlay
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#015-networking-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#015-networking-__codelineno-4-4"></a><span class="c1"># Run service on overlay network</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#015-networking-__codelineno-4-5"></a>docker<span class="w"> </span>service<span class="w"> </span>create<span class="w"> </span>--network<span class="w"> </span>my-overlay<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span></code></pre></div>
<h3 id="015-networking-macvlan-network">Macvlan Network<a class="headerlink" href="#015-networking-macvlan-network" title="Permanent link">&para;</a></h3>
<p>Assigns MAC addresses to containers, making them appear as physical devices.</p>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Layer 2 networking</li>
<li>Direct layer 2 access</li>
<li>No port mapping needed</li>
<li>Requires promiscuous mode on host interface</li>
</ul>
<p><strong>Example:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#015-networking-__codelineno-5-1"></a><span class="c1"># Create macvlan network</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#015-networking-__codelineno-5-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>macvlan<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#015-networking-__codelineno-5-3"></a><span class="w">  </span>--subnet<span class="o">=</span><span class="m">192</span>.168.1.0/24<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#015-networking-__codelineno-5-4"></a><span class="w">  </span>--gateway<span class="o">=</span><span class="m">192</span>.168.1.1<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#015-networking-__codelineno-5-5"></a><span class="w">  </span>-o<span class="w"> </span><span class="nv">parent</span><span class="o">=</span>eth0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#015-networking-__codelineno-5-6"></a><span class="w">  </span>my-macvlan
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#015-networking-__codelineno-5-7"></a>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#015-networking-__codelineno-5-8"></a><span class="c1"># Run container on macvlan</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#015-networking-__codelineno-5-9"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>my-macvlan<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span></code></pre></div>
<hr />
<h2 id="015-networking-custom-networks">‚öôÔ∏è Custom Networks<a class="headerlink" href="#015-networking-custom-networks" title="Permanent link">&para;</a></h2>
<h3 id="015-networking-creating-custom-networks">Creating Custom Networks<a class="headerlink" href="#015-networking-creating-custom-networks" title="Permanent link">&para;</a></h3>
<p>Create user-defined networks for better control.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#015-networking-__codelineno-6-1"></a><span class="c1"># Create bridge network</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#015-networking-__codelineno-6-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>my-bridge
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#015-networking-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#015-networking-__codelineno-6-4"></a><span class="c1"># Create network with custom subnet</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#015-networking-__codelineno-6-5"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>--subnet<span class="w"> </span><span class="m">172</span>.20.0.0/16<span class="w"> </span>my-custom-net
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#015-networking-__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#015-networking-__codelineno-6-7"></a><span class="c1"># Create network with options</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#015-networking-__codelineno-6-8"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#015-networking-__codelineno-6-9"></a><span class="w">  </span>--driver<span class="w"> </span>bridge<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#015-networking-__codelineno-6-10"></a><span class="w">  </span>--subnet<span class="w"> </span><span class="m">172</span>.25.0.0/16<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#015-networking-__codelineno-6-11"></a><span class="w">  </span>--gateway<span class="w"> </span><span class="m">172</span>.25.0.1<span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#015-networking-__codelineno-6-12"></a><span class="w">  </span>--opt<span class="w"> </span><span class="s2">&quot;com.docker.network.bridge.name&quot;</span><span class="o">=</span><span class="s2">&quot;my-bridge&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#015-networking-__codelineno-6-13"></a><span class="w">  </span>my-network
</span></code></pre></div>
<h3 id="015-networking-network-configuration">Network Configuration<a class="headerlink" href="#015-networking-network-configuration" title="Permanent link">&para;</a></h3>
<p>Configure network settings for containers.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#015-networking-__codelineno-7-1"></a><span class="c1"># Connect container to network</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#015-networking-__codelineno-7-2"></a>docker<span class="w"> </span>network<span class="w"> </span>connect<span class="w"> </span>my-network<span class="w"> </span>web
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#015-networking-__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#015-networking-__codelineno-7-4"></a><span class="c1"># Disconnect from network</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#015-networking-__codelineno-7-5"></a>docker<span class="w"> </span>network<span class="w"> </span>disconnect<span class="w"> </span>bridge<span class="w"> </span>web
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#015-networking-__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#015-networking-__codelineno-7-7"></a><span class="c1"># Run container with specific IP</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#015-networking-__codelineno-7-8"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>my-network<span class="w"> </span>--ip<span class="w"> </span><span class="m">172</span>.20.0.10<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#015-networking-__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#015-networking-__codelineno-7-10"></a><span class="c1"># Inspect network</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#015-networking-__codelineno-7-11"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>my-network
</span></code></pre></div>
<hr />
<h2 id="015-networking-container-networking">üîå Container Networking<a class="headerlink" href="#015-networking-container-networking" title="Permanent link">&para;</a></h2>
<h3 id="015-networking-connecting-containers">Connecting Containers<a class="headerlink" href="#015-networking-connecting-containers" title="Permanent link">&para;</a></h3>
<p>Enable communication between containers.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#015-networking-__codelineno-8-1"></a><span class="c1"># Create network</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#015-networking-__codelineno-8-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>app-network
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#015-networking-__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#015-networking-__codelineno-8-4"></a><span class="c1"># Run database</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#015-networking-__codelineno-8-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>app-network<span class="w"> </span>--name<span class="w"> </span>db<span class="w"> </span>postgres
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#015-networking-__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#015-networking-__codelineno-8-7"></a><span class="c1"># Run app connected to same network</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#015-networking-__codelineno-8-8"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>app-network<span class="w"> </span>--name<span class="w"> </span>app<span class="w"> </span>myapp
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#015-networking-__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#015-networking-__codelineno-8-10"></a><span class="c1"># Containers can communicate by name</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#015-networking-__codelineno-8-11"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>app<span class="w"> </span>ping<span class="w"> </span>db
</span></code></pre></div>
<h3 id="015-networking-port-mapping">Port Mapping<a class="headerlink" href="#015-networking-port-mapping" title="Permanent link">&para;</a></h3>
<p>Expose container ports to host.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#015-networking-__codelineno-9-1"></a><span class="c1"># Map single port</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#015-networking-__codelineno-9-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#015-networking-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#015-networking-__codelineno-9-4"></a><span class="c1"># Map multiple ports</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#015-networking-__codelineno-9-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>-p<span class="w"> </span><span class="m">8443</span>:443<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#015-networking-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#015-networking-__codelineno-9-7"></a><span class="c1"># Map to specific host interface</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#015-networking-__codelineno-9-8"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">192</span>.168.1.100:8080:80<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#015-networking-__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#015-networking-__codelineno-9-10"></a><span class="c1"># Dynamic port mapping</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#015-networking-__codelineno-9-11"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-P<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span></code></pre></div>
<h3 id="015-networking-service-discovery">Service Discovery<a class="headerlink" href="#015-networking-service-discovery" title="Permanent link">&para;</a></h3>
<p>Automatic service discovery in user-defined networks.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#015-networking-__codelineno-10-1"></a><span class="c1"># Create network</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#015-networking-__codelineno-10-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>--driver<span class="w"> </span>bridge<span class="w"> </span>app-net
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#015-networking-__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#015-networking-__codelineno-10-4"></a><span class="c1"># Run services</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#015-networking-__codelineno-10-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>app-net<span class="w"> </span>--name<span class="w"> </span>redis<span class="w"> </span>redis
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#015-networking-__codelineno-10-6"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>app-net<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>-e<span class="w"> </span><span class="nv">REDIS_HOST</span><span class="o">=</span>redis<span class="w"> </span>myapp
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#015-networking-__codelineno-10-7"></a>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#015-networking-__codelineno-10-8"></a><span class="c1"># Services resolve by container name</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#015-networking-__codelineno-10-9"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>nslookup<span class="w"> </span>redis
</span></code></pre></div>
<hr />
<h2 id="015-networking-advanced-networking">üöÄ Advanced Networking<a class="headerlink" href="#015-networking-advanced-networking" title="Permanent link">&para;</a></h2>
<h3 id="015-networking-network-plugins">Network Plugins<a class="headerlink" href="#015-networking-network-plugins" title="Permanent link">&para;</a></h3>
<p>Extend Docker networking with plugins.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#015-networking-__codelineno-11-1"></a><span class="c1"># Install network plugin (example: weave)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#015-networking-__codelineno-11-2"></a>docker<span class="w"> </span>plugin<span class="w"> </span>install<span class="w"> </span>weaveworks/net-plugin:latest_release
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#015-networking-__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#015-networking-__codelineno-11-4"></a><span class="c1"># Create network with plugin</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#015-networking-__codelineno-11-5"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>weave<span class="w"> </span>my-weave-net
</span></code></pre></div>
<h3 id="015-networking-dns-configuration">DNS Configuration<a class="headerlink" href="#015-networking-dns-configuration" title="Permanent link">&para;</a></h3>
<p>Configure DNS for containers.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#015-networking-__codelineno-12-1"></a><span class="c1"># Use custom DNS</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#015-networking-__codelineno-12-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--dns<span class="w"> </span><span class="m">8</span>.8.8.8<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#015-networking-__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#015-networking-__codelineno-12-4"></a><span class="c1"># Use custom DNS search domains</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#015-networking-__codelineno-12-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--dns-search<span class="w"> </span>example.com<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#015-networking-__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#015-networking-__codelineno-12-7"></a><span class="c1"># Inspect DNS configuration</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#015-networking-__codelineno-12-8"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>cat<span class="w"> </span>/etc/resolv.conf
</span></code></pre></div>
<h3 id="015-networking-network-security">Network Security<a class="headerlink" href="#015-networking-network-security" title="Permanent link">&para;</a></h3>
<p>Secure container communications.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#015-networking-__codelineno-13-1"></a><span class="c1"># Create encrypted overlay network</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#015-networking-__codelineno-13-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>overlay<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#015-networking-__codelineno-13-3"></a><span class="w">  </span>--opt<span class="w"> </span>encrypted<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#015-networking-__codelineno-13-4"></a><span class="w">  </span>my-secure-net
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#015-networking-__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#015-networking-__codelineno-13-6"></a><span class="c1"># Use network with iptables rules</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#015-networking-__codelineno-13-7"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>--driver<span class="w"> </span>bridge<span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#015-networking-__codelineno-13-8"></a><span class="w">  </span>--opt<span class="w"> </span><span class="s2">&quot;com.docker.network.bridge.enable_icc&quot;</span><span class="o">=</span><span class="s2">&quot;false&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#015-networking-__codelineno-13-9"></a><span class="w">  </span>isolated-net
</span></code></pre></div>
<hr />
<h2 id="015-networking-networking-commands">üîß Networking Commands<a class="headerlink" href="#015-networking-networking-commands" title="Permanent link">&para;</a></h2>
<h3 id="015-networking-network-management">Network Management<a class="headerlink" href="#015-networking-network-management" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#015-networking-__codelineno-14-1"></a><span class="c1"># List networks</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#015-networking-__codelineno-14-2"></a>docker<span class="w"> </span>network<span class="w"> </span>ls
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#015-networking-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#015-networking-__codelineno-14-4"></a><span class="c1"># Create network</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#015-networking-__codelineno-14-5"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>my-network
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#015-networking-__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#015-networking-__codelineno-14-7"></a><span class="c1"># Remove network</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#015-networking-__codelineno-14-8"></a>docker<span class="w"> </span>network<span class="w"> </span>rm<span class="w"> </span>my-network
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#015-networking-__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#015-networking-__codelineno-14-10"></a><span class="c1"># Prune unused networks</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#015-networking-__codelineno-14-11"></a>docker<span class="w"> </span>network<span class="w"> </span>prune
</span></code></pre></div>
<h3 id="015-networking-container-network-commands">Container Network Commands<a class="headerlink" href="#015-networking-container-network-commands" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#015-networking-__codelineno-15-1"></a><span class="c1"># Connect container to network</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#015-networking-__codelineno-15-2"></a>docker<span class="w"> </span>network<span class="w"> </span>connect<span class="w"> </span>my-network<span class="w"> </span>container_name
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#015-networking-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#015-networking-__codelineno-15-4"></a><span class="c1"># Disconnect container from network</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#015-networking-__codelineno-15-5"></a>docker<span class="w"> </span>network<span class="w"> </span>disconnect<span class="w"> </span>bridge<span class="w"> </span>container_name
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#015-networking-__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#015-networking-__codelineno-15-7"></a><span class="c1"># Inspect container networks</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#015-networking-__codelineno-15-8"></a>docker<span class="w"> </span>inspect<span class="w"> </span>container_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.NetworkSettings.Networks
</span></code></pre></div>
<h3 id="015-networking-troubleshooting-commands">Troubleshooting Commands<a class="headerlink" href="#015-networking-troubleshooting-commands" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#015-networking-__codelineno-16-1"></a><span class="c1"># Check network connectivity</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#015-networking-__codelineno-16-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ping<span class="w"> </span>google.com
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#015-networking-__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#015-networking-__codelineno-16-4"></a><span class="c1"># View network interfaces</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#015-networking-__codelineno-16-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ip<span class="w"> </span>addr
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#015-networking-__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#015-networking-__codelineno-16-7"></a><span class="c1"># Check routing table</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#015-networking-__codelineno-16-8"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ip<span class="w"> </span>route
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#015-networking-__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#015-networking-__codelineno-16-10"></a><span class="c1"># View iptables rules</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#015-networking-__codelineno-16-11"></a>sudo<span class="w"> </span>iptables<span class="w"> </span>-L<span class="w"> </span>-n
</span></code></pre></div>
<hr />
<h2 id="015-networking-monitoring-and-troubleshooting">üìä Monitoring and Troubleshooting<a class="headerlink" href="#015-networking-monitoring-and-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="015-networking-network-monitoring">Network Monitoring<a class="headerlink" href="#015-networking-network-monitoring" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#015-networking-__codelineno-17-1"></a><span class="c1"># View network usage</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#015-networking-__codelineno-17-2"></a>docker<span class="w"> </span>network<span class="w"> </span>ls<span class="w"> </span>-q<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.[].Containers | length&#39;</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#015-networking-__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#015-networking-__codelineno-17-4"></a><span class="c1"># Monitor network traffic (requires tools)</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#015-networking-__codelineno-17-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--net<span class="w"> </span>container:web<span class="w"> </span>nicolaka/netshoot<span class="w"> </span>tcpdump<span class="w"> </span>-i<span class="w"> </span>eth0
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#015-networking-__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#015-networking-__codelineno-17-7"></a><span class="c1"># Check container connectivity</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#015-networking-__codelineno-17-8"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>curl<span class="w"> </span>-I<span class="w"> </span>http://other-container
</span></code></pre></div>
<h3 id="015-networking-common-issues">Common Issues<a class="headerlink" href="#015-networking-common-issues" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Container can&rsquo;t reach internet</strong>: Check DNS and gateway configuration</li>
<li><strong>Containers can&rsquo;t communicate</strong>: Verify network connectivity and firewall rules</li>
<li><strong>Port conflicts</strong>: Check host port usage</li>
<li><strong>Network isolation</strong>: Ensure containers are on the same network</li>
</ul>
<h3 id="015-networking-debugging-steps">Debugging Steps<a class="headerlink" href="#015-networking-debugging-steps" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#015-networking-__codelineno-18-1"></a><span class="c1"># 1. Check container network settings</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#015-networking-__codelineno-18-2"></a>docker<span class="w"> </span>inspect<span class="w"> </span>container_name<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.NetworkSettings
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#015-networking-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#015-networking-__codelineno-18-4"></a><span class="c1"># 2. Verify network connectivity</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#015-networking-__codelineno-18-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container_name<span class="w"> </span>ping<span class="w"> </span><span class="m">8</span>.8.8.8
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#015-networking-__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#015-networking-__codelineno-18-7"></a><span class="c1"># 3. Check DNS resolution</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#015-networking-__codelineno-18-8"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>container_name<span class="w"> </span>nslookup<span class="w"> </span>google.com
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#015-networking-__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#015-networking-__codelineno-18-10"></a><span class="c1"># 4. Inspect network details</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#015-networking-__codelineno-18-11"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>network_name
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#015-networking-__codelineno-18-12"></a>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#015-networking-__codelineno-18-13"></a><span class="c1"># 5. View Docker daemon logs</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#015-networking-__codelineno-18-14"></a>sudo<span class="w"> </span>journalctl<span class="w"> </span>-u<span class="w"> </span>docker<span class="w"> </span>-f
</span></code></pre></div>
<hr />
<h2 id="015-networking-networking-best-practices">üîí Networking Best Practices<a class="headerlink" href="#015-networking-networking-best-practices" title="Permanent link">&para;</a></h2>
<ul>
<li>
<h3 id="015-networking-use-user-defined-networks">üåâ Use User-Defined Networks<a class="headerlink" href="#015-networking-use-user-defined-networks" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Prefer user-defined networks over default bridge for better isolation and service discovery.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#015-networking-__codelineno-19-1"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>app-network
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#015-networking-__codelineno-19-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--network<span class="w"> </span>app-network<span class="w"> </span>--name<span class="w"> </span>app<span class="w"> </span>myapp
</span></code></pre></div>
<ul>
<li>
<h3 id="015-networking-implement-network-segmentation">üîí Implement Network Segmentation<a class="headerlink" href="#015-networking-implement-network-segmentation" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Separate applications into different networks for security.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#015-networking-__codelineno-20-1"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>frontend
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#015-networking-__codelineno-20-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>backend
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#015-networking-__codelineno-20-3"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>database
</span></code></pre></div>
<ul>
<li>
<h3 id="015-networking-minimize-port-exposure">üö™ Minimize Port Exposure<a class="headerlink" href="#015-networking-minimize-port-exposure" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Only expose necessary ports and use specific IP bindings.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#015-networking-__codelineno-21-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">127</span>.0.0.1:8080:80<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span></code></pre></div>
<ul>
<li>
<h3 id="015-networking-use-encrypted-networks">üîê Use Encrypted Networks<a class="headerlink" href="#015-networking-use-encrypted-networks" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Enable encryption for sensitive communications.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#015-networking-__codelineno-22-1"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>overlay<span class="w"> </span>--opt<span class="w"> </span>encrypted<span class="w"> </span>secure-net
</span></code></pre></div>
<ul>
<li>
<h3 id="015-networking-monitor-network-traffic">üìä Monitor Network Traffic<a class="headerlink" href="#015-networking-monitor-network-traffic" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Regularly monitor and audit network communications.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#015-networking-__codelineno-23-1"></a>docker<span class="w"> </span>network<span class="w"> </span>ls
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#015-networking-__codelineno-23-2"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>&lt;network&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.Containers
</span></code></pre></div>
<ul>
<li>
<h3 id="015-networking-clean-up-unused-networks">üßπ Clean Up Unused Networks<a class="headerlink" href="#015-networking-clean-up-unused-networks" title="Permanent link">&para;</a></h3>
</li>
</ul>
<p>Remove unused networks to prevent clutter.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#015-networking-__codelineno-24-1"></a>docker<span class="w"> </span>network<span class="w"> </span>prune
</span></code></pre></div>
<hr />
<h2 id="015-networking-lab-exercises">üìã Lab Exercises<a class="headerlink" href="#015-networking-lab-exercises" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p><strong>Explore Default Networks</strong></p>
<ul>
<li>List all Docker networks</li>
<li>Inspect the bridge network configuration</li>
<li>Run containers on default networks</li>
</ul>
</li>
<li>
<p><strong>Create Custom Networks</strong></p>
<ul>
<li>Create a user-defined bridge network</li>
<li>Run containers on the custom network</li>
<li>Test service discovery between containers</li>
</ul>
</li>
<li>
<p><strong>Port Mapping and Exposure</strong></p>
<ul>
<li>Run a web server with port mapping</li>
<li>Access the application from host</li>
<li>Test different port mapping options</li>
</ul>
</li>
<li>
<p><strong>Network Isolation</strong></p>
<ul>
<li>Create multiple networks</li>
<li>Connect containers to specific networks</li>
<li>Verify isolation between networks</li>
</ul>
</li>
<li>
<p><strong>Advanced Networking</strong></p>
<ul>
<li>Set up overlay networking (if Swarm available)</li>
<li>Configure DNS settings</li>
<li>Implement network security measures</li>
</ul>
</li>
</ol>
<hr />
<h2 id="015-networking-additional-resources">üîó Additional Resources<a class="headerlink" href="#015-networking-additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.docker.com/network/">Docker Networking Overview</a></li>
<li><a href="https://docs.docker.com/network/drivers/">Network Drivers</a></li>
<li><a href="https://docs.docker.com/network/overlay/">Docker Swarm Networking</a></li>
<li><a href="https://docs.docker.com/network/security/">Network Security</a></li>
<li><a href="https://docs.docker.com/develop/dev-best-practices/networking/">Networking Best Practices</a></li>
</ul></section><section class="print-page" id="016-advanced-build" heading-number="1.17"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="016-advanced-build-lab-016-advanced-build">Lab 016 - Advanced Build<a class="headerlink" href="#016-advanced-build-lab-016-advanced-build" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab covers advanced Docker build techniques using BuildKit and BuildX.</li>
<li>You will learn how to leverage BuildKit for faster and more efficient builds, and use BuildX to build multi-platform images locally.</li>
<li>By the end of this lab, you will understand how to build Docker images for multiple architectures and platforms using the Docker CLI.</li>
</ul>
<hr />
<h2 id="016-advanced-build-prerequisites">Prerequisites<a class="headerlink" href="#016-advanced-build-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Docker Desktop or Docker Engine with BuildX support</li>
<li>Basic understanding of Dockerfiles and Docker CLI</li>
</ul>
<h2 id="016-advanced-build-buildkit">BuildKit<a class="headerlink" href="#016-advanced-build-buildkit" title="Permanent link">&para;</a></h2>
<p>BuildKit is an improved backend for building Docker images. It provides:</p>
<ul>
<li>Faster builds through parallel processing</li>
<li>Better caching mechanisms</li>
<li>Support for advanced Dockerfile features</li>
<li>Improved security with rootless builds</li>
</ul>
<h3 id="016-advanced-build-enabling-buildkit">Enabling BuildKit<a class="headerlink" href="#016-advanced-build-enabling-buildkit" title="Permanent link">&para;</a></h3>
<p>BuildKit is enabled by default in Docker Desktop. For Docker Engine, you can enable it by setting the environment variable:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#016-advanced-build-__codelineno-0-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span>
</span></code></pre></div>
<p>Or add it to your shell profile:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#016-advanced-build-__codelineno-1-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;export DOCKER_BUILDKIT=1&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.zshrc
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#016-advanced-build-__codelineno-1-2"></a><span class="nb">source</span><span class="w"> </span>~/.zshrc
</span></code></pre></div>
<h3 id="016-advanced-build-buildkit-features">BuildKit Features<a class="headerlink" href="#016-advanced-build-buildkit-features" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Parallel builds</strong>: Build stages can run in parallel</li>
<li><strong>Better caching</strong>: More granular cache invalidation</li>
<li><strong>Secrets management</strong>: Secure handling of sensitive data during builds</li>
<li><strong>Multi-stage builds</strong>: Improved support for multi-stage Dockerfiles</li>
</ul>
<p>Example Dockerfile using BuildKit features:</p>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#016-advanced-build-__codelineno-2-1"></a><span class="c"># syntax=docker/dockerfile:1</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#016-advanced-build-__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#016-advanced-build-__codelineno-2-3"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#016-advanced-build-__codelineno-2-4"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>git
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#016-advanced-build-__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#016-advanced-build-__codelineno-2-6"></a><span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#016-advanced-build-__codelineno-2-7"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#016-advanced-build-__codelineno-2-8"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#016-advanced-build-__codelineno-2-9"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building application...&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#016-advanced-build-__codelineno-2-10"></a>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#016-advanced-build-__codelineno-2-11"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#016-advanced-build-__codelineno-2-12"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>build<span class="w"> </span>/app<span class="w"> </span>/app
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#016-advanced-build-__codelineno-2-13"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Application built with BuildKit&quot;</span><span class="p">]</span>
</span></code></pre></div>
<h2 id="016-advanced-build-buildx">BuildX<a class="headerlink" href="#016-advanced-build-buildx" title="Permanent link">&para;</a></h2>
<p>BuildX is a Docker CLI plugin that extends the build capabilities with BuildKit. It provides:</p>
<ul>
<li>Multi-platform builds</li>
<li>Advanced build options</li>
<li>Custom build drivers</li>
<li>Bake support for complex builds</li>
</ul>
<h3 id="016-advanced-build-installing-buildx">Installing BuildX<a class="headerlink" href="#016-advanced-build-installing-buildx" title="Permanent link">&para;</a></h3>
<p>BuildX comes pre-installed with Docker Desktop. For Docker Engine:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#016-advanced-build-__codelineno-3-1"></a><span class="c1"># Download and install BuildX</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#016-advanced-build-__codelineno-3-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/.docker/cli-plugins
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#016-advanced-build-__codelineno-3-3"></a>curl<span class="w"> </span>-L<span class="w"> </span>https://github.com/docker/buildx/releases/latest/download/buildx-linux-amd64<span class="w"> </span>-o<span class="w"> </span>~/.docker/cli-plugins/docker-buildx
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#016-advanced-build-__codelineno-3-4"></a>chmod<span class="w"> </span>+x<span class="w"> </span>~/.docker/cli-plugins/docker-buildx
</span></code></pre></div>
<h3 id="016-advanced-build-building-multi-platform-images-locally">Building Multi-Platform Images Locally<a class="headerlink" href="#016-advanced-build-building-multi-platform-images-locally" title="Permanent link">&para;</a></h3>
<p>BuildX allows you to build images for multiple platforms simultaneously. To build for all platforms locally, you need to enable QEMU emulation:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#016-advanced-build-__codelineno-4-1"></a><span class="c1"># Enable QEMU emulation for cross-platform builds</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#016-advanced-build-__codelineno-4-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>tonistiigi/binfmt<span class="w"> </span>--install<span class="w"> </span>all
</span></code></pre></div>
<p>Or using the Docker image for this purpose:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#016-advanced-build-__codelineno-5-1"></a><span class="c1"># Use the docker/binfmt image to enable multi-platform support</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#016-advanced-build-__codelineno-5-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>docker/binfmt:a7996909642ee92942dcd6cff44b9b95f08dad64c
</span></code></pre></div>
<hr />
<h2 id="016-advanced-build-using-tonistiigibinfmt-for-qemu-emulation">Using tonistiigi/binfmt for QEMU Emulation<a class="headerlink" href="#016-advanced-build-using-tonistiigibinfmt-for-qemu-emulation" title="Permanent link">&para;</a></h2>
<p>The <a href="https://github.com/tonistiigi/binfmt">tonistiigi/binfmt</a> project provides a Docker image that installs QEMU and binfmt_misc support, enabling cross-platform architecture emulation. This is essential for building Docker images for different CPU architectures on your local machine.</p>
<p><strong>What it does:</strong></p>
<ul>
<li>Installs QEMU user-mode emulation for various architectures</li>
<li>Configures binfmt_misc to automatically use QEMU when running foreign binaries</li>
<li>Enables building and testing multi-platform Docker images locally</li>
</ul>
<p><strong>Installation and Setup:</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#016-advanced-build-__codelineno-6-1"></a><span class="c1"># Install QEMU and binfmt support for all architectures</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#016-advanced-build-__codelineno-6-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>tonistiigi/binfmt<span class="w"> </span>--install<span class="w"> </span>all
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#016-advanced-build-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#016-advanced-build-__codelineno-6-4"></a><span class="c1"># Install specific architectures only</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#016-advanced-build-__codelineno-6-5"></a>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>tonistiigi/binfmt<span class="w"> </span>--install<span class="w"> </span>amd64,arm64,arm
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#016-advanced-build-__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#016-advanced-build-__codelineno-6-7"></a><span class="c1"># Check installed formats</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#016-advanced-build-__codelineno-6-8"></a>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>tonistiigi/binfmt
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#016-advanced-build-__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#016-advanced-build-__codelineno-6-10"></a><span class="c1"># Uninstall (if needed)</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#016-advanced-build-__codelineno-6-11"></a>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>tonistiigi/binfmt<span class="w"> </span>--uninstall<span class="w"> </span>all
</span></code></pre></div>
<p><strong>Supported Architectures:</strong></p>
<ul>
<li><code>amd64</code> (x86-64)</li>
<li><code>arm64</code> (ARM 64-bit)</li>
<li><code>arm</code> (ARM 32-bit)</li>
<li><code>ppc64le</code> (PowerPC 64-bit little-endian)</li>
<li><code>s390x</code> (IBM System z)</li>
<li><code>riscv64</code> (RISC-V 64-bit)</li>
<li>And more&hellip;</li>
</ul>
<p><strong>Persistent Setup:</strong>
To make the setup persistent across Docker daemon restarts, you can create a systemd service or add it to your Docker startup script.</p>
<p><strong>Verification:</strong>
After installation, verify that binfmt is working:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#016-advanced-build-__codelineno-7-1"></a><span class="c1"># Check binfmt_misc entries</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#016-advanced-build-__codelineno-7-2"></a>cat<span class="w"> </span>/proc/sys/fs/binfmt_misc/qemu-aarch64
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#016-advanced-build-__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#016-advanced-build-__codelineno-7-4"></a><span class="c1"># Test with a simple command</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#016-advanced-build-__codelineno-7-5"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>arm64v8/alpine<span class="w"> </span>uname<span class="w"> </span>-m<span class="w">  </span><span class="c1"># Should show aarch64</span>
</span></code></pre></div>
<p><strong>Common Issues:</strong></p>
<ul>
<li><strong>Permission denied</strong>: Run with <code>--privileged</code> flag</li>
<li><strong>Already installed</strong>: The tool is idempotent, running it multiple times is safe</li>
<li><strong>Docker Desktop</strong>: May require restarting Docker Desktop after installation</li>
</ul>
<p>This tool is the foundation for local multi-platform Docker builds, allowing you to emulate different architectures without needing physical hardware.</p>
<h4 id="016-advanced-build-building-on-macos">Building on macOS<a class="headerlink" href="#016-advanced-build-building-on-macos" title="Permanent link">&para;</a></h4>
<p>On macOS, Docker Desktop provides built-in support for multi-platform builds, but for full cross-platform emulation (especially when building ARM images on Intel Macs or vice versa), you need to set up QEMU using the Docker binfmt image.</p>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>Docker Desktop for Mac (latest version)</li>
<li>At least 4GB of RAM allocated to Docker</li>
</ul>
<p><strong>Setup QEMU on macOS:</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#016-advanced-build-__codelineno-8-1"></a><span class="c1"># Enable binfmt support for multi-architecture emulation</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#016-advanced-build-__codelineno-8-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>docker/binfmt:a7996909642ee92942dcd6cff44b9b95f08dad64c
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#016-advanced-build-__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#016-advanced-build-__codelineno-8-4"></a><span class="c1"># Verify the setup</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#016-advanced-build-__codelineno-8-5"></a>docker<span class="w"> </span>buildx<span class="w"> </span>inspect<span class="w"> </span>--bootstrap
</span></code></pre></div>
<p><strong>Supported Platforms on macOS:</strong></p>
<ul>
<li><code>linux/amd64</code> (Intel/AMD)</li>
<li><code>linux/arm64</code> (Apple Silicon)</li>
<li><code>linux/arm/v7</code> (32-bit ARM)</li>
<li><code>linux/arm/v6</code> (Raspberry Pi)</li>
</ul>
<p><strong>Example: Building for all platforms on macOS:</strong></p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#016-advanced-build-__codelineno-9-1"></a><span class="c1"># Create a builder with docker-container driver for better isolation</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#016-advanced-build-__codelineno-9-2"></a>docker<span class="w"> </span>buildx<span class="w"> </span>create<span class="w"> </span>--use<span class="w"> </span>--name<span class="w"> </span>mac-multi-builder<span class="w"> </span>--driver<span class="w"> </span>docker-container
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#016-advanced-build-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#016-advanced-build-__codelineno-9-4"></a><span class="c1"># Build for all supported platforms</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#016-advanced-build-__codelineno-9-5"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#016-advanced-build-__codelineno-9-6"></a><span class="w">  </span>--platform<span class="w"> </span>linux/amd64,linux/arm64,linux/arm/v7,linux/arm/v6<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#016-advanced-build-__codelineno-9-7"></a><span class="w">  </span>-t<span class="w"> </span>myapp:all-platforms<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#016-advanced-build-__codelineno-9-8"></a><span class="w">  </span>--push<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#016-advanced-build-__codelineno-9-9"></a><span class="w">  </span>.
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#016-advanced-build-__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#016-advanced-build-__codelineno-9-11"></a><span class="c1"># For local testing (load only native platform)</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#016-advanced-build-__codelineno-9-12"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#016-advanced-build-__codelineno-9-13"></a><span class="w">  </span>--platform<span class="w"> </span>linux/amd64,linux/arm64<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#016-advanced-build-__codelineno-9-14"></a><span class="w">  </span>-t<span class="w"> </span>myapp:native<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#016-advanced-build-__codelineno-9-15"></a><span class="w">  </span>--load<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#016-advanced-build-__codelineno-9-16"></a><span class="w">  </span>.
</span></code></pre></div>
<p><strong>Troubleshooting macOS builds:</strong></p>
<ul>
<li>If builds fail with QEMU errors, restart Docker Desktop</li>
<li>Ensure Docker Desktop has enough RAM (8GB+ recommended for multi-platform builds)</li>
<li>Use <code>--progress=plain</code> for detailed build logs</li>
<li>Check available platforms: <code>docker buildx inspect --bootstrap | grep Platforms</code></li>
</ul>
<h3 id="016-advanced-build-basic-multi-platform-build">Basic Multi-Platform Build<a class="headerlink" href="#016-advanced-build-basic-multi-platform-build" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#016-advanced-build-__codelineno-10-1"></a><span class="c1"># Create a new builder instance</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#016-advanced-build-__codelineno-10-2"></a>docker<span class="w"> </span>buildx<span class="w"> </span>create<span class="w"> </span>--use<span class="w"> </span>--name<span class="w"> </span>multi-platform-builder
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#016-advanced-build-__codelineno-10-3"></a>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#016-advanced-build-__codelineno-10-4"></a><span class="c1"># Build for multiple platforms</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#016-advanced-build-__codelineno-10-5"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>linux/amd64,linux/arm64,linux/arm/v7<span class="w"> </span>-t<span class="w"> </span>myapp:multi<span class="w"> </span>.
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#016-advanced-build-__codelineno-10-6"></a>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#016-advanced-build-__codelineno-10-7"></a><span class="c1"># Build and push to registry</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#016-advanced-build-__codelineno-10-8"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>linux/amd64,linux/arm64,linux/arm/v7<span class="w"> </span>-t<span class="w"> </span>myregistry.com/myapp:multi<span class="w"> </span>--push<span class="w"> </span>.
</span></code></pre></div>
<h3 id="016-advanced-build-advanced-buildx-commands">Advanced BuildX Commands<a class="headerlink" href="#016-advanced-build-advanced-buildx-commands" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>List builders</strong>:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#016-advanced-build-__codelineno-11-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>ls
</span></code></pre></div>
<ul>
<li><strong>Inspect builder</strong>:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#016-advanced-build-__codelineno-12-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>inspect<span class="w"> </span>multi-platform-builder
</span></code></pre></div>
<ul>
<li><strong>Build with custom output</strong>:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#016-advanced-build-__codelineno-13-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>linux/amd64,linux/arm64<span class="w"> </span>-t<span class="w"> </span>myapp:multi<span class="w"> </span>--output<span class="w"> </span><span class="nv">type</span><span class="o">=</span>local,dest<span class="o">=</span>./dist<span class="w"> </span>.
</span></code></pre></div>
<ul>
<li><strong>Build with bake</strong> (using docker-bake.hcl file):</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#016-advanced-build-__codelineno-14-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>bake
</span></code></pre></div>
<h3 id="016-advanced-build-example-multi-platform-nodejs-application">Example: Multi-Platform Node.js Application<a class="headerlink" href="#016-advanced-build-example-multi-platform-nodejs-application" title="Permanent link">&para;</a></h3>
<p>Create a sample application:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#016-advanced-build-__codelineno-15-1"></a>mkdir<span class="w"> </span>multi-platform-example
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#016-advanced-build-__codelineno-15-2"></a><span class="nb">cd</span><span class="w"> </span>multi-platform-example
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#016-advanced-build-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#016-advanced-build-__codelineno-15-4"></a><span class="c1"># Create package.json</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#016-advanced-build-__codelineno-15-5"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF &gt; package.json</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#016-advanced-build-__codelineno-15-6"></a><span class="s">{</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#016-advanced-build-__codelineno-15-7"></a><span class="s">  &quot;name&quot;: &quot;multi-platform-app&quot;,</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#016-advanced-build-__codelineno-15-8"></a><span class="s">  &quot;version&quot;: &quot;1.0.0&quot;,</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#016-advanced-build-__codelineno-15-9"></a><span class="s">  &quot;main&quot;: &quot;index.js&quot;,</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#016-advanced-build-__codelineno-15-10"></a><span class="s">  &quot;scripts&quot;: {</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#016-advanced-build-__codelineno-15-11"></a><span class="s">    &quot;start&quot;: &quot;node index.js&quot;</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#016-advanced-build-__codelineno-15-12"></a><span class="s">  },</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#016-advanced-build-__codelineno-15-13"></a><span class="s">  &quot;dependencies&quot;: {</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#016-advanced-build-__codelineno-15-14"></a><span class="s">    &quot;express&quot;: &quot;^4.18.2&quot;</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#016-advanced-build-__codelineno-15-15"></a><span class="s">  }</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#016-advanced-build-__codelineno-15-16"></a><span class="s">}</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#016-advanced-build-__codelineno-15-17"></a><span class="s">EOF</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#016-advanced-build-__codelineno-15-18"></a>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#016-advanced-build-__codelineno-15-19"></a><span class="c1"># Create index.js</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#016-advanced-build-__codelineno-15-20"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF &gt; index.js</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#016-advanced-build-__codelineno-15-21"></a><span class="s">const express = require(&#39;express&#39;);</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#016-advanced-build-__codelineno-15-22"></a><span class="s">const app = express();</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#016-advanced-build-__codelineno-15-23"></a><span class="s">const port = process.env.PORT || 3000;</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#016-advanced-build-__codelineno-15-24"></a>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#016-advanced-build-__codelineno-15-25"></a><span class="s">app.get(&#39;/&#39;, (req, res) =&gt; {</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#016-advanced-build-__codelineno-15-26"></a><span class="s">  res.json({</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#016-advanced-build-__codelineno-15-27"></a><span class="s">    message: &#39;Hello from multi-platform Docker app!&#39;,</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#016-advanced-build-__codelineno-15-28"></a><span class="s">    platform: process.arch,</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#016-advanced-build-__codelineno-15-29"></a><span class="s">    timestamp: new Date().toISOString()</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#016-advanced-build-__codelineno-15-30"></a><span class="s">  });</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#016-advanced-build-__codelineno-15-31"></a><span class="s">});</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#016-advanced-build-__codelineno-15-32"></a>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#016-advanced-build-__codelineno-15-33"></a><span class="s">app.listen(port, () =&gt; {</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#016-advanced-build-__codelineno-15-34"></a><span class="s">  console.log(\`App listening on port \${port}\`);</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#016-advanced-build-__codelineno-15-35"></a><span class="s">});</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#016-advanced-build-__codelineno-15-36"></a><span class="s">EOF</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#016-advanced-build-__codelineno-15-37"></a>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#016-advanced-build-__codelineno-15-38"></a><span class="c1"># Create Dockerfile</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#016-advanced-build-__codelineno-15-39"></a>cat<span class="w"> </span><span class="s">&lt;&lt;EOF &gt; Dockerfile</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#016-advanced-build-__codelineno-15-40"></a><span class="s">FROM node:18-alpine</span>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#016-advanced-build-__codelineno-15-41"></a>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#016-advanced-build-__codelineno-15-42"></a><span class="s">WORKDIR /app</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#016-advanced-build-__codelineno-15-43"></a><span class="s">COPY package*.json ./</span>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44" href="#016-advanced-build-__codelineno-15-44"></a><span class="s">RUN npm ci --only=production</span>
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45" href="#016-advanced-build-__codelineno-15-45"></a>
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46" href="#016-advanced-build-__codelineno-15-46"></a><span class="s">COPY . .</span>
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47" href="#016-advanced-build-__codelineno-15-47"></a><span class="s">EXPOSE 3000</span>
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48" href="#016-advanced-build-__codelineno-15-48"></a><span class="s">CMD [&quot;npm&quot;, &quot;start&quot;]</span>
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49" href="#016-advanced-build-__codelineno-15-49"></a><span class="s">EOF</span>
</span></code></pre></div>
<p>Build for multiple platforms:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#016-advanced-build-__codelineno-16-1"></a><span class="c1"># Enable multi-platform support</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#016-advanced-build-__codelineno-16-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--privileged<span class="w"> </span>--rm<span class="w"> </span>docker/binfmt:a7996909642ee92942dcd6cff44b9b95f08dad64c
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#016-advanced-build-__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#016-advanced-build-__codelineno-16-4"></a><span class="c1"># Create and use builder</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#016-advanced-build-__codelineno-16-5"></a>docker<span class="w"> </span>buildx<span class="w"> </span>create<span class="w"> </span>--use<span class="w"> </span>--name<span class="w"> </span>multi-builder
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#016-advanced-build-__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#016-advanced-build-__codelineno-16-7"></a><span class="c1"># Build for multiple platforms</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#016-advanced-build-__codelineno-16-8"></a>docker<span class="w"> </span>buildx<span class="w"> </span>build<span class="w"> </span>--platform<span class="w"> </span>linux/amd64,linux/arm64,linux/arm/v7<span class="w"> </span>-t<span class="w"> </span>multi-platform-node:latest<span class="w"> </span>--load<span class="w"> </span>.
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#016-advanced-build-__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#016-advanced-build-__codelineno-16-10"></a><span class="c1"># Test the built image</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#016-advanced-build-__codelineno-16-11"></a>docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">3000</span>:3000<span class="w"> </span>multi-platform-node:latest
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#016-advanced-build-__codelineno-16-12"></a>curl<span class="w"> </span>localhost:3000
</span></code></pre></div>
<h3 id="016-advanced-build-buildx-bake-for-complex-builds">BuildX Bake for Complex Builds<a class="headerlink" href="#016-advanced-build-buildx-bake-for-complex-builds" title="Permanent link">&para;</a></h3>
<p>Create a <code>docker-bake.hcl</code> file for complex multi-target builds:</p>
<div class="language-hcl highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#016-advanced-build-__codelineno-17-1"></a><span class="err">group</span><span class="w"> </span><span class="s2">&quot;default&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#016-advanced-build-__codelineno-17-2"></a><span class="w">  </span><span class="na">targets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;app&quot;, &quot;debug&quot;</span><span class="p">]</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#016-advanced-build-__codelineno-17-3"></a><span class="p">}</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#016-advanced-build-__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#016-advanced-build-__codelineno-17-5"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;app&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#016-advanced-build-__codelineno-17-6"></a><span class="w">  </span><span class="na">context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;.&quot;</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#016-advanced-build-__codelineno-17-7"></a><span class="w">  </span><span class="na">dockerfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dockerfile&quot;</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#016-advanced-build-__codelineno-17-8"></a><span class="w">  </span><span class="na">platforms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;linux/amd64&quot;, &quot;linux/arm64&quot;</span><span class="p">]</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#016-advanced-build-__codelineno-17-9"></a><span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myapp:latest&quot;</span><span class="p">]</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#016-advanced-build-__codelineno-17-10"></a><span class="p">}</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#016-advanced-build-__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#016-advanced-build-__codelineno-17-12"></a><span class="err">target</span><span class="w"> </span><span class="s2">&quot;debug&quot;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#016-advanced-build-__codelineno-17-13"></a><span class="w">  </span><span class="na">inherits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;app&quot;</span><span class="p">]</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#016-advanced-build-__codelineno-17-14"></a><span class="w">  </span><span class="na">dockerfile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Dockerfile.debug&quot;</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#016-advanced-build-__codelineno-17-15"></a><span class="w">  </span><span class="na">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;myapp:debug&quot;</span><span class="p">]</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#016-advanced-build-__codelineno-17-16"></a><span class="p">}</span>
</span></code></pre></div>
<p>Build using bake:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#016-advanced-build-__codelineno-18-1"></a>docker<span class="w"> </span>buildx<span class="w"> </span>bake
</span></code></pre></div>
<h3 id="016-advanced-build-troubleshooting">Troubleshooting<a class="headerlink" href="#016-advanced-build-troubleshooting" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>QEMU issues</strong>: Ensure QEMU is properly installed for cross-platform emulation</li>
<li><strong>Builder not found</strong>: Use <code>docker buildx create --use</code> to create a new builder</li>
<li><strong>Platform not supported</strong>: Check available platforms with <code>docker buildx inspect --bootstrap</code></li>
<li><strong>Build failures</strong>: Use <code>--progress=plain</code> for detailed build output</li>
</ul>
<h3 id="016-advanced-build-cleanup">Cleanup<a class="headerlink" href="#016-advanced-build-cleanup" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#016-advanced-build-__codelineno-19-1"></a><span class="c1"># Remove builder</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#016-advanced-build-__codelineno-19-2"></a>docker<span class="w"> </span>buildx<span class="w"> </span>rm<span class="w"> </span>multi-platform-builder
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#016-advanced-build-__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#016-advanced-build-__codelineno-19-4"></a><span class="c1"># Clean up images</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#016-advanced-build-__codelineno-19-5"></a>docker<span class="w"> </span>image<span class="w"> </span>rm<span class="w"> </span>myapp:multi<span class="w"> </span>multi-platform-node:latest
</span></code></pre></div>
<hr />
<p>This lab demonstrates the power of BuildKit and BuildX for advanced Docker builds, enabling efficient and multi-platform container development.</p></section><section class="print-page" id="017-logging" heading-number="1.18"><h1 id="017-logging-lab-017-logging-with-fluentd">Lab 017 - Logging with Fluentd<a class="headerlink" href="#017-logging-lab-017-logging-with-fluentd" title="Permanent link">&para;</a></h1>
<p>This lab demonstrates how to use Fluentd with Docker to collect and manage logs from Docker containers, Docker events, and syslog.</p>
<h2 id="017-logging-prerequisites">Prerequisites<a class="headerlink" href="#017-logging-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Docker installed and running</li>
<li>Basic understanding of Docker and logging concepts</li>
</ul>
<h2 id="017-logging-overview">Overview<a class="headerlink" href="#017-logging-overview" title="Permanent link">&para;</a></h2>
<p>Fluentd is an open-source data collector that provides a unified logging layer. In this lab, we&rsquo;ll:</p>
<ol>
<li>Set up Fluentd as a logging driver for Docker containers</li>
<li>Collect Docker events using Fluentd</li>
<li>Configure syslog input for Fluentd</li>
</ol>
<h2 id="017-logging-demo-scripts">Demo Scripts<a class="headerlink" href="#017-logging-demo-scripts" title="Permanent link">&para;</a></h2>
<ul>
<li><code>demo.sh</code>: Main demo script showing Fluentd setup with Docker logging</li>
<li><code>fluentd.conf</code>: Fluentd configuration file</li>
<li><code>docker-compose.yml</code>: Docker Compose file to run Fluentd</li>
</ul>
<h2 id="017-logging-running-the-demo">Running the Demo<a class="headerlink" href="#017-logging-running-the-demo" title="Permanent link">&para;</a></h2>
<ol>
<li>Make sure Docker is running</li>
<li>Run the demo script: <code>./demo.sh</code></li>
<li>Follow the on-screen instructions</li>
</ol>
<h2 id="017-logging-key-concepts">Key Concepts<a class="headerlink" href="#017-logging-key-concepts" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Fluentd Logging Driver</strong>: Docker can send container logs directly to Fluentd</li>
<li><strong>Docker Events</strong>: System events from Docker daemon (container start/stop, etc.)</li>
<li><strong>Syslog Input</strong>: Fluentd can receive syslog messages from various sources</li>
</ul>
<h2 id="017-logging-cleanup">Cleanup<a class="headerlink" href="#017-logging-cleanup" title="Permanent link">&para;</a></h2>
<p>After the demo, run:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#017-logging-__codelineno-0-1"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div>
<h2 id="017-logging-additional-resources">Additional Resources<a class="headerlink" href="#017-logging-additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.fluentd.org/">Fluentd Documentation</a></li>
<li><a href="https://docs.docker.com/config/containers/logging/configure/">Docker Logging Drivers</a></li>
</ul></section><section class="print-page" id="100-hands-on" heading-number="1.19"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="100-hands-on-lab-100-basic-docker-hands-on">Lab 100 - Basic Docker Hands-On<a class="headerlink" href="#100-hands-on-lab-100-basic-docker-hands-on" title="Permanent link">&para;</a></h1>
<ul>
<li>In this lab we will create a simple NodeJs server and run it inside a docker container. </li>
<li>Next, we will create a second container which will print some text to the screen. </li>
<li>We will also create a docker hub account and push our images to the cloud.</li>
</ul>
<hr />
<!-- omit in toc -->
<h2 id="100-hands-on-table-of-contents">Table of Contents<a class="headerlink" href="#100-hands-on-table-of-contents" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#100-hands-on-1-verify-docker-installation">1. Verify Docker installation</a></li>
<li><a href="#100-hands-on-2-building-our-nodejs-server">2. Building our NodeJs server</a></li>
<li><a href="#100-hands-on-3-test-our-server-code">3. Test our server code</a></li>
<li><a href="#100-hands-on-31-test-if-the-server-is-running">3.1. Test if the server is running</a></li>
<li><a href="#100-hands-on-32-stop-the-server">3.2. Stop the server</a></li>
<li><a href="#100-hands-on-4-creating-docker-containers">4. Creating Docker containers</a></li>
<li><a href="#100-hands-on-41-create-dockerfile">4.1. Create <code>Dockerfile</code></a></li>
<li><a href="#100-hands-on-5-build-the-docker-image">5. Build the Docker image</a></li>
<li><a href="#100-hands-on-51-verifying-that-the-container-was-created">5.1. Verifying that the container was created</a></li>
<li><a href="#100-hands-on-52-testing-the-image">5.2. Testing the image</a></li>
<li><a href="#100-hands-on-53-test-if-the-server-is-running-and-listening">5.3 Test if the server is running and listening:</a></li>
<li><a href="#100-hands-on-6-container-with-arguments">6. Container with arguments</a></li>
</ul>
<hr />
<h4 id="100-hands-on-1-verify-docker-installation">1. Verify Docker installation<a class="headerlink" href="#100-hands-on-1-verify-docker-installation" title="Permanent link">&para;</a></h4>
<ul>
<li>Run the following command in the shell to verify that Docker is installed and running</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#100-hands-on-__codelineno-0-1"></a>docker<span class="w"> </span>run<span class="w"> </span>node
</span></code></pre></div>
<h4 id="100-hands-on-2-building-our-nodejs-server">2. Building our NodeJs server<a class="headerlink" href="#100-hands-on-2-building-our-nodejs-server" title="Permanent link">&para;</a></h4>
<ul>
<li>In this section we will create a simple NodeJs server and later on we will run it inside a docker container.</li>
<li>First, we will create a folder for our server code and then we will create the server code file.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#100-hands-on-__codelineno-1-1"></a><span class="c1"># Create the desired folder</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#100-hands-on-__codelineno-1-2"></a>mkdir<span class="w"> </span>hello-docker
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#100-hands-on-__codelineno-1-3"></a><span class="c1"># Switch to the created directory</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#100-hands-on-__codelineno-1-4"></a><span class="nb">cd</span><span class="w"> </span>hello-docker
</span></code></pre></div>
<ul>
<li>Create our server code file (copy the code into this file)
<a href="../100-Hands-On/server.js"><code>server.js</code></a></li>
</ul>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#100-hands-on-__codelineno-2-1"></a><span class="c1">// import the HTTP module</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#100-hands-on-__codelineno-2-2"></a><span class="kd">var</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#100-hands-on-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#100-hands-on-__codelineno-2-4"></a><span class="c1">// Define a port we want to listen to</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#100-hands-on-__codelineno-2-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="o">=</span><span class="mf">8080</span><span class="p">;</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#100-hands-on-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#100-hands-on-__codelineno-2-7"></a><span class="c1">// We need a function which handles requests and send response</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#100-hands-on-__codelineno-2-8"></a><span class="kd">function</span><span class="w"> </span><span class="nx">handleRequest</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">){</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#100-hands-on-__codelineno-2-9"></a><span class="w">  </span><span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;It Works!! Path Hit: &#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#100-hands-on-__codelineno-2-10"></a><span class="p">}</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#100-hands-on-__codelineno-2-11"></a>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#100-hands-on-__codelineno-2-12"></a><span class="c1">// Create a server</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#100-hands-on-__codelineno-2-13"></a><span class="kd">var</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="nx">handleRequest</span><span class="p">);</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#100-hands-on-__codelineno-2-14"></a>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#100-hands-on-__codelineno-2-15"></a><span class="c1">// Start our server</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#100-hands-on-__codelineno-2-16"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="p">(){</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#100-hands-on-__codelineno-2-17"></a><span class="w">  </span><span class="c1">//Callback triggered when server is successfully listening. Hurray!</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#100-hands-on-__codelineno-2-18"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Server listening on: http://localhost:%s&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">PORT</span><span class="p">);</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#100-hands-on-__codelineno-2-19"></a><span class="p">});</span>
</span></code></pre></div>
<h4 id="100-hands-on-3-test-our-server-code">3. Test our server code<a class="headerlink" href="#100-hands-on-3-test-our-server-code" title="Permanent link">&para;</a></h4>
<ul>
<li>You can run the server code using NodeJs by executing the following command.</li>
<li>This will run the server and listen to port 8080</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#100-hands-on-__codelineno-3-1"></a>node<span class="w"> </span>server.js
</span></code></pre></div>
<h3 id="100-hands-on-31-test-if-the-server-is-running">3.1. Test if the server is running<a class="headerlink" href="#100-hands-on-31-test-if-the-server-is-running" title="Permanent link">&para;</a></h3>
<ul>
<li>If you are using <strong>Cloud Shell</strong>, you can test it by clicking on the most left icon (web preview) and open port 8080 which is our server port</li>
<li>If you are running it locally, you can test it by opening your browser </li>
<li>Use the following URL in your browser <code>http://localhost:8080</code></li>
<li>You should see the following message in your browser or terminal
  <div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#100-hands-on-__codelineno-4-1"></a>It Works!! Path Hit: /
</span></code></pre></div></li>
</ul>
<h3 id="100-hands-on-32-stop-the-server">3.2. Stop the server<a class="headerlink" href="#100-hands-on-32-stop-the-server" title="Permanent link">&para;</a></h3>
<ul>
<li>Type <kbd>CTRL</kbd>+<kbd>C</kbd> <strong>twice</strong> to stop the server</li>
</ul>
<hr />
<h4 id="100-hands-on-4-creating-docker-containers">4. Creating Docker containers<a class="headerlink" href="#100-hands-on-4-creating-docker-containers" title="Permanent link">&para;</a></h4>
<h3 id="100-hands-on-41-create-dockerfile">4.1. Create <code>Dockerfile</code><a class="headerlink" href="#100-hands-on-41-create-dockerfile" title="Permanent link">&para;</a></h3>
<ul>
<li>In the same folder create the create a file called <code>Dockerfile</code> and add the following content:
  <div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#100-hands-on-__codelineno-5-1"></a><span class="c"># Base image for Node.js</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#100-hands-on-__codelineno-5-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:latest</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#100-hands-on-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#100-hands-on-__codelineno-5-4"></a><span class="c"># Set the working directory in the container</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#100-hands-on-__codelineno-5-5"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/usr/src/app</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#100-hands-on-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#100-hands-on-__codelineno-5-7"></a><span class="c"># Copy the server file into the container </span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#100-hands-on-__codelineno-5-8"></a><span class="c"># (Don`t forget the dot at the end)</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#100-hands-on-__codelineno-5-9"></a><span class="k">COPY</span><span class="w"> </span>server.js<span class="w"> </span>.
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#100-hands-on-__codelineno-5-10"></a>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#100-hands-on-__codelineno-5-11"></a><span class="c"># Expose port 8080</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#100-hands-on-__codelineno-5-12"></a><span class="c"># This is the port our server will listen to</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#100-hands-on-__codelineno-5-13"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#100-hands-on-__codelineno-5-14"></a>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#100-hands-on-__codelineno-5-15"></a><span class="c"># Start the Node.js server</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#100-hands-on-__codelineno-5-16"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;server.js&quot;</span><span class="w"> </span><span class="p">]</span>
</span></code></pre></div></li>
<li>This Dockerfile does the following:</li>
<li>Uses the latest Node.js image as the base image</li>
<li>Sets the working directory inside the container to <code>/usr/src/app</code></li>
<li>Copies the <code>server.js</code> file from the current directory into the container&rsquo;s working directory</li>
<li>Exposes port 8080 so that it can be accessed from outside the container</li>
<li>Specifies the command to run when the container starts, which is <code>node server.js</code></li>
</ul>
<blockquote>
<p>[!NOTE] 
Make sure that the <code>Dockerfile</code> is in the same directory as the <code>server.js</code> file.</p>
<p>[!IMPORTANT] 
The <code>COPY</code> command in the Dockerfile is used to copy files from the host machine into the container. The first argument is the source file (in this case, <code>server.js</code>), and the second argument is the destination path inside the container (<code>.</code> means the current working directory in the container).</p>
</blockquote>
<hr />
<h3 id="100-hands-on-5-build-the-docker-image">5. Build the Docker image<a class="headerlink" href="#100-hands-on-5-build-the-docker-image" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>In this step we will build the Docker image using the <code>Dockerfile</code> we created in the previous step.</p>
<blockquote>
<p>[!IMPORTANT] 
Make sure you are in the same directory where the <code>Dockerfile</code> and <code>server.js</code> files are located.</p>
</blockquote>
</li>
<li>
<p>Build the image using docker build with the following parameters
  <div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#100-hands-on-__codelineno-6-1"></a>--t = Tag name which will be attached to the container
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#100-hands-on-__codelineno-6-2"></a>.   = The Context to the Dockerfile (current folder in our case)
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#100-hands-on-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#100-hands-on-__codelineno-6-4"></a># Sample command to build the image
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#100-hands-on-__codelineno-6-5"></a>docker build -t hello-node:v1 .
</span></code></pre></div></p>
</li>
</ul>
<h3 id="100-hands-on-51-verifying-that-the-container-was-created">5.1. Verifying that the container was created<a class="headerlink" href="#100-hands-on-51-verifying-that-the-container-was-created" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s verify that the image was created successfully by listing all the images on our system</li>
<li>Run the following command to list all Docker images:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#100-hands-on-__codelineno-7-1"></a>docker<span class="w"> </span>images
</span></code></pre></div></li>
<li>You should see an output similar to this:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#100-hands-on-__codelineno-8-1"></a>REPOSITORY          TAG       IMAGE ID       CREATED          SIZE
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#100-hands-on-__codelineno-8-2"></a>hello-node          v1        123456789abc   10 seconds ago   200MB
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#100-hands-on-__codelineno-8-3"></a>node                latest    abcdef123456   2 days ago       150MB
</span></code></pre></div></li>
</ul>
<h3 id="100-hands-on-52-testing-the-image">5.2. Testing the image<a class="headerlink" href="#100-hands-on-52-testing-the-image" title="Permanent link">&para;</a></h3>
<ul>
<li>Now we can run the container using the image we just created</li>
<li>Execute <code>docker run</code> command with the following flags:</li>
</ul>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-d</code></td>
<td>Run container in background (daemon mode)</td>
</tr>
<tr>
<td><code>-p</code></td>
<td>Map internal port 8080 to external port 8080</td>
</tr>
<tr>
<td><code>hello-node:v1</code></td>
<td>The name of the image we just created</td>
</tr>
</tbody>
</table>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#100-hands-on-__codelineno-9-1"></a><span class="c1"># Run the container in the background</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#100-hands-on-__codelineno-9-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>hello-node:v1
</span></code></pre></div>
<h3 id="100-hands-on-53-test-if-the-server-is-running-and-listening">5.3 Test if the server is running and listening:<a class="headerlink" href="#100-hands-on-53-test-if-the-server-is-running-and-listening" title="Permanent link">&para;</a></h3>
<ul>
<li>If you are using <strong>Cloud Shell</strong>, you can test it by clicking on the most left icon (web preview) and open port <code>8080</code> which is our server port</li>
<li>If you are running it locally, you can test it by opening your browser </li>
<li>Use the following URL in your browser <code>http://localhost:8080</code></li>
<li>You should see the following message in your browser or terminal
  <div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#100-hands-on-__codelineno-10-1"></a>It Works!! Path Hit: /
</span></code></pre></div></li>
</ul>
<hr />
<h4 id="100-hands-on-6-container-with-arguments">6. Container with arguments<a class="headerlink" href="#100-hands-on-6-container-with-arguments" title="Permanent link">&para;</a></h4>
<ul>
<li>Let&rsquo;s test another container which will print content to screen</li>
</ul>
<blockquote>
<p>[!WARNING]<br />
You might get the following error:</p>
<p>docker: [DEPRECATION NOTICE] Docker Image Format v1 and Docker Image manifest version 2, schema 1 support is disabled by default and will be removed in an upcoming release.</p>
</blockquote>
<ul>
<li>Run the following command to run a container with arguments
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#100-hands-on-__codelineno-11-1"></a>docker<span class="w"> </span>run<span class="w"> </span>docker/whalesay<span class="w"> </span>cowsay<span class="w"> </span>boo
</span></code></pre></div></li>
<li>You should see the following output in your terminal
  <div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#100-hands-on-__codelineno-12-1"></a>________
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#100-hands-on-__codelineno-12-2"></a>&lt; boo &gt;
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#100-hands-on-__codelineno-12-3"></a>--------
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#100-hands-on-__codelineno-12-4"></a>        \  ^__^
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#100-hands-on-__codelineno-12-5"></a>        \  (oo)\_______
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#100-hands-on-__codelineno-12-6"></a>            (__)\       )\/\
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#100-hands-on-__codelineno-12-7"></a>                ||----w |
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#100-hands-on-__codelineno-12-8"></a>                ||     ||
</span></code></pre></div></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-2' heading-number='2'>
                        <h1>Tasks<a class='headerlink' href='#section-2' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="tasks" heading-number="2.1"><h1 id="tasks-dockerlabs-tasks">DockerLabs Tasks<a class="headerlink" href="#tasks-dockerlabs-tasks" title="Permanent link">&para;</a></h1>
<p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<ul>
<li>Welcome to the DockerLabs Tasks section.</li>
<li>Each folder below contains a hands-on task/exercise that you can complete independently to practice specific Docker skills.</li>
<li>Follow the README file in each task for detailed instructions and solutions.</li>
</ul>
<hr />
<h2 id="tasks-task-index">Task Index<a class="headerlink" href="#tasks-task-index" title="Permanent link">&para;</a></h2>
<h3 id="tasks-complete-docker-tasks">Complete Docker Tasks<a class="headerlink" href="#tasks-complete-docker-tasks" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Task</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#tasks-complete-docker-tasks">Complete Docker Tasks</a></td>
<td>Collection of 18 comprehensive Docker exercises covering CLI commands, container debugging, Dockerfile best practices, volumes, networking, multi-stage builds, Docker Compose, health checks, environment variables, security, and advanced debugging techniques.</td>
</tr>
</tbody>
</table>
<h3 id="tasks-dockerfile-tasks">Dockerfile Tasks<a class="headerlink" href="#tasks-dockerfile-tasks" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Task</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#tasks-dockerfile">Dockerfile Tasks</a></td>
<td>Collection of 2 Dockerfile exercises covering build arguments, parameterized ports, and multi-stage builds.</td>
</tr>
</tbody>
</table>
<h3 id="tasks-docker-network-tasks">Docker Network Tasks<a class="headerlink" href="#tasks-docker-network-tasks" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Task</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#tasks-dockernetwork">Docker Network Tasks</a></td>
<td>Comprehensive guide to creating and testing Docker networks, including custom networks and container connectivity.</td>
</tr>
</tbody>
</table>
<p>Happy learning and hacking with Docker!</p></section><section class="print-page" id="tasks-dockerbasics" heading-number="2.2"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="tasks-dockerbasics-lab-000-docker-basics">Lab 000 - Docker Basics<a class="headerlink" href="#tasks-dockerbasics-lab-000-docker-basics" title="Permanent link">&para;</a></h1>
<ul>
<li>This lab covers the fundamental concepts and commands of Docker.</li>
<li>You will learn basic Docker operations including running containers, managing images, and creating simple Dockerfiles.</li>
<li>Each task is designed to be simple and atomic, focusing on one specific Docker command or concept.</li>
<li>By the end of this lab, you will have hands-on experience with core Docker functionality.</li>
<li>The lab includes 50 tasks divided into Docker CLI commands, Dockerfile creation, and Docker Compose orchestration.</li>
</ul>
<hr />
<h2 id="tasks-dockerbasics-tasks-overview">Tasks Overview<a class="headerlink" href="#tasks-dockerbasics-tasks-overview" title="Permanent link">&para;</a></h2>
<h3 id="tasks-dockerbasics-docker-cli-tasks">Docker CLI Tasks<a class="headerlink" href="#tasks-dockerbasics-docker-cli-tasks" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#tasks-dockerbasics-task-01-run-hello-world-container">Task 01: Run hello-world container</a></li>
<li><a href="#tasks-dockerbasics-task-02-list-running-containers">Task 02: List running containers</a></li>
<li><a href="#tasks-dockerbasics-task-03-list-all-containers">Task 03: List all containers</a></li>
<li><a href="#tasks-dockerbasics-task-04-pull-an-image">Task 04: Pull an image</a></li>
<li><a href="#tasks-dockerbasics-task-05-list-images">Task 05: List images</a></li>
<li><a href="#tasks-dockerbasics-task-06-run-container-interactively">Task 06: Run container interactively</a></li>
<li><a href="#tasks-dockerbasics-task-07-run-container-in-background">Task 07: Run container in background</a></li>
<li><a href="#tasks-dockerbasics-task-08-list-running-containers-again">Task 08: List running containers again</a></li>
<li><a href="#tasks-dockerbasics-task-09-stop-a-container">Task 09: Stop a container</a></li>
<li><a href="#tasks-dockerbasics-task-10-remove-a-container">Task 10: Remove a container</a></li>
<li><a href="#tasks-dockerbasics-task-11-inspect-a-container">Task 11: Inspect a container</a></li>
<li><a href="#tasks-dockerbasics-task-12-view-container-logs">Task 12: View container logs</a></li>
<li><a href="#tasks-dockerbasics-task-13-execute-command-in-container">Task 13: Execute command in container</a></li>
<li><a href="#tasks-dockerbasics-task-14-copy-file-to-container">Task 14: Copy file to container</a></li>
<li><a href="#tasks-dockerbasics-task-15-copy-file-from-container">Task 15: Copy file from container</a></li>
<li><a href="#tasks-dockerbasics-task-16-run-container-with-port-mapping">Task 16: Run container with port mapping</a></li>
<li><a href="#tasks-dockerbasics-task-17-run-container-with-volume">Task 17: Run container with volume</a></li>
<li><a href="#tasks-dockerbasics-task-18-create-container-without-starting">Task 18: Create container without starting</a></li>
<li><a href="#tasks-dockerbasics-task-19-start-created-container">Task 19: Start created container</a></li>
<li><a href="#tasks-dockerbasics-task-20-kill-a-container">Task 20: Kill a container</a></li>
</ul>
<h3 id="tasks-dockerbasics-dockerfile-tasks">Dockerfile Tasks<a class="headerlink" href="#tasks-dockerbasics-dockerfile-tasks" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#tasks-dockerbasics-task-21-create-basic-dockerfile">Task 21: Create basic Dockerfile</a></li>
<li><a href="#tasks-dockerbasics-task-22-build-image-from-dockerfile">Task 22: Build image from Dockerfile</a></li>
<li><a href="#tasks-dockerbasics-task-23-run-built-image">Task 23: Run built image</a></li>
<li><a href="#tasks-dockerbasics-task-24-create-dockerfile-with-copy">Task 24: Create Dockerfile with COPY</a></li>
<li><a href="#tasks-dockerbasics-task-25-create-dockerfile-with-run">Task 25: Create Dockerfile with RUN</a></li>
<li><a href="#tasks-dockerbasics-task-26-docker-commit---create-image-from-container">Task 26: Docker commit - create image from container</a></li>
<li><a href="#tasks-dockerbasics-task-27-advanced-docker-cp---copy-directories">Task 27: Advanced docker cp - copy directories</a></li>
<li><a href="#tasks-dockerbasics-task-28-dockerfile-with-multiple-run-commands">Task 28: Dockerfile with multiple RUN commands</a></li>
<li><a href="#tasks-dockerbasics-task-29-dockerfile-with-workdir">Task 29: Dockerfile with WORKDIR</a></li>
<li><a href="#tasks-dockerbasics-task-30-dockerfile-with-env-variables">Task 30: Dockerfile with ENV variables</a></li>
<li><a href="#tasks-dockerbasics-task-31-dockerfile-with-expose">Task 31: Dockerfile with EXPOSE</a></li>
<li><a href="#tasks-dockerbasics-task-32-custom-entrypoint-in-dockerfile">Task 32: Custom ENTRYPOINT in Dockerfile</a></li>
<li><a href="#tasks-dockerbasics-task-33-dockerfile-with-user-non-root">Task 33: Dockerfile with USER (non-root)</a></li>
<li><a href="#tasks-dockerbasics-task-34-copy-multiple-files-with-copy">Task 34: Copy multiple files with COPY</a></li>
<li><a href="#tasks-dockerbasics-task-35-build-a-simple-web-server-image">Task 35: Build a simple web server image</a></li>
</ul>
<h3 id="tasks-dockerbasics-docker-compose-tasks">Docker Compose Tasks<a class="headerlink" href="#tasks-dockerbasics-docker-compose-tasks" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#tasks-dockerbasics-task-36-basic-docker-composeyml-structure">Task 36: Basic docker-compose.yml structure</a></li>
<li><a href="#tasks-dockerbasics-task-37-docker-compose-with-multiple-services">Task 37: Docker Compose with multiple services</a></li>
<li><a href="#tasks-dockerbasics-task-38-docker-compose-with-networks">Task 38: Docker Compose with networks</a></li>
<li><a href="#tasks-dockerbasics-task-39-docker-compose-with-volumes">Task 39: Docker Compose with volumes</a></li>
<li><a href="#tasks-dockerbasics-task-40-docker-compose-with-environment-variables">Task 40: Docker Compose with environment variables</a></li>
<li><a href="#tasks-dockerbasics-task-41-docker-compose-with-build-context">Task 41: Docker Compose with build context</a></li>
<li><a href="#tasks-dockerbasics-task-42-docker-compose-with-depends_on">Task 42: Docker Compose with depends_on</a></li>
<li><a href="#tasks-dockerbasics-task-43-docker-compose-with-health-checks">Task 43: Docker Compose with health checks</a></li>
<li><a href="#tasks-dockerbasics-task-44-docker-compose-scaling-services">Task 44: Docker Compose scaling services</a></li>
<li><a href="#tasks-dockerbasics-task-45-docker-compose-with-logging">Task 45: Docker Compose with logging</a></li>
<li><a href="#tasks-dockerbasics-task-46-docker-compose-with-environment-files">Task 46: Docker Compose with environment files</a></li>
<li><a href="#tasks-dockerbasics-task-47-docker-compose-overrides">Task 47: Docker Compose overrides</a></li>
<li><a href="#tasks-dockerbasics-task-48-docker-compose-with-profiles">Task 48: Docker Compose with profiles</a></li>
<li><a href="#tasks-dockerbasics-task-49-docker-compose-with-secrets">Task 49: Docker Compose with secrets</a></li>
<li><a href="#tasks-dockerbasics-task-50-docker-compose-with-extensions">Task 50: Docker Compose with extensions</a></li>
</ul>
<hr />
<h2 id="tasks-dockerbasics-docker-cli-tasks_1">Docker CLI Tasks<a class="headerlink" href="#tasks-dockerbasics-docker-cli-tasks_1" title="Permanent link">&para;</a></h2>
<h4 id="tasks-dockerbasics-task-01-run-hello-world-container">Task 01: Run hello-world container<a class="headerlink" href="#tasks-dockerbasics-task-01-run-hello-world-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Run the official hello-world container to verify Docker installation.</li>
<li>This container will print a message and exit.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#tasks-dockerbasics-__codelineno-0-1"></a>docker<span class="w"> </span>run<span class="w"> </span>hello-world
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-02-list-running-containers">Task 02: List running containers<a class="headerlink" href="#tasks-dockerbasics-task-02-list-running-containers" title="Permanent link">&para;</a></h4>
<ul>
<li>Display all currently running containers.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#tasks-dockerbasics-__codelineno-1-1"></a>docker<span class="w"> </span>ps
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-03-list-all-containers">Task 03: List all containers<a class="headerlink" href="#tasks-dockerbasics-task-03-list-all-containers" title="Permanent link">&para;</a></h4>
<ul>
<li>Display all containers, including stopped ones.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#tasks-dockerbasics-__codelineno-2-1"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-04-pull-an-image">Task 04: Pull an image<a class="headerlink" href="#tasks-dockerbasics-task-04-pull-an-image" title="Permanent link">&para;</a></h4>
<ul>
<li>Download the alpine image from Docker Hub without running it.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#tasks-dockerbasics-__codelineno-3-1"></a>docker<span class="w"> </span>pull<span class="w"> </span>alpine
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-05-list-images">Task 05: List images<a class="headerlink" href="#tasks-dockerbasics-task-05-list-images" title="Permanent link">&para;</a></h4>
<ul>
<li>Display all Docker images available locally.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#tasks-dockerbasics-__codelineno-4-1"></a>docker<span class="w"> </span>images
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-06-run-container-interactively">Task 06: Run container interactively<a class="headerlink" href="#tasks-dockerbasics-task-06-run-container-interactively" title="Permanent link">&para;</a></h4>
<ul>
<li>Run an alpine container and open an interactive shell.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#tasks-dockerbasics-__codelineno-5-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>alpine<span class="w"> </span>sh
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-07-run-container-in-background">Task 07: Run container in background<a class="headerlink" href="#tasks-dockerbasics-task-07-run-container-in-background" title="Permanent link">&para;</a></h4>
<ul>
<li>Run an nginx container in the background.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#tasks-dockerbasics-__codelineno-6-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>web<span class="w"> </span>nginx
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-08-list-running-containers-again">Task 08: List running containers again<a class="headerlink" href="#tasks-dockerbasics-task-08-list-running-containers-again" title="Permanent link">&para;</a></h4>
<ul>
<li>Verify the nginx container is running.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#tasks-dockerbasics-__codelineno-7-1"></a>docker<span class="w"> </span>ps
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-09-stop-a-container">Task 09: Stop a container<a class="headerlink" href="#tasks-dockerbasics-task-09-stop-a-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Stop the running nginx container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#tasks-dockerbasics-__codelineno-8-1"></a>docker<span class="w"> </span>stop<span class="w"> </span>web
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-10-remove-a-container">Task 10: Remove a container<a class="headerlink" href="#tasks-dockerbasics-task-10-remove-a-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Remove the stopped nginx container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#tasks-dockerbasics-__codelineno-9-1"></a>docker<span class="w"> </span>rm<span class="w"> </span>web
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-11-inspect-a-container">Task 11: Inspect a container<a class="headerlink" href="#tasks-dockerbasics-task-11-inspect-a-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Run a container and inspect its details.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#tasks-dockerbasics-__codelineno-10-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span><span class="nb">test</span><span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">100</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#tasks-dockerbasics-__codelineno-10-2"></a>docker<span class="w"> </span>inspect<span class="w"> </span><span class="nb">test</span>
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-12-view-container-logs">Task 12: View container logs<a class="headerlink" href="#tasks-dockerbasics-task-12-view-container-logs" title="Permanent link">&para;</a></h4>
<ul>
<li>View the logs of a running container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#tasks-dockerbasics-__codelineno-11-1"></a>docker<span class="w"> </span>logs<span class="w"> </span><span class="nb">test</span>
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-13-execute-command-in-container">Task 13: Execute command in container<a class="headerlink" href="#tasks-dockerbasics-task-13-execute-command-in-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Execute a command inside a running container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#tasks-dockerbasics-__codelineno-12-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span><span class="nb">test</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello from inside the container&quot;</span>
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-14-copy-file-to-container">Task 14: Copy file to container<a class="headerlink" href="#tasks-dockerbasics-task-14-copy-file-to-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Copy a file from the host to a running container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#tasks-dockerbasics-__codelineno-13-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test content&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>testfile.txt
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#tasks-dockerbasics-__codelineno-13-2"></a>docker<span class="w"> </span>cp<span class="w"> </span>testfile.txt<span class="w"> </span>test:/tmp/
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-15-copy-file-from-container">Task 15: Copy file from container<a class="headerlink" href="#tasks-dockerbasics-task-15-copy-file-from-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Copy a file from a container back to the host.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#tasks-dockerbasics-__codelineno-14-1"></a>docker<span class="w"> </span>cp<span class="w"> </span>test:/tmp/testfile.txt<span class="w"> </span>copiedfile.txt
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-16-run-container-with-port-mapping">Task 16: Run container with port mapping<a class="headerlink" href="#tasks-dockerbasics-task-16-run-container-with-port-mapping" title="Permanent link">&para;</a></h4>
<ul>
<li>Run nginx with port mapping to access it from the host.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#tasks-dockerbasics-__codelineno-15-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>--name<span class="w"> </span>web2<span class="w"> </span>nginx
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#tasks-dockerbasics-__codelineno-15-2"></a>curl<span class="w"> </span>localhost:8080
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-17-run-container-with-volume">Task 17: Run container with volume<a class="headerlink" href="#tasks-dockerbasics-task-17-run-container-with-volume" title="Permanent link">&para;</a></h4>
<ul>
<li>Run a container with a volume mount.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#tasks-dockerbasics-__codelineno-16-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-v<span class="w"> </span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/data<span class="w"> </span>--name<span class="w"> </span>vol-test<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">100</span>
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-18-create-container-without-starting">Task 18: Create container without starting<a class="headerlink" href="#tasks-dockerbasics-task-18-create-container-without-starting" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a container but don&rsquo;t start it.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#tasks-dockerbasics-__codelineno-17-1"></a>docker<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>created-test<span class="w"> </span>alpine<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;created&quot;</span>
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-19-start-created-container">Task 19: Start created container<a class="headerlink" href="#tasks-dockerbasics-task-19-start-created-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Start the previously created container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#tasks-dockerbasics-__codelineno-18-1"></a>docker<span class="w"> </span>start<span class="w"> </span>-a<span class="w"> </span>created-test
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-20-kill-a-container">Task 20: Kill a container<a class="headerlink" href="#tasks-dockerbasics-task-20-kill-a-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Forcefully kill a running container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#tasks-dockerbasics-__codelineno-19-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>kill-test<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">100</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#tasks-dockerbasics-__codelineno-19-2"></a>docker<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>kill-test
</span></code></pre></div>
</details>
<h2 id="tasks-dockerbasics-dockerfile-tasks_1">Dockerfile Tasks<a class="headerlink" href="#tasks-dockerbasics-dockerfile-tasks_1" title="Permanent link">&para;</a></h2>
<h4 id="tasks-dockerbasics-task-21-create-basic-dockerfile">Task 21: Create basic Dockerfile<a class="headerlink" href="#tasks-dockerbasics-task-21-create-basic-dockerfile" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a simple Dockerfile that uses alpine as base and runs a basic command.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#tasks-dockerbasics-__codelineno-20-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#tasks-dockerbasics-__codelineno-20-2"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Hello Docker&quot;</span><span class="p">]</span>
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-22-build-image-from-dockerfile">Task 22: Build image from Dockerfile<a class="headerlink" href="#tasks-dockerbasics-task-22-build-image-from-dockerfile" title="Permanent link">&para;</a></h4>
<ul>
<li>Build an image from the Dockerfile created in Task 21.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#tasks-dockerbasics-__codelineno-21-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>basic-image<span class="w"> </span>.
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-23-run-built-image">Task 23: Run built image<a class="headerlink" href="#tasks-dockerbasics-task-23-run-built-image" title="Permanent link">&para;</a></h4>
<ul>
<li>Run the image built in Task 22.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#tasks-dockerbasics-__codelineno-22-1"></a>docker<span class="w"> </span>run<span class="w"> </span>basic-image
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-24-create-dockerfile-with-copy">Task 24: Create Dockerfile with COPY<a class="headerlink" href="#tasks-dockerbasics-task-24-create-dockerfile-with-copy" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a Dockerfile that copies a file and runs it.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#tasks-dockerbasics-__codelineno-23-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#tasks-dockerbasics-__codelineno-23-2"></a><span class="k">COPY</span><span class="w"> </span>testfile.txt<span class="w"> </span>/tmp/
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#tasks-dockerbasics-__codelineno-23-3"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/tmp/testfile.txt&quot;</span><span class="p">]</span>
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-25-create-dockerfile-with-run">Task 25: Create Dockerfile with RUN<a class="headerlink" href="#tasks-dockerbasics-task-25-create-dockerfile-with-run" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a Dockerfile that installs a package and runs a command.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#tasks-dockerbasics-__codelineno-24-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#tasks-dockerbasics-__codelineno-24-2"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>curl
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#tasks-dockerbasics-__codelineno-24-3"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;curl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--version&quot;</span><span class="p">]</span>
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-26-docker-commit-create-image-from-container">Task 26: Docker commit - create image from container<a class="headerlink" href="#tasks-dockerbasics-task-26-docker-commit-create-image-from-container" title="Permanent link">&para;</a></h4>
<ul>
<li>Modify a running container and create a new image from it using docker commit.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#tasks-dockerbasics-__codelineno-25-1"></a><span class="c1"># Run a container and modify it</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#tasks-dockerbasics-__codelineno-25-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>modify-me<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">100</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#tasks-dockerbasics-__codelineno-25-3"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>modify-me<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;Modified content&#39; &gt; /modified.txt&quot;</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#tasks-dockerbasics-__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#tasks-dockerbasics-__codelineno-25-5"></a><span class="c1"># Commit the changes to a new image</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#tasks-dockerbasics-__codelineno-25-6"></a>docker<span class="w"> </span>commit<span class="w"> </span>modify-me<span class="w"> </span>my-modified-image
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#tasks-dockerbasics-__codelineno-25-7"></a>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#tasks-dockerbasics-__codelineno-25-8"></a><span class="c1"># Run a container from the new image to verify</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#tasks-dockerbasics-__codelineno-25-9"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>my-modified-image<span class="w"> </span>cat<span class="w"> </span>/modified.txt
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#tasks-dockerbasics-__codelineno-25-10"></a>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#tasks-dockerbasics-__codelineno-25-11"></a><span class="c1"># Clean up</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#tasks-dockerbasics-__codelineno-25-12"></a>docker<span class="w"> </span>stop<span class="w"> </span>modify-me
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#tasks-dockerbasics-__codelineno-25-13"></a>docker<span class="w"> </span>rm<span class="w"> </span>modify-me
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#tasks-dockerbasics-__codelineno-25-14"></a>docker<span class="w"> </span>rmi<span class="w"> </span>my-modified-image
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-27-advanced-docker-cp-copy-directories">Task 27: Advanced docker cp - copy directories<a class="headerlink" href="#tasks-dockerbasics-task-27-advanced-docker-cp-copy-directories" title="Permanent link">&para;</a></h4>
<ul>
<li>Copy entire directories between host and container using docker cp.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#tasks-dockerbasics-__codelineno-26-1"></a><span class="c1"># Create a directory with files</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#tasks-dockerbasics-__codelineno-26-2"></a>mkdir<span class="w"> </span>test-dir
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#tasks-dockerbasics-__codelineno-26-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;file1 content&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>test-dir/file1.txt
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#tasks-dockerbasics-__codelineno-26-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;file2 content&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>test-dir/file2.txt
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#tasks-dockerbasics-__codelineno-26-5"></a>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#tasks-dockerbasics-__codelineno-26-6"></a><span class="c1"># Run a container</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#tasks-dockerbasics-__codelineno-26-7"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>copy-test<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">100</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#tasks-dockerbasics-__codelineno-26-8"></a>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#tasks-dockerbasics-__codelineno-26-9"></a><span class="c1"># Copy directory to container</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#tasks-dockerbasics-__codelineno-26-10"></a>docker<span class="w"> </span>cp<span class="w"> </span>test-dir<span class="w"> </span>copy-test:/tmp/
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#tasks-dockerbasics-__codelineno-26-11"></a>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#tasks-dockerbasics-__codelineno-26-12"></a><span class="c1"># Copy directory from container to host</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#tasks-dockerbasics-__codelineno-26-13"></a>docker<span class="w"> </span>cp<span class="w"> </span>copy-test:/tmp/test-dir<span class="w"> </span>copied-dir
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#tasks-dockerbasics-__codelineno-26-14"></a>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#tasks-dockerbasics-__codelineno-26-15"></a><span class="c1"># Verify</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#tasks-dockerbasics-__codelineno-26-16"></a>ls<span class="w"> </span>-la<span class="w"> </span>copied-dir/
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#tasks-dockerbasics-__codelineno-26-17"></a>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#tasks-dockerbasics-__codelineno-26-18"></a><span class="c1"># Clean up</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#tasks-dockerbasics-__codelineno-26-19"></a>docker<span class="w"> </span>stop<span class="w"> </span>copy-test
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#tasks-dockerbasics-__codelineno-26-20"></a>docker<span class="w"> </span>rm<span class="w"> </span>copy-test
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#tasks-dockerbasics-__codelineno-26-21"></a>rm<span class="w"> </span>-rf<span class="w"> </span>test-dir<span class="w"> </span>copied-dir
</span></code></pre></div>
</details>
<h4 id="tasks-dockerbasics-task-28-dockerfile-with-multiple-run-commands">Task 28: Dockerfile with multiple RUN commands<a class="headerlink" href="#tasks-dockerbasics-task-28-dockerfile-with-multiple-run-commands" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a Dockerfile with multiple RUN instructions to install packages and configure the image.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#tasks-dockerbasics-__codelineno-27-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#tasks-dockerbasics-__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#tasks-dockerbasics-__codelineno-27-3"></a><span class="c"># Update package index</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#tasks-dockerbasics-__codelineno-27-4"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>update
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#tasks-dockerbasics-__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#tasks-dockerbasics-__codelineno-27-6"></a><span class="c"># Install multiple packages</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#tasks-dockerbasics-__codelineno-27-7"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#tasks-dockerbasics-__codelineno-27-8"></a><span class="w">    </span>curl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#tasks-dockerbasics-__codelineno-27-9"></a><span class="w">    </span>wget<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#tasks-dockerbasics-__codelineno-27-10"></a><span class="w">    </span>git
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#tasks-dockerbasics-__codelineno-27-11"></a>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#tasks-dockerbasics-__codelineno-27-12"></a><span class="c"># Create a directory</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#tasks-dockerbasics-__codelineno-27-13"></a><span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/app
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#tasks-dockerbasics-__codelineno-27-14"></a>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#tasks-dockerbasics-__codelineno-27-15"></a><span class="c"># Set permissions</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#tasks-dockerbasics-__codelineno-27-16"></a><span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/app
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#tasks-dockerbasics-__codelineno-27-17"></a>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#tasks-dockerbasics-__codelineno-27-18"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;echo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Multi-RUN Dockerfile completed&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#tasks-dockerbasics-__codelineno-28-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>multi-run-image<span class="w"> </span>.
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#tasks-dockerbasics-__codelineno-28-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>multi-run-image
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#tasks-dockerbasics-__codelineno-28-3"></a>docker<span class="w"> </span>rmi<span class="w"> </span>multi-run-image
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-29-dockerfile-with-workdir">Task 29: Dockerfile with WORKDIR<a class="headerlink" href="#tasks-dockerbasics-task-29-dockerfile-with-workdir" title="Permanent link">&para;</a></h4>
<ul>
<li>Use WORKDIR instruction to set the working directory for subsequent instructions.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#tasks-dockerbasics-__codelineno-29-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#tasks-dockerbasics-__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#tasks-dockerbasics-__codelineno-29-3"></a><span class="c"># Set working directory</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#tasks-dockerbasics-__codelineno-29-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#tasks-dockerbasics-__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#tasks-dockerbasics-__codelineno-29-6"></a><span class="c"># Create files in the working directory</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#tasks-dockerbasics-__codelineno-29-7"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello from /app&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>hello.txt
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#tasks-dockerbasics-__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#tasks-dockerbasics-__codelineno-29-9"></a><span class="c"># Copy files to working directory</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#tasks-dockerbasics-__codelineno-29-10"></a><span class="k">COPY</span><span class="w"> </span>testfile.txt<span class="w"> </span>.
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#tasks-dockerbasics-__codelineno-29-11"></a>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#tasks-dockerbasics-__codelineno-29-12"></a><span class="c"># Run commands in working directory</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#tasks-dockerbasics-__codelineno-29-13"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;hello.txt&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#tasks-dockerbasics-__codelineno-30-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;test content&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>testfile.txt
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#tasks-dockerbasics-__codelineno-30-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>workdir-image<span class="w"> </span>.
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#tasks-dockerbasics-__codelineno-30-3"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>workdir-image
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#tasks-dockerbasics-__codelineno-30-4"></a>docker<span class="w"> </span>rmi<span class="w"> </span>workdir-image
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#tasks-dockerbasics-__codelineno-30-5"></a>rm<span class="w"> </span>testfile.txt
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-30-dockerfile-with-env-variables">Task 30: Dockerfile with ENV variables<a class="headerlink" href="#tasks-dockerbasics-task-30-dockerfile-with-env-variables" title="Permanent link">&para;</a></h4>
<ul>
<li>Use ENV instruction to set environment variables in the Dockerfile.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#tasks-dockerbasics-__codelineno-31-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#tasks-dockerbasics-__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#tasks-dockerbasics-__codelineno-31-3"></a><span class="c"># Set environment variables</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#tasks-dockerbasics-__codelineno-31-4"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">&quot;My Docker App&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#tasks-dockerbasics-__codelineno-31-5"></a><span class="w">    </span><span class="nv">APP_VERSION</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#tasks-dockerbasics-__codelineno-31-6"></a><span class="w">    </span><span class="nv">AUTHOR</span><span class="o">=</span><span class="s2">&quot;Docker User&quot;</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#tasks-dockerbasics-__codelineno-31-7"></a>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#tasks-dockerbasics-__codelineno-31-8"></a><span class="c"># Use environment variables in RUN commands</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#tasks-dockerbasics-__codelineno-31-9"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Building </span><span class="nv">$APP_NAME</span><span class="s2"> version </span><span class="nv">$APP_VERSION</span><span class="s2"> by </span><span class="nv">$AUTHOR</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/app/info.txt
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#tasks-dockerbasics-__codelineno-31-10"></a>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#tasks-dockerbasics-__codelineno-31-11"></a><span class="c"># Use in CMD</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#tasks-dockerbasics-__codelineno-31-12"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;sh&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-c&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;echo &#39;App: &#39;$APP_NAME&#39;, Version: &#39;$APP_VERSION&#39;, Author: &#39;$AUTHOR &amp;&amp; cat /app/info.txt&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#tasks-dockerbasics-__codelineno-32-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>env-image<span class="w"> </span>.
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#tasks-dockerbasics-__codelineno-32-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>env-image
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#tasks-dockerbasics-__codelineno-32-3"></a>docker<span class="w"> </span>rmi<span class="w"> </span>env-image
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-31-dockerfile-with-expose">Task 31: Dockerfile with EXPOSE<a class="headerlink" href="#tasks-dockerbasics-task-31-dockerfile-with-expose" title="Permanent link">&para;</a></h4>
<ul>
<li>Use EXPOSE instruction to document which ports the container listens on.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#tasks-dockerbasics-__codelineno-33-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#tasks-dockerbasics-__codelineno-33-2"></a>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#tasks-dockerbasics-__codelineno-33-3"></a><span class="c"># Install a simple HTTP server</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#tasks-dockerbasics-__codelineno-33-4"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>python3
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#tasks-dockerbasics-__codelineno-33-5"></a>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#tasks-dockerbasics-__codelineno-33-6"></a><span class="c"># Create a simple HTML file</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#tasks-dockerbasics-__codelineno-33-7"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from Docker!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/index.html
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#tasks-dockerbasics-__codelineno-33-8"></a>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#tasks-dockerbasics-__codelineno-33-9"></a><span class="c"># Expose port 8080</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#tasks-dockerbasics-__codelineno-33-10"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#tasks-dockerbasics-__codelineno-33-11"></a>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#tasks-dockerbasics-__codelineno-33-12"></a><span class="c"># Start a simple HTTP server</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#tasks-dockerbasics-__codelineno-33-13"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python3&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-m&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;http.server&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;8080&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#tasks-dockerbasics-__codelineno-34-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>expose-image<span class="w"> </span>.
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#tasks-dockerbasics-__codelineno-34-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>--name<span class="w"> </span>expose-test<span class="w"> </span>expose-image
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#tasks-dockerbasics-__codelineno-34-3"></a>sleep<span class="w"> </span><span class="m">2</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#tasks-dockerbasics-__codelineno-34-4"></a>curl<span class="w"> </span>localhost:8080
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#tasks-dockerbasics-__codelineno-34-5"></a>docker<span class="w"> </span>stop<span class="w"> </span>expose-test
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#tasks-dockerbasics-__codelineno-34-6"></a>docker<span class="w"> </span>rm<span class="w"> </span>expose-test
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#tasks-dockerbasics-__codelineno-34-7"></a>docker<span class="w"> </span>rmi<span class="w"> </span>expose-image
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-32-custom-entrypoint-in-dockerfile">Task 32: Custom ENTRYPOINT in Dockerfile<a class="headerlink" href="#tasks-dockerbasics-task-32-custom-entrypoint-in-dockerfile" title="Permanent link">&para;</a></h4>
<ul>
<li>Use ENTRYPOINT instruction to set the default executable for the container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#tasks-dockerbasics-__codelineno-35-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#tasks-dockerbasics-__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#tasks-dockerbasics-__codelineno-35-3"></a><span class="c"># Install curl</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#tasks-dockerbasics-__codelineno-35-4"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>curl
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#tasks-dockerbasics-__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#tasks-dockerbasics-__codelineno-35-6"></a><span class="c"># Set entrypoint to curl</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#tasks-dockerbasics-__codelineno-35-7"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;curl&quot;</span><span class="p">]</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#tasks-dockerbasics-__codelineno-35-8"></a>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#tasks-dockerbasics-__codelineno-35-9"></a><span class="c"># Default arguments for curl</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#tasks-dockerbasics-__codelineno-35-10"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;--version&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#tasks-dockerbasics-__codelineno-36-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>entrypoint-image<span class="w"> </span>.
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#tasks-dockerbasics-__codelineno-36-2"></a>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#tasks-dockerbasics-__codelineno-36-3"></a><span class="c1"># Run with default CMD</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#tasks-dockerbasics-__codelineno-36-4"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>entrypoint-image
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#tasks-dockerbasics-__codelineno-36-5"></a>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#tasks-dockerbasics-__codelineno-36-6"></a><span class="c1"># Run with custom arguments</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#tasks-dockerbasics-__codelineno-36-7"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>entrypoint-image<span class="w"> </span>-I<span class="w"> </span>https://httpbin.org/get
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#tasks-dockerbasics-__codelineno-36-8"></a>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#tasks-dockerbasics-__codelineno-36-9"></a>docker<span class="w"> </span>rmi<span class="w"> </span>entrypoint-image
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-33-dockerfile-with-user-non-root">Task 33: Dockerfile with USER (non-root)<a class="headerlink" href="#tasks-dockerbasics-task-33-dockerfile-with-user-non-root" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a Dockerfile that runs as a non-root user for security.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#tasks-dockerbasics-__codelineno-37-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#tasks-dockerbasics-__codelineno-37-2"></a>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#tasks-dockerbasics-__codelineno-37-3"></a><span class="c"># Create a non-root user</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#tasks-dockerbasics-__codelineno-37-4"></a><span class="k">RUN</span><span class="w"> </span>addgroup<span class="w"> </span>-g<span class="w"> </span><span class="m">1001</span><span class="w"> </span>-S<span class="w"> </span>appgroup<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#tasks-dockerbasics-__codelineno-37-5"></a><span class="w">    </span>adduser<span class="w"> </span>-u<span class="w"> </span><span class="m">1001</span><span class="w"> </span>-S<span class="w"> </span>appuser<span class="w"> </span>-G<span class="w"> </span>appgroup
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#tasks-dockerbasics-__codelineno-37-6"></a>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#tasks-dockerbasics-__codelineno-37-7"></a><span class="c"># Create app directory and set ownership</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#tasks-dockerbasics-__codelineno-37-8"></a><span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>/app<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>chown<span class="w"> </span>appuser:appgroup<span class="w"> </span>/app
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#tasks-dockerbasics-__codelineno-37-9"></a>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#tasks-dockerbasics-__codelineno-37-10"></a><span class="c"># Switch to non-root user</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#tasks-dockerbasics-__codelineno-37-11"></a><span class="k">USER</span><span class="w"> </span><span class="s">appuser</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#tasks-dockerbasics-__codelineno-37-12"></a>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#tasks-dockerbasics-__codelineno-37-13"></a><span class="c"># Set working directory</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#tasks-dockerbasics-__codelineno-37-14"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#tasks-dockerbasics-__codelineno-37-15"></a>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#tasks-dockerbasics-__codelineno-37-16"></a><span class="c"># Create a file as non-root user</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#tasks-dockerbasics-__codelineno-37-17"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Running as </span><span class="k">$(</span>whoami<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>user-info.txt
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#tasks-dockerbasics-__codelineno-37-18"></a>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#tasks-dockerbasics-__codelineno-37-19"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;user-info.txt&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#tasks-dockerbasics-__codelineno-38-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>user-image<span class="w"> </span>.
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#tasks-dockerbasics-__codelineno-38-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>user-image
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#tasks-dockerbasics-__codelineno-38-3"></a>docker<span class="w"> </span>rmi<span class="w"> </span>user-image
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-34-copy-multiple-files-with-copy">Task 34: Copy multiple files with COPY<a class="headerlink" href="#tasks-dockerbasics-task-34-copy-multiple-files-with-copy" title="Permanent link">&para;</a></h4>
<ul>
<li>Use COPY instruction to copy multiple files and directories into the container.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#tasks-dockerbasics-__codelineno-39-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#tasks-dockerbasics-__codelineno-39-2"></a>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#tasks-dockerbasics-__codelineno-39-3"></a><span class="c"># Create source files</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#tasks-dockerbasics-__codelineno-39-4"></a><span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>/source
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#tasks-dockerbasics-__codelineno-39-5"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;config data&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/source/config.txt
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#tasks-dockerbasics-__codelineno-39-6"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;script content&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/source/script.sh
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#tasks-dockerbasics-__codelineno-39-7"></a>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#tasks-dockerbasics-__codelineno-39-8"></a><span class="c"># Copy multiple files</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#tasks-dockerbasics-__codelineno-39-9"></a><span class="k">COPY</span><span class="w"> </span>/source/*<span class="w"> </span>/app/
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#tasks-dockerbasics-__codelineno-39-10"></a>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#tasks-dockerbasics-__codelineno-39-11"></a><span class="c"># Copy entire directory</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#tasks-dockerbasics-__codelineno-39-12"></a><span class="k">COPY</span><span class="w"> </span>/source<span class="w"> </span>/app/source/
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#tasks-dockerbasics-__codelineno-39-13"></a>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#tasks-dockerbasics-__codelineno-39-14"></a><span class="c"># List copied files</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#tasks-dockerbasics-__codelineno-39-15"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ls&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-la&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/app/&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#tasks-dockerbasics-__codelineno-40-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>copy-multi-image<span class="w"> </span>.
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#tasks-dockerbasics-__codelineno-40-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>copy-multi-image
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#tasks-dockerbasics-__codelineno-40-3"></a>docker<span class="w"> </span>rmi<span class="w"> </span>copy-multi-image
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-35-build-a-simple-web-server-image">Task 35: Build a simple web server image<a class="headerlink" href="#tasks-dockerbasics-task-35-build-a-simple-web-server-image" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a complete Dockerfile for a simple web server that serves static files.</li>
</ul>
<details>
<summary>Solution</summary>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#tasks-dockerbasics-__codelineno-41-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#tasks-dockerbasics-__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#tasks-dockerbasics-__codelineno-41-3"></a><span class="c"># Install nginx</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#tasks-dockerbasics-__codelineno-41-4"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>nginx
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#tasks-dockerbasics-__codelineno-41-5"></a>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#tasks-dockerbasics-__codelineno-41-6"></a><span class="c"># Create web directory</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#tasks-dockerbasics-__codelineno-41-7"></a><span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/www/html
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#tasks-dockerbasics-__codelineno-41-8"></a>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#tasks-dockerbasics-__codelineno-41-9"></a><span class="c"># Create a simple HTML page</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#tasks-dockerbasics-__codelineno-41-10"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;&lt;html&gt;&lt;head&gt;&lt;title&gt;Docker Web Server&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to my Docker Web Server!&lt;/h1&gt;&lt;p&gt;This page is served from a custom Docker image.&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/var/www/html/index.html
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#tasks-dockerbasics-__codelineno-41-11"></a>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#tasks-dockerbasics-__codelineno-41-12"></a><span class="c"># Create nginx config</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#tasks-dockerbasics-__codelineno-41-13"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;server { listen 80; root /var/www/html; index index.html; location / { try_files $uri $uri/ =404; } }&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/etc/nginx/http.d/default.conf
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#tasks-dockerbasics-__codelineno-41-14"></a>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#tasks-dockerbasics-__codelineno-41-15"></a><span class="c"># Expose port</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#tasks-dockerbasics-__codelineno-41-16"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#tasks-dockerbasics-__codelineno-41-17"></a>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#tasks-dockerbasics-__codelineno-41-18"></a><span class="c"># Start nginx</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#tasks-dockerbasics-__codelineno-41-19"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;nginx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;daemon off;&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#tasks-dockerbasics-__codelineno-42-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>web-server-image<span class="w"> </span>.
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#tasks-dockerbasics-__codelineno-42-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>--name<span class="w"> </span>web-server<span class="w"> </span>web-server-image
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#tasks-dockerbasics-__codelineno-42-3"></a>sleep<span class="w"> </span><span class="m">3</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#tasks-dockerbasics-__codelineno-42-4"></a>curl<span class="w"> </span>localhost:8080
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#tasks-dockerbasics-__codelineno-42-5"></a>docker<span class="w"> </span>stop<span class="w"> </span>web-server
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#tasks-dockerbasics-__codelineno-42-6"></a>docker<span class="w"> </span>rm<span class="w"> </span>web-server
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#tasks-dockerbasics-__codelineno-42-7"></a>docker<span class="w"> </span>rmi<span class="w"> </span>web-server-image
</span></code></pre></div></p>
</details>
<h2 id="tasks-dockerbasics-docker-compose-tasks_1">Docker Compose Tasks<a class="headerlink" href="#tasks-dockerbasics-docker-compose-tasks_1" title="Permanent link">&para;</a></h2>
<h4 id="tasks-dockerbasics-task-36-basic-docker-composeyml-structure">Task 36: Basic docker-compose.yml structure<a class="headerlink" href="#tasks-dockerbasics-task-36-basic-docker-composeyml-structure" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a basic docker-compose.yml file with a single service.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#tasks-dockerbasics-__codelineno-43-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#tasks-dockerbasics-__codelineno-43-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#tasks-dockerbasics-__codelineno-43-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#tasks-dockerbasics-__codelineno-43-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#tasks-dockerbasics-__codelineno-43-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#tasks-dockerbasics-__codelineno-43-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#tasks-dockerbasics-__codelineno-44-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#tasks-dockerbasics-__codelineno-44-2"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#tasks-dockerbasics-__codelineno-44-3"></a>curl<span class="w"> </span>localhost:8080
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#tasks-dockerbasics-__codelineno-44-4"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-37-docker-compose-with-multiple-services">Task 37: Docker Compose with multiple services<a class="headerlink" href="#tasks-dockerbasics-task-37-docker-compose-with-multiple-services" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a docker-compose.yml with multiple services that communicate with each other.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#tasks-dockerbasics-__codelineno-45-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#tasks-dockerbasics-__codelineno-45-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#tasks-dockerbasics-__codelineno-45-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#tasks-dockerbasics-__codelineno-45-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#tasks-dockerbasics-__codelineno-45-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#tasks-dockerbasics-__codelineno-45-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#tasks-dockerbasics-__codelineno-45-7"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#tasks-dockerbasics-__codelineno-45-8"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#tasks-dockerbasics-__codelineno-45-9"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;while</span><span class="nv"> </span><span class="s">true;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">&#39;API</span><span class="nv"> </span><span class="s">running&#39;;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30;</span><span class="nv"> </span><span class="s">done&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#tasks-dockerbasics-__codelineno-46-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#tasks-dockerbasics-__codelineno-46-2"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#tasks-dockerbasics-__codelineno-46-3"></a>docker-compose<span class="w"> </span>logs
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#tasks-dockerbasics-__codelineno-46-4"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-38-docker-compose-with-networks">Task 38: Docker Compose with networks<a class="headerlink" href="#tasks-dockerbasics-task-38-docker-compose-with-networks" title="Permanent link">&para;</a></h4>
<ul>
<li>Configure custom networks in docker-compose.yml for service isolation.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#tasks-dockerbasics-__codelineno-47-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#tasks-dockerbasics-__codelineno-47-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#tasks-dockerbasics-__codelineno-47-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#tasks-dockerbasics-__codelineno-47-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#tasks-dockerbasics-__codelineno-47-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#tasks-dockerbasics-__codelineno-47-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#tasks-dockerbasics-__codelineno-47-7"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#tasks-dockerbasics-__codelineno-47-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#tasks-dockerbasics-__codelineno-47-9"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#tasks-dockerbasics-__codelineno-47-10"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#tasks-dockerbasics-__codelineno-47-11"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;while</span><span class="nv"> </span><span class="s">true;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">&#39;API</span><span class="nv"> </span><span class="s">running&#39;;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30;</span><span class="nv"> </span><span class="s">done&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#tasks-dockerbasics-__codelineno-47-12"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#tasks-dockerbasics-__codelineno-47-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#tasks-dockerbasics-__codelineno-47-14"></a><span class="w">  </span><span class="nt">proxy</span><span class="p">:</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#tasks-dockerbasics-__codelineno-47-15"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#tasks-dockerbasics-__codelineno-47-16"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#tasks-dockerbasics-__codelineno-47-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8081:80&quot;</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#tasks-dockerbasics-__codelineno-47-18"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#tasks-dockerbasics-__codelineno-47-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#tasks-dockerbasics-__codelineno-47-20"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#tasks-dockerbasics-__codelineno-47-21"></a>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#tasks-dockerbasics-__codelineno-47-22"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#tasks-dockerbasics-__codelineno-47-23"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#tasks-dockerbasics-__codelineno-47-24"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#tasks-dockerbasics-__codelineno-47-25"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#tasks-dockerbasics-__codelineno-47-26"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#tasks-dockerbasics-__codelineno-48-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#tasks-dockerbasics-__codelineno-48-2"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#tasks-dockerbasics-__codelineno-48-3"></a>docker<span class="w"> </span>network<span class="w"> </span>ls
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#tasks-dockerbasics-__codelineno-48-4"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-39-docker-compose-with-volumes">Task 39: Docker Compose with volumes<a class="headerlink" href="#tasks-dockerbasics-task-39-docker-compose-with-volumes" title="Permanent link">&para;</a></h4>
<ul>
<li>Use named volumes and bind mounts in docker-compose.yml.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#tasks-dockerbasics-__codelineno-49-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#tasks-dockerbasics-__codelineno-49-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#tasks-dockerbasics-__codelineno-49-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#tasks-dockerbasics-__codelineno-49-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#tasks-dockerbasics-__codelineno-49-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#tasks-dockerbasics-__codelineno-49-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#tasks-dockerbasics-__codelineno-49-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#tasks-dockerbasics-__codelineno-49-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./html:/usr/share/nginx/html:ro</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#tasks-dockerbasics-__codelineno-49-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-logs:/var/log/nginx</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#tasks-dockerbasics-__codelineno-49-10"></a><span class="w">  </span><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#tasks-dockerbasics-__codelineno-49-11"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#tasks-dockerbasics-__codelineno-49-12"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#tasks-dockerbasics-__codelineno-49-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-volume:/data</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#tasks-dockerbasics-__codelineno-49-14"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;Data</span><span class="nv"> </span><span class="s">stored&#39;</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">/data/file.txt</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">3600&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#tasks-dockerbasics-__codelineno-49-15"></a>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#tasks-dockerbasics-__codelineno-49-16"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#tasks-dockerbasics-__codelineno-49-17"></a><span class="w">  </span><span class="nt">nginx-logs</span><span class="p">:</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#tasks-dockerbasics-__codelineno-49-18"></a><span class="w">  </span><span class="nt">data-volume</span><span class="p">:</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#tasks-dockerbasics-__codelineno-50-1"></a>mkdir<span class="w"> </span>html
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#tasks-dockerbasics-__codelineno-50-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;h1&gt;Hello from Docker Compose!&lt;/h1&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>html/index.html
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#tasks-dockerbasics-__codelineno-50-3"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#tasks-dockerbasics-__codelineno-50-4"></a>curl<span class="w"> </span>localhost:8080
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#tasks-dockerbasics-__codelineno-50-5"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>data<span class="w"> </span>cat<span class="w"> </span>/data/file.txt
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#tasks-dockerbasics-__codelineno-50-6"></a>docker-compose<span class="w"> </span>down<span class="w"> </span>-v
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#tasks-dockerbasics-__codelineno-50-7"></a>rm<span class="w"> </span>-rf<span class="w"> </span>html
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-40-docker-compose-with-environment-variables">Task 40: Docker Compose with environment variables<a class="headerlink" href="#tasks-dockerbasics-task-40-docker-compose-with-environment-variables" title="Permanent link">&para;</a></h4>
<ul>
<li>Configure environment variables in docker-compose.yml.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#tasks-dockerbasics-__codelineno-51-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#tasks-dockerbasics-__codelineno-51-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#tasks-dockerbasics-__codelineno-51-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#tasks-dockerbasics-__codelineno-51-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#tasks-dockerbasics-__codelineno-51-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#tasks-dockerbasics-__codelineno-51-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#tasks-dockerbasics-__codelineno-51-7"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#tasks-dockerbasics-__codelineno-51-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NGINX_PORT=80</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#tasks-dockerbasics-__codelineno-51-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_ENV=production</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#tasks-dockerbasics-__codelineno-51-10"></a><span class="w">  </span><span class="nt">app</span><span class="p">:</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#tasks-dockerbasics-__codelineno-51-11"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#tasks-dockerbasics-__codelineno-51-12"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#tasks-dockerbasics-__codelineno-51-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=postgres://user:pass@db:5432/mydb</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#tasks-dockerbasics-__codelineno-51-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_URL=redis://cache:6379</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#tasks-dockerbasics-__codelineno-51-15"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;DB:</span><span class="nv"> </span><span class="s">&#39;$DATABASE_URL</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">&#39;Redis:</span><span class="nv"> </span><span class="s">&#39;$REDIS_URL</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#tasks-dockerbasics-__codelineno-52-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#tasks-dockerbasics-__codelineno-52-2"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>app<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(DATABASE|REDIS)&quot;</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#tasks-dockerbasics-__codelineno-52-3"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-41-docker-compose-with-build-context">Task 41: Docker Compose with build context<a class="headerlink" href="#tasks-dockerbasics-task-41-docker-compose-with-build-context" title="Permanent link">&para;</a></h4>
<ul>
<li>Build custom images using docker-compose.yml.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>Dockerfile</code>:
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#tasks-dockerbasics-__codelineno-53-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#tasks-dockerbasics-__codelineno-53-2"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Custom built image&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/message.txt
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#tasks-dockerbasics-__codelineno-53-3"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/message.txt&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#tasks-dockerbasics-__codelineno-54-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#tasks-dockerbasics-__codelineno-54-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#tasks-dockerbasics-__codelineno-54-3"></a><span class="w">  </span><span class="nt">custom-app</span><span class="p">:</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#tasks-dockerbasics-__codelineno-54-4"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#tasks-dockerbasics-__codelineno-54-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#tasks-dockerbasics-__codelineno-54-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#tasks-dockerbasics-__codelineno-55-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>--build<span class="w"> </span>-d
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#tasks-dockerbasics-__codelineno-55-2"></a>docker-compose<span class="w"> </span>logs
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#tasks-dockerbasics-__codelineno-55-3"></a>docker-compose<span class="w"> </span>down<span class="w"> </span>--rmi<span class="w"> </span><span class="nb">local</span>
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-42-docker-compose-with-depends_on">Task 42: Docker Compose with depends_on<a class="headerlink" href="#tasks-dockerbasics-task-42-docker-compose-with-depends_on" title="Permanent link">&para;</a></h4>
<ul>
<li>Use depends_on to control service startup order.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#tasks-dockerbasics-__codelineno-56-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#tasks-dockerbasics-__codelineno-56-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#tasks-dockerbasics-__codelineno-56-3"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#tasks-dockerbasics-__codelineno-56-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#tasks-dockerbasics-__codelineno-56-5"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#tasks-dockerbasics-__codelineno-56-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD=mypassword</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#tasks-dockerbasics-__codelineno-56-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_DB=testdb</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#tasks-dockerbasics-__codelineno-56-8"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#tasks-dockerbasics-__codelineno-56-9"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">postgres&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#tasks-dockerbasics-__codelineno-56-10"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#tasks-dockerbasics-__codelineno-56-11"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#tasks-dockerbasics-__codelineno-56-12"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#tasks-dockerbasics-__codelineno-56-13"></a><span class="w">  </span><span class="nt">app</span><span class="p">:</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#tasks-dockerbasics-__codelineno-56-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#tasks-dockerbasics-__codelineno-56-15"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#tasks-dockerbasics-__codelineno-56-16"></a><span class="w">      </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#tasks-dockerbasics-__codelineno-56-17"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#tasks-dockerbasics-__codelineno-56-18"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;App</span><span class="nv"> </span><span class="s">started</span><span class="nv"> </span><span class="s">after</span><span class="nv"> </span><span class="s">DB</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">healthy&#39;</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#tasks-dockerbasics-__codelineno-57-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#tasks-dockerbasics-__codelineno-57-2"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#tasks-dockerbasics-__codelineno-57-3"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>app
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#tasks-dockerbasics-__codelineno-57-4"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-43-docker-compose-with-health-checks">Task 43: Docker Compose with health checks<a class="headerlink" href="#tasks-dockerbasics-task-43-docker-compose-with-health-checks" title="Permanent link">&para;</a></h4>
<ul>
<li>Configure health checks for services in docker-compose.yml.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#tasks-dockerbasics-__codelineno-58-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#tasks-dockerbasics-__codelineno-58-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#tasks-dockerbasics-__codelineno-58-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#tasks-dockerbasics-__codelineno-58-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#tasks-dockerbasics-__codelineno-58-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#tasks-dockerbasics-__codelineno-58-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#tasks-dockerbasics-__codelineno-58-7"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#tasks-dockerbasics-__codelineno-58-8"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#tasks-dockerbasics-__codelineno-58-9"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#tasks-dockerbasics-__codelineno-58-10"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#tasks-dockerbasics-__codelineno-58-11"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#tasks-dockerbasics-__codelineno-58-12"></a><span class="w">      </span><span class="nt">start_period</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40s</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#tasks-dockerbasics-__codelineno-58-13"></a><span class="w">  </span><span class="nt">monitor</span><span class="p">:</span>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#tasks-dockerbasics-__codelineno-58-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#tasks-dockerbasics-__codelineno-58-15"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#tasks-dockerbasics-__codelineno-58-16"></a><span class="w">      </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#tasks-dockerbasics-__codelineno-58-17"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#tasks-dockerbasics-__codelineno-58-18"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;Web</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">is</span><span class="nv"> </span><span class="s">healthy!&#39;</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#tasks-dockerbasics-__codelineno-59-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#tasks-dockerbasics-__codelineno-59-2"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#tasks-dockerbasics-__codelineno-59-3"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost/
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#tasks-dockerbasics-__codelineno-59-4"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-44-docker-compose-scaling-services">Task 44: Docker Compose scaling services<a class="headerlink" href="#tasks-dockerbasics-task-44-docker-compose-scaling-services" title="Permanent link">&para;</a></h4>
<ul>
<li>Scale services up and down using docker-compose.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#tasks-dockerbasics-__codelineno-60-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#tasks-dockerbasics-__codelineno-60-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#tasks-dockerbasics-__codelineno-60-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#tasks-dockerbasics-__codelineno-60-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#tasks-dockerbasics-__codelineno-60-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#tasks-dockerbasics-__codelineno-60-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080-8085:80&quot;</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#tasks-dockerbasics-__codelineno-61-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">web</span><span class="o">=</span><span class="m">3</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#tasks-dockerbasics-__codelineno-61-2"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#tasks-dockerbasics-__codelineno-61-3"></a>curl<span class="w"> </span>localhost:8080
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#tasks-dockerbasics-__codelineno-61-4"></a>curl<span class="w"> </span>localhost:8081
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#tasks-dockerbasics-__codelineno-61-5"></a>curl<span class="w"> </span>localhost:8082
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#tasks-dockerbasics-__codelineno-61-6"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">web</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#tasks-dockerbasics-__codelineno-61-7"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-45-docker-compose-with-logging">Task 45: Docker Compose with logging<a class="headerlink" href="#tasks-dockerbasics-task-45-docker-compose-with-logging" title="Permanent link">&para;</a></h4>
<ul>
<li>Configure logging options in docker-compose.yml.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#tasks-dockerbasics-__codelineno-62-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#tasks-dockerbasics-__codelineno-62-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#tasks-dockerbasics-__codelineno-62-3"></a><span class="w">  </span><span class="nt">app</span><span class="p">:</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#tasks-dockerbasics-__codelineno-62-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#tasks-dockerbasics-__codelineno-62-5"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;for</span><span class="nv"> </span><span class="s">i</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">$(seq</span><span class="nv"> </span><span class="s">1</span><span class="nv"> </span><span class="s">10);</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">&#39;Log</span><span class="nv"> </span><span class="s">message</span><span class="nv"> </span><span class="s">&#39;$i;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">2;</span><span class="nv"> </span><span class="s">done&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#tasks-dockerbasics-__codelineno-62-6"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#tasks-dockerbasics-__codelineno-62-7"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#tasks-dockerbasics-__codelineno-62-8"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#tasks-dockerbasics-__codelineno-62-9"></a><span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#tasks-dockerbasics-__codelineno-62-10"></a><span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#tasks-dockerbasics-__codelineno-62-11"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#tasks-dockerbasics-__codelineno-62-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#tasks-dockerbasics-__codelineno-62-13"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#tasks-dockerbasics-__codelineno-62-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#tasks-dockerbasics-__codelineno-62-15"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16" href="#tasks-dockerbasics-__codelineno-62-16"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syslog</span>
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17" href="#tasks-dockerbasics-__codelineno-62-17"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18" href="#tasks-dockerbasics-__codelineno-62-18"></a><span class="w">        </span><span class="nt">syslog-address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tcp://localhost:514&quot;</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#tasks-dockerbasics-__codelineno-63-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#tasks-dockerbasics-__codelineno-63-2"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>app
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#tasks-dockerbasics-__codelineno-63-3"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>--tail<span class="o">=</span><span class="m">5</span><span class="w"> </span>web
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#tasks-dockerbasics-__codelineno-63-4"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-46-docker-compose-with-environment-files">Task 46: Docker Compose with environment files<a class="headerlink" href="#tasks-dockerbasics-task-46-docker-compose-with-environment-files" title="Permanent link">&para;</a></h4>
<ul>
<li>Use .env files to manage environment variables.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>.env</code> file:
<div class="language-text highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#tasks-dockerbasics-__codelineno-64-1"></a>APP_NAME=MyApp
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#tasks-dockerbasics-__codelineno-64-2"></a>APP_VERSION=1.0.0
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#tasks-dockerbasics-__codelineno-64-3"></a>DATABASE_URL=postgres://user:pass@localhost:5432/mydb
</span></code></pre></div></p>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#tasks-dockerbasics-__codelineno-65-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#tasks-dockerbasics-__codelineno-65-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#tasks-dockerbasics-__codelineno-65-3"></a><span class="w">  </span><span class="nt">app</span><span class="p">:</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#tasks-dockerbasics-__codelineno-65-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#tasks-dockerbasics-__codelineno-65-5"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#tasks-dockerbasics-__codelineno-65-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_NAME=${APP_NAME}</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#tasks-dockerbasics-__codelineno-65-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_VERSION=${APP_VERSION}</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#tasks-dockerbasics-__codelineno-65-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=${DATABASE_URL}</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#tasks-dockerbasics-__codelineno-65-9"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;App:</span><span class="nv"> </span><span class="s">&#39;$APP_NAME&#39;</span><span class="nv"> </span><span class="s">v&#39;$APP_VERSION</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">&#39;DB:</span><span class="nv"> </span><span class="s">&#39;$DATABASE_URL</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#tasks-dockerbasics-__codelineno-66-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#tasks-dockerbasics-__codelineno-66-2"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>app<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(APP|DATABASE)&quot;</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#tasks-dockerbasics-__codelineno-66-3"></a>docker-compose<span class="w"> </span>down
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#tasks-dockerbasics-__codelineno-66-4"></a>rm<span class="w"> </span>.env
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-47-docker-compose-overrides">Task 47: Docker Compose overrides<a class="headerlink" href="#tasks-dockerbasics-task-47-docker-compose-overrides" title="Permanent link">&para;</a></h4>
<ul>
<li>Use multiple compose files for different environments.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code> (base):
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#tasks-dockerbasics-__codelineno-67-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#tasks-dockerbasics-__codelineno-67-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#tasks-dockerbasics-__codelineno-67-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#tasks-dockerbasics-__codelineno-67-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#tasks-dockerbasics-__codelineno-67-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#tasks-dockerbasics-__codelineno-67-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span></code></pre></div></p>
<p>Create <code>docker-compose.override.yml</code> (development):
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#tasks-dockerbasics-__codelineno-68-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#tasks-dockerbasics-__codelineno-68-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#tasks-dockerbasics-__codelineno-68-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#tasks-dockerbasics-__codelineno-68-4"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#tasks-dockerbasics-__codelineno-68-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENV=development</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#tasks-dockerbasics-__codelineno-68-6"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#tasks-dockerbasics-__codelineno-68-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./dev-html:/usr/share/nginx/html</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#tasks-dockerbasics-__codelineno-68-8"></a><span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#tasks-dockerbasics-__codelineno-68-9"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#tasks-dockerbasics-__codelineno-68-10"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;while</span><span class="nv"> </span><span class="s">true;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">&#39;Debug</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">running&#39;;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30;</span><span class="nv"> </span><span class="s">done&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#tasks-dockerbasics-__codelineno-69-1"></a>mkdir<span class="w"> </span>dev-html
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#tasks-dockerbasics-__codelineno-69-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;h1&gt;Development Environment&lt;/h1&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>dev-html/index.html
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#tasks-dockerbasics-__codelineno-69-3"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#tasks-dockerbasics-__codelineno-69-4"></a>curl<span class="w"> </span>localhost:8080
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#tasks-dockerbasics-__codelineno-69-5"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#tasks-dockerbasics-__codelineno-69-6"></a>docker-compose<span class="w"> </span>down
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#tasks-dockerbasics-__codelineno-69-7"></a>rm<span class="w"> </span>-rf<span class="w"> </span>dev-html
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-48-docker-compose-with-profiles">Task 48: Docker Compose with profiles<a class="headerlink" href="#tasks-dockerbasics-task-48-docker-compose-with-profiles" title="Permanent link">&para;</a></h4>
<ul>
<li>Use profiles to enable/disable services.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#tasks-dockerbasics-__codelineno-70-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#tasks-dockerbasics-__codelineno-70-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#tasks-dockerbasics-__codelineno-70-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#tasks-dockerbasics-__codelineno-70-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#tasks-dockerbasics-__codelineno-70-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#tasks-dockerbasics-__codelineno-70-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#tasks-dockerbasics-__codelineno-70-7"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#tasks-dockerbasics-__codelineno-70-8"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#tasks-dockerbasics-__codelineno-70-9"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#tasks-dockerbasics-__codelineno-70-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD=mypassword</span>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#tasks-dockerbasics-__codelineno-70-11"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#tasks-dockerbasics-__codelineno-70-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#tasks-dockerbasics-__codelineno-70-13"></a><span class="w">  </span><span class="nt">cache</span><span class="p">:</span>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#tasks-dockerbasics-__codelineno-70-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:latest</span>
</span><span id="__span-70-15"><a id="__codelineno-70-15" name="__codelineno-70-15" href="#tasks-dockerbasics-__codelineno-70-15"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-70-16"><a id="__codelineno-70-16" name="__codelineno-70-16" href="#tasks-dockerbasics-__codelineno-70-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache</span>
</span><span id="__span-70-17"><a id="__codelineno-70-17" name="__codelineno-70-17" href="#tasks-dockerbasics-__codelineno-70-17"></a><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span id="__span-70-18"><a id="__codelineno-70-18" name="__codelineno-70-18" href="#tasks-dockerbasics-__codelineno-70-18"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-70-19"><a id="__codelineno-70-19" name="__codelineno-70-19" href="#tasks-dockerbasics-__codelineno-70-19"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;while</span><span class="nv"> </span><span class="s">true;</span><span class="nv"> </span><span class="s">do</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">&#39;Monitoring...&#39;;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30;</span><span class="nv"> </span><span class="s">done&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-70-20"><a id="__codelineno-70-20" name="__codelineno-70-20" href="#tasks-dockerbasics-__codelineno-70-20"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-70-21"><a id="__codelineno-70-21" name="__codelineno-70-21" href="#tasks-dockerbasics-__codelineno-70-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#tasks-dockerbasics-__codelineno-71-1"></a><span class="c1"># Start only web service</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#tasks-dockerbasics-__codelineno-71-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#tasks-dockerbasics-__codelineno-71-3"></a>curl<span class="w"> </span>localhost:8080
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#tasks-dockerbasics-__codelineno-71-4"></a>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#tasks-dockerbasics-__codelineno-71-5"></a><span class="c1"># Start with database</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#tasks-dockerbasics-__codelineno-71-6"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>database<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#tasks-dockerbasics-__codelineno-71-7"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#tasks-dockerbasics-__codelineno-71-8"></a>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#tasks-dockerbasics-__codelineno-71-9"></a><span class="c1"># Start with cache and monitoring</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#tasks-dockerbasics-__codelineno-71-10"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>cache<span class="w"> </span>--profile<span class="w"> </span>monitoring<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#tasks-dockerbasics-__codelineno-71-11"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#tasks-dockerbasics-__codelineno-71-12"></a>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#tasks-dockerbasics-__codelineno-71-13"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-49-docker-compose-with-secrets">Task 49: Docker Compose with secrets<a class="headerlink" href="#tasks-dockerbasics-task-49-docker-compose-with-secrets" title="Permanent link">&para;</a></h4>
<ul>
<li>Manage sensitive data using Docker secrets.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create secret files:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#tasks-dockerbasics-__codelineno-72-1"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;mysecretpassword&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>db_password.txt
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#tasks-dockerbasics-__codelineno-72-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;myappsecretkey&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>app_secret.txt
</span></code></pre></div></p>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#tasks-dockerbasics-__codelineno-73-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#tasks-dockerbasics-__codelineno-73-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#tasks-dockerbasics-__codelineno-73-3"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#tasks-dockerbasics-__codelineno-73-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#tasks-dockerbasics-__codelineno-73-5"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#tasks-dockerbasics-__codelineno-73-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD_FILE=/run/secrets/db_password</span>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#tasks-dockerbasics-__codelineno-73-7"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#tasks-dockerbasics-__codelineno-73-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_password</span>
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#tasks-dockerbasics-__codelineno-73-9"></a><span class="w">  </span><span class="nt">app</span><span class="p">:</span>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#tasks-dockerbasics-__codelineno-73-10"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#tasks-dockerbasics-__codelineno-73-11"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-73-12"><a id="__codelineno-73-12" name="__codelineno-73-12" href="#tasks-dockerbasics-__codelineno-73-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app_secret</span>
</span><span id="__span-73-13"><a id="__codelineno-73-13" name="__codelineno-73-13" href="#tasks-dockerbasics-__codelineno-73-13"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;cat</span><span class="nv"> </span><span class="s">/run/secrets/app_secret</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">30&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-73-14"><a id="__codelineno-73-14" name="__codelineno-73-14" href="#tasks-dockerbasics-__codelineno-73-14"></a>
</span><span id="__span-73-15"><a id="__codelineno-73-15" name="__codelineno-73-15" href="#tasks-dockerbasics-__codelineno-73-15"></a><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-73-16"><a id="__codelineno-73-16" name="__codelineno-73-16" href="#tasks-dockerbasics-__codelineno-73-16"></a><span class="w">  </span><span class="nt">db_password</span><span class="p">:</span>
</span><span id="__span-73-17"><a id="__codelineno-73-17" name="__codelineno-73-17" href="#tasks-dockerbasics-__codelineno-73-17"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./db_password.txt</span>
</span><span id="__span-73-18"><a id="__codelineno-73-18" name="__codelineno-73-18" href="#tasks-dockerbasics-__codelineno-73-18"></a><span class="w">  </span><span class="nt">app_secret</span><span class="p">:</span>
</span><span id="__span-73-19"><a id="__codelineno-73-19" name="__codelineno-73-19" href="#tasks-dockerbasics-__codelineno-73-19"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./app_secret.txt</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#tasks-dockerbasics-__codelineno-74-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#tasks-dockerbasics-__codelineno-74-2"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>app<span class="w"> </span>cat<span class="w"> </span>/run/secrets/app_secret
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#tasks-dockerbasics-__codelineno-74-3"></a>docker-compose<span class="w"> </span>down
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#tasks-dockerbasics-__codelineno-74-4"></a>rm<span class="w"> </span>db_password.txt<span class="w"> </span>app_secret.txt
</span></code></pre></div></p>
</details>
<h4 id="tasks-dockerbasics-task-50-docker-compose-with-extensions">Task 50: Docker Compose with extensions<a class="headerlink" href="#tasks-dockerbasics-task-50-docker-compose-with-extensions" title="Permanent link">&para;</a></h4>
<ul>
<li>Use extensions (x-) for reusable configurations.</li>
</ul>
<details>
<summary>Solution</summary>
<p>Create <code>docker-compose.yml</code>:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#tasks-dockerbasics-__codelineno-75-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#tasks-dockerbasics-__codelineno-75-2"></a>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#tasks-dockerbasics-__codelineno-75-3"></a><span class="nt">x-app-defaults</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;app-defaults</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#tasks-dockerbasics-__codelineno-75-4"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#tasks-dockerbasics-__codelineno-75-5"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#tasks-dockerbasics-__codelineno-75-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOG_LEVEL=info</span>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#tasks-dockerbasics-__codelineno-75-7"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#tasks-dockerbasics-__codelineno-75-8"></a>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#tasks-dockerbasics-__codelineno-75-9"></a><span class="nt">x-db-defaults</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;db-defaults</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#tasks-dockerbasics-__codelineno-75-10"></a><span class="w">  </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#tasks-dockerbasics-__codelineno-75-11"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#tasks-dockerbasics-__codelineno-75-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_USER=app</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#tasks-dockerbasics-__codelineno-75-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_DB=myapp</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#tasks-dockerbasics-__codelineno-75-14"></a>
</span><span id="__span-75-15"><a id="__codelineno-75-15" name="__codelineno-75-15" href="#tasks-dockerbasics-__codelineno-75-15"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-75-16"><a id="__codelineno-75-16" name="__codelineno-75-16" href="#tasks-dockerbasics-__codelineno-75-16"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-75-17"><a id="__codelineno-75-17" name="__codelineno-75-17" href="#tasks-dockerbasics-__codelineno-75-17"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*app-defaults</span>
</span><span id="__span-75-18"><a id="__codelineno-75-18" name="__codelineno-75-18" href="#tasks-dockerbasics-__codelineno-75-18"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-75-19"><a id="__codelineno-75-19" name="__codelineno-75-19" href="#tasks-dockerbasics-__codelineno-75-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-75-20"><a id="__codelineno-75-20" name="__codelineno-75-20" href="#tasks-dockerbasics-__codelineno-75-20"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;Web</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">defaults&#39;</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">3600&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-75-21"><a id="__codelineno-75-21" name="__codelineno-75-21" href="#tasks-dockerbasics-__codelineno-75-21"></a>
</span><span id="__span-75-22"><a id="__codelineno-75-22" name="__codelineno-75-22" href="#tasks-dockerbasics-__codelineno-75-22"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-75-23"><a id="__codelineno-75-23" name="__codelineno-75-23" href="#tasks-dockerbasics-__codelineno-75-23"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*app-defaults</span>
</span><span id="__span-75-24"><a id="__codelineno-75-24" name="__codelineno-75-24" href="#tasks-dockerbasics-__codelineno-75-24"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-75-25"><a id="__codelineno-75-25" name="__codelineno-75-25" href="#tasks-dockerbasics-__codelineno-75-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8081:8081&quot;</span>
</span><span id="__span-75-26"><a id="__codelineno-75-26" name="__codelineno-75-26" href="#tasks-dockerbasics-__codelineno-75-26"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-75-27"><a id="__codelineno-75-27" name="__codelineno-75-27" href="#tasks-dockerbasics-__codelineno-75-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LOG_LEVEL=debug</span>
</span><span id="__span-75-28"><a id="__codelineno-75-28" name="__codelineno-75-28" href="#tasks-dockerbasics-__codelineno-75-28"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;sh&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-c&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo</span><span class="nv"> </span><span class="s">&#39;API</span><span class="nv"> </span><span class="s">service</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">custom</span><span class="nv"> </span><span class="s">log</span><span class="nv"> </span><span class="s">level&#39;</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">sleep</span><span class="nv"> </span><span class="s">3600&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-75-29"><a id="__codelineno-75-29" name="__codelineno-75-29" href="#tasks-dockerbasics-__codelineno-75-29"></a>
</span><span id="__span-75-30"><a id="__codelineno-75-30" name="__codelineno-75-30" href="#tasks-dockerbasics-__codelineno-75-30"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-75-31"><a id="__codelineno-75-31" name="__codelineno-75-31" href="#tasks-dockerbasics-__codelineno-75-31"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*db-defaults</span>
</span><span id="__span-75-32"><a id="__codelineno-75-32" name="__codelineno-75-32" href="#tasks-dockerbasics-__codelineno-75-32"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
</span><span id="__span-75-33"><a id="__codelineno-75-33" name="__codelineno-75-33" href="#tasks-dockerbasics-__codelineno-75-33"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-75-34"><a id="__codelineno-75-34" name="__codelineno-75-34" href="#tasks-dockerbasics-__codelineno-75-34"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span>
</span><span id="__span-75-35"><a id="__codelineno-75-35" name="__codelineno-75-35" href="#tasks-dockerbasics-__codelineno-75-35"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-75-36"><a id="__codelineno-75-36" name="__codelineno-75-36" href="#tasks-dockerbasics-__codelineno-75-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POSTGRES_PASSWORD=mypassword</span>
</span></code></pre></div></p>
<p>Run and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#tasks-dockerbasics-__codelineno-76-1"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#tasks-dockerbasics-__codelineno-76-2"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#tasks-dockerbasics-__codelineno-76-3"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>LOG_LEVEL
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#tasks-dockerbasics-__codelineno-76-4"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>LOG_LEVEL
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#tasks-dockerbasics-__codelineno-76-5"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
</details>
<ul>
<li>After completing all tasks, clean up containers and images.</li>
</ul>
<details>
<summary>Clean Up Commands</summary>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#tasks-dockerbasics-__codelineno-77-1"></a><span class="c1"># Remove all containers</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#tasks-dockerbasics-__codelineno-77-2"></a>docker<span class="w"> </span>rm<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-aq<span class="k">)</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#tasks-dockerbasics-__codelineno-77-3"></a>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#tasks-dockerbasics-__codelineno-77-4"></a><span class="c1"># Remove unused images</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#tasks-dockerbasics-__codelineno-77-5"></a>docker<span class="w"> </span>image<span class="w"> </span>prune<span class="w"> </span>-f
</span></code></pre></div>
</details>
<hr />
<p><img alt="Well Done" src="../assets/images/well-done.png" /></p></section><section class="print-page" id="tasks-docker-cli-tasks" heading-number="2.3"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="tasks-docker-cli-tasks-docker-cli-tasks">Docker CLI Tasks<a class="headerlink" href="#tasks-docker-cli-tasks-docker-cli-tasks" title="Permanent link">&para;</a></h1>
<ul>
<li>Hands-on Docker exercises covering essential CLI commands, debugging techniques, and advanced containerization concepts.</li>
<li>Each task includes a description and a detailed solution with step-by-step instructions.</li>
<li>Practice these tasks to master Docker from basic operations to advanced deployment scenarios.</li>
</ul>
<hr />
<h4 id="tasks-docker-cli-tasks-table-of-contents">Table of Contents<a class="headerlink" href="#tasks-docker-cli-tasks-table-of-contents" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="#tasks-docker-cli-tasks-1-docker-commit-workflow">01. Docker Commit Workflow</a></li>
<li><a href="#tasks-docker-cli-tasks-2-docker-container-debugging-challenge">02. Docker Container Debugging Challenge</a></li>
<li><a href="#tasks-docker-cli-tasks-3-docker-logs-and-container-management">03. Docker Logs and Container Management</a></li>
<li><a href="#tasks-docker-cli-tasks-4-run-a-docker-container-write-file-to-the-container-export-the-container-as-a-new-image">04. Run a docker container, write file to the container, export the container as a new image</a></li>
<li><a href="#tasks-docker-cli-tasks-5-run-nginx-container-map-the-ports-redirect-the-logs-to-a-file-on-the-host">05. Run nginx container, map the ports, redirect the logs to a file on the host</a></li>
<li><a href="#tasks-docker-cli-tasks-6-serve-a-local-folder-as-a-website-using-nginx">06. Serve a local folder as a website using Nginx</a></li>
<li><a href="#tasks-docker-cli-tasks-7-extract-the-default-configuration-file-of-an-apache-server-to-use-as-a-template">07. Extract the default configuration file of an Apache server to use as a template</a></li>
<li><a href="#tasks-docker-cli-tasks-8-run-nginx-and-monitor-the-logs-in-real-time">08. Run nginx and monitor the logs in real time</a></li>
<li><a href="#tasks-docker-cli-tasks-9-delete-all-stopped-containers-at-once">09. Delete all stopped containers at once</a></li>
<li><a href="#tasks-docker-cli-tasks-10-create-a-multi-stage-build-dockerfile-for-a-go-application">10. Create a multi-stage build Dockerfile for a Go application</a></li>
<li><a href="#tasks-docker-cli-tasks-11-use-docker-volumes-to-persist-data-between-container-restarts">11. Use Docker volumes to persist data between container restarts</a></li>
<li><a href="#tasks-docker-cli-tasks-12-set-up-a-docker-network-and-connect-multiple-containers">12. Set up a Docker network and connect multiple containers</a></li>
<li><a href="#tasks-docker-cli-tasks-13-build-and-push-a-custom-image-to-docker-hub">13. Build and push a custom image to Docker Hub</a></li>
<li><a href="#tasks-docker-cli-tasks-14-use-docker-compose-to-run-a-multi-container-application">14. Use docker-compose to run a multi-container application</a></li>
<li><a href="#tasks-docker-cli-tasks-15-implement-health-checks-for-a-container">15. Implement health checks for a container</a></li>
<li><a href="#tasks-docker-cli-tasks-16-use-environment-variables-in-a-dockerfile">16. Use environment variables in a Dockerfile</a></li>
<li><a href="#tasks-docker-cli-tasks-17-create-a-dockerfile-that-runs-as-a-non-root-user">17. Create a Dockerfile that runs as a non-root user</a></li>
<li><a href="#tasks-docker-cli-tasks-18-use-docker-exec-to-debug-a-running-container">18. Use docker exec to debug a running container</a></li>
</ul>
<hr />
<h4 id="tasks-docker-cli-tasks-01-docker-commit-workflow">01. Docker Commit Workflow<a class="headerlink" href="#tasks-docker-cli-tasks-01-docker-commit-workflow" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Start an <code>alpine</code> container and keep it running for modifications, create a new file inside the running container, use <code>docker commit</code> to capture a new image with the file included, run a container from the committed image and verify the file exists.</p>
<h4 id="tasks-docker-cli-tasks-scenario"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario" title="Permanent link">&para;</a></h4>
<ul>
<li>As a developer, you need to quickly customize a base image for testing by adding configuration files or debugging tools without rebuilding the entire image from source code. </li>
<li>This workflow allows you to make runtime modifications and save them as a new reusable image.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> <code>docker run</code>, <code>docker exec</code>, <code>docker commit</code>, and <code>docker run --rm</code></p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<ul>
<li><strong>Run a modifiable alpine container</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#tasks-docker-cli-tasks-__codelineno-0-1"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>alpine-commit<span class="w"> </span>alpine:latest<span class="w"> </span>sleep<span class="w"> </span>infinity
</span></code></pre></div>
<ul>
<li><strong>Write a file inside the running container</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#tasks-docker-cli-tasks-__codelineno-1-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>alpine-commit<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;Persisted with docker commit&#39; &gt; /opt/commit-note.txt&quot;</span>
</span></code></pre></div>
<ul>
<li><strong>Validate the file inside the original container (optional check)</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#tasks-docker-cli-tasks-__codelineno-2-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>alpine-commit<span class="w"> </span>cat<span class="w"> </span>/opt/commit-note.txt
</span></code></pre></div>
<ul>
<li><strong>Create a new image from the modified container</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#tasks-docker-cli-tasks-__codelineno-3-1"></a>docker<span class="w"> </span>commit<span class="w"> </span>alpine-commit<span class="w"> </span>alpine-with-note:latest
</span></code></pre></div>
<ul>
<li><strong>Run a container from the committed image and verify the file exists</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#tasks-docker-cli-tasks-__codelineno-4-1"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>alpine-with-note:latest<span class="w"> </span>cat<span class="w"> </span>/opt/commit-note.txt
</span></code></pre></div>
<p>Expected output:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#tasks-docker-cli-tasks-__codelineno-5-1"></a>Persisted with docker commit
</span></code></pre></div>
<ul>
<li><strong>Clean up resources</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#tasks-docker-cli-tasks-__codelineno-6-1"></a>docker<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>alpine-commit
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#tasks-docker-cli-tasks-__codelineno-6-2"></a>docker<span class="w"> </span>image<span class="w"> </span>rm<span class="w"> </span>alpine-with-note:latest
</span></code></pre></div>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker run -d &hellip; sleep infinity</strong>: Starts a container that stays alive for edits</li>
<li><strong>docker exec &hellip; echo &lsquo;&hellip;&rsquo; &gt; file</strong>: Writes a file into the running container</li>
<li><strong>docker commit</strong>: Captures the container&rsquo;s filesystem changes into a new image</li>
<li><strong>docker run &ndash;rm new-image cat file</strong>: Launches the new image, verifies the persistent file, and removes the container when done</li>
<li><strong>Cleanup commands</strong>: Remove the temporary container and image to free resources</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-02-docker-container-debugging-challenge">02. Docker Container Debugging Challenge<a class="headerlink" href="#tasks-docker-cli-tasks-02-docker-container-debugging-challenge" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Run a container that encounters an error, use debugging techniques to identify the issue, and fix the problem.</p>
<h4 id="tasks-docker-cli-tasks-scenario_1"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Your production application container is failing to start, and you need to diagnose the root cause quickly. </li>
<li>Using Docker&rsquo;s debugging tools, you can inspect logs, check exit codes, and test commands to identify and resolve the issue without affecting other services.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker logs</code>, <code>docker exec</code>, and <code>docker inspect</code> to troubleshoot container issues</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<ul>
<li><strong>Run a container that will fail</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#tasks-docker-cli-tasks-__codelineno-7-1"></a>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>failing-container<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;Starting...&#39; &amp;&amp; nonexistent_command &amp;&amp; echo &#39;Success&#39;&quot;</span>
</span></code></pre></div>
<ul>
<li><strong>Check the container status</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#tasks-docker-cli-tasks-__codelineno-8-1"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>failing-container
</span></code></pre></div>
<ul>
<li><strong>Examine the container logs</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#tasks-docker-cli-tasks-__codelineno-9-1"></a>docker<span class="w"> </span>logs<span class="w"> </span>failing-container
</span></code></pre></div>
<p>Expected output will show the error:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#tasks-docker-cli-tasks-__codelineno-10-1"></a>Starting...
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#tasks-docker-cli-tasks-__codelineno-10-2"></a>sh: nonexistent_command: not found
</span></code></pre></div>
<ul>
<li><strong>Inspect the container for more details</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#tasks-docker-cli-tasks-__codelineno-11-1"></a>docker<span class="w"> </span>inspect<span class="w"> </span>failing-container<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s2">&quot;State&quot;</span>
</span></code></pre></div>
<ul>
<li><strong>Debug by running a successful command in a similar container</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#tasks-docker-cli-tasks-__codelineno-12-1"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;Debug: Container is working&#39; &amp;&amp; ls -la /&quot;</span>
</span></code></pre></div>
<ul>
<li><strong>Fix the original command and run a corrected version</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#tasks-docker-cli-tasks-__codelineno-13-1"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;Starting...&#39; &amp;&amp; echo &#39;This command exists&#39; &amp;&amp; echo &#39;Success&#39;&quot;</span>
</span></code></pre></div>
<ul>
<li><strong>Clean up</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#tasks-docker-cli-tasks-__codelineno-14-1"></a>docker<span class="w"> </span>rm<span class="w"> </span>failing-container
</span></code></pre></div>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker logs</strong>: Shows stdout/stderr output from the container, crucial for debugging failures</li>
<li><strong>docker inspect</strong>: Provides detailed container information including exit codes and state</li>
<li><strong>docker exec</strong>: Allows running commands in running containers for interactive debugging</li>
<li><strong>Exit codes</strong>: Non-zero exit codes indicate failures that can be investigated with logs</li>
</ul>
<p><strong>Bonus: Advanced Debugging Techniques</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#tasks-docker-cli-tasks-__codelineno-15-1"></a><span class="c1"># Check container exit code</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#tasks-docker-cli-tasks-__codelineno-15-2"></a>docker<span class="w"> </span>inspect<span class="w"> </span>failing-container<span class="w"> </span>--format<span class="o">=</span><span class="s1">&#39;{{.State.ExitCode}}&#39;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#tasks-docker-cli-tasks-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#tasks-docker-cli-tasks-__codelineno-15-4"></a><span class="c1"># Run a debug container with the same image</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#tasks-docker-cli-tasks-__codelineno-15-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>alpine<span class="w"> </span>sh
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#tasks-docker-cli-tasks-__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#tasks-docker-cli-tasks-__codelineno-15-7"></a><span class="c1"># Inside the debug shell, test commands manually</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#tasks-docker-cli-tasks-__codelineno-15-8"></a><span class="c1"># echo &quot;Testing commands...&quot;</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#tasks-docker-cli-tasks-__codelineno-15-9"></a><span class="c1"># exit</span>
</span></code></pre></div>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-03-docker-logs-and-container-management">03. Docker Logs and Container Management<a class="headerlink" href="#tasks-docker-cli-tasks-03-docker-logs-and-container-management" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Run a <code>cowsay</code> Docker container with a custom message, send a message to the cowsay container (e.g., &ldquo;Hello from Docker!&rdquo;), stop the container after execution, extract and save the container logs to the host machine for debugging purposes.</p>
<h4 id="tasks-docker-cli-tasks-scenario_2"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_2" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re running a batch processing job in a container and need to capture its output for analysis or compliance purposes. </li>
<li>By redirecting container logs to host files, you can preserve important output data even after the container terminates.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker run</code>, <code>docker logs</code>, and output redirection.</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<ul>
<li><strong>Run the cowsay container with a custom message</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#tasks-docker-cli-tasks-__codelineno-16-1"></a>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>my-cowsay<span class="w"> </span>docker/whalesay<span class="w"> </span>cowsay<span class="w"> </span><span class="s2">&quot;Hello from Docker!&quot;</span>
</span></code></pre></div>
<ul>
<li><strong>Verify the container has stopped</strong></li>
</ul>
<p>The container stops automatically after execution. You can verify with:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#tasks-docker-cli-tasks-__codelineno-17-1"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>my-cowsay
</span></code></pre></div>
<ul>
<li><strong>Grab the logs and save to host machine</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#tasks-docker-cli-tasks-__codelineno-18-1"></a>docker<span class="w"> </span>logs<span class="w"> </span>my-cowsay<span class="w"> </span>&gt;<span class="w"> </span>cowsay-logs.txt
</span></code></pre></div>
<ul>
<li><strong>View the saved logs</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#tasks-docker-cli-tasks-__codelineno-19-1"></a>cat<span class="w"> </span>cowsay-logs.txt
</span></code></pre></div>
<p>Expected output in <code>cowsay-logs.txt</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#tasks-docker-cli-tasks-__codelineno-20-1"></a> ______________________
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#tasks-docker-cli-tasks-__codelineno-20-2"></a>&lt; Hello from Docker! &gt;
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#tasks-docker-cli-tasks-__codelineno-20-3"></a> ----------------------
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#tasks-docker-cli-tasks-__codelineno-20-4"></a>    \
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#tasks-docker-cli-tasks-__codelineno-20-5"></a>     \
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#tasks-docker-cli-tasks-__codelineno-20-6"></a>      \
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#tasks-docker-cli-tasks-__codelineno-20-7"></a>                    ##        .
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#tasks-docker-cli-tasks-__codelineno-20-8"></a>              ## ## ##       ==
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#tasks-docker-cli-tasks-__codelineno-20-9"></a>           ## ## ## ##      ===
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#tasks-docker-cli-tasks-__codelineno-20-10"></a>       /&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;___/ ===
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#tasks-docker-cli-tasks-__codelineno-20-11"></a>  ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#tasks-docker-cli-tasks-__codelineno-20-12"></a>       \______ o          __/
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#tasks-docker-cli-tasks-__codelineno-20-13"></a>        \    \        __/
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#tasks-docker-cli-tasks-__codelineno-20-14"></a>          \____\______/
</span></code></pre></div>
<ul>
<li><strong>Clean up (optional)</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#tasks-docker-cli-tasks-__codelineno-21-1"></a><span class="c1"># Remove the container</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#tasks-docker-cli-tasks-__codelineno-21-2"></a>docker<span class="w"> </span>rm<span class="w"> </span>my-cowsay
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#tasks-docker-cli-tasks-__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#tasks-docker-cli-tasks-__codelineno-21-4"></a><span class="c1"># Remove the log file</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#tasks-docker-cli-tasks-__codelineno-21-5"></a>rm<span class="w"> </span>cowsay-logs.txt
</span></code></pre></div>
<p><strong>Alternative: Using a Different Cowsay Image</strong></p>
<p>If <code>docker/whalesay</code> is not available, you can build your own:</p>
<p><strong>Dockerfile:</strong></p>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#tasks-docker-cli-tasks-__codelineno-22-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#tasks-docker-cli-tasks-__codelineno-22-2"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>cowsay
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#tasks-docker-cli-tasks-__codelineno-22-3"></a><span class="k">ENTRYPOINT</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/usr/bin/cowsay&quot;</span><span class="p">]</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#tasks-docker-cli-tasks-__codelineno-22-4"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Hello Docker!&quot;</span><span class="p">]</span>
</span></code></pre></div>
<p><strong>Build and run:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#tasks-docker-cli-tasks-__codelineno-23-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-cowsay<span class="w"> </span>.
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#tasks-docker-cli-tasks-__codelineno-23-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>cowsay-test<span class="w"> </span>my-cowsay<span class="w"> </span><span class="s2">&quot;Hello from Docker!&quot;</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#tasks-docker-cli-tasks-__codelineno-23-3"></a>docker<span class="w"> </span>logs<span class="w"> </span>cowsay-test<span class="w"> </span>&gt;<span class="w"> </span>cowsay-logs.txt
</span></code></pre></div>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker run &ndash;name</strong>: Assigns a name to the container for easy reference</li>
<li><strong>cowsay &ldquo;message&rdquo;</strong>: Passes the message to the cowsay command</li>
<li><strong>docker logs</strong>: Retrieves all stdout/stderr output from the container</li>
<li><strong>&gt; cowsay-logs.txt</strong>: Redirects the log output to a file on the host machine</li>
<li>The container stops automatically after the command completes</li>
</ul>
<p><strong>Bonus: Running in Detached Mode</strong></p>
<p>For containers that run longer:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#tasks-docker-cli-tasks-__codelineno-24-1"></a><span class="c1"># Run in detached mode</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#tasks-docker-cli-tasks-__codelineno-24-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>my-cowsay-bg<span class="w"> </span>docker/whalesay<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;cowsay &#39;Background task&#39; &amp;&amp; sleep 30&quot;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#tasks-docker-cli-tasks-__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#tasks-docker-cli-tasks-__codelineno-24-4"></a><span class="c1"># Get logs while running</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#tasks-docker-cli-tasks-__codelineno-24-5"></a>docker<span class="w"> </span>logs<span class="w"> </span>my-cowsay-bg
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#tasks-docker-cli-tasks-__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#tasks-docker-cli-tasks-__codelineno-24-7"></a><span class="c1"># Follow logs in real-time</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#tasks-docker-cli-tasks-__codelineno-24-8"></a>docker<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>my-cowsay-bg
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#tasks-docker-cli-tasks-__codelineno-24-9"></a>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#tasks-docker-cli-tasks-__codelineno-24-10"></a><span class="c1"># Stop the container</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#tasks-docker-cli-tasks-__codelineno-24-11"></a>docker<span class="w"> </span>stop<span class="w"> </span>my-cowsay-bg
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#tasks-docker-cli-tasks-__codelineno-24-12"></a>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#tasks-docker-cli-tasks-__codelineno-24-13"></a><span class="c1"># Save logs after stopping</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#tasks-docker-cli-tasks-__codelineno-24-14"></a>docker<span class="w"> </span>logs<span class="w"> </span>my-cowsay-bg<span class="w"> </span>&gt;<span class="w"> </span>cowsay-bg-logs.txt
</span></code></pre></div>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-04-run-a-docker-container-write-file-to-the-container-export-the-container-as-a-new-image">04. Run a docker container, write file to the container, export the container as a new image<a class="headerlink" href="#tasks-docker-cli-tasks-04-run-a-docker-container-write-file-to-the-container-export-the-container-as-a-new-image" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Start an Alpine container, create a file inside it, and then commit the changes to create a new image.</p>
<h4 id="tasks-docker-cli-tasks-scenario_3"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_3" title="Permanent link">&para;</a></h4>
<ul>
<li>You have a legacy application that requires manual configuration steps that can&rsquo;t be easily automated in a Dockerfile. </li>
<li>You need to perform these configurations interactively and then save the configured state as a new image for deployment.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker run -it</code>, <code>docker commit</code>, and <code>docker run --rm</code></p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#tasks-docker-cli-tasks-__codelineno-25-1"></a><span class="c1"># Run an Alpine container interactively</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#tasks-docker-cli-tasks-__codelineno-25-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--name<span class="w"> </span>alpine-modify<span class="w"> </span>alpine<span class="w"> </span>sh
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#tasks-docker-cli-tasks-__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#tasks-docker-cli-tasks-__codelineno-25-4"></a><span class="c1"># Inside the container, create a file</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#tasks-docker-cli-tasks-__codelineno-25-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello from modified container&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>/hello.txt
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#tasks-docker-cli-tasks-__codelineno-25-6"></a>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#tasks-docker-cli-tasks-__codelineno-25-7"></a><span class="c1"># Exit the container (Ctrl+D or exit)</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#tasks-docker-cli-tasks-__codelineno-25-8"></a>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#tasks-docker-cli-tasks-__codelineno-25-9"></a><span class="c1"># Commit the container to a new image</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#tasks-docker-cli-tasks-__codelineno-25-10"></a>docker<span class="w"> </span>commit<span class="w"> </span>alpine-modify<span class="w"> </span>my-alpine-modified:v1
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#tasks-docker-cli-tasks-__codelineno-25-11"></a>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#tasks-docker-cli-tasks-__codelineno-25-12"></a><span class="c1"># Verify the new image</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#tasks-docker-cli-tasks-__codelineno-25-13"></a>docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>my-alpine-modified
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#tasks-docker-cli-tasks-__codelineno-25-14"></a>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#tasks-docker-cli-tasks-__codelineno-25-15"></a><span class="c1"># Test the new image</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#tasks-docker-cli-tasks-__codelineno-25-16"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>my-alpine-modified<span class="w"> </span>cat<span class="w"> </span>/hello.txt
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#tasks-docker-cli-tasks-__codelineno-25-17"></a>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#tasks-docker-cli-tasks-__codelineno-25-18"></a><span class="c1"># Clean up</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#tasks-docker-cli-tasks-__codelineno-25-19"></a>docker<span class="w"> </span>rm<span class="w"> </span>alpine-modify
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker run -it</strong>: Runs a container interactively, allowing direct shell access</li>
<li><strong>docker commit</strong>: Creates a new image from a container&rsquo;s current state</li>
<li><strong>docker images</strong>: Lists all available images to verify the new image was created</li>
<li><strong>docker run &ndash;rm</strong>: Runs a container and automatically removes it when it exits</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-05-run-nginx-container-map-the-ports-redirect-the-logs-to-a-file-on-the-host">05. Run nginx container, map the ports, redirect the logs to a file on the host<a class="headerlink" href="#tasks-docker-cli-tasks-05-run-nginx-container-map-the-ports-redirect-the-logs-to-a-file-on-the-host" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Run an Nginx container with port mapping and redirect its logs to a file on the host system.</p>
<h4 id="tasks-docker-cli-tasks-scenario_4"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_4" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re deploying a web application in production and need to centralize log collection for monitoring and troubleshooting. </li>
<li>By mounting host directories as volumes, you can integrate container logs with your existing log aggregation system.</li>
</ul>
<h4 id="tasks-docker-cli-tasks-resources"><strong>Resources:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-resources" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a logs directory: <code>mkdir -p ~/nginx-logs</code></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker run -d -p</code> and volume mounting with <code>-v</code></p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#tasks-docker-cli-tasks-__codelineno-26-1"></a><span class="c1"># Create a directory for logs</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#tasks-docker-cli-tasks-__codelineno-26-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/nginx-logs
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#tasks-docker-cli-tasks-__codelineno-26-3"></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#tasks-docker-cli-tasks-__codelineno-26-4"></a><span class="c1"># Run Nginx container with port mapping and log redirection</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#tasks-docker-cli-tasks-__codelineno-26-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>nginx-logged<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#tasks-docker-cli-tasks-__codelineno-26-6"></a><span class="w">  </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#tasks-docker-cli-tasks-__codelineno-26-7"></a><span class="w">  </span>-v<span class="w"> </span>~/nginx-logs:/var/log/nginx<span class="w"> </span><span class="se">\</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#tasks-docker-cli-tasks-__codelineno-26-8"></a><span class="w">  </span>nginx
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#tasks-docker-cli-tasks-__codelineno-26-9"></a>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#tasks-docker-cli-tasks-__codelineno-26-10"></a><span class="c1"># Wait a moment for the container to start</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#tasks-docker-cli-tasks-__codelineno-26-11"></a>sleep<span class="w"> </span><span class="m">3</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#tasks-docker-cli-tasks-__codelineno-26-12"></a>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#tasks-docker-cli-tasks-__codelineno-26-13"></a><span class="c1"># Test the container</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#tasks-docker-cli-tasks-__codelineno-26-14"></a>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#tasks-docker-cli-tasks-__codelineno-26-15"></a>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#tasks-docker-cli-tasks-__codelineno-26-16"></a><span class="c1"># Check that logs are being written to the host</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#tasks-docker-cli-tasks-__codelineno-26-17"></a>ls<span class="w"> </span>-la<span class="w"> </span>~/nginx-logs/
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#tasks-docker-cli-tasks-__codelineno-26-18"></a>tail<span class="w"> </span>~/nginx-logs/access.log
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#tasks-docker-cli-tasks-__codelineno-26-19"></a>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#tasks-docker-cli-tasks-__codelineno-26-20"></a><span class="c1"># Clean up</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#tasks-docker-cli-tasks-__codelineno-26-21"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx-logged
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#tasks-docker-cli-tasks-__codelineno-26-22"></a>docker<span class="w"> </span>rm<span class="w"> </span>nginx-logged
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#tasks-docker-cli-tasks-__codelineno-26-23"></a>rm<span class="w"> </span>-rf<span class="w"> </span>~/nginx-logs
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker run -d -p</strong>: Runs container in detached mode and maps host port to container port</li>
<li><strong>-v flag</strong>: Mounts host directory as volume inside container for log persistence</li>
<li><strong>curl</strong>: Tests HTTP connectivity to verify the container is responding</li>
<li><strong>tail</strong>: Shows the last lines of log files to monitor access logs</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-06-serve-a-local-folder-as-a-website-using-nginx">06. Serve a local folder as a website using Nginx<a class="headerlink" href="#tasks-docker-cli-tasks-06-serve-a-local-folder-as-a-website-using-nginx" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a local HTML file and serve it using an Nginx container that mounts the local directory.</p>
<h4 id="tasks-docker-cli-tasks-scenario_5"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_5" title="Permanent link">&para;</a></h4>
<ul>
<li>As a frontend developer, you want to quickly test your static website changes without setting up a full development server. </li>
<li>Using Docker, you can instantly serve your local files through Nginx for testing across different devices on your network.</li>
</ul>
<h4 id="tasks-docker-cli-tasks-resources_1"><strong>Resources:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-resources_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Create a website directory: <code>mkdir -p ~/my-website</code></li>
<li>Create an HTML file: <code>echo "&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from my local website!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;" &gt; ~/my-website/index.html</code></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use volume mounting to override Nginx&rsquo;s default web root directory</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#tasks-docker-cli-tasks-__codelineno-27-1"></a><span class="c1"># Create a local directory and HTML file</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#tasks-docker-cli-tasks-__codelineno-27-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>~/my-website
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#tasks-docker-cli-tasks-__codelineno-27-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello from my local website!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>~/my-website/index.html
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#tasks-docker-cli-tasks-__codelineno-27-4"></a>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#tasks-docker-cli-tasks-__codelineno-27-5"></a><span class="c1"># Run Nginx container mounting the local directory</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#tasks-docker-cli-tasks-__codelineno-27-6"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>nginx-website<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#tasks-docker-cli-tasks-__codelineno-27-7"></a><span class="w">  </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#tasks-docker-cli-tasks-__codelineno-27-8"></a><span class="w">  </span>-v<span class="w"> </span>~/my-website:/usr/share/nginx/html<span class="w"> </span><span class="se">\</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#tasks-docker-cli-tasks-__codelineno-27-9"></a><span class="w">  </span>nginx
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#tasks-docker-cli-tasks-__codelineno-27-10"></a>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#tasks-docker-cli-tasks-__codelineno-27-11"></a><span class="c1"># Wait for the container to start</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#tasks-docker-cli-tasks-__codelineno-27-12"></a>sleep<span class="w"> </span><span class="m">3</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#tasks-docker-cli-tasks-__codelineno-27-13"></a>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#tasks-docker-cli-tasks-__codelineno-27-14"></a><span class="c1"># Test the website</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#tasks-docker-cli-tasks-__codelineno-27-15"></a>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#tasks-docker-cli-tasks-__codelineno-27-16"></a>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#tasks-docker-cli-tasks-__codelineno-27-17"></a><span class="c1"># Clean up</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#tasks-docker-cli-tasks-__codelineno-27-18"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx-website
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#tasks-docker-cli-tasks-__codelineno-27-19"></a>docker<span class="w"> </span>rm<span class="w"> </span>nginx-website
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#tasks-docker-cli-tasks-__codelineno-27-20"></a>rm<span class="w"> </span>-rf<span class="w"> </span>~/my-website
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Volume mounting (-v)</strong>: Maps host directory to container directory for file sharing</li>
<li><strong>Nginx web root</strong>: /usr/share/nginx/html is the default directory Nginx serves files from</li>
<li><strong>curl</strong>: Tests the web server to ensure content is being served correctly</li>
<li><strong>Directory creation</strong>: Creates local content that gets served by the container</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-07-extract-the-default-configuration-file-of-an-apache-server-to-use-as-a-template">07. Extract the default configuration file of an Apache server to use as a template<a class="headerlink" href="#tasks-docker-cli-tasks-07-extract-the-default-configuration-file-of-an-apache-server-to-use-as-a-template" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Run an Apache container, copy its default configuration file to the host, then stop and remove the container.</p>
<h4 id="tasks-docker-cli-tasks-scenario_6"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_6" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re setting up a custom Apache configuration for your application and need a reference configuration file to start with. </li>
<li>Rather than manually creating one, you can extract the default configuration from the official Apache image as a template.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker cp</code> to copy files from a running container to the host</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#tasks-docker-cli-tasks-__codelineno-28-1"></a><span class="c1"># Run Apache container</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#tasks-docker-cli-tasks-__codelineno-28-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>apache-config<span class="w"> </span>httpd
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#tasks-docker-cli-tasks-__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#tasks-docker-cli-tasks-__codelineno-28-4"></a><span class="c1"># Wait for it to start</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#tasks-docker-cli-tasks-__codelineno-28-5"></a>sleep<span class="w"> </span><span class="m">3</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#tasks-docker-cli-tasks-__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#tasks-docker-cli-tasks-__codelineno-28-7"></a><span class="c1"># Copy the default configuration file</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#tasks-docker-cli-tasks-__codelineno-28-8"></a>docker<span class="w"> </span>cp<span class="w"> </span>apache-config:/usr/local/apache2/conf/httpd.conf<span class="w"> </span>~/apache-config-template.conf
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#tasks-docker-cli-tasks-__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#tasks-docker-cli-tasks-__codelineno-28-10"></a><span class="c1"># Verify the file was copied</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#tasks-docker-cli-tasks-__codelineno-28-11"></a>ls<span class="w"> </span>-la<span class="w"> </span>~/apache-config-template.conf
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#tasks-docker-cli-tasks-__codelineno-28-12"></a>head<span class="w"> </span>-20<span class="w"> </span>~/apache-config-template.conf
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#tasks-docker-cli-tasks-__codelineno-28-13"></a>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#tasks-docker-cli-tasks-__codelineno-28-14"></a><span class="c1"># Clean up</span>
</span><span id="__span-28-15"><a id="__codelineno-28-15" name="__codelineno-28-15" href="#tasks-docker-cli-tasks-__codelineno-28-15"></a>docker<span class="w"> </span>stop<span class="w"> </span>apache-config
</span><span id="__span-28-16"><a id="__codelineno-28-16" name="__codelineno-28-16" href="#tasks-docker-cli-tasks-__codelineno-28-16"></a>docker<span class="w"> </span>rm<span class="w"> </span>apache-config
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker cp</strong>: Copies files between host and running containers</li>
<li><strong>Configuration extraction</strong>: Useful for getting default configs as templates for customization</li>
<li><strong>head command</strong>: Shows the first few lines of files to verify content</li>
<li><strong>File permissions check</strong>: ls -la shows detailed file information including permissions</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-08-run-nginx-and-monitor-the-logs-in-real-time">08. Run nginx and monitor the logs in real time<a class="headerlink" href="#tasks-docker-cli-tasks-08-run-nginx-and-monitor-the-logs-in-real-time" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Start an Nginx container and monitor its access logs in real time using docker logs.</p>
<h4 id="tasks-docker-cli-tasks-scenario_7"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_7" title="Permanent link">&para;</a></h4>
<ul>
<li>Your web application is experiencing intermittent issues, and you need to monitor incoming requests in real-time to identify patterns or problematic traffic. </li>
<li>Following logs live helps you correlate user actions with system behavior.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker logs -f</code> to follow logs in real time</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#tasks-docker-cli-tasks-__codelineno-29-1"></a><span class="c1"># Run Nginx container</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#tasks-docker-cli-tasks-__codelineno-29-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>nginx-monitor<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>nginx
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#tasks-docker-cli-tasks-__codelineno-29-3"></a>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#tasks-docker-cli-tasks-__codelineno-29-4"></a><span class="c1"># In another terminal, monitor logs in real time</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#tasks-docker-cli-tasks-__codelineno-29-5"></a><span class="c1"># docker logs -f nginx-monitor</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#tasks-docker-cli-tasks-__codelineno-29-6"></a>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#tasks-docker-cli-tasks-__codelineno-29-7"></a><span class="c1"># In the current terminal, generate some traffic</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#tasks-docker-cli-tasks-__codelineno-29-8"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..5<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#tasks-docker-cli-tasks-__codelineno-29-9"></a><span class="w">  </span>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#tasks-docker-cli-tasks-__codelineno-29-10"></a><span class="w">  </span>sleep<span class="w"> </span><span class="m">1</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#tasks-docker-cli-tasks-__codelineno-29-11"></a><span class="k">done</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#tasks-docker-cli-tasks-__codelineno-29-12"></a>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#tasks-docker-cli-tasks-__codelineno-29-13"></a><span class="c1"># Stop monitoring (Ctrl+C in the other terminal)</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#tasks-docker-cli-tasks-__codelineno-29-14"></a>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#tasks-docker-cli-tasks-__codelineno-29-15"></a><span class="c1"># Clean up</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#tasks-docker-cli-tasks-__codelineno-29-16"></a>docker<span class="w"> </span>stop<span class="w"> </span>nginx-monitor
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#tasks-docker-cli-tasks-__codelineno-29-17"></a>docker<span class="w"> </span>rm<span class="w"> </span>nginx-monitor
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker logs -f</strong>: Follows log output in real-time (like tail -f)</li>
<li><strong>Background monitoring</strong>: Running logs command in separate terminal while generating traffic</li>
<li><strong>Traffic generation</strong>: Using curl in a loop to create access log entries</li>
<li><strong>Real-time debugging</strong>: Essential for monitoring live application behavior</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-09-delete-all-stopped-containers-at-once">09. Delete all stopped containers at once<a class="headerlink" href="#tasks-docker-cli-tasks-09-delete-all-stopped-containers-at-once" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Remove all containers that are not currently running.</p>
<h4 id="tasks-docker-cli-tasks-scenario_8"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_8" title="Permanent link">&para;</a></h4>
<ul>
<li>After a development session with multiple container iterations, your Docker environment is cluttered with stopped containers consuming disk space. </li>
<li>You need to clean up efficiently to free resources and maintain a tidy development environment.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker container prune</code> or filter containers by status</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#tasks-docker-cli-tasks-__codelineno-30-1"></a><span class="c1"># List all containers (running and stopped)</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#tasks-docker-cli-tasks-__codelineno-30-2"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#tasks-docker-cli-tasks-__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#tasks-docker-cli-tasks-__codelineno-30-4"></a><span class="c1"># Remove all stopped containers</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#tasks-docker-cli-tasks-__codelineno-30-5"></a>docker<span class="w"> </span>container<span class="w"> </span>prune<span class="w"> </span>-f
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#tasks-docker-cli-tasks-__codelineno-30-6"></a>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#tasks-docker-cli-tasks-__codelineno-30-7"></a><span class="c1"># Alternatively, using rm with ps</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#tasks-docker-cli-tasks-__codelineno-30-8"></a><span class="c1"># docker rm $(docker ps -aq --filter status=exited)</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#tasks-docker-cli-tasks-__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#tasks-docker-cli-tasks-__codelineno-30-10"></a><span class="c1"># Verify cleanup</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#tasks-docker-cli-tasks-__codelineno-30-11"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker container prune</strong>: Removes all stopped containers at once</li>
<li><strong>docker ps -a</strong>: Shows all containers (running and stopped) for verification</li>
<li><strong>Container lifecycle management</strong>: Important for keeping Docker environment clean</li>
<li><strong>Bulk operations</strong>: More efficient than removing containers one by one</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-10-create-a-multi-stage-build-dockerfile-for-a-go-application">10. Create a multi-stage build Dockerfile for a Go application<a class="headerlink" href="#tasks-docker-cli-tasks-10-create-a-multi-stage-build-dockerfile-for-a-go-application" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a Dockerfile that uses multi-stage builds to compile a Go application and produce a minimal runtime image.</p>
<h4 id="tasks-docker-cli-tasks-scenario_9"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_9" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re deploying a Go application to production and want to minimize the attack surface and image size. </li>
<li>Multi-stage builds allow you to use heavy build tools in the first stage and copy only the compiled binary to a minimal runtime image.</li>
</ul>
<h4 id="tasks-docker-cli-tasks-resources_2"><strong>Resources:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-resources_2" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>main.go</code>:
  <div class="language-go highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#tasks-docker-cli-tasks-__codelineno-31-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#tasks-docker-cli-tasks-__codelineno-31-2"></a>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#tasks-docker-cli-tasks-__codelineno-31-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#tasks-docker-cli-tasks-__codelineno-31-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#tasks-docker-cli-tasks-__codelineno-31-5"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#tasks-docker-cli-tasks-__codelineno-31-6"></a><span class="p">)</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#tasks-docker-cli-tasks-__codelineno-31-7"></a>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#tasks-docker-cli-tasks-__codelineno-31-8"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#tasks-docker-cli-tasks-__codelineno-31-9"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#tasks-docker-cli-tasks-__codelineno-31-10"></a><span class="w">        </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello from Go!&quot;</span><span class="p">)</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#tasks-docker-cli-tasks-__codelineno-31-11"></a><span class="w">    </span><span class="p">})</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#tasks-docker-cli-tasks-__codelineno-31-12"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">)</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#tasks-docker-cli-tasks-__codelineno-31-13"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Create <code>go.mod</code>:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#tasks-docker-cli-tasks-__codelineno-32-1"></a>module app
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#tasks-docker-cli-tasks-__codelineno-32-2"></a>go 1.21
</span></code></pre></div></li>
<li>Create <code>Dockerfile.multi-stage</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>FROM ... AS</code> to define build stages and <code>COPY --from=</code> to copy artifacts between stages</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
Create a file named <code>Dockerfile.multi-stage</code>:
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#tasks-docker-cli-tasks-__codelineno-33-1"></a><span class="c"># Build stage</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#tasks-docker-cli-tasks-__codelineno-33-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.21-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#tasks-docker-cli-tasks-__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#tasks-docker-cli-tasks-__codelineno-33-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#tasks-docker-cli-tasks-__codelineno-33-5"></a>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#tasks-docker-cli-tasks-__codelineno-33-6"></a><span class="c"># Copy go mod files</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#tasks-docker-cli-tasks-__codelineno-33-7"></a><span class="k">COPY</span><span class="w"> </span>go.mod<span class="w"> </span>go.sum<span class="w"> </span>./
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#tasks-docker-cli-tasks-__codelineno-33-8"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>download
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#tasks-docker-cli-tasks-__codelineno-33-9"></a>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#tasks-docker-cli-tasks-__codelineno-33-10"></a><span class="c"># Copy source code</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#tasks-docker-cli-tasks-__codelineno-33-11"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#tasks-docker-cli-tasks-__codelineno-33-12"></a>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#tasks-docker-cli-tasks-__codelineno-33-13"></a><span class="c"># Build the application</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#tasks-docker-cli-tasks-__codelineno-33-14"></a><span class="k">RUN</span><span class="w"> </span><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">GOOS</span><span class="o">=</span>linux<span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-a<span class="w"> </span>-installsuffix<span class="w"> </span>cgo<span class="w"> </span>-o<span class="w"> </span>main<span class="w"> </span>.
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#tasks-docker-cli-tasks-__codelineno-33-15"></a>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#tasks-docker-cli-tasks-__codelineno-33-16"></a><span class="c"># Runtime stage</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#tasks-docker-cli-tasks-__codelineno-33-17"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#tasks-docker-cli-tasks-__codelineno-33-18"></a>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#tasks-docker-cli-tasks-__codelineno-33-19"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>--no-cache<span class="w"> </span>add<span class="w"> </span>ca-certificates
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#tasks-docker-cli-tasks-__codelineno-33-20"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/root/</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#tasks-docker-cli-tasks-__codelineno-33-21"></a>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#tasks-docker-cli-tasks-__codelineno-33-22"></a><span class="c"># Copy the binary from builder stage</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#tasks-docker-cli-tasks-__codelineno-33-23"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/main<span class="w"> </span>.
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#tasks-docker-cli-tasks-__codelineno-33-24"></a>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#tasks-docker-cli-tasks-__codelineno-33-25"></a><span class="c"># Expose port</span>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#tasks-docker-cli-tasks-__codelineno-33-26"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#tasks-docker-cli-tasks-__codelineno-33-27"></a>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#tasks-docker-cli-tasks-__codelineno-33-28"></a><span class="c"># Run the binary</span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#tasks-docker-cli-tasks-__codelineno-33-29"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;./main&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p>Build and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#tasks-docker-cli-tasks-__codelineno-34-1"></a><span class="c1"># Assuming you have a simple Go app</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#tasks-docker-cli-tasks-__codelineno-34-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;package main</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#tasks-docker-cli-tasks-__codelineno-34-3"></a>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#tasks-docker-cli-tasks-__codelineno-34-4"></a><span class="s1">import (</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#tasks-docker-cli-tasks-__codelineno-34-5"></a><span class="s1">    &quot;fmt&quot;</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#tasks-docker-cli-tasks-__codelineno-34-6"></a><span class="s1">    &quot;net/http&quot;</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#tasks-docker-cli-tasks-__codelineno-34-7"></a><span class="s1">)</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#tasks-docker-cli-tasks-__codelineno-34-8"></a>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#tasks-docker-cli-tasks-__codelineno-34-9"></a><span class="s1">func main() {</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#tasks-docker-cli-tasks-__codelineno-34-10"></a><span class="s1">    http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) {</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#tasks-docker-cli-tasks-__codelineno-34-11"></a><span class="s1">        fmt.Fprintf(w, &quot;Hello from Go!&quot;)</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#tasks-docker-cli-tasks-__codelineno-34-12"></a><span class="s1">    })</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#tasks-docker-cli-tasks-__codelineno-34-13"></a><span class="s1">    http.ListenAndServe(&quot;:8080&quot;, nil)</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#tasks-docker-cli-tasks-__codelineno-34-14"></a><span class="s1">}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>main.go
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#tasks-docker-cli-tasks-__codelineno-34-15"></a>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#tasks-docker-cli-tasks-__codelineno-34-16"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;module app</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#tasks-docker-cli-tasks-__codelineno-34-17"></a><span class="s1">go 1.21&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>go.mod
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#tasks-docker-cli-tasks-__codelineno-34-18"></a>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#tasks-docker-cli-tasks-__codelineno-34-19"></a><span class="c1"># Build the multi-stage image</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#tasks-docker-cli-tasks-__codelineno-34-20"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.multi-stage<span class="w"> </span>-t<span class="w"> </span>go-multi-stage<span class="w"> </span>.
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#tasks-docker-cli-tasks-__codelineno-34-21"></a>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#tasks-docker-cli-tasks-__codelineno-34-22"></a><span class="c1"># Run the container</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#tasks-docker-cli-tasks-__codelineno-34-23"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>go-multi-stage
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#tasks-docker-cli-tasks-__codelineno-34-24"></a>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#tasks-docker-cli-tasks-__codelineno-34-25"></a><span class="c1"># Test</span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#tasks-docker-cli-tasks-__codelineno-34-26"></a>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#tasks-docker-cli-tasks-__codelineno-34-27"></a>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#tasks-docker-cli-tasks-__codelineno-34-28"></a><span class="c1"># Clean up</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#tasks-docker-cli-tasks-__codelineno-34-29"></a>docker<span class="w"> </span>stop<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>--filter<span class="w"> </span><span class="nv">ancestor</span><span class="o">=</span>go-multi-stage<span class="k">)</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#tasks-docker-cli-tasks-__codelineno-34-30"></a>docker<span class="w"> </span>rm<span class="w"> </span><span class="k">$(</span>docker<span class="w"> </span>ps<span class="w"> </span>-aq<span class="w"> </span>--filter<span class="w"> </span><span class="nv">ancestor</span><span class="o">=</span>go-multi-stage<span class="k">)</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#tasks-docker-cli-tasks-__codelineno-34-31"></a>docker<span class="w"> </span>rmi<span class="w"> </span>go-multi-stage
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Multi-stage builds</strong>: Separate build and runtime stages for smaller final images</li>
<li><strong>FROM &hellip; AS</strong>: Defines named build stages that can be referenced later</li>
<li><strong>COPY &ndash;from=</strong>: Copies artifacts from build stage to runtime stage</li>
<li><strong>CGO_ENABLED=0</strong>: Disables CGO for static binary compilation</li>
<li><strong>Minimal runtime images</strong>: Alpine Linux provides small, secure base images</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-11-use-docker-volumes-to-persist-data-between-container-restarts">11. Use Docker volumes to persist data between container restarts<a class="headerlink" href="#tasks-docker-cli-tasks-11-use-docker-volumes-to-persist-data-between-container-restarts" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a named volume, use it with a container to store data, restart the container, and verify data persistence.</p>
<h4 id="tasks-docker-cli-tasks-scenario_10"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_10" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application stores user data or configuration that must survive container updates or crashes. </li>
<li>Using Docker volumes ensures that important data persists independently of container lifecycle.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker volume create</code> and mount volumes with <code>-v</code> flag</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#tasks-docker-cli-tasks-__codelineno-35-1"></a><span class="c1"># Create a named volume</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#tasks-docker-cli-tasks-__codelineno-35-2"></a>docker<span class="w"> </span>volume<span class="w"> </span>create<span class="w"> </span>my-data-volume
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#tasks-docker-cli-tasks-__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#tasks-docker-cli-tasks-__codelineno-35-4"></a><span class="c1"># Run a container that writes to the volume</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#tasks-docker-cli-tasks-__codelineno-35-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>data-container<span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#tasks-docker-cli-tasks-__codelineno-35-6"></a><span class="w">  </span>-v<span class="w"> </span>my-data-volume:/data<span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#tasks-docker-cli-tasks-__codelineno-35-7"></a><span class="w">  </span>alpine<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;echo &#39;Persistent data&#39; &gt; /data/file.txt &amp;&amp; sleep 30&quot;</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#tasks-docker-cli-tasks-__codelineno-35-8"></a>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#tasks-docker-cli-tasks-__codelineno-35-9"></a><span class="c1"># Wait a moment</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#tasks-docker-cli-tasks-__codelineno-35-10"></a>sleep<span class="w"> </span><span class="m">5</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#tasks-docker-cli-tasks-__codelineno-35-11"></a>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#tasks-docker-cli-tasks-__codelineno-35-12"></a><span class="c1"># Check the data in the volume</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#tasks-docker-cli-tasks-__codelineno-35-13"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span>my-data-volume:/data<span class="w"> </span>alpine<span class="w"> </span>cat<span class="w"> </span>/data/file.txt
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#tasks-docker-cli-tasks-__codelineno-35-14"></a>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#tasks-docker-cli-tasks-__codelineno-35-15"></a><span class="c1"># Stop and remove the container</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#tasks-docker-cli-tasks-__codelineno-35-16"></a>docker<span class="w"> </span>stop<span class="w"> </span>data-container
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#tasks-docker-cli-tasks-__codelineno-35-17"></a>docker<span class="w"> </span>rm<span class="w"> </span>data-container
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#tasks-docker-cli-tasks-__codelineno-35-18"></a>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#tasks-docker-cli-tasks-__codelineno-35-19"></a><span class="c1"># Run a new container with the same volume</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#tasks-docker-cli-tasks-__codelineno-35-20"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-v<span class="w"> </span>my-data-volume:/data<span class="w"> </span>alpine<span class="w"> </span>cat<span class="w"> </span>/data/file.txt
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#tasks-docker-cli-tasks-__codelineno-35-21"></a>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#tasks-docker-cli-tasks-__codelineno-35-22"></a><span class="c1"># Clean up</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#tasks-docker-cli-tasks-__codelineno-35-23"></a>docker<span class="w"> </span>volume<span class="w"> </span>rm<span class="w"> </span>my-data-volume
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker volume create</strong>: Creates named volumes for persistent data storage</li>
<li><strong>Named volumes</strong>: Managed by Docker and survive container deletion</li>
<li><strong>Data persistence</strong>: Volumes maintain data across container restarts and recreations</li>
<li><strong>Volume mounting</strong>: -v flag attaches volumes to containers at specific paths</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-12-set-up-a-docker-network-and-connect-multiple-containers">12. Set up a Docker network and connect multiple containers<a class="headerlink" href="#tasks-docker-cli-tasks-12-set-up-a-docker-network-and-connect-multiple-containers" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a custom Docker network, run two containers on it, and demonstrate inter-container communication.</p>
<h4 id="tasks-docker-cli-tasks-scenario_11"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_11" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re deploying a microservices architecture where multiple containers need to communicate securely. </li>
<li>Custom networks provide isolation and service discovery, allowing containers to communicate using predictable hostnames.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker network create</code> and <code>--network</code> flag when running containers</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#tasks-docker-cli-tasks-__codelineno-36-1"></a><span class="c1"># Create a custom network</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#tasks-docker-cli-tasks-__codelineno-36-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>my-network
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#tasks-docker-cli-tasks-__codelineno-36-3"></a>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#tasks-docker-cli-tasks-__codelineno-36-4"></a><span class="c1"># Run a container that provides a service (simple HTTP server)</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#tasks-docker-cli-tasks-__codelineno-36-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>web-server<span class="w"> </span><span class="se">\</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#tasks-docker-cli-tasks-__codelineno-36-6"></a><span class="w">  </span>--network<span class="w"> </span>my-network<span class="w"> </span><span class="se">\</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#tasks-docker-cli-tasks-__codelineno-36-7"></a><span class="w">  </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span><span class="se">\</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#tasks-docker-cli-tasks-__codelineno-36-8"></a><span class="w">  </span>nginx
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#tasks-docker-cli-tasks-__codelineno-36-9"></a>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#tasks-docker-cli-tasks-__codelineno-36-10"></a><span class="c1"># Run another container that can communicate with the first</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#tasks-docker-cli-tasks-__codelineno-36-11"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--network<span class="w"> </span>my-network<span class="w"> </span><span class="se">\</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#tasks-docker-cli-tasks-__codelineno-36-12"></a><span class="w">  </span>alpine<span class="w"> </span>wget<span class="w"> </span>-qO-<span class="w"> </span>http://web-server
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#tasks-docker-cli-tasks-__codelineno-36-13"></a>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#tasks-docker-cli-tasks-__codelineno-36-14"></a><span class="c1"># Test from host (should work via port mapping)</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#tasks-docker-cli-tasks-__codelineno-36-15"></a>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#tasks-docker-cli-tasks-__codelineno-36-16"></a>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#tasks-docker-cli-tasks-__codelineno-36-17"></a><span class="c1"># Inspect the network</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#tasks-docker-cli-tasks-__codelineno-36-18"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>my-network
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#tasks-docker-cli-tasks-__codelineno-36-19"></a>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#tasks-docker-cli-tasks-__codelineno-36-20"></a><span class="c1"># Clean up</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#tasks-docker-cli-tasks-__codelineno-36-21"></a>docker<span class="w"> </span>stop<span class="w"> </span>web-server
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#tasks-docker-cli-tasks-__codelineno-36-22"></a>docker<span class="w"> </span>rm<span class="w"> </span>web-server
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#tasks-docker-cli-tasks-__codelineno-36-23"></a>docker<span class="w"> </span>network<span class="w"> </span>rm<span class="w"> </span>my-network
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker network create</strong>: Creates isolated networks for container communication</li>
<li><strong>&ndash;network flag</strong>: Connects containers to specific networks</li>
<li><strong>Service discovery</strong>: Containers can communicate using container names as hostnames</li>
<li><strong>Network isolation</strong>: Provides security and organization for multi-container applications</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-13-build-and-push-a-custom-image-to-docker-hub">13. Build and push a custom image to Docker Hub<a class="headerlink" href="#tasks-docker-cli-tasks-13-build-and-push-a-custom-image-to-docker-hub" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a simple custom image, tag it appropriately, and push it to Docker Hub (requires a Docker Hub account).</p>
<h4 id="tasks-docker-cli-tasks-scenario_12"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_12" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;ve developed a custom application image and want to share it with your team or deploy it across multiple environments. </li>
<li>Pushing to Docker Hub makes the image accessible from any Docker host with internet access.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker build</code>, <code>docker tag</code>, <code>docker login</code>, and <code>docker push</code></p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#tasks-docker-cli-tasks-__codelineno-37-1"></a><span class="c1"># Create a simple Dockerfile</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#tasks-docker-cli-tasks-__codelineno-37-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;FROM alpine:latest</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#tasks-docker-cli-tasks-__codelineno-37-3"></a><span class="s1">RUN echo &quot;Hello from my custom image&quot; &gt; /hello.txt</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#tasks-docker-cli-tasks-__codelineno-37-4"></a><span class="s1">CMD [&quot;cat&quot;, &quot;/hello.txt&quot;]&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>Dockerfile
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#tasks-docker-cli-tasks-__codelineno-37-5"></a>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#tasks-docker-cli-tasks-__codelineno-37-6"></a><span class="c1"># Build the image</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#tasks-docker-cli-tasks-__codelineno-37-7"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>my-custom-image:v1<span class="w"> </span>.
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#tasks-docker-cli-tasks-__codelineno-37-8"></a>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#tasks-docker-cli-tasks-__codelineno-37-9"></a><span class="c1"># Tag for Docker Hub (replace &#39;yourusername&#39; with your Docker Hub username)</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#tasks-docker-cli-tasks-__codelineno-37-10"></a><span class="c1"># docker tag my-custom-image:v1 yourusername/my-custom-image:v1</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#tasks-docker-cli-tasks-__codelineno-37-11"></a>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#tasks-docker-cli-tasks-__codelineno-37-12"></a><span class="c1"># Login to Docker Hub</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#tasks-docker-cli-tasks-__codelineno-37-13"></a><span class="c1"># docker login</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#tasks-docker-cli-tasks-__codelineno-37-14"></a>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#tasks-docker-cli-tasks-__codelineno-37-15"></a><span class="c1"># Push the image</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#tasks-docker-cli-tasks-__codelineno-37-16"></a><span class="c1"># docker push yourusername/my-custom-image:v1</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#tasks-docker-cli-tasks-__codelineno-37-17"></a>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#tasks-docker-cli-tasks-__codelineno-37-18"></a><span class="c1"># Test pulling the image (after pushing)</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#tasks-docker-cli-tasks-__codelineno-37-19"></a><span class="c1"># docker rmi yourusername/my-custom-image:v1</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#tasks-docker-cli-tasks-__codelineno-37-20"></a><span class="c1"># docker pull yourusername/my-custom-image:v1</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#tasks-docker-cli-tasks-__codelineno-37-21"></a>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#tasks-docker-cli-tasks-__codelineno-37-22"></a><span class="c1"># Clean up</span>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#tasks-docker-cli-tasks-__codelineno-37-23"></a>docker<span class="w"> </span>rmi<span class="w"> </span>my-custom-image:v1
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#tasks-docker-cli-tasks-__codelineno-37-24"></a>rm<span class="w"> </span>Dockerfile
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker build</strong>: Creates images from Dockerfiles</li>
<li><strong>docker tag</strong>: Assigns repository names and tags to images</li>
<li><strong>docker login</strong>: Authenticates with Docker Hub for pushing images</li>
<li><strong>docker push</strong>: Uploads images to remote registries like Docker Hub</li>
<li><strong>Image distribution</strong>: Enables sharing and deploying applications across environments</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-14-use-docker-compose-to-run-a-multi-container-application">14. Use docker-compose to run a multi-container application<a class="headerlink" href="#tasks-docker-cli-tasks-14-use-docker-compose-to-run-a-multi-container-application" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a docker-compose.yml file for a simple web application with a database, and run it.</p>
<h4 id="tasks-docker-cli-tasks-scenario_13"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_13" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re developing a full-stack application with multiple components (web server, database, cache) that need to work together. </li>
<li>Docker Compose allows you to define, configure, and run all services with a single command.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Define services, ports, volumes, and environment variables in docker-compose.yml</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
Create a <code>docker-compose.yml</code> file:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#tasks-docker-cli-tasks-__codelineno-38-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#tasks-docker-cli-tasks-__codelineno-38-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#tasks-docker-cli-tasks-__codelineno-38-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#tasks-docker-cli-tasks-__codelineno-38-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#tasks-docker-cli-tasks-__codelineno-38-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#tasks-docker-cli-tasks-__codelineno-38-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#tasks-docker-cli-tasks-__codelineno-38-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#tasks-docker-cli-tasks-__codelineno-38-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./html:/usr/share/nginx/html</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#tasks-docker-cli-tasks-__codelineno-38-9"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#tasks-docker-cli-tasks-__codelineno-38-10"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#tasks-docker-cli-tasks-__codelineno-38-11"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#tasks-docker-cli-tasks-__codelineno-38-12"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mypassword</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#tasks-docker-cli-tasks-__codelineno-38-13"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mydb</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#tasks-docker-cli-tasks-__codelineno-38-14"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#tasks-docker-cli-tasks-__codelineno-38-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db-data:/var/lib/postgresql/data</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#tasks-docker-cli-tasks-__codelineno-38-16"></a>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#tasks-docker-cli-tasks-__codelineno-38-17"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#tasks-docker-cli-tasks-__codelineno-38-18"></a><span class="w">  </span><span class="nt">db-data</span><span class="p">:</span>
</span></code></pre></div></p>
<p>Run the application:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#tasks-docker-cli-tasks-__codelineno-39-1"></a><span class="c1"># Create a simple HTML file</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#tasks-docker-cli-tasks-__codelineno-39-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>html
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#tasks-docker-cli-tasks-__codelineno-39-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Web App with DB&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>html/index.html
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#tasks-docker-cli-tasks-__codelineno-39-4"></a>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#tasks-docker-cli-tasks-__codelineno-39-5"></a><span class="c1"># Start the services</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#tasks-docker-cli-tasks-__codelineno-39-6"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#tasks-docker-cli-tasks-__codelineno-39-7"></a>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#tasks-docker-cli-tasks-__codelineno-39-8"></a><span class="c1"># Check running services</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#tasks-docker-cli-tasks-__codelineno-39-9"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#tasks-docker-cli-tasks-__codelineno-39-10"></a>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#tasks-docker-cli-tasks-__codelineno-39-11"></a><span class="c1"># Test the web service</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#tasks-docker-cli-tasks-__codelineno-39-12"></a>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#tasks-docker-cli-tasks-__codelineno-39-13"></a>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#tasks-docker-cli-tasks-__codelineno-39-14"></a><span class="c1"># Stop and clean up</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#tasks-docker-cli-tasks-__codelineno-39-15"></a>docker-compose<span class="w"> </span>down<span class="w"> </span>-v
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#tasks-docker-cli-tasks-__codelineno-39-16"></a>rm<span class="w"> </span>-rf<span class="w"> </span>html<span class="w"> </span>docker-compose.yml
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker-compose.yml</strong>: Defines multi-container applications with services, networks, and volumes</li>
<li><strong>docker-compose up -d</strong>: Starts all services defined in the compose file in detached mode</li>
<li><strong>Service orchestration</strong>: Manages complex applications with multiple interconnected containers</li>
<li><strong>Environment variables</strong>: Configure services through compose file declarations</li>
<li><strong>Named volumes</strong>: Persistent storage that survives container recreation</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-15-implement-health-checks-for-a-container">15. Implement health checks for a container<a class="headerlink" href="#tasks-docker-cli-tasks-15-implement-health-checks-for-a-container" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a Dockerfile with a health check and run a container to monitor its health status.</p>
<h4 id="tasks-docker-cli-tasks-scenario_14"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_14" title="Permanent link">&para;</a></h4>
<ul>
<li>Your containerized application runs in production with auto-healing capabilities. </li>
<li>Health checks allow the orchestrator to detect when a container becomes unresponsive and automatically restart it, ensuring high availability.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>HEALTHCHECK</code> instruction in Dockerfile and check status with <code>docker ps</code> or <code>docker inspect</code></p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
Create a <code>Dockerfile.health</code>:
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#tasks-docker-cli-tasks-__codelineno-40-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">nginx:latest</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#tasks-docker-cli-tasks-__codelineno-40-2"></a>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#tasks-docker-cli-tasks-__codelineno-40-3"></a><span class="c"># Copy a custom health check script</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#tasks-docker-cli-tasks-__codelineno-40-4"></a><span class="k">COPY</span><span class="w"> </span>healthcheck.sh<span class="w"> </span>/healthcheck.sh
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#tasks-docker-cli-tasks-__codelineno-40-5"></a><span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>/healthcheck.sh
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#tasks-docker-cli-tasks-__codelineno-40-6"></a>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#tasks-docker-cli-tasks-__codelineno-40-7"></a><span class="c"># Add health check</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#tasks-docker-cli-tasks-__codelineno-40-8"></a><span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>3s<span class="w"> </span>--start-period<span class="o">=</span>5s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#tasks-docker-cli-tasks-__codelineno-40-9"></a><span class="w">  </span>CMD<span class="w"> </span>/healthcheck.sh
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#tasks-docker-cli-tasks-__codelineno-40-10"></a>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#tasks-docker-cli-tasks-__codelineno-40-11"></a><span class="c"># Expose port</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#tasks-docker-cli-tasks-__codelineno-40-12"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80</span>
</span></code></pre></div></p>
<p>Create the health check script:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#tasks-docker-cli-tasks-__codelineno-41-1"></a><span class="ch">#!/bin/sh</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#tasks-docker-cli-tasks-__codelineno-41-2"></a><span class="c1"># Simple health check that verifies nginx is responding</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#tasks-docker-cli-tasks-__codelineno-41-3"></a>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost/<span class="w"> </span>&gt;<span class="w"> </span>/dev/null<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#tasks-docker-cli-tasks-__codelineno-41-4"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#tasks-docker-cli-tasks-__codelineno-41-5"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Health check passed&quot;</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#tasks-docker-cli-tasks-__codelineno-41-6"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#tasks-docker-cli-tasks-__codelineno-41-7"></a><span class="k">else</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#tasks-docker-cli-tasks-__codelineno-41-8"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Health check failed&quot;</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#tasks-docker-cli-tasks-__codelineno-41-9"></a><span class="w">    </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#tasks-docker-cli-tasks-__codelineno-41-10"></a><span class="k">fi</span>
</span></code></pre></div></p>
<p>Build and run:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#tasks-docker-cli-tasks-__codelineno-42-1"></a><span class="c1"># Build the image</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#tasks-docker-cli-tasks-__codelineno-42-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.health<span class="w"> </span>-t<span class="w"> </span>nginx-healthy<span class="w"> </span>.
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#tasks-docker-cli-tasks-__codelineno-42-3"></a>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#tasks-docker-cli-tasks-__codelineno-42-4"></a><span class="c1"># Run the container</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#tasks-docker-cli-tasks-__codelineno-42-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>healthy-nginx<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>nginx-healthy
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#tasks-docker-cli-tasks-__codelineno-42-6"></a>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#tasks-docker-cli-tasks-__codelineno-42-7"></a><span class="c1"># Wait for health check to run</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#tasks-docker-cli-tasks-__codelineno-42-8"></a>sleep<span class="w"> </span><span class="m">10</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#tasks-docker-cli-tasks-__codelineno-42-9"></a>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#tasks-docker-cli-tasks-__codelineno-42-10"></a><span class="c1"># Check container health</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#tasks-docker-cli-tasks-__codelineno-42-11"></a>docker<span class="w"> </span>ps
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#tasks-docker-cli-tasks-__codelineno-42-12"></a>docker<span class="w"> </span>inspect<span class="w"> </span>healthy-nginx<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">5</span><span class="w"> </span><span class="s2">&quot;Health&quot;</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#tasks-docker-cli-tasks-__codelineno-42-13"></a>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#tasks-docker-cli-tasks-__codelineno-42-14"></a><span class="c1"># Clean up</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#tasks-docker-cli-tasks-__codelineno-42-15"></a>docker<span class="w"> </span>stop<span class="w"> </span>healthy-nginx
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#tasks-docker-cli-tasks-__codelineno-42-16"></a>docker<span class="w"> </span>rm<span class="w"> </span>healthy-nginx
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#tasks-docker-cli-tasks-__codelineno-42-17"></a>docker<span class="w"> </span>rmi<span class="w"> </span>nginx-healthy
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#tasks-docker-cli-tasks-__codelineno-42-18"></a>rm<span class="w"> </span>Dockerfile.health<span class="w"> </span>healthcheck.sh
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>HEALTHCHECK instruction</strong>: Defines how Docker determines if a container is healthy</li>
<li><strong>Health check intervals</strong>: &ndash;interval, &ndash;timeout, &ndash;start-period, and &ndash;retries parameters</li>
<li><strong>Custom health scripts</strong>: Executable scripts that perform application-specific health checks</li>
<li><strong>Container monitoring</strong>: Docker automatically restarts unhealthy containers when configured</li>
<li><strong>docker inspect</strong>: Shows health status information for running containers</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-16-use-environment-variables-in-a-dockerfile">16. Use environment variables in a Dockerfile<a class="headerlink" href="#tasks-docker-cli-tasks-16-use-environment-variables-in-a-dockerfile" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a Dockerfile that uses environment variables for configuration and demonstrates their usage.</p>
<h4 id="tasks-docker-cli-tasks-scenario_15"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_15" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application needs different configurations for development, staging, and production environments. </li>
<li>Environment variables allow you to build one image that can be configured differently at runtime without code changes.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>ENV</code> instruction in Dockerfile and override with <code>docker run -e</code></p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
Create a <code>Dockerfile.env</code>:
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#tasks-docker-cli-tasks-__codelineno-43-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#tasks-docker-cli-tasks-__codelineno-43-2"></a>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#tasks-docker-cli-tasks-__codelineno-43-3"></a><span class="c"># Set environment variables</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#tasks-docker-cli-tasks-__codelineno-43-4"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">GREETING</span><span class="o">=</span><span class="s2">&quot;Hello&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#tasks-docker-cli-tasks-__codelineno-43-5"></a><span class="w">    </span><span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;Docker User&quot;</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#tasks-docker-cli-tasks-__codelineno-43-6"></a>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#tasks-docker-cli-tasks-__codelineno-43-7"></a><span class="c"># Use environment variables in a script</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#tasks-docker-cli-tasks-__codelineno-43-8"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;#!/bin/sh&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/greet.sh<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#tasks-docker-cli-tasks-__codelineno-43-9"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;echo &quot;$GREETING, $NAME!&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/greet.sh<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#tasks-docker-cli-tasks-__codelineno-43-10"></a><span class="w">    </span>chmod<span class="w"> </span>+x<span class="w"> </span>/greet.sh
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#tasks-docker-cli-tasks-__codelineno-43-11"></a>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#tasks-docker-cli-tasks-__codelineno-43-12"></a><span class="c"># Run the script</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#tasks-docker-cli-tasks-__codelineno-43-13"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/greet.sh&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p>Build and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#tasks-docker-cli-tasks-__codelineno-44-1"></a><span class="c1"># Build the image</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#tasks-docker-cli-tasks-__codelineno-44-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.env<span class="w"> </span>-t<span class="w"> </span>env-example<span class="w"> </span>.
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#tasks-docker-cli-tasks-__codelineno-44-3"></a>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#tasks-docker-cli-tasks-__codelineno-44-4"></a><span class="c1"># Run with default environment variables</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#tasks-docker-cli-tasks-__codelineno-44-5"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>env-example
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#tasks-docker-cli-tasks-__codelineno-44-6"></a>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#tasks-docker-cli-tasks-__codelineno-44-7"></a><span class="c1"># Run with overridden environment variables</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#tasks-docker-cli-tasks-__codelineno-44-8"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-e<span class="w"> </span><span class="nv">GREETING</span><span class="o">=</span><span class="s2">&quot;Hi&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">NAME</span><span class="o">=</span><span class="s2">&quot;Developer&quot;</span><span class="w"> </span>env-example
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#tasks-docker-cli-tasks-__codelineno-44-9"></a>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#tasks-docker-cli-tasks-__codelineno-44-10"></a><span class="c1"># Clean up</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#tasks-docker-cli-tasks-__codelineno-44-11"></a>docker<span class="w"> </span>rmi<span class="w"> </span>env-example
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#tasks-docker-cli-tasks-__codelineno-44-12"></a>rm<span class="w"> </span>Dockerfile.env
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>ENV instruction</strong>: Sets environment variables in the Docker image</li>
<li><strong>docker run -e</strong>: Overrides environment variables at runtime</li>
<li><strong>Configuration flexibility</strong>: Environment variables allow runtime customization</li>
<li><strong>Build-time vs runtime</strong>: ENV sets defaults, -e overrides them when running containers</li>
<li><strong>Security considerations</strong>: Avoid hardcoding sensitive values in images</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-17-create-a-dockerfile-that-runs-as-a-non-root-user">17. Create a Dockerfile that runs as a non-root user<a class="headerlink" href="#tasks-docker-cli-tasks-17-create-a-dockerfile-that-runs-as-a-non-root-user" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a Dockerfile that creates a non-root user and runs the container as that user for security.</p>
<h4 id="tasks-docker-cli-tasks-scenario_16"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_16" title="Permanent link">&para;</a></h4>
<ul>
<li>Security best practices require running containers as non-root users to minimize the impact of potential vulnerabilities. </li>
<li>This is especially important in multi-tenant environments where container escapes could compromise the host system.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>RUN</code> to create user/group, <code>USER</code> instruction, and proper file permissions</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
Create a <code>Dockerfile.nonroot</code>:
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#tasks-docker-cli-tasks-__codelineno-45-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#tasks-docker-cli-tasks-__codelineno-45-2"></a>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#tasks-docker-cli-tasks-__codelineno-45-3"></a><span class="c"># Create a non-root user</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#tasks-docker-cli-tasks-__codelineno-45-4"></a><span class="k">RUN</span><span class="w"> </span>addgroup<span class="w"> </span>-g<span class="w"> </span><span class="m">1001</span><span class="w"> </span>-S<span class="w"> </span>appgroup<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#tasks-docker-cli-tasks-__codelineno-45-5"></a><span class="w">    </span>adduser<span class="w"> </span>-u<span class="w"> </span><span class="m">1001</span><span class="w"> </span>-S<span class="w"> </span>appuser<span class="w"> </span>-G<span class="w"> </span>appgroup
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#tasks-docker-cli-tasks-__codelineno-45-6"></a>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#tasks-docker-cli-tasks-__codelineno-45-7"></a><span class="c"># Create a directory for the app</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#tasks-docker-cli-tasks-__codelineno-45-8"></a><span class="k">RUN</span><span class="w"> </span>mkdir<span class="w"> </span>/app<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>chown<span class="w"> </span>appuser:appgroup<span class="w"> </span>/app
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#tasks-docker-cli-tasks-__codelineno-45-9"></a>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#tasks-docker-cli-tasks-__codelineno-45-10"></a><span class="c"># Switch to non-root user</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#tasks-docker-cli-tasks-__codelineno-45-11"></a><span class="k">USER</span><span class="w"> </span><span class="s">appuser</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#tasks-docker-cli-tasks-__codelineno-45-12"></a>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#tasks-docker-cli-tasks-__codelineno-45-13"></a><span class="c"># Set working directory</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#tasks-docker-cli-tasks-__codelineno-45-14"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#tasks-docker-cli-tasks-__codelineno-45-15"></a>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#tasks-docker-cli-tasks-__codelineno-45-16"></a><span class="c"># Create a simple script</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#tasks-docker-cli-tasks-__codelineno-45-17"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;#!/bin/sh&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/app/hello.sh<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#tasks-docker-cli-tasks-__codelineno-45-18"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;echo &quot;Running as $(whoami) with UID $(id -u)&quot;&#39;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>/app/hello.sh<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#tasks-docker-cli-tasks-__codelineno-45-19"></a><span class="w">    </span>chmod<span class="w"> </span>+x<span class="w"> </span>/app/hello.sh
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#tasks-docker-cli-tasks-__codelineno-45-20"></a>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#tasks-docker-cli-tasks-__codelineno-45-21"></a><span class="c"># Run as non-root user</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#tasks-docker-cli-tasks-__codelineno-45-22"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/app/hello.sh&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p>Build and test:
<div class="language-sh highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#tasks-docker-cli-tasks-__codelineno-46-1"></a><span class="c1"># Build the image</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#tasks-docker-cli-tasks-__codelineno-46-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.nonroot<span class="w"> </span>-t<span class="w"> </span>nonroot-example<span class="w"> </span>.
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#tasks-docker-cli-tasks-__codelineno-46-3"></a>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#tasks-docker-cli-tasks-__codelineno-46-4"></a><span class="c1"># Run the container</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#tasks-docker-cli-tasks-__codelineno-46-5"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>nonroot-example
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#tasks-docker-cli-tasks-__codelineno-46-6"></a>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#tasks-docker-cli-tasks-__codelineno-46-7"></a><span class="c1"># Verify it&#39;s running as non-root (should show appuser, not root)</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#tasks-docker-cli-tasks-__codelineno-46-8"></a><span class="c1"># Clean up</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#tasks-docker-cli-tasks-__codelineno-46-9"></a>docker<span class="w"> </span>rmi<span class="w"> </span>nonroot-example
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#tasks-docker-cli-tasks-__codelineno-46-10"></a>rm<span class="w"> </span>Dockerfile.nonroot
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>USER instruction</strong>: Specifies the user to run subsequent commands and the final container</li>
<li><strong>Non-root security</strong>: Running as non-root user reduces attack surface and follows security best practices</li>
<li><strong>User creation</strong>: RUN commands to create users/groups before switching with USER</li>
<li><strong>File permissions</strong>: Proper ownership and permissions for non-root users</li>
<li><strong>whoami and id</strong>: Commands to verify which user the container is running as</li>
</ul>
</details>
<hr />
<h4 id="tasks-docker-cli-tasks-18-use-docker-exec-to-debug-a-running-container">18. Use docker exec to debug a running container<a class="headerlink" href="#tasks-docker-cli-tasks-18-use-docker-exec-to-debug-a-running-container" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Start a container, use docker exec to enter it and inspect its state, then make changes.</p>
<h4 id="tasks-docker-cli-tasks-scenario_17"><strong>Scenario:</strong><a class="headerlink" href="#tasks-docker-cli-tasks-scenario_17" title="Permanent link">&para;</a></h4>
<ul>
<li>Your production container is behaving unexpectedly, and you need to investigate without stopping the service. </li>
<li>Using docker exec, you can attach to the running container, examine its state, and make temporary fixes while maintaining service availability.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker exec -it</code> for interactive shell access and <code>docker exec</code> for running commands</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#tasks-docker-cli-tasks-__codelineno-47-1"></a><span class="c1"># Run a container</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#tasks-docker-cli-tasks-__codelineno-47-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>debug-container<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span><span class="m">1000</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#tasks-docker-cli-tasks-__codelineno-47-3"></a>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#tasks-docker-cli-tasks-__codelineno-47-4"></a><span class="c1"># Check what&#39;s running</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#tasks-docker-cli-tasks-__codelineno-47-5"></a>docker<span class="w"> </span>ps
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#tasks-docker-cli-tasks-__codelineno-47-6"></a>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#tasks-docker-cli-tasks-__codelineno-47-7"></a><span class="c1"># Execute a command in the running container</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#tasks-docker-cli-tasks-__codelineno-47-8"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>debug-container<span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello from inside the container&quot;</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#tasks-docker-cli-tasks-__codelineno-47-9"></a>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#tasks-docker-cli-tasks-__codelineno-47-10"></a><span class="c1"># Start an interactive shell in the container</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#tasks-docker-cli-tasks-__codelineno-47-11"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>debug-container<span class="w"> </span>sh
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#tasks-docker-cli-tasks-__codelineno-47-12"></a>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#tasks-docker-cli-tasks-__codelineno-47-13"></a><span class="c1"># Inside the shell, you can:</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#tasks-docker-cli-tasks-__codelineno-47-14"></a><span class="c1"># - Check processes: ps aux</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#tasks-docker-cli-tasks-__codelineno-47-15"></a><span class="c1"># - Check filesystem: ls -la /</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#tasks-docker-cli-tasks-__codelineno-47-16"></a><span class="c1"># - Check environment: env</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#tasks-docker-cli-tasks-__codelineno-47-17"></a><span class="c1"># - Create files: echo &quot;test&quot; &gt; /tmp/test.txt</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#tasks-docker-cli-tasks-__codelineno-47-18"></a><span class="c1"># - Exit with Ctrl+D</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#tasks-docker-cli-tasks-__codelineno-47-19"></a>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#tasks-docker-cli-tasks-__codelineno-47-20"></a><span class="c1"># After exiting, check if changes persist</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#tasks-docker-cli-tasks-__codelineno-47-21"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>debug-container<span class="w"> </span>cat<span class="w"> </span>/tmp/test.txt
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#tasks-docker-cli-tasks-__codelineno-47-22"></a>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#tasks-docker-cli-tasks-__codelineno-47-23"></a><span class="c1"># Check container logs</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#tasks-docker-cli-tasks-__codelineno-47-24"></a>docker<span class="w"> </span>logs<span class="w"> </span>debug-container
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#tasks-docker-cli-tasks-__codelineno-47-25"></a>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#tasks-docker-cli-tasks-__codelineno-47-26"></a><span class="c1"># Inspect container details</span>
</span><span id="__span-47-27"><a id="__codelineno-47-27" name="__codelineno-47-27" href="#tasks-docker-cli-tasks-__codelineno-47-27"></a>docker<span class="w"> </span>inspect<span class="w"> </span>debug-container<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s2">&quot;State&quot;</span>
</span><span id="__span-47-28"><a id="__codelineno-47-28" name="__codelineno-47-28" href="#tasks-docker-cli-tasks-__codelineno-47-28"></a>
</span><span id="__span-47-29"><a id="__codelineno-47-29" name="__codelineno-47-29" href="#tasks-docker-cli-tasks-__codelineno-47-29"></a><span class="c1"># Clean up</span>
</span><span id="__span-47-30"><a id="__codelineno-47-30" name="__codelineno-47-30" href="#tasks-docker-cli-tasks-__codelineno-47-30"></a>docker<span class="w"> </span>stop<span class="w"> </span>debug-container
</span><span id="__span-47-31"><a id="__codelineno-47-31" name="__codelineno-47-31" href="#tasks-docker-cli-tasks-__codelineno-47-31"></a>docker<span class="w"> </span>rm<span class="w"> </span>debug-container
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>docker exec</strong>: Runs commands inside running containers without stopping them</li>
<li><strong>docker exec -it</strong>: Interactive terminal access to running containers for debugging</li>
<li><strong>Container inspection</strong>: Examining processes, filesystem, and environment inside containers</li>
<li><strong>Live debugging</strong>: Essential for troubleshooting running applications</li>
<li><strong>Non-destructive testing</strong>: Debug without affecting the container&rsquo;s state</li>
</ul>
</details></section><section class="print-page" id="tasks-dockerfile" heading-number="2.4"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="tasks-dockerfile-dockerfile-tasks">Dockerfile Tasks<a class="headerlink" href="#tasks-dockerfile-dockerfile-tasks" title="Permanent link">&para;</a></h1>
<ul>
<li>Hands-on Dockerfile exercises covering essential image building concepts, optimization techniques, and advanced containerization patterns.</li>
<li>Each task includes a clear scenario description, helpful hints, and detailed solutions with explanations.</li>
<li>Practice these tasks to master Dockerfile best practices, multi-stage builds, and image optimization.</li>
</ul>
<hr />
<h4 id="tasks-dockerfile-table-of-contents">Table of Contents<a class="headerlink" href="#tasks-dockerfile-table-of-contents" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="#tasks-dockerfile-01-basic-dockerfile-structure">01. Basic Dockerfile Structure</a></li>
<li><a href="#tasks-dockerfile-02-build-arguments-and-environment-variables">02. Build Arguments and Environment Variables</a></li>
<li><a href="#tasks-dockerfile-03-multi-stage-build-basics">03. Multi-Stage Build Basics</a></li>
<li><a href="#tasks-dockerfile-04-working-directory-and-file-operations">04. Working Directory and File Operations</a></li>
<li><a href="#tasks-dockerfile-05-user-management-and-security">05. User Management and Security</a></li>
<li><a href="#tasks-dockerfile-06-port-exposure-and-networking">06. Port Exposure and Networking</a></li>
<li><a href="#tasks-dockerfile-07-health-checks-implementation">07. Health Checks Implementation</a></li>
<li><a href="#tasks-dockerfile-08-labels-and-metadata">08. Labels and Metadata</a></li>
<li><a href="#tasks-dockerfile-09-build-context-optimization">09. Build Context Optimization</a></li>
<li><a href="#tasks-dockerfile-10-multi-stage-build-with-go-application">10. Multi-Stage Build with Go Application</a></li>
<li><a href="#tasks-dockerfile-11-python-application-containerization">11. Python Application Containerization</a></li>
<li><a href="#tasks-dockerfile-12-image-layer-caching-optimization">12. Image Layer Caching Optimization</a></li>
<li><a href="#tasks-dockerfile-13-build-secrets-management">13. Build Secrets Management</a></li>
<li><a href="#tasks-dockerfile-14-advanced-multi-stage-build-patterns">14. Advanced Multi-Stage Build Patterns</a></li>
<li><a href="#tasks-dockerfile-15-dockerfile-security-best-practices">15. Dockerfile Security Best Practices</a></li>
<li><a href="#tasks-dockerfile-16-buildkit-advanced-features">16. BuildKit Advanced Features</a></li>
<li><a href="#tasks-dockerfile-17-image-size-optimization">17. Image Size Optimization</a></li>
<li><a href="#tasks-dockerfile-18-complex-application-stack">18. Complex Application Stack</a></li>
</ul>
<hr />
<h4 id="tasks-dockerfile-01-basic-dockerfile-structure">01. Basic Dockerfile Structure<a class="headerlink" href="#tasks-dockerfile-01-basic-dockerfile-structure" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a simple Dockerfile that builds a basic web server using Nginx to serve static HTML content.</p>
<h4 id="tasks-dockerfile-scenario"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario" title="Permanent link">&para;</a></h4>
<ul>
<li>As a web developer, you need to quickly containerize a static website for local development and testing before deploying to production. </li>
<li>Using a basic Dockerfile allows you to package your HTML, CSS, and JavaScript files into a portable container that can run consistently across different environments.</li>
</ul>
<h4 id="tasks-dockerfile-resources"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>index.html</code>:
  <div class="language-html highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#tasks-dockerfile-__codelineno-0-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#tasks-dockerfile-__codelineno-0-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#tasks-dockerfile-__codelineno-0-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#tasks-dockerfile-__codelineno-0-4"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My First Docker App<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#tasks-dockerfile-__codelineno-0-5"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#tasks-dockerfile-__codelineno-0-6"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#tasks-dockerfile-__codelineno-0-7"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello from Docker!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#tasks-dockerfile-__codelineno-0-8"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This page is served from a container.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#tasks-dockerfile-__codelineno-0-9"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#tasks-dockerfile-__codelineno-0-10"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>FROM</code>, <code>COPY</code>, <code>EXPOSE</code>, and <code>CMD</code> instructions</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p>Create the following files:</p>
<p><strong>index.html</strong>
<div class="language-html highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#tasks-dockerfile-__codelineno-1-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#tasks-dockerfile-__codelineno-1-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#tasks-dockerfile-__codelineno-1-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#tasks-dockerfile-__codelineno-1-4"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>My First Docker App<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#tasks-dockerfile-__codelineno-1-5"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#tasks-dockerfile-__codelineno-1-6"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#tasks-dockerfile-__codelineno-1-7"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello from Docker!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#tasks-dockerfile-__codelineno-1-8"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This page is served from a container.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#tasks-dockerfile-__codelineno-1-9"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#tasks-dockerfile-__codelineno-1-10"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#tasks-dockerfile-__codelineno-2-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">nginx:alpine</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#tasks-dockerfile-__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#tasks-dockerfile-__codelineno-2-3"></a><span class="c"># Copy custom HTML file to nginx default location</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#tasks-dockerfile-__codelineno-2-4"></a><span class="k">COPY</span><span class="w"> </span>index.html<span class="w"> </span>/usr/share/nginx/html/
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#tasks-dockerfile-__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#tasks-dockerfile-__codelineno-2-6"></a><span class="c"># Expose port 80</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#tasks-dockerfile-__codelineno-2-7"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#tasks-dockerfile-__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#tasks-dockerfile-__codelineno-2-9"></a><span class="c"># Use default nginx command</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#tasks-dockerfile-__codelineno-2-10"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;nginx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;daemon off;&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#tasks-dockerfile-__codelineno-3-1"></a><span class="c1"># Build the image</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#tasks-dockerfile-__codelineno-3-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>basic-nginx<span class="w"> </span>.
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#tasks-dockerfile-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#tasks-dockerfile-__codelineno-3-4"></a><span class="c1"># Run the container</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#tasks-dockerfile-__codelineno-3-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>--name<span class="w"> </span>basic-web<span class="w"> </span>basic-nginx
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#tasks-dockerfile-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#tasks-dockerfile-__codelineno-3-7"></a><span class="c1"># Test</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#tasks-dockerfile-__codelineno-3-8"></a>curl<span class="w"> </span>http://localhost:8080
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>FROM</strong>: Specifies the base image to build upon</li>
<li><strong>COPY</strong>: Copies files from build context to the image</li>
<li><strong>EXPOSE</strong>: Documents which ports the container listens on</li>
<li><strong>CMD</strong>: Specifies the command to run when the container starts</li>
<li><strong>nginx:alpine</strong>: Lightweight base image for web serving</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-02-build-arguments-and-environment-variables">02. Build Arguments and Environment Variables<a class="headerlink" href="#tasks-dockerfile-02-build-arguments-and-environment-variables" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Build a configurable Node.js application that accepts build-time arguments for version and port configuration.</p>
<h4 id="tasks-dockerfile-scenario_1"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_1" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re deploying the same application across multiple environments (development, staging, production) with different configurations. </li>
<li>Build arguments allow you to customize the image at build time, while environment variables enable runtime configuration flexibility.</li>
</ul>
<h4 id="tasks-dockerfile-resources_1"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_1" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>app.js</code>:
  <div class="language-javascript highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#tasks-dockerfile-__codelineno-4-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#tasks-dockerfile-__codelineno-4-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#tasks-dockerfile-__codelineno-4-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VERSION</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;1.0.0&#39;</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#tasks-dockerfile-__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#tasks-dockerfile-__codelineno-4-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#tasks-dockerfile-__codelineno-4-6"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#tasks-dockerfile-__codelineno-4-7"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`App Version: </span><span class="si">${</span><span class="nx">version</span><span class="si">}</span><span class="sb">, Running on port: </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#tasks-dockerfile-__codelineno-4-8"></a><span class="p">});</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#tasks-dockerfile-__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#tasks-dockerfile-__codelineno-4-10"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#tasks-dockerfile-__codelineno-4-11"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server running on port </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#tasks-dockerfile-__codelineno-4-12"></a><span class="p">});</span>
</span></code></pre></div></li>
<li>Create <code>package.json</code>:
  <div class="language-json highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#tasks-dockerfile-__codelineno-5-1"></a><span class="p">{</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#tasks-dockerfile-__codelineno-5-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;configurable-app&quot;</span><span class="p">,</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#tasks-dockerfile-__codelineno-5-3"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#tasks-dockerfile-__codelineno-5-4"></a><span class="w">  </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;app.js&quot;</span><span class="p">,</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#tasks-dockerfile-__codelineno-5-5"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#tasks-dockerfile-__codelineno-5-6"></a><span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node app.js&quot;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#tasks-dockerfile-__codelineno-5-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#tasks-dockerfile-__codelineno-5-8"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>ARG</code> for build-time variables and <code>ENV</code> for runtime environment variables</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>app.js</strong>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#tasks-dockerfile-__codelineno-6-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#tasks-dockerfile-__codelineno-6-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#tasks-dockerfile-__codelineno-6-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VERSION</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;1.0.0&#39;</span><span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#tasks-dockerfile-__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#tasks-dockerfile-__codelineno-6-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#tasks-dockerfile-__codelineno-6-6"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#tasks-dockerfile-__codelineno-6-7"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`App Version: </span><span class="si">${</span><span class="nx">version</span><span class="si">}</span><span class="sb">, Running on port: </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#tasks-dockerfile-__codelineno-6-8"></a><span class="p">});</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#tasks-dockerfile-__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#tasks-dockerfile-__codelineno-6-10"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#tasks-dockerfile-__codelineno-6-11"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server running on port </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#tasks-dockerfile-__codelineno-6-12"></a><span class="p">});</span>
</span></code></pre></div></p>
<p><strong>package.json</strong>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#tasks-dockerfile-__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#tasks-dockerfile-__codelineno-7-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;configurable-app&quot;</span><span class="p">,</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#tasks-dockerfile-__codelineno-7-3"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#tasks-dockerfile-__codelineno-7-4"></a><span class="w">  </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;app.js&quot;</span><span class="p">,</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#tasks-dockerfile-__codelineno-7-5"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#tasks-dockerfile-__codelineno-7-6"></a><span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node app.js&quot;</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#tasks-dockerfile-__codelineno-7-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#tasks-dockerfile-__codelineno-7-8"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#tasks-dockerfile-__codelineno-8-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#tasks-dockerfile-__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#tasks-dockerfile-__codelineno-8-3"></a><span class="c"># Build-time argument</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#tasks-dockerfile-__codelineno-8-4"></a><span class="k">ARG</span><span class="w"> </span><span class="nv">APP_VERSION</span><span class="o">=</span><span class="m">1</span>.0.0
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#tasks-dockerfile-__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#tasks-dockerfile-__codelineno-8-6"></a><span class="c"># Set environment variable from build arg</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#tasks-dockerfile-__codelineno-8-7"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="si">${</span><span class="nv">APP_VERSION</span><span class="si">}</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#tasks-dockerfile-__codelineno-8-8"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">PORT</span><span class="o">=</span><span class="m">3000</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#tasks-dockerfile-__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#tasks-dockerfile-__codelineno-8-10"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#tasks-dockerfile-__codelineno-8-11"></a>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#tasks-dockerfile-__codelineno-8-12"></a><span class="c"># Copy package files</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#tasks-dockerfile-__codelineno-8-13"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#tasks-dockerfile-__codelineno-8-14"></a>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#tasks-dockerfile-__codelineno-8-15"></a><span class="c"># Install dependencies</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#tasks-dockerfile-__codelineno-8-16"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci<span class="w"> </span>--only<span class="o">=</span>production
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#tasks-dockerfile-__codelineno-8-17"></a>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#tasks-dockerfile-__codelineno-8-18"></a><span class="c"># Copy application code</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#tasks-dockerfile-__codelineno-8-19"></a><span class="k">COPY</span><span class="w"> </span>app.js<span class="w"> </span>./
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#tasks-dockerfile-__codelineno-8-20"></a>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#tasks-dockerfile-__codelineno-8-21"></a><span class="c"># Expose the port</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#tasks-dockerfile-__codelineno-8-22"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">${PORT}</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#tasks-dockerfile-__codelineno-8-23"></a>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#tasks-dockerfile-__codelineno-8-24"></a><span class="c"># Run the application</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#tasks-dockerfile-__codelineno-8-25"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and test:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#tasks-dockerfile-__codelineno-9-1"></a><span class="c1"># Build with custom version</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#tasks-dockerfile-__codelineno-9-2"></a>docker<span class="w"> </span>build<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">APP_VERSION</span><span class="o">=</span><span class="m">2</span>.1.0<span class="w"> </span>-t<span class="w"> </span>configurable-app<span class="w"> </span>.
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#tasks-dockerfile-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#tasks-dockerfile-__codelineno-9-4"></a><span class="c1"># Run the container</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#tasks-dockerfile-__codelineno-9-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">3000</span>:3000<span class="w"> </span>--name<span class="w"> </span>config-app<span class="w"> </span>configurable-app
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#tasks-dockerfile-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#tasks-dockerfile-__codelineno-9-7"></a><span class="c1"># Test</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#tasks-dockerfile-__codelineno-9-8"></a>curl<span class="w"> </span>http://localhost:3000
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>ARG</strong>: Defines build-time variables that can be passed with &ndash;build-arg</li>
<li><strong>ENV</strong>: Sets environment variables that persist in the final image</li>
<li><strong>Build-time vs runtime</strong>: ARG is only available during build, ENV persists in containers</li>
<li><strong>Default values</strong>: Both ARG and ENV can have fallback values</li>
<li><strong>EXPOSE with variables</strong>: Can use environment variables for port exposure</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-03-multi-stage-build-basics">03. Multi-Stage Build Basics<a class="headerlink" href="#tasks-dockerfile-03-multi-stage-build-basics" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a multi-stage Dockerfile that compiles a C application in one stage and copies the binary to a minimal runtime image.</p>
<h4 id="tasks-dockerfile-scenario_2"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_2" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re building a compiled application that requires heavy build tools and dependencies, but you want to minimize the production image size and attack surface. </li>
<li>Multi-stage builds allow you to use a full development environment for compilation, then copy only the resulting binary to a minimal runtime image.</li>
</ul>
<h4 id="tasks-dockerfile-resources_2"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_2" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>hello.c</code>:
  <div class="language-c highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#tasks-dockerfile-__codelineno-10-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#tasks-dockerfile-__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#tasks-dockerfile-__codelineno-10-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#tasks-dockerfile-__codelineno-10-4"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from multi-stage build!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#tasks-dockerfile-__codelineno-10-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#tasks-dockerfile-__codelineno-10-6"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Use this basic <code>Dockerfile</code> snippet to get started:
  <div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#tasks-dockerfile-__codelineno-11-1"></a><span class="c"># Build stage</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#tasks-dockerfile-__codelineno-11-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">gcc:9-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#tasks-dockerfile-__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#tasks-dockerfile-__codelineno-11-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/src</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#tasks-dockerfile-__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#tasks-dockerfile-__codelineno-11-6"></a><span class="c"># Copy source code</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#tasks-dockerfile-__codelineno-11-7"></a><span class="k">COPY</span><span class="w"> </span>hello.c<span class="w"> </span>.
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#tasks-dockerfile-__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#tasks-dockerfile-__codelineno-11-9"></a><span class="c"># Compile the application</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#tasks-dockerfile-__codelineno-11-10"></a><span class="k">RUN</span><span class="w"> </span>gcc<span class="w"> </span>-o<span class="w"> </span>hello<span class="w"> </span>hello.c
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>FROM ... AS</code> to define stages and <code>COPY --from=</code> to transfer artifacts</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>hello.c</strong>
<div class="language-c highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#tasks-dockerfile-__codelineno-12-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#tasks-dockerfile-__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#tasks-dockerfile-__codelineno-12-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#tasks-dockerfile-__codelineno-12-4"></a><span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Hello from multi-stage build!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#tasks-dockerfile-__codelineno-12-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#tasks-dockerfile-__codelineno-12-6"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#tasks-dockerfile-__codelineno-13-1"></a><span class="c"># Build stage</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#tasks-dockerfile-__codelineno-13-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">gcc:9-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#tasks-dockerfile-__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#tasks-dockerfile-__codelineno-13-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/src</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#tasks-dockerfile-__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#tasks-dockerfile-__codelineno-13-6"></a><span class="c"># Copy source code</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#tasks-dockerfile-__codelineno-13-7"></a><span class="k">COPY</span><span class="w"> </span>hello.c<span class="w"> </span>.
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#tasks-dockerfile-__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#tasks-dockerfile-__codelineno-13-9"></a><span class="c"># Compile the application</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#tasks-dockerfile-__codelineno-13-10"></a><span class="k">RUN</span><span class="w"> </span>gcc<span class="w"> </span>-o<span class="w"> </span>hello<span class="w"> </span>hello.c
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#tasks-dockerfile-__codelineno-13-11"></a>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#tasks-dockerfile-__codelineno-13-12"></a><span class="c"># Runtime stage</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#tasks-dockerfile-__codelineno-13-13"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#tasks-dockerfile-__codelineno-13-14"></a>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#tasks-dockerfile-__codelineno-13-15"></a><span class="c"># Copy binary from build stage</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#tasks-dockerfile-__codelineno-13-16"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/src/hello<span class="w"> </span>/usr/local/bin/hello
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#tasks-dockerfile-__codelineno-13-17"></a>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#tasks-dockerfile-__codelineno-13-18"></a><span class="c"># Run the application</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#tasks-dockerfile-__codelineno-13-19"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;hello&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#tasks-dockerfile-__codelineno-14-1"></a><span class="c1"># Build the multi-stage image</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#tasks-dockerfile-__codelineno-14-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>multi-stage-hello<span class="w"> </span>.
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#tasks-dockerfile-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#tasks-dockerfile-__codelineno-14-4"></a><span class="c1"># Run the container</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#tasks-dockerfile-__codelineno-14-5"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>multi-stage-hello
</span></code></pre></div></p>
<p><strong>Expected output:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#tasks-dockerfile-__codelineno-15-1"></a>Hello from multi-stage build!
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Multi-stage builds</strong>: Separate build dependencies from runtime image</li>
<li><strong>AS builder</strong>: Names the build stage for reference</li>
<li><strong>COPY &ndash;from=builder</strong>: Copies files from the named build stage</li>
<li><strong>Smaller final images</strong>: Only runtime dependencies in final image</li>
<li><strong>Build optimization</strong>: No need for GCC in the final running container</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-04-working-directory-and-file-operations">04. Working Directory and File Operations<a class="headerlink" href="#tasks-dockerfile-04-working-directory-and-file-operations" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a Dockerfile that demonstrates proper working directory management and file operations for a Python application.</p>
<h4 id="tasks-dockerfile-scenario_3"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_3" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re containerizing a Python application with multiple source files, configuration files, and dependencies that need to be organized properly within the container. </li>
<li>Proper working directory management ensures that your application runs from the correct location and can access its files reliably.</li>
</ul>
<h4 id="tasks-dockerfile-resources_3"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_3" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>app.py</code>:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#tasks-dockerfile-__codelineno-16-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#tasks-dockerfile-__codelineno-16-2"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello from Python application!&quot;</span><span class="p">)</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#tasks-dockerfile-__codelineno-16-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory:&quot;</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">)</span>
</span></code></pre></div></li>
<li>Create <code>requirements.txt</code>:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#tasks-dockerfile-__codelineno-17-1"></a># No dependencies for this simple example
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>WORKDIR</code>, <code>COPY</code>, <code>ADD</code>, and proper file permissions</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>app.py</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#tasks-dockerfile-__codelineno-18-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#tasks-dockerfile-__codelineno-18-2"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello from Python application!&quot;</span><span class="p">)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#tasks-dockerfile-__codelineno-18-3"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current working directory:&quot;</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>requirements.txt</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#tasks-dockerfile-__codelineno-19-1"></a># No dependencies for this simple example
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#tasks-dockerfile-__codelineno-20-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9-slim</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#tasks-dockerfile-__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#tasks-dockerfile-__codelineno-20-3"></a><span class="c"># Set working directory</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#tasks-dockerfile-__codelineno-20-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#tasks-dockerfile-__codelineno-20-5"></a>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#tasks-dockerfile-__codelineno-20-6"></a><span class="c"># Copy requirements first (for better caching)</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#tasks-dockerfile-__codelineno-20-7"></a><span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#tasks-dockerfile-__codelineno-20-8"></a>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#tasks-dockerfile-__codelineno-20-9"></a><span class="c"># Install dependencies (if any)</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#tasks-dockerfile-__codelineno-20-10"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#tasks-dockerfile-__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#tasks-dockerfile-__codelineno-20-12"></a><span class="c"># Copy application code</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#tasks-dockerfile-__codelineno-20-13"></a><span class="k">COPY</span><span class="w"> </span>app.py<span class="w"> </span>.
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#tasks-dockerfile-__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#tasks-dockerfile-__codelineno-20-15"></a><span class="c"># Make script executable</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#tasks-dockerfile-__codelineno-20-16"></a><span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>app.py
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#tasks-dockerfile-__codelineno-20-17"></a>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#tasks-dockerfile-__codelineno-20-18"></a><span class="c"># Set working directory again (can be set multiple times)</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#tasks-dockerfile-__codelineno-20-19"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#tasks-dockerfile-__codelineno-20-20"></a>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#tasks-dockerfile-__codelineno-20-21"></a><span class="c"># Run the application</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#tasks-dockerfile-__codelineno-20-22"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.py&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#tasks-dockerfile-__codelineno-21-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>workdir-demo<span class="w"> </span>.
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#tasks-dockerfile-__codelineno-21-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>workdir-demo
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>WORKDIR</strong>: Sets the working directory for subsequent instructions</li>
<li><strong>Layer optimization</strong>: Copy requirements first for better Docker layer caching</li>
<li><strong>File permissions</strong>: Use RUN chmod to set executable permissions</li>
<li><strong>Working directory persistence</strong>: Affects COPY, RUN, and CMD instructions</li>
<li><strong>Absolute vs relative paths</strong>: WORKDIR helps avoid full path specifications</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-05-user-management-and-security">05. User Management and Security<a class="headerlink" href="#tasks-dockerfile-05-user-management-and-security" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a Dockerfile that runs as a non-root user for security, demonstrating proper user creation and permission management.</p>
<h4 id="tasks-dockerfile-scenario_4"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_4" title="Permanent link">&para;</a></h4>
<ul>
<li>Security auditors require that your production containers don&rsquo;t run as root user to minimize potential security vulnerabilities. </li>
<li>Implementing non-root user execution ensures that even if an attacker compromises your application, they have limited system access.</li>
</ul>
<h4 id="tasks-dockerfile-resources_4"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_4" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>app.py</code>:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#tasks-dockerfile-__codelineno-22-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#tasks-dockerfile-__codelineno-22-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#tasks-dockerfile-__codelineno-22-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running as user: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#tasks-dockerfile-__codelineno-22-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Username: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#tasks-dockerfile-__codelineno-22-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Application is running securely!&quot;</span><span class="p">)</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>RUN</code> to create users, <code>USER</code> to switch, and proper file ownership</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>app.py</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#tasks-dockerfile-__codelineno-23-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#tasks-dockerfile-__codelineno-23-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#tasks-dockerfile-__codelineno-23-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Running as user: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#tasks-dockerfile-__codelineno-23-4"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Username: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;USER&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#tasks-dockerfile-__codelineno-23-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Application is running securely!&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#tasks-dockerfile-__codelineno-24-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9-slim</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#tasks-dockerfile-__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#tasks-dockerfile-__codelineno-24-3"></a><span class="c"># Create a non-root user</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#tasks-dockerfile-__codelineno-24-4"></a><span class="k">RUN</span><span class="w"> </span>groupadd<span class="w"> </span>-r<span class="w"> </span>appuser<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>useradd<span class="w"> </span>-r<span class="w"> </span>-g<span class="w"> </span>appuser<span class="w"> </span>appuser
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#tasks-dockerfile-__codelineno-24-5"></a>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#tasks-dockerfile-__codelineno-24-6"></a><span class="c"># Set working directory</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#tasks-dockerfile-__codelineno-24-7"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#tasks-dockerfile-__codelineno-24-8"></a>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#tasks-dockerfile-__codelineno-24-9"></a><span class="c"># Copy application files</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#tasks-dockerfile-__codelineno-24-10"></a><span class="k">COPY</span><span class="w"> </span>app.py<span class="w"> </span>.
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#tasks-dockerfile-__codelineno-24-11"></a>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#tasks-dockerfile-__codelineno-24-12"></a><span class="c"># Change ownership of the app directory</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#tasks-dockerfile-__codelineno-24-13"></a><span class="k">RUN</span><span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>appuser:appuser<span class="w"> </span>/app
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#tasks-dockerfile-__codelineno-24-14"></a>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#tasks-dockerfile-__codelineno-24-15"></a><span class="c"># Switch to non-root user</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#tasks-dockerfile-__codelineno-24-16"></a><span class="k">USER</span><span class="w"> </span><span class="s">appuser</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#tasks-dockerfile-__codelineno-24-17"></a>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#tasks-dockerfile-__codelineno-24-18"></a><span class="c"># Run the application</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#tasks-dockerfile-__codelineno-24-19"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.py&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#tasks-dockerfile-__codelineno-25-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>secure-app<span class="w"> </span>.
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#tasks-dockerfile-__codelineno-25-2"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>secure-app
</span></code></pre></div></p>
<p><strong>Expected output:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#tasks-dockerfile-__codelineno-26-1"></a>Running as user: 1000
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#tasks-dockerfile-__codelineno-26-2"></a>Username: appuser
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#tasks-dockerfile-__codelineno-26-3"></a>Application is running securely!
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Non-root security</strong>: Running as non-root user reduces security risks</li>
<li><strong>groupadd/useradd</strong>: Creates system users and groups</li>
<li><strong>chown</strong>: Changes file ownership to the application user</li>
<li><strong>USER instruction</strong>: Switches the user context for subsequent commands</li>
<li><strong>Principle of least privilege</strong>: Application runs with minimal required permissions</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-06-port-exposure-and-networking">06. Port Exposure and Networking<a class="headerlink" href="#tasks-dockerfile-06-port-exposure-and-networking" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a Dockerfile for a web application that properly exposes ports and demonstrates networking concepts.</p>
<h4 id="tasks-dockerfile-scenario_5"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_5" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re deploying a web service that needs to accept HTTP requests from external clients while maintaining proper network isolation. </li>
<li>Correct port exposure ensures your application is accessible to other services and clients while documenting the intended network interface.</li>
</ul>
<h4 id="tasks-dockerfile-resources_5"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_5" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>server.js</code>:
  <div class="language-javascript highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#tasks-dockerfile-__codelineno-27-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#tasks-dockerfile-__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#tasks-dockerfile-__codelineno-27-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#tasks-dockerfile-__codelineno-27-4"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#tasks-dockerfile-__codelineno-27-5"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`Hello from container!\nRequest from: </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#tasks-dockerfile-__codelineno-27-6"></a><span class="p">});</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#tasks-dockerfile-__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#tasks-dockerfile-__codelineno-27-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">8080</span><span class="p">;</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#tasks-dockerfile-__codelineno-27-9"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#tasks-dockerfile-__codelineno-27-10"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server listening on port </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#tasks-dockerfile-__codelineno-27-11"></a><span class="p">});</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>EXPOSE</code> for documentation and port mapping, understand the difference between exposing and publishing ports</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>server.js</strong>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#tasks-dockerfile-__codelineno-28-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#tasks-dockerfile-__codelineno-28-2"></a>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#tasks-dockerfile-__codelineno-28-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#tasks-dockerfile-__codelineno-28-4"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#tasks-dockerfile-__codelineno-28-5"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`Hello from container!\nRequest from: </span><span class="si">${</span><span class="nx">req</span><span class="p">.</span><span class="nx">connection</span><span class="p">.</span><span class="nx">remoteAddress</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#tasks-dockerfile-__codelineno-28-6"></a><span class="p">});</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#tasks-dockerfile-__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#tasks-dockerfile-__codelineno-28-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">8080</span><span class="p">;</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#tasks-dockerfile-__codelineno-28-9"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#tasks-dockerfile-__codelineno-28-10"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server listening on port </span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#tasks-dockerfile-__codelineno-28-11"></a><span class="p">});</span>
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#tasks-dockerfile-__codelineno-29-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#tasks-dockerfile-__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#tasks-dockerfile-__codelineno-29-3"></a><span class="c"># Set working directory</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#tasks-dockerfile-__codelineno-29-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#tasks-dockerfile-__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#tasks-dockerfile-__codelineno-29-6"></a><span class="c"># Copy package files</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#tasks-dockerfile-__codelineno-29-7"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#tasks-dockerfile-__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#tasks-dockerfile-__codelineno-29-9"></a><span class="c"># Install dependencies</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#tasks-dockerfile-__codelineno-29-10"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci<span class="w"> </span>--only<span class="o">=</span>production
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#tasks-dockerfile-__codelineno-29-11"></a>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#tasks-dockerfile-__codelineno-29-12"></a><span class="c"># Copy application</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#tasks-dockerfile-__codelineno-29-13"></a><span class="k">COPY</span><span class="w"> </span>server.js<span class="w"> </span>.
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#tasks-dockerfile-__codelineno-29-14"></a>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#tasks-dockerfile-__codelineno-29-15"></a><span class="c"># Expose port (documentation)</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#tasks-dockerfile-__codelineno-29-16"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#tasks-dockerfile-__codelineno-29-17"></a>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#tasks-dockerfile-__codelineno-29-18"></a><span class="c"># Environment variable for port</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#tasks-dockerfile-__codelineno-29-19"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">PORT</span><span class="o">=</span><span class="m">8080</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#tasks-dockerfile-__codelineno-29-20"></a>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#tasks-dockerfile-__codelineno-29-21"></a><span class="c"># Run the server</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#tasks-dockerfile-__codelineno-29-22"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;server.js&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and test:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#tasks-dockerfile-__codelineno-30-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>networking-demo<span class="w"> </span>.
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#tasks-dockerfile-__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#tasks-dockerfile-__codelineno-30-3"></a><span class="c1"># Run with port mapping</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#tasks-dockerfile-__codelineno-30-4"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>--name<span class="w"> </span>net-demo<span class="w"> </span>networking-demo
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#tasks-dockerfile-__codelineno-30-5"></a>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#tasks-dockerfile-__codelineno-30-6"></a><span class="c1"># Test from host</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#tasks-dockerfile-__codelineno-30-7"></a>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#tasks-dockerfile-__codelineno-30-8"></a>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#tasks-dockerfile-__codelineno-30-9"></a><span class="c1"># Test from another container</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#tasks-dockerfile-__codelineno-30-10"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>--network<span class="w"> </span>container:net-demo<span class="w"> </span>alpine<span class="w"> </span>wget<span class="w"> </span>-qO-<span class="w"> </span>http://localhost:8080
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>EXPOSE</strong>: Documents which ports the container listens on (metadata only)</li>
<li><strong>Port mapping</strong>: <code>-p</code> flag maps host port to container port</li>
<li><strong>0.0.0.0 binding</strong>: Allows connections from outside the container</li>
<li><strong>Container networking</strong>: Containers can communicate via exposed ports</li>
<li><strong>Environment variables</strong>: Configure ports dynamically</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-07-health-checks-implementation">07. Health Checks Implementation<a class="headerlink" href="#tasks-dockerfile-07-health-checks-implementation" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Implement health checks in a Dockerfile to monitor container health and enable automatic restarts.</p>
<h4 id="tasks-dockerfile-scenario_6"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_6" title="Permanent link">&para;</a></h4>
<ul>
<li>Your production application needs to automatically recover from failures without manual intervention. </li>
<li>Health checks allow the container orchestrator to detect when your application becomes unresponsive and automatically restart the container to maintain service availability.</li>
</ul>
<h4 id="tasks-dockerfile-resources_6"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_6" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>healthcheck.sh</code>:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#tasks-dockerfile-__codelineno-31-1"></a><span class="ch">#!/bin/sh</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#tasks-dockerfile-__codelineno-31-2"></a><span class="c1"># Health check script</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#tasks-dockerfile-__codelineno-31-3"></a>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost:8080/health<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span></code></pre></div></li>
<li>Create <code>server.js</code>:
  <div class="language-javascript highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#tasks-dockerfile-__codelineno-32-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#tasks-dockerfile-__codelineno-32-2"></a>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#tasks-dockerfile-__codelineno-32-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#tasks-dockerfile-__codelineno-32-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;/health&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#tasks-dockerfile-__codelineno-32-5"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#tasks-dockerfile-__codelineno-32-6"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">);</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#tasks-dockerfile-__codelineno-32-7"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#tasks-dockerfile-__codelineno-32-8"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#tasks-dockerfile-__codelineno-32-9"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Hello World!\n&#39;</span><span class="p">);</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#tasks-dockerfile-__codelineno-32-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#tasks-dockerfile-__codelineno-32-11"></a><span class="p">});</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#tasks-dockerfile-__codelineno-32-12"></a>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#tasks-dockerfile-__codelineno-32-13"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">8080</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#tasks-dockerfile-__codelineno-32-14"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running on port 8080&#39;</span><span class="p">);</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#tasks-dockerfile-__codelineno-32-15"></a><span class="p">});</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>HEALTHCHECK</code> instruction with appropriate intervals, timeouts, and retry logic</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>healthcheck.sh</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#tasks-dockerfile-__codelineno-33-1"></a><span class="ch">#!/bin/sh</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#tasks-dockerfile-__codelineno-33-2"></a><span class="c1"># Health check script</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#tasks-dockerfile-__codelineno-33-3"></a>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost:8080/health<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span></code></pre></div></p>
<p><strong>server.js</strong>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#tasks-dockerfile-__codelineno-34-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#tasks-dockerfile-__codelineno-34-2"></a>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#tasks-dockerfile-__codelineno-34-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#tasks-dockerfile-__codelineno-34-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;/health&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#tasks-dockerfile-__codelineno-34-5"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#tasks-dockerfile-__codelineno-34-6"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">);</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#tasks-dockerfile-__codelineno-34-7"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#tasks-dockerfile-__codelineno-34-8"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#tasks-dockerfile-__codelineno-34-9"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Hello World!\n&#39;</span><span class="p">);</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#tasks-dockerfile-__codelineno-34-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#tasks-dockerfile-__codelineno-34-11"></a><span class="p">});</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#tasks-dockerfile-__codelineno-34-12"></a>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#tasks-dockerfile-__codelineno-34-13"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">8080</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#tasks-dockerfile-__codelineno-34-14"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running on port 8080&#39;</span><span class="p">);</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#tasks-dockerfile-__codelineno-34-15"></a><span class="p">});</span>
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#tasks-dockerfile-__codelineno-35-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#tasks-dockerfile-__codelineno-35-2"></a>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#tasks-dockerfile-__codelineno-35-3"></a><span class="c"># Install curl for health checks</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#tasks-dockerfile-__codelineno-35-4"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>curl
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#tasks-dockerfile-__codelineno-35-5"></a>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#tasks-dockerfile-__codelineno-35-6"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#tasks-dockerfile-__codelineno-35-7"></a>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#tasks-dockerfile-__codelineno-35-8"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#tasks-dockerfile-__codelineno-35-9"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci<span class="w"> </span>--only<span class="o">=</span>production
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#tasks-dockerfile-__codelineno-35-10"></a>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#tasks-dockerfile-__codelineno-35-11"></a><span class="k">COPY</span><span class="w"> </span>server.js<span class="w"> </span>.
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#tasks-dockerfile-__codelineno-35-12"></a><span class="k">COPY</span><span class="w"> </span>healthcheck.sh<span class="w"> </span>.
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#tasks-dockerfile-__codelineno-35-13"></a>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#tasks-dockerfile-__codelineno-35-14"></a><span class="c"># Make health check script executable</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#tasks-dockerfile-__codelineno-35-15"></a><span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>healthcheck.sh
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#tasks-dockerfile-__codelineno-35-16"></a>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#tasks-dockerfile-__codelineno-35-17"></a><span class="c"># Expose port</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#tasks-dockerfile-__codelineno-35-18"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#tasks-dockerfile-__codelineno-35-19"></a>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#tasks-dockerfile-__codelineno-35-20"></a><span class="c"># Health check configuration</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#tasks-dockerfile-__codelineno-35-21"></a><span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>3s<span class="w"> </span>--start-period<span class="o">=</span>5s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#tasks-dockerfile-__codelineno-35-22"></a><span class="w">  </span>CMD<span class="w"> </span>./healthcheck.sh
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#tasks-dockerfile-__codelineno-35-23"></a>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#tasks-dockerfile-__codelineno-35-24"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;server.js&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and test:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#tasks-dockerfile-__codelineno-36-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>healthcheck-demo<span class="w"> </span>.
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#tasks-dockerfile-__codelineno-36-2"></a>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#tasks-dockerfile-__codelineno-36-3"></a><span class="c1"># Run the container</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#tasks-dockerfile-__codelineno-36-4"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>--name<span class="w"> </span>health-demo<span class="w"> </span>healthcheck-demo
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#tasks-dockerfile-__codelineno-36-5"></a>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#tasks-dockerfile-__codelineno-36-6"></a><span class="c1"># Check health status</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#tasks-dockerfile-__codelineno-36-7"></a>docker<span class="w"> </span>ps
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#tasks-dockerfile-__codelineno-36-8"></a>docker<span class="w"> </span>inspect<span class="w"> </span>health-demo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s2">&quot;Health&quot;</span>
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>HEALTHCHECK</strong>: Defines how Docker determines container health</li>
<li><strong>&ndash;interval</strong>: How often to run the health check</li>
<li><strong>&ndash;timeout</strong>: Maximum time for health check to complete</li>
<li><strong>&ndash;start-period</strong>: Grace period before health checks begin</li>
<li><strong>&ndash;retries</strong>: Number of consecutive failures before marking unhealthy</li>
<li><strong>Automatic restarts</strong>: Docker can restart unhealthy containers</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-08-labels-and-metadata">08. Labels and Metadata<a class="headerlink" href="#tasks-dockerfile-08-labels-and-metadata" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Add comprehensive labels to a Dockerfile to provide metadata about the image, maintainer, and build information.</p>
<h4 id="tasks-dockerfile-scenario_7"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_7" title="Permanent link">&para;</a></h4>
<ul>
<li>Your organization needs to track image versions, maintainers, and build information for compliance and operational purposes. </li>
<li>Labels provide structured metadata that can be inspected and used by automated tools for inventory management, security scanning, and deployment decisions.</li>
</ul>
<h4 id="tasks-dockerfile-resources_7"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_7" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>nginx.conf</code>:
  <div class="language-nginx highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#tasks-dockerfile-__codelineno-37-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#tasks-dockerfile-__codelineno-37-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#tasks-dockerfile-__codelineno-37-3"></a><span class="p">}</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#tasks-dockerfile-__codelineno-37-4"></a>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#tasks-dockerfile-__codelineno-37-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#tasks-dockerfile-__codelineno-37-6"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#tasks-dockerfile-__codelineno-37-7"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#tasks-dockerfile-__codelineno-37-8"></a><span class="w">        </span><span class="kn">server_name</span><span class="w"> </span><span class="s">localhost</span><span class="p">;</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#tasks-dockerfile-__codelineno-37-9"></a>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#tasks-dockerfile-__codelineno-37-10"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#tasks-dockerfile-__codelineno-37-11"></a><span class="w">            </span><span class="kn">root</span><span class="w"> </span><span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#tasks-dockerfile-__codelineno-37-12"></a><span class="w">            </span><span class="kn">index</span><span class="w"> </span><span class="s">index.html</span><span class="p">;</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#tasks-dockerfile-__codelineno-37-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#tasks-dockerfile-__codelineno-37-14"></a>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#tasks-dockerfile-__codelineno-37-15"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/health</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#tasks-dockerfile-__codelineno-37-16"></a><span class="w">            </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#tasks-dockerfile-__codelineno-37-17"></a><span class="w">            </span><span class="kn">return</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="s">&quot;healthy\n&quot;</span><span class="p">;</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#tasks-dockerfile-__codelineno-37-18"></a><span class="w">            </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Content-Type</span><span class="w"> </span><span class="s">text/plain</span><span class="p">;</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#tasks-dockerfile-__codelineno-37-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#tasks-dockerfile-__codelineno-37-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#tasks-dockerfile-__codelineno-37-21"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Create <code>index.html</code>:
  <div class="language-html highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#tasks-dockerfile-__codelineno-38-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#tasks-dockerfile-__codelineno-38-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#tasks-dockerfile-__codelineno-38-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Labeled Image<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#tasks-dockerfile-__codelineno-38-4"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This image has comprehensive labels!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#tasks-dockerfile-__codelineno-38-5"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>LABEL</code> instruction to add key-value metadata that can be inspected with <code>docker inspect</code></p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#tasks-dockerfile-__codelineno-39-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">nginx:alpine</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#tasks-dockerfile-__codelineno-39-2"></a>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#tasks-dockerfile-__codelineno-39-3"></a><span class="c"># Image metadata labels</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#tasks-dockerfile-__codelineno-39-4"></a><span class="k">LABEL</span><span class="w"> </span><span class="nv">maintainer</span><span class="o">=</span><span class="s2">&quot;DockerLabs Team &lt;team@dockerlabs.com&gt;&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#tasks-dockerfile-__codelineno-39-5"></a><span class="w">      </span><span class="nv">version</span><span class="o">=</span><span class="s2">&quot;1.0.0&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#tasks-dockerfile-__codelineno-39-6"></a><span class="w">      </span><span class="nv">description</span><span class="o">=</span><span class="s2">&quot;Nginx web server with custom configuration&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#tasks-dockerfile-__codelineno-39-7"></a><span class="w">      </span><span class="nv">build_date</span><span class="o">=</span><span class="s2">&quot;2024-01-01&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#tasks-dockerfile-__codelineno-39-8"></a><span class="w">      </span><span class="nv">vcs_ref</span><span class="o">=</span><span class="s2">&quot;abc123def&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#tasks-dockerfile-__codelineno-39-9"></a><span class="w">      </span><span class="nv">vcs_url</span><span class="o">=</span><span class="s2">&quot;https://github.com/dockerlabs/web-server&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#tasks-dockerfile-__codelineno-39-10"></a><span class="w">      </span><span class="nv">vendor</span><span class="o">=</span><span class="s2">&quot;DockerLabs&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#tasks-dockerfile-__codelineno-39-11"></a><span class="w">      </span><span class="nv">license</span><span class="o">=</span><span class="s2">&quot;MIT&quot;</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#tasks-dockerfile-__codelineno-39-12"></a>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#tasks-dockerfile-__codelineno-39-13"></a><span class="c"># Copy custom configuration</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#tasks-dockerfile-__codelineno-39-14"></a><span class="k">COPY</span><span class="w"> </span>nginx.conf<span class="w"> </span>/etc/nginx/nginx.conf
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#tasks-dockerfile-__codelineno-39-15"></a><span class="k">COPY</span><span class="w"> </span>index.html<span class="w"> </span>/usr/share/nginx/html/
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#tasks-dockerfile-__codelineno-39-16"></a>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#tasks-dockerfile-__codelineno-39-17"></a><span class="c"># Expose port</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#tasks-dockerfile-__codelineno-39-18"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#tasks-dockerfile-__codelineno-39-19"></a>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#tasks-dockerfile-__codelineno-39-20"></a><span class="c"># Health check</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#tasks-dockerfile-__codelineno-39-21"></a><span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>3s<span class="w"> </span>--start-period<span class="o">=</span>5s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#tasks-dockerfile-__codelineno-39-22"></a><span class="w">  </span>CMD<span class="w"> </span>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost/<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#tasks-dockerfile-__codelineno-39-23"></a>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#tasks-dockerfile-__codelineno-39-24"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;nginx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;daemon off;&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>nginx.conf</strong>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#tasks-dockerfile-__codelineno-40-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#tasks-dockerfile-__codelineno-40-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#tasks-dockerfile-__codelineno-40-3"></a><span class="p">}</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#tasks-dockerfile-__codelineno-40-4"></a>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#tasks-dockerfile-__codelineno-40-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#tasks-dockerfile-__codelineno-40-6"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#tasks-dockerfile-__codelineno-40-7"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#tasks-dockerfile-__codelineno-40-8"></a><span class="w">        </span><span class="kn">server_name</span><span class="w"> </span><span class="s">localhost</span><span class="p">;</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#tasks-dockerfile-__codelineno-40-9"></a>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#tasks-dockerfile-__codelineno-40-10"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#tasks-dockerfile-__codelineno-40-11"></a><span class="w">            </span><span class="kn">root</span><span class="w"> </span><span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#tasks-dockerfile-__codelineno-40-12"></a><span class="w">            </span><span class="kn">index</span><span class="w"> </span><span class="s">index.html</span><span class="p">;</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#tasks-dockerfile-__codelineno-40-13"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#tasks-dockerfile-__codelineno-40-14"></a>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#tasks-dockerfile-__codelineno-40-15"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/health</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#tasks-dockerfile-__codelineno-40-16"></a><span class="w">            </span><span class="kn">access_log</span><span class="w"> </span><span class="no">off</span><span class="p">;</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#tasks-dockerfile-__codelineno-40-17"></a><span class="w">            </span><span class="kn">return</span><span class="w"> </span><span class="mi">200</span><span class="w"> </span><span class="s">&quot;healthy\n&quot;</span><span class="p">;</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#tasks-dockerfile-__codelineno-40-18"></a><span class="w">            </span><span class="kn">add_header</span><span class="w"> </span><span class="s">Content-Type</span><span class="w"> </span><span class="s">text/plain</span><span class="p">;</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#tasks-dockerfile-__codelineno-40-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#tasks-dockerfile-__codelineno-40-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#tasks-dockerfile-__codelineno-40-21"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>index.html</strong>
<div class="language-html highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#tasks-dockerfile-__codelineno-41-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#tasks-dockerfile-__codelineno-41-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#tasks-dockerfile-__codelineno-41-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Labeled Image<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#tasks-dockerfile-__codelineno-41-4"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>This image has comprehensive labels!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#tasks-dockerfile-__codelineno-41-5"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></p>
<p><strong>Build and inspect:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#tasks-dockerfile-__codelineno-42-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>labeled-nginx<span class="w"> </span>.
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#tasks-dockerfile-__codelineno-42-2"></a>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#tasks-dockerfile-__codelineno-42-3"></a><span class="c1"># Inspect labels</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#tasks-dockerfile-__codelineno-42-4"></a>docker<span class="w"> </span>inspect<span class="w"> </span>labeled-nginx<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="s2">&quot;Labels&quot;</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#tasks-dockerfile-__codelineno-42-5"></a>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#tasks-dockerfile-__codelineno-42-6"></a><span class="c1"># Run the container</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#tasks-dockerfile-__codelineno-42-7"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>labeled-nginx
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>LABEL</strong>: Adds metadata to images as key-value pairs</li>
<li><strong>Maintainer info</strong>: Contact information for image support</li>
<li><strong>Version tracking</strong>: Build version and date information</li>
<li><strong>Source control</strong>: Git commit and repository information</li>
<li><strong>Licensing</strong>: Legal information about the image</li>
<li><strong>Inspection</strong>: Labels can be viewed with <code>docker inspect</code></li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-09-build-context-optimization">09. Build Context Optimization<a class="headerlink" href="#tasks-dockerfile-09-build-context-optimization" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Optimize the build context by using .dockerignore to exclude unnecessary files and improve build performance.</p>
<h4 id="tasks-dockerfile-scenario_8"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_8" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application repository contains large files, dependencies, and temporary files that slow down Docker builds and increase build context size. </li>
<li>Optimizing the build context with .dockerignore improves build performance, reduces network transfer, and prevents sensitive files from being included in images.</li>
</ul>
<h4 id="tasks-dockerfile-resources_8"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_8" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>.dockerignore</code>:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#tasks-dockerfile-__codelineno-43-1"></a># Node modules (will be installed in container)
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#tasks-dockerfile-__codelineno-43-2"></a>node_modules
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#tasks-dockerfile-__codelineno-43-3"></a>npm-debug.log*
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#tasks-dockerfile-__codelineno-43-4"></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#tasks-dockerfile-__codelineno-43-5"></a># Git repository
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#tasks-dockerfile-__codelineno-43-6"></a>.git
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#tasks-dockerfile-__codelineno-43-7"></a>.gitignore
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#tasks-dockerfile-__codelineno-43-8"></a>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#tasks-dockerfile-__codelineno-43-9"></a># Environment files
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#tasks-dockerfile-__codelineno-43-10"></a>.env
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#tasks-dockerfile-__codelineno-43-11"></a>.env.local
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#tasks-dockerfile-__codelineno-43-12"></a>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#tasks-dockerfile-__codelineno-43-13"></a># Logs and temporary files
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#tasks-dockerfile-__codelineno-43-14"></a>logs
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#tasks-dockerfile-__codelineno-43-15"></a>*.log
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#tasks-dockerfile-__codelineno-43-16"></a>temp/
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#tasks-dockerfile-__codelineno-43-17"></a>*.tmp
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#tasks-dockerfile-__codelineno-43-18"></a>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#tasks-dockerfile-__codelineno-43-19"></a># IDE files
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#tasks-dockerfile-__codelineno-43-20"></a>.vscode
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#tasks-dockerfile-__codelineno-43-21"></a>.idea
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#tasks-dockerfile-__codelineno-43-22"></a>*.swp
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#tasks-dockerfile-__codelineno-43-23"></a>*.swo
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#tasks-dockerfile-__codelineno-43-24"></a>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#tasks-dockerfile-__codelineno-43-25"></a># OS files
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#tasks-dockerfile-__codelineno-43-26"></a>.DS_Store
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27" href="#tasks-dockerfile-__codelineno-43-27"></a>Thumbs.db
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28" href="#tasks-dockerfile-__codelineno-43-28"></a>
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29" href="#tasks-dockerfile-__codelineno-43-29"></a># Documentation (not needed for build)
</span><span id="__span-43-30"><a id="__codelineno-43-30" name="__codelineno-43-30" href="#tasks-dockerfile-__codelineno-43-30"></a>README.md
</span><span id="__span-43-31"><a id="__codelineno-43-31" name="__codelineno-43-31" href="#tasks-dockerfile-__codelineno-43-31"></a>docs/
</span><span id="__span-43-32"><a id="__codelineno-43-32" name="__codelineno-43-32" href="#tasks-dockerfile-__codelineno-43-32"></a>
</span><span id="__span-43-33"><a id="__codelineno-43-33" name="__codelineno-43-33" href="#tasks-dockerfile-__codelineno-43-33"></a># Test files (if not running tests in container)
</span><span id="__span-43-34"><a id="__codelineno-43-34" name="__codelineno-43-34" href="#tasks-dockerfile-__codelineno-43-34"></a>test/
</span><span id="__span-43-35"><a id="__codelineno-43-35" name="__codelineno-43-35" href="#tasks-dockerfile-__codelineno-43-35"></a>*.test.js
</span></code></pre></div></li>
<li>Create <code>app.js</code>:
  <div class="language-javascript highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#tasks-dockerfile-__codelineno-44-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#tasks-dockerfile-__codelineno-44-2"></a>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#tasks-dockerfile-__codelineno-44-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#tasks-dockerfile-__codelineno-44-4"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#tasks-dockerfile-__codelineno-44-5"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Optimized build context!\n&#39;</span><span class="p">);</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#tasks-dockerfile-__codelineno-44-6"></a><span class="p">});</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#tasks-dockerfile-__codelineno-44-7"></a>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#tasks-dockerfile-__codelineno-44-8"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#tasks-dockerfile-__codelineno-44-9"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running on port 3000&#39;</span><span class="p">);</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#tasks-dockerfile-__codelineno-44-10"></a><span class="p">});</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Create a <code>.dockerignore</code> file to exclude files that aren&rsquo;t needed in the build context</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Project structure:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#tasks-dockerfile-__codelineno-45-1"></a>my-app/
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#tasks-dockerfile-__codelineno-45-2"></a>‚îú‚îÄ‚îÄ Dockerfile
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#tasks-dockerfile-__codelineno-45-3"></a>‚îú‚îÄ‚îÄ .dockerignore
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#tasks-dockerfile-__codelineno-45-4"></a>‚îú‚îÄ‚îÄ package.json
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#tasks-dockerfile-__codelineno-45-5"></a>‚îú‚îÄ‚îÄ app.js
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#tasks-dockerfile-__codelineno-45-6"></a>‚îú‚îÄ‚îÄ README.md
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#tasks-dockerfile-__codelineno-45-7"></a>‚îú‚îÄ‚îÄ .git/
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#tasks-dockerfile-__codelineno-45-8"></a>‚îú‚îÄ‚îÄ node_modules/
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#tasks-dockerfile-__codelineno-45-9"></a>‚îú‚îÄ‚îÄ .env
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#tasks-dockerfile-__codelineno-45-10"></a>‚îú‚îÄ‚îÄ logs/
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#tasks-dockerfile-__codelineno-45-11"></a>‚îî‚îÄ‚îÄ temp/
</span></code></pre></div></p>
<p><strong>.dockerignore</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#tasks-dockerfile-__codelineno-46-1"></a># Node modules (will be installed in container)
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#tasks-dockerfile-__codelineno-46-2"></a>node_modules
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#tasks-dockerfile-__codelineno-46-3"></a>npm-debug.log*
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#tasks-dockerfile-__codelineno-46-4"></a>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#tasks-dockerfile-__codelineno-46-5"></a># Git repository
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#tasks-dockerfile-__codelineno-46-6"></a>.git
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#tasks-dockerfile-__codelineno-46-7"></a>.gitignore
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#tasks-dockerfile-__codelineno-46-8"></a>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#tasks-dockerfile-__codelineno-46-9"></a># Environment files
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#tasks-dockerfile-__codelineno-46-10"></a>.env
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#tasks-dockerfile-__codelineno-46-11"></a>.env.local
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#tasks-dockerfile-__codelineno-46-12"></a>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#tasks-dockerfile-__codelineno-46-13"></a># Logs and temporary files
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#tasks-dockerfile-__codelineno-46-14"></a>logs
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#tasks-dockerfile-__codelineno-46-15"></a>*.log
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#tasks-dockerfile-__codelineno-46-16"></a>temp/
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#tasks-dockerfile-__codelineno-46-17"></a>*.tmp
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#tasks-dockerfile-__codelineno-46-18"></a>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#tasks-dockerfile-__codelineno-46-19"></a># IDE files
</span><span id="__span-46-20"><a id="__codelineno-46-20" name="__codelineno-46-20" href="#tasks-dockerfile-__codelineno-46-20"></a>.vscode
</span><span id="__span-46-21"><a id="__codelineno-46-21" name="__codelineno-46-21" href="#tasks-dockerfile-__codelineno-46-21"></a>.idea
</span><span id="__span-46-22"><a id="__codelineno-46-22" name="__codelineno-46-22" href="#tasks-dockerfile-__codelineno-46-22"></a>*.swp
</span><span id="__span-46-23"><a id="__codelineno-46-23" name="__codelineno-46-23" href="#tasks-dockerfile-__codelineno-46-23"></a>*.swo
</span><span id="__span-46-24"><a id="__codelineno-46-24" name="__codelineno-46-24" href="#tasks-dockerfile-__codelineno-46-24"></a>
</span><span id="__span-46-25"><a id="__codelineno-46-25" name="__codelineno-46-25" href="#tasks-dockerfile-__codelineno-46-25"></a># OS files
</span><span id="__span-46-26"><a id="__codelineno-46-26" name="__codelineno-46-26" href="#tasks-dockerfile-__codelineno-46-26"></a>.DS_Store
</span><span id="__span-46-27"><a id="__codelineno-46-27" name="__codelineno-46-27" href="#tasks-dockerfile-__codelineno-46-27"></a>Thumbs.db
</span><span id="__span-46-28"><a id="__codelineno-46-28" name="__codelineno-46-28" href="#tasks-dockerfile-__codelineno-46-28"></a>
</span><span id="__span-46-29"><a id="__codelineno-46-29" name="__codelineno-46-29" href="#tasks-dockerfile-__codelineno-46-29"></a># Documentation (not needed for build)
</span><span id="__span-46-30"><a id="__codelineno-46-30" name="__codelineno-46-30" href="#tasks-dockerfile-__codelineno-46-30"></a>README.md
</span><span id="__span-46-31"><a id="__codelineno-46-31" name="__codelineno-46-31" href="#tasks-dockerfile-__codelineno-46-31"></a>docs/
</span><span id="__span-46-32"><a id="__codelineno-46-32" name="__codelineno-46-32" href="#tasks-dockerfile-__codelineno-46-32"></a>
</span><span id="__span-46-33"><a id="__codelineno-46-33" name="__codelineno-46-33" href="#tasks-dockerfile-__codelineno-46-33"></a># Test files (if not running tests in container)
</span><span id="__span-46-34"><a id="__codelineno-46-34" name="__codelineno-46-34" href="#tasks-dockerfile-__codelineno-46-34"></a>test/
</span><span id="__span-46-35"><a id="__codelineno-46-35" name="__codelineno-46-35" href="#tasks-dockerfile-__codelineno-46-35"></a>*.test.js
</span></code></pre></div></p>
<p><strong>app.js</strong>
<div class="language-javascript highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#tasks-dockerfile-__codelineno-47-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">http</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#tasks-dockerfile-__codelineno-47-2"></a>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#tasks-dockerfile-__codelineno-47-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#tasks-dockerfile-__codelineno-47-4"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#tasks-dockerfile-__codelineno-47-5"></a><span class="w">  </span><span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="s1">&#39;Optimized build context!\n&#39;</span><span class="p">);</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#tasks-dockerfile-__codelineno-47-6"></a><span class="p">});</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#tasks-dockerfile-__codelineno-47-7"></a>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#tasks-dockerfile-__codelineno-47-8"></a><span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mf">3000</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#tasks-dockerfile-__codelineno-47-9"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running on port 3000&#39;</span><span class="p">);</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#tasks-dockerfile-__codelineno-47-10"></a><span class="p">});</span>
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#tasks-dockerfile-__codelineno-48-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#tasks-dockerfile-__codelineno-48-2"></a>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#tasks-dockerfile-__codelineno-48-3"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#tasks-dockerfile-__codelineno-48-4"></a>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#tasks-dockerfile-__codelineno-48-5"></a><span class="c"># Copy package files first for better caching</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#tasks-dockerfile-__codelineno-48-6"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#tasks-dockerfile-__codelineno-48-7"></a>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#tasks-dockerfile-__codelineno-48-8"></a><span class="c"># Install dependencies</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#tasks-dockerfile-__codelineno-48-9"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci<span class="w"> </span>--only<span class="o">=</span>production
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#tasks-dockerfile-__codelineno-48-10"></a>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#tasks-dockerfile-__codelineno-48-11"></a><span class="c"># Copy application code (excluding .dockerignore files)</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#tasks-dockerfile-__codelineno-48-12"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#tasks-dockerfile-__codelineno-48-13"></a>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#tasks-dockerfile-__codelineno-48-14"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">3000</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#tasks-dockerfile-__codelineno-48-15"></a>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#tasks-dockerfile-__codelineno-48-16"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.js&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build comparison:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#tasks-dockerfile-__codelineno-49-1"></a><span class="c1"># Time the build with .dockerignore</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#tasks-dockerfile-__codelineno-49-2"></a><span class="nb">time</span><span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>optimized-app<span class="w"> </span>.
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#tasks-dockerfile-__codelineno-49-3"></a>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#tasks-dockerfile-__codelineno-49-4"></a><span class="c1"># Compare build context size</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#tasks-dockerfile-__codelineno-49-5"></a>docker<span class="w"> </span>build<span class="w"> </span>--no-cache<span class="w"> </span>--progress<span class="o">=</span>plain<span class="w"> </span>-t<span class="w"> </span>optimized-app<span class="w"> </span>.<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;Sending build context&quot;</span>
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>.dockerignore</strong>: Excludes files from build context to improve performance</li>
<li><strong>Build context</strong>: All files in the directory are sent to the Docker daemon</li>
<li><strong>Performance</strong>: Smaller context means faster builds and less network transfer</li>
<li><strong>Security</strong>: Prevents sensitive files from being included in images</li>
<li><strong>Caching</strong>: Better layer caching when unnecessary files aren&rsquo;t included</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-10-multi-stage-build-with-go-application">10. Multi-Stage Build with Go Application<a class="headerlink" href="#tasks-dockerfile-10-multi-stage-build-with-go-application" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create an optimized multi-stage Dockerfile for a Go web application that compiles in one stage and runs in a minimal distroless image.</p>
<h4 id="tasks-dockerfile-scenario_9"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_9" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re deploying a Go application to production where security and minimal image size are critical requirements. </li>
<li>Using distroless base images with multi-stage builds eliminates unnecessary packages and shell access, significantly reducing the attack surface while maintaining functionality.</li>
</ul>
<h4 id="tasks-dockerfile-resources_9"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_9" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>main.go</code>:
  <div class="language-go highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#tasks-dockerfile-__codelineno-50-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#tasks-dockerfile-__codelineno-50-2"></a>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#tasks-dockerfile-__codelineno-50-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#tasks-dockerfile-__codelineno-50-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#tasks-dockerfile-__codelineno-50-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#tasks-dockerfile-__codelineno-50-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#tasks-dockerfile-__codelineno-50-7"></a><span class="p">)</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#tasks-dockerfile-__codelineno-50-8"></a>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#tasks-dockerfile-__codelineno-50-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#tasks-dockerfile-__codelineno-50-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello from Go multi-stage build!\n&quot;</span><span class="p">)</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#tasks-dockerfile-__codelineno-50-11"></a><span class="p">}</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#tasks-dockerfile-__codelineno-50-12"></a>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#tasks-dockerfile-__codelineno-50-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#tasks-dockerfile-__codelineno-50-14"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#tasks-dockerfile-__codelineno-50-15"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Server starting on :8080&quot;</span><span class="p">)</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#tasks-dockerfile-__codelineno-50-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#tasks-dockerfile-__codelineno-50-17"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Create <code>go.mod</code>:
  <div class="language-go highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#tasks-dockerfile-__codelineno-51-1"></a><span class="nx">module</span><span class="w"> </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">dockerlabs</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">app</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#tasks-dockerfile-__codelineno-51-2"></a>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#tasks-dockerfile-__codelineno-51-3"></a><span class="k">go</span><span class="w"> </span><span class="mf">1.21</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use multi-stage builds to separate compilation from runtime, and use distroless base images for security</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>main.go</strong>
<div class="language-go highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#tasks-dockerfile-__codelineno-52-1"></a><span class="kn">package</span><span class="w"> </span><span class="nx">main</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#tasks-dockerfile-__codelineno-52-2"></a>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#tasks-dockerfile-__codelineno-52-3"></a><span class="kn">import</span><span class="w"> </span><span class="p">(</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#tasks-dockerfile-__codelineno-52-4"></a><span class="w">    </span><span class="s">&quot;fmt&quot;</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#tasks-dockerfile-__codelineno-52-5"></a><span class="w">    </span><span class="s">&quot;log&quot;</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#tasks-dockerfile-__codelineno-52-6"></a><span class="w">    </span><span class="s">&quot;net/http&quot;</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#tasks-dockerfile-__codelineno-52-7"></a><span class="p">)</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#tasks-dockerfile-__codelineno-52-8"></a>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#tasks-dockerfile-__codelineno-52-9"></a><span class="kd">func</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#tasks-dockerfile-__codelineno-52-10"></a><span class="w">    </span><span class="nx">fmt</span><span class="p">.</span><span class="nx">Fprintf</span><span class="p">(</span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello from Go multi-stage build!\n&quot;</span><span class="p">)</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#tasks-dockerfile-__codelineno-52-11"></a><span class="p">}</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#tasks-dockerfile-__codelineno-52-12"></a>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#tasks-dockerfile-__codelineno-52-13"></a><span class="kd">func</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#tasks-dockerfile-__codelineno-52-14"></a><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">HandleFunc</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">)</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#tasks-dockerfile-__codelineno-52-15"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Println</span><span class="p">(</span><span class="s">&quot;Server starting on :8080&quot;</span><span class="p">)</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#tasks-dockerfile-__codelineno-52-16"></a><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nx">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">ListenAndServe</span><span class="p">(</span><span class="s">&quot;:8080&quot;</span><span class="p">,</span><span class="w"> </span><span class="kc">nil</span><span class="p">))</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#tasks-dockerfile-__codelineno-52-17"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>go.mod</strong>
<div class="language-go highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#tasks-dockerfile-__codelineno-53-1"></a><span class="nx">module</span><span class="w"> </span><span class="nx">github</span><span class="p">.</span><span class="nx">com</span><span class="o">/</span><span class="nx">dockerlabs</span><span class="o">/</span><span class="k">go</span><span class="o">-</span><span class="nx">app</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#tasks-dockerfile-__codelineno-53-2"></a>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#tasks-dockerfile-__codelineno-53-3"></a><span class="k">go</span><span class="w"> </span><span class="mf">1.21</span>
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#tasks-dockerfile-__codelineno-54-1"></a><span class="c"># Build stage</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#tasks-dockerfile-__codelineno-54-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.21-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#tasks-dockerfile-__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#tasks-dockerfile-__codelineno-54-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#tasks-dockerfile-__codelineno-54-5"></a>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#tasks-dockerfile-__codelineno-54-6"></a><span class="c"># Copy go mod files</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#tasks-dockerfile-__codelineno-54-7"></a><span class="k">COPY</span><span class="w"> </span>go.mod<span class="w"> </span>go.sum<span class="w"> </span>./
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#tasks-dockerfile-__codelineno-54-8"></a>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#tasks-dockerfile-__codelineno-54-9"></a><span class="c"># Download dependencies</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#tasks-dockerfile-__codelineno-54-10"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>download
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#tasks-dockerfile-__codelineno-54-11"></a>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#tasks-dockerfile-__codelineno-54-12"></a><span class="c"># Copy source code</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#tasks-dockerfile-__codelineno-54-13"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#tasks-dockerfile-__codelineno-54-14"></a>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#tasks-dockerfile-__codelineno-54-15"></a><span class="c"># Build the application</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#tasks-dockerfile-__codelineno-54-16"></a><span class="k">RUN</span><span class="w"> </span><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">GOOS</span><span class="o">=</span>linux<span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-a<span class="w"> </span>-installsuffix<span class="w"> </span>cgo<span class="w"> </span>-o<span class="w"> </span>main<span class="w"> </span>.
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#tasks-dockerfile-__codelineno-54-17"></a>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#tasks-dockerfile-__codelineno-54-18"></a><span class="c"># Runtime stage</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#tasks-dockerfile-__codelineno-54-19"></a><span class="k">FROM</span><span class="w"> </span><span class="s">gcr.io/distroless/static-debian12</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#tasks-dockerfile-__codelineno-54-20"></a>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#tasks-dockerfile-__codelineno-54-21"></a><span class="c"># Copy binary from build stage</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#tasks-dockerfile-__codelineno-54-22"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/main<span class="w"> </span>/
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#tasks-dockerfile-__codelineno-54-23"></a>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#tasks-dockerfile-__codelineno-54-24"></a><span class="c"># Expose port</span>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25" href="#tasks-dockerfile-__codelineno-54-25"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26" href="#tasks-dockerfile-__codelineno-54-26"></a>
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27" href="#tasks-dockerfile-__codelineno-54-27"></a><span class="c"># Run the binary</span>
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28" href="#tasks-dockerfile-__codelineno-54-28"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/main&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#tasks-dockerfile-__codelineno-55-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>go-multi-stage<span class="w"> </span>.
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#tasks-dockerfile-__codelineno-55-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:8080<span class="w"> </span>--name<span class="w"> </span>go-app<span class="w"> </span>go-multi-stage
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#tasks-dockerfile-__codelineno-55-3"></a>curl<span class="w"> </span>http://localhost:8080
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Multi-stage optimization</strong>: Separate build and runtime environments</li>
<li><strong>Distroless images</strong>: Minimal images with no shell or package manager</li>
<li><strong>Static compilation</strong>: CGO_ENABLED=0 creates statically linked binaries</li>
<li><strong>Security</strong>: Smaller attack surface with minimal base images</li>
<li><strong>Go optimization</strong>: -a flag forces rebuild, -installsuffix cgo avoids caching issues</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-11-python-application-containerization">11. Python Application Containerization<a class="headerlink" href="#tasks-dockerfile-11-python-application-containerization" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Containerize a Python Flask application with proper dependency management and optimization.</p>
<h4 id="tasks-dockerfile-scenario_10"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_10" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re deploying a Python web application that needs to run consistently across development, testing, and production environments. </li>
<li>Proper containerization ensures that all dependencies are correctly managed and the application runs with the same configuration regardless of the host system.</li>
</ul>
<h4 id="tasks-dockerfile-resources_10"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_10" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>app.py</code>:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#tasks-dockerfile-__codelineno-56-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#tasks-dockerfile-__codelineno-56-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#tasks-dockerfile-__codelineno-56-3"></a>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#tasks-dockerfile-__codelineno-56-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#tasks-dockerfile-__codelineno-56-5"></a>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#tasks-dockerfile-__codelineno-56-6"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#tasks-dockerfile-__codelineno-56-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">():</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#tasks-dockerfile-__codelineno-56-8"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Hello from Python container! Version: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;APP_VERSION&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#tasks-dockerfile-__codelineno-56-9"></a>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#tasks-dockerfile-__codelineno-56-10"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#tasks-dockerfile-__codelineno-56-11"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)))</span>
</span></code></pre></div></li>
<li>Create <code>requirements.txt</code>:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#tasks-dockerfile-__codelineno-57-1"></a>Flask==3.0.0
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#tasks-dockerfile-__codelineno-57-2"></a>gunicorn==21.2.0
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use virtual environments, multi-stage builds, and proper Python packaging</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>app.py</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#tasks-dockerfile-__codelineno-58-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#tasks-dockerfile-__codelineno-58-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#tasks-dockerfile-__codelineno-58-3"></a>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#tasks-dockerfile-__codelineno-58-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#tasks-dockerfile-__codelineno-58-5"></a>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#tasks-dockerfile-__codelineno-58-6"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#tasks-dockerfile-__codelineno-58-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">():</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#tasks-dockerfile-__codelineno-58-8"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Hello from Python container! Version: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;APP_VERSION&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#tasks-dockerfile-__codelineno-58-9"></a>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#tasks-dockerfile-__codelineno-58-10"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#tasks-dockerfile-__codelineno-58-11"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">5000</span><span class="p">)))</span>
</span></code></pre></div></p>
<p><strong>requirements.txt</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#tasks-dockerfile-__codelineno-59-1"></a>Flask==3.0.0
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#tasks-dockerfile-__codelineno-59-2"></a>gunicorn==21.2.0
</span></code></pre></div></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#tasks-dockerfile-__codelineno-60-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#tasks-dockerfile-__codelineno-60-2"></a>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#tasks-dockerfile-__codelineno-60-3"></a><span class="c"># Set environment variables</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#tasks-dockerfile-__codelineno-60-4"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">PYTHONDONTWRITEBYTECODE</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#tasks-dockerfile-__codelineno-60-5"></a><span class="w">    </span><span class="nv">PYTHONUNBUFFERED</span><span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#tasks-dockerfile-__codelineno-60-6"></a><span class="w">    </span><span class="nv">APP_VERSION</span><span class="o">=</span><span class="m">1</span>.0.0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#tasks-dockerfile-__codelineno-60-7"></a><span class="w">    </span><span class="nv">PORT</span><span class="o">=</span><span class="m">5000</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#tasks-dockerfile-__codelineno-60-8"></a>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#tasks-dockerfile-__codelineno-60-9"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#tasks-dockerfile-__codelineno-60-10"></a>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#tasks-dockerfile-__codelineno-60-11"></a><span class="c"># Install system dependencies</span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#tasks-dockerfile-__codelineno-60-12"></a><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#tasks-dockerfile-__codelineno-60-13"></a><span class="w">    </span>gcc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#tasks-dockerfile-__codelineno-60-14"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#tasks-dockerfile-__codelineno-60-15"></a>
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#tasks-dockerfile-__codelineno-60-16"></a><span class="c"># Copy requirements and install Python dependencies</span>
</span><span id="__span-60-17"><a id="__codelineno-60-17" name="__codelineno-60-17" href="#tasks-dockerfile-__codelineno-60-17"></a><span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
</span><span id="__span-60-18"><a id="__codelineno-60-18" name="__codelineno-60-18" href="#tasks-dockerfile-__codelineno-60-18"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span><span id="__span-60-19"><a id="__codelineno-60-19" name="__codelineno-60-19" href="#tasks-dockerfile-__codelineno-60-19"></a>
</span><span id="__span-60-20"><a id="__codelineno-60-20" name="__codelineno-60-20" href="#tasks-dockerfile-__codelineno-60-20"></a><span class="c"># Copy application code</span>
</span><span id="__span-60-21"><a id="__codelineno-60-21" name="__codelineno-60-21" href="#tasks-dockerfile-__codelineno-60-21"></a><span class="k">COPY</span><span class="w"> </span>app.py<span class="w"> </span>.
</span><span id="__span-60-22"><a id="__codelineno-60-22" name="__codelineno-60-22" href="#tasks-dockerfile-__codelineno-60-22"></a>
</span><span id="__span-60-23"><a id="__codelineno-60-23" name="__codelineno-60-23" href="#tasks-dockerfile-__codelineno-60-23"></a><span class="c"># Create non-root user</span>
</span><span id="__span-60-24"><a id="__codelineno-60-24" name="__codelineno-60-24" href="#tasks-dockerfile-__codelineno-60-24"></a><span class="k">RUN</span><span class="w"> </span>useradd<span class="w"> </span>--create-home<span class="w"> </span>--shell<span class="w"> </span>/bin/bash<span class="w"> </span>app<span class="w"> </span><span class="se">\</span>
</span><span id="__span-60-25"><a id="__codelineno-60-25" name="__codelineno-60-25" href="#tasks-dockerfile-__codelineno-60-25"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>app:app<span class="w"> </span>/app
</span><span id="__span-60-26"><a id="__codelineno-60-26" name="__codelineno-60-26" href="#tasks-dockerfile-__codelineno-60-26"></a><span class="k">USER</span><span class="w"> </span><span class="s">app</span>
</span><span id="__span-60-27"><a id="__codelineno-60-27" name="__codelineno-60-27" href="#tasks-dockerfile-__codelineno-60-27"></a>
</span><span id="__span-60-28"><a id="__codelineno-60-28" name="__codelineno-60-28" href="#tasks-dockerfile-__codelineno-60-28"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">5000</span>
</span><span id="__span-60-29"><a id="__codelineno-60-29" name="__codelineno-60-29" href="#tasks-dockerfile-__codelineno-60-29"></a>
</span><span id="__span-60-30"><a id="__codelineno-60-30" name="__codelineno-60-30" href="#tasks-dockerfile-__codelineno-60-30"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;gunicorn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--bind&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;0.0.0.0:5000&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app:app&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build and run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#tasks-dockerfile-__codelineno-61-1"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>python-flask<span class="w"> </span>.
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#tasks-dockerfile-__codelineno-61-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">5000</span>:5000<span class="w"> </span>python-flask
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#tasks-dockerfile-__codelineno-61-3"></a>curl<span class="w"> </span>http://localhost:5000
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Python optimization</strong>: PYTHONDONTWRITEBYTECODE prevents .pyc files</li>
<li><strong>Dependency management</strong>: Separate requirements copying for better caching</li>
<li><strong>Gunicorn</strong>: Production WSGI server instead of development server</li>
<li><strong>System dependencies</strong>: Install build tools only when needed</li>
<li><strong>Non-root user</strong>: Security best practice for Python applications</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-12-image-layer-caching-optimization">12. Image Layer Caching Optimization<a class="headerlink" href="#tasks-dockerfile-12-image-layer-caching-optimization" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Optimize Dockerfile layer caching by ordering instructions properly and combining RUN commands.</p>
<h4 id="tasks-dockerfile-scenario_11"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_11" title="Permanent link">&para;</a></h4>
<ul>
<li>Your development team frequently rebuilds Docker images during development, and slow build times are impacting productivity. </li>
<li>Optimizing layer caching ensures that only changed parts of the application trigger rebuilds, significantly reducing build times and improving the development workflow.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Order COPY commands from least to most frequently changing, combine RUN commands, and use multi-stage builds</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Dockerfile (Optimized)</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#tasks-dockerfile-__codelineno-62-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:20.04</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#tasks-dockerfile-__codelineno-62-2"></a>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#tasks-dockerfile-__codelineno-62-3"></a><span class="c"># Update and install system packages in one layer</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#tasks-dockerfile-__codelineno-62-4"></a><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#tasks-dockerfile-__codelineno-62-5"></a><span class="w">    </span>curl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#tasks-dockerfile-__codelineno-62-6"></a><span class="w">    </span>wget<span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#tasks-dockerfile-__codelineno-62-7"></a><span class="w">    </span>git<span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#tasks-dockerfile-__codelineno-62-8"></a><span class="w">    </span>vim<span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#tasks-dockerfile-__codelineno-62-9"></a><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#tasks-dockerfile-__codelineno-62-10"></a>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#tasks-dockerfile-__codelineno-62-11"></a><span class="c"># Copy dependency files first (rarely change)</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#tasks-dockerfile-__codelineno-62-12"></a><span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>package.json<span class="w"> </span>./
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#tasks-dockerfile-__codelineno-62-13"></a>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#tasks-dockerfile-__codelineno-62-14"></a><span class="c"># Install dependencies (changes less frequently)</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#tasks-dockerfile-__codelineno-62-15"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16" href="#tasks-dockerfile-__codelineno-62-16"></a><span class="w">    </span>npm<span class="w"> </span>install
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17" href="#tasks-dockerfile-__codelineno-62-17"></a>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18" href="#tasks-dockerfile-__codelineno-62-18"></a><span class="c"># Copy application code (changes most frequently)</span>
</span><span id="__span-62-19"><a id="__codelineno-62-19" name="__codelineno-62-19" href="#tasks-dockerfile-__codelineno-62-19"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-62-20"><a id="__codelineno-62-20" name="__codelineno-62-20" href="#tasks-dockerfile-__codelineno-62-20"></a>
</span><span id="__span-62-21"><a id="__codelineno-62-21" name="__codelineno-62-21" href="#tasks-dockerfile-__codelineno-62-21"></a><span class="c"># Set permissions and create directories in one command</span>
</span><span id="__span-62-22"><a id="__codelineno-62-22" name="__codelineno-62-22" href="#tasks-dockerfile-__codelineno-62-22"></a><span class="k">RUN</span><span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>scripts/*<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-23"><a id="__codelineno-62-23" name="__codelineno-62-23" href="#tasks-dockerfile-__codelineno-62-23"></a><span class="w">    </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/app/logs<span class="w"> </span>/app/data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-24"><a id="__codelineno-62-24" name="__codelineno-62-24" href="#tasks-dockerfile-__codelineno-62-24"></a><span class="w">    </span>chown<span class="w"> </span>-R<span class="w"> </span>www-data:www-data<span class="w"> </span>/app
</span><span id="__span-62-25"><a id="__codelineno-62-25" name="__codelineno-62-25" href="#tasks-dockerfile-__codelineno-62-25"></a>
</span><span id="__span-62-26"><a id="__codelineno-62-26" name="__codelineno-62-26" href="#tasks-dockerfile-__codelineno-62-26"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-62-27"><a id="__codelineno-62-27" name="__codelineno-62-27" href="#tasks-dockerfile-__codelineno-62-27"></a>
</span><span id="__span-62-28"><a id="__codelineno-62-28" name="__codelineno-62-28" href="#tasks-dockerfile-__codelineno-62-28"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;./start.sh&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Dockerfile (Poor - for comparison)</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#tasks-dockerfile-__codelineno-63-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">ubuntu:20.04</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#tasks-dockerfile-__codelineno-63-2"></a>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#tasks-dockerfile-__codelineno-63-3"></a><span class="c"># Poor: Update in separate layer</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#tasks-dockerfile-__codelineno-63-4"></a><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#tasks-dockerfile-__codelineno-63-5"></a>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#tasks-dockerfile-__codelineno-63-6"></a><span class="c"># Poor: Install packages one by one</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#tasks-dockerfile-__codelineno-63-7"></a><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>curl
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#tasks-dockerfile-__codelineno-63-8"></a><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>wget
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#tasks-dockerfile-__codelineno-63-9"></a><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#tasks-dockerfile-__codelineno-63-10"></a>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#tasks-dockerfile-__codelineno-63-11"></a><span class="c"># Poor: Copy application code before dependencies</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#tasks-dockerfile-__codelineno-63-12"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-63-13"><a id="__codelineno-63-13" name="__codelineno-63-13" href="#tasks-dockerfile-__codelineno-63-13"></a>
</span><span id="__span-63-14"><a id="__codelineno-63-14" name="__codelineno-63-14" href="#tasks-dockerfile-__codelineno-63-14"></a><span class="c"># Poor: Install dependencies after copying code</span>
</span><span id="__span-63-15"><a id="__codelineno-63-15" name="__codelineno-63-15" href="#tasks-dockerfile-__codelineno-63-15"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span><span id="__span-63-16"><a id="__codelineno-63-16" name="__codelineno-63-16" href="#tasks-dockerfile-__codelineno-63-16"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>install
</span><span id="__span-63-17"><a id="__codelineno-63-17" name="__codelineno-63-17" href="#tasks-dockerfile-__codelineno-63-17"></a>
</span><span id="__span-63-18"><a id="__codelineno-63-18" name="__codelineno-63-18" href="#tasks-dockerfile-__codelineno-63-18"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-63-19"><a id="__codelineno-63-19" name="__codelineno-63-19" href="#tasks-dockerfile-__codelineno-63-19"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;./start.sh&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build comparison:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#tasks-dockerfile-__codelineno-64-1"></a><span class="c1"># Build optimized version</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#tasks-dockerfile-__codelineno-64-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.optimized<span class="w"> </span>-t<span class="w"> </span>optimized-image<span class="w"> </span>.
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#tasks-dockerfile-__codelineno-64-3"></a>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#tasks-dockerfile-__codelineno-64-4"></a><span class="c1"># Make small change to app code</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#tasks-dockerfile-__codelineno-64-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# comment&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>app.py
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#tasks-dockerfile-__codelineno-64-6"></a>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#tasks-dockerfile-__codelineno-64-7"></a><span class="c1"># Rebuild - notice how many layers are cached</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#tasks-dockerfile-__codelineno-64-8"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.optimized<span class="w"> </span>-t<span class="w"> </span>optimized-image<span class="w"> </span>.
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#tasks-dockerfile-__codelineno-64-9"></a>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#tasks-dockerfile-__codelineno-64-10"></a><span class="c1"># Compare with poor version</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#tasks-dockerfile-__codelineno-64-11"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.poor<span class="w"> </span>-t<span class="w"> </span>poor-image<span class="w"> </span>.
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#tasks-dockerfile-__codelineno-64-12"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# comment&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>app.py
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#tasks-dockerfile-__codelineno-64-13"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.poor<span class="w"> </span>-t<span class="w"> </span>poor-image<span class="w"> </span>.
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Layer ordering</strong>: Least changing instructions first (system packages, dependencies)</li>
<li><strong>RUN command combining</strong>: Single RUN for related operations to reduce layers</li>
<li><strong>Dependency copying</strong>: Copy requirements before code for better caching</li>
<li><strong>Cache invalidation</strong>: Changing code doesn&rsquo;t invalidate dependency layers</li>
<li><strong>Cleanup</strong>: Remove package manager cache to reduce image size</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-13-build-secrets-management">13. Build Secrets Management<a class="headerlink" href="#tasks-dockerfile-13-build-secrets-management" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Use BuildKit secrets to handle sensitive information during the build process without embedding them in the final image.</p>
<h4 id="tasks-dockerfile-scenario_12"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_12" title="Permanent link">&para;</a></h4>
<ul>
<li>Your build process requires access to sensitive information like API keys, database credentials, or authentication tokens for private repositories. </li>
<li>BuildKit secrets allow you to use these credentials during the build process without embedding them in the final image layers, maintaining security compliance.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>--secret</code> flag with BuildKit and <code>RUN --mount=type=secret</code> to access secrets during build</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#tasks-dockerfile-__codelineno-65-1"></a><span class="c"># syntax=docker/dockerfile:1</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#tasks-dockerfile-__codelineno-65-2"></a>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#tasks-dockerfile-__codelineno-65-3"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#tasks-dockerfile-__codelineno-65-4"></a>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#tasks-dockerfile-__codelineno-65-5"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#tasks-dockerfile-__codelineno-65-6"></a>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#tasks-dockerfile-__codelineno-65-7"></a><span class="c"># Copy package files</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#tasks-dockerfile-__codelineno-65-8"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#tasks-dockerfile-__codelineno-65-9"></a>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#tasks-dockerfile-__codelineno-65-10"></a><span class="c"># Install dependencies</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#tasks-dockerfile-__codelineno-65-11"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci<span class="w"> </span>--only<span class="o">=</span>production
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#tasks-dockerfile-__codelineno-65-12"></a>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#tasks-dockerfile-__codelineno-65-13"></a><span class="c"># Copy source</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#tasks-dockerfile-__codelineno-65-14"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#tasks-dockerfile-__codelineno-65-15"></a>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#tasks-dockerfile-__codelineno-65-16"></a><span class="c"># Use secret during build (e.g., for API keys, tokens)</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#tasks-dockerfile-__codelineno-65-17"></a><span class="k">RUN</span><span class="w"> </span>--mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>npm_token<span class="w"> </span><span class="se">\</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#tasks-dockerfile-__codelineno-65-18"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;//registry.npmjs.org/:_authToken=</span><span class="k">$(</span>cat<span class="w"> </span>/run/secrets/npm_token<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>~/.npmrc<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#tasks-dockerfile-__codelineno-65-19"></a><span class="w">    </span>npm<span class="w"> </span>publish
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#tasks-dockerfile-__codelineno-65-20"></a>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#tasks-dockerfile-__codelineno-65-21"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">runtime</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#tasks-dockerfile-__codelineno-65-22"></a>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#tasks-dockerfile-__codelineno-65-23"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#tasks-dockerfile-__codelineno-65-24"></a>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#tasks-dockerfile-__codelineno-65-25"></a><span class="c"># Copy from builder stage</span>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#tasks-dockerfile-__codelineno-65-26"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/node_modules<span class="w"> </span>./node_modules
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#tasks-dockerfile-__codelineno-65-27"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/package*.json<span class="w"> </span>./
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#tasks-dockerfile-__codelineno-65-28"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/src<span class="w"> </span>./src
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#tasks-dockerfile-__codelineno-65-29"></a>
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#tasks-dockerfile-__codelineno-65-30"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">3000</span>
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#tasks-dockerfile-__codelineno-65-31"></a>
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#tasks-dockerfile-__codelineno-65-32"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build with secrets:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#tasks-dockerfile-__codelineno-66-1"></a><span class="c1"># Create a secret file (never commit this)</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#tasks-dockerfile-__codelineno-66-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;your-npm-token-here&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>npm_token.txt
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#tasks-dockerfile-__codelineno-66-3"></a>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#tasks-dockerfile-__codelineno-66-4"></a><span class="c1"># Build with secret</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#tasks-dockerfile-__codelineno-66-5"></a><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#tasks-dockerfile-__codelineno-66-6"></a><span class="w">  </span>--secret<span class="w"> </span><span class="nv">id</span><span class="o">=</span>npm_token,src<span class="o">=</span>npm_token.txt<span class="w"> </span><span class="se">\</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#tasks-dockerfile-__codelineno-66-7"></a><span class="w">  </span>-t<span class="w"> </span>secret-build<span class="w"> </span>.
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#tasks-dockerfile-__codelineno-66-8"></a>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#tasks-dockerfile-__codelineno-66-9"></a><span class="c1"># Clean up</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#tasks-dockerfile-__codelineno-66-10"></a>rm<span class="w"> </span>npm_token.txt
</span></code></pre></div></p>
<p><strong>Alternative approach with environment variables:</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#tasks-dockerfile-__codelineno-67-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#tasks-dockerfile-__codelineno-67-2"></a>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#tasks-dockerfile-__codelineno-67-3"></a><span class="c"># Use ARG for build-time secrets (less secure)</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#tasks-dockerfile-__codelineno-67-4"></a><span class="k">ARG</span><span class="w"> </span>NPM_TOKEN
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#tasks-dockerfile-__codelineno-67-5"></a>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#tasks-dockerfile-__codelineno-67-6"></a><span class="k">RUN</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;//registry.npmjs.org/:_authToken=</span><span class="si">${</span><span class="nv">NPM_TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>~/.npmrc
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#tasks-dockerfile-__codelineno-67-7"></a>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#tasks-dockerfile-__codelineno-67-8"></a><span class="c"># Rest of the build...</span>
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>BuildKit secrets</strong>: Secure way to pass sensitive data during build</li>
<li><strong>&ndash;mount=type=secret</strong>: Mounts secret files into build container</li>
<li><strong>Runtime security</strong>: Secrets not embedded in final image layers</li>
<li><strong>Environment variables</strong>: Less secure alternative for build-time secrets</li>
<li><strong>Secret management</strong>: Proper handling of tokens, keys, and credentials</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-14-advanced-multi-stage-build-patterns">14. Advanced Multi-Stage Build Patterns<a class="headerlink" href="#tasks-dockerfile-14-advanced-multi-stage-build-patterns" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Implement advanced multi-stage build patterns including shared base stages and conditional builds.</p>
<h4 id="tasks-dockerfile-scenario_13"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_13" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re managing complex applications that need different configurations for development, testing, and production environments. </li>
<li>Advanced multi-stage patterns allow you to create optimized images for each environment while sharing common build steps, improving both build efficiency and maintainability.</li>
</ul>
<h4 id="tasks-dockerfile-resources_11"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_11" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>nginx.production.conf</code>:
  <div class="language-nginx highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#tasks-dockerfile-__codelineno-68-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#tasks-dockerfile-__codelineno-68-2"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#tasks-dockerfile-__codelineno-68-3"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#tasks-dockerfile-__codelineno-68-4"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#tasks-dockerfile-__codelineno-68-5"></a><span class="w">        </span><span class="kn">root</span><span class="w"> </span><span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#tasks-dockerfile-__codelineno-68-6"></a><span class="w">        </span><span class="kn">index</span><span class="w"> </span><span class="s">index.html</span><span class="p">;</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#tasks-dockerfile-__codelineno-68-7"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#tasks-dockerfile-__codelineno-68-8"></a><span class="w">            </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.html</span><span class="p">;</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#tasks-dockerfile-__codelineno-68-9"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#tasks-dockerfile-__codelineno-68-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#tasks-dockerfile-__codelineno-68-11"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Create <code>nginx.staging.conf</code>:
  <div class="language-nginx highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#tasks-dockerfile-__codelineno-69-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#tasks-dockerfile-__codelineno-69-2"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#tasks-dockerfile-__codelineno-69-3"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#tasks-dockerfile-__codelineno-69-4"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-69-5"><a id="__codelineno-69-5" name="__codelineno-69-5" href="#tasks-dockerfile-__codelineno-69-5"></a><span class="w">        </span><span class="kn">root</span><span class="w"> </span><span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span><span id="__span-69-6"><a id="__codelineno-69-6" name="__codelineno-69-6" href="#tasks-dockerfile-__codelineno-69-6"></a><span class="w">        </span><span class="kn">index</span><span class="w"> </span><span class="s">index.html</span><span class="p">;</span>
</span><span id="__span-69-7"><a id="__codelineno-69-7" name="__codelineno-69-7" href="#tasks-dockerfile-__codelineno-69-7"></a><span class="w">        </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Environment</span><span class="w"> </span><span class="s">staging</span><span class="p">;</span>
</span><span id="__span-69-8"><a id="__codelineno-69-8" name="__codelineno-69-8" href="#tasks-dockerfile-__codelineno-69-8"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-69-9"><a id="__codelineno-69-9" name="__codelineno-69-9" href="#tasks-dockerfile-__codelineno-69-9"></a><span class="w">            </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.html</span><span class="p">;</span>
</span><span id="__span-69-10"><a id="__codelineno-69-10" name="__codelineno-69-10" href="#tasks-dockerfile-__codelineno-69-10"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-69-11"><a id="__codelineno-69-11" name="__codelineno-69-11" href="#tasks-dockerfile-__codelineno-69-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-69-12"><a id="__codelineno-69-12" name="__codelineno-69-12" href="#tasks-dockerfile-__codelineno-69-12"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use shared base stages, target builds, and conditional logic with build arguments</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#tasks-dockerfile-__codelineno-70-1"></a><span class="c"># syntax=docker/dockerfile:1</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#tasks-dockerfile-__codelineno-70-2"></a>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#tasks-dockerfile-__codelineno-70-3"></a><span class="c"># Shared base stage</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#tasks-dockerfile-__codelineno-70-4"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">base</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#tasks-dockerfile-__codelineno-70-5"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#tasks-dockerfile-__codelineno-70-6"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#tasks-dockerfile-__codelineno-70-7"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#tasks-dockerfile-__codelineno-70-8"></a>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#tasks-dockerfile-__codelineno-70-9"></a><span class="c"># Development stage</span>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#tasks-dockerfile-__codelineno-70-10"></a><span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">development</span>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#tasks-dockerfile-__codelineno-70-11"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#tasks-dockerfile-__codelineno-70-12"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">3000</span>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#tasks-dockerfile-__codelineno-70-13"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;run&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dev&quot;</span><span class="p">]</span>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#tasks-dockerfile-__codelineno-70-14"></a>
</span><span id="__span-70-15"><a id="__codelineno-70-15" name="__codelineno-70-15" href="#tasks-dockerfile-__codelineno-70-15"></a><span class="c"># Build stage</span>
</span><span id="__span-70-16"><a id="__codelineno-70-16" name="__codelineno-70-16" href="#tasks-dockerfile-__codelineno-70-16"></a><span class="k">FROM</span><span class="w"> </span><span class="s">base</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>
</span><span id="__span-70-17"><a id="__codelineno-70-17" name="__codelineno-70-17" href="#tasks-dockerfile-__codelineno-70-17"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-70-18"><a id="__codelineno-70-18" name="__codelineno-70-18" href="#tasks-dockerfile-__codelineno-70-18"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>build
</span><span id="__span-70-19"><a id="__codelineno-70-19" name="__codelineno-70-19" href="#tasks-dockerfile-__codelineno-70-19"></a>
</span><span id="__span-70-20"><a id="__codelineno-70-20" name="__codelineno-70-20" href="#tasks-dockerfile-__codelineno-70-20"></a><span class="c"># Test stage</span>
</span><span id="__span-70-21"><a id="__codelineno-70-21" name="__codelineno-70-21" href="#tasks-dockerfile-__codelineno-70-21"></a><span class="k">FROM</span><span class="w"> </span><span class="s">build</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">test</span>
</span><span id="__span-70-22"><a id="__codelineno-70-22" name="__codelineno-70-22" href="#tasks-dockerfile-__codelineno-70-22"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>test
</span><span id="__span-70-23"><a id="__codelineno-70-23" name="__codelineno-70-23" href="#tasks-dockerfile-__codelineno-70-23"></a>
</span><span id="__span-70-24"><a id="__codelineno-70-24" name="__codelineno-70-24" href="#tasks-dockerfile-__codelineno-70-24"></a><span class="c"># Production stage</span>
</span><span id="__span-70-25"><a id="__codelineno-70-25" name="__codelineno-70-25" href="#tasks-dockerfile-__codelineno-70-25"></a><span class="k">FROM</span><span class="w"> </span><span class="s">nginx:alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">production</span>
</span><span id="__span-70-26"><a id="__codelineno-70-26" name="__codelineno-70-26" href="#tasks-dockerfile-__codelineno-70-26"></a><span class="k">ARG</span><span class="w"> </span><span class="nv">BUILD_ENV</span><span class="o">=</span>production
</span><span id="__span-70-27"><a id="__codelineno-70-27" name="__codelineno-70-27" href="#tasks-dockerfile-__codelineno-70-27"></a>
</span><span id="__span-70-28"><a id="__codelineno-70-28" name="__codelineno-70-28" href="#tasks-dockerfile-__codelineno-70-28"></a><span class="c"># Copy built assets from build stage</span>
</span><span id="__span-70-29"><a id="__codelineno-70-29" name="__codelineno-70-29" href="#tasks-dockerfile-__codelineno-70-29"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>build<span class="w"> </span>/app/dist<span class="w"> </span>/usr/share/nginx/html
</span><span id="__span-70-30"><a id="__codelineno-70-30" name="__codelineno-70-30" href="#tasks-dockerfile-__codelineno-70-30"></a>
</span><span id="__span-70-31"><a id="__codelineno-70-31" name="__codelineno-70-31" href="#tasks-dockerfile-__codelineno-70-31"></a><span class="c"># Copy nginx config based on environment</span>
</span><span id="__span-70-32"><a id="__codelineno-70-32" name="__codelineno-70-32" href="#tasks-dockerfile-__codelineno-70-32"></a><span class="k">COPY</span><span class="w"> </span>nginx.<span class="si">${</span><span class="nv">BUILD_ENV</span><span class="si">}</span>.conf<span class="w"> </span>/etc/nginx/nginx.conf
</span><span id="__span-70-33"><a id="__codelineno-70-33" name="__codelineno-70-33" href="#tasks-dockerfile-__codelineno-70-33"></a>
</span><span id="__span-70-34"><a id="__codelineno-70-34" name="__codelineno-70-34" href="#tasks-dockerfile-__codelineno-70-34"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80</span>
</span><span id="__span-70-35"><a id="__codelineno-70-35" name="__codelineno-70-35" href="#tasks-dockerfile-__codelineno-70-35"></a>
</span><span id="__span-70-36"><a id="__codelineno-70-36" name="__codelineno-70-36" href="#tasks-dockerfile-__codelineno-70-36"></a><span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>3s<span class="w"> </span>--start-period<span class="o">=</span>5s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-70-37"><a id="__codelineno-70-37" name="__codelineno-70-37" href="#tasks-dockerfile-__codelineno-70-37"></a><span class="w">  </span>CMD<span class="w"> </span>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost/<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-70-38"><a id="__codelineno-70-38" name="__codelineno-70-38" href="#tasks-dockerfile-__codelineno-70-38"></a>
</span><span id="__span-70-39"><a id="__codelineno-70-39" name="__codelineno-70-39" href="#tasks-dockerfile-__codelineno-70-39"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;nginx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;daemon off;&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>nginx.production.conf</strong>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#tasks-dockerfile-__codelineno-71-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#tasks-dockerfile-__codelineno-71-2"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#tasks-dockerfile-__codelineno-71-3"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#tasks-dockerfile-__codelineno-71-4"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#tasks-dockerfile-__codelineno-71-5"></a><span class="w">        </span><span class="kn">root</span><span class="w"> </span><span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#tasks-dockerfile-__codelineno-71-6"></a><span class="w">        </span><span class="kn">index</span><span class="w"> </span><span class="s">index.html</span><span class="p">;</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#tasks-dockerfile-__codelineno-71-7"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#tasks-dockerfile-__codelineno-71-8"></a><span class="w">            </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.html</span><span class="p">;</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#tasks-dockerfile-__codelineno-71-9"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#tasks-dockerfile-__codelineno-71-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#tasks-dockerfile-__codelineno-71-11"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>nginx.staging.conf</strong>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#tasks-dockerfile-__codelineno-72-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#tasks-dockerfile-__codelineno-72-2"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#tasks-dockerfile-__codelineno-72-3"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#tasks-dockerfile-__codelineno-72-4"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#tasks-dockerfile-__codelineno-72-5"></a><span class="w">        </span><span class="kn">root</span><span class="w"> </span><span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#tasks-dockerfile-__codelineno-72-6"></a><span class="w">        </span><span class="kn">index</span><span class="w"> </span><span class="s">index.html</span><span class="p">;</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#tasks-dockerfile-__codelineno-72-7"></a><span class="w">        </span><span class="kn">add_header</span><span class="w"> </span><span class="s">X-Environment</span><span class="w"> </span><span class="s">staging</span><span class="p">;</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#tasks-dockerfile-__codelineno-72-8"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#tasks-dockerfile-__codelineno-72-9"></a><span class="w">            </span><span class="kn">try_files</span><span class="w"> </span><span class="nv">$uri</span><span class="w"> </span><span class="nv">$uri/</span><span class="w"> </span><span class="s">/index.html</span><span class="p">;</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#tasks-dockerfile-__codelineno-72-10"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#tasks-dockerfile-__codelineno-72-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#tasks-dockerfile-__codelineno-72-12"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Build different targets:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#tasks-dockerfile-__codelineno-73-1"></a><span class="c1"># Build for development</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#tasks-dockerfile-__codelineno-73-2"></a>docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>development<span class="w"> </span>-t<span class="w"> </span>myapp:dev<span class="w"> </span>.
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#tasks-dockerfile-__codelineno-73-3"></a>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#tasks-dockerfile-__codelineno-73-4"></a><span class="c1"># Build for production</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#tasks-dockerfile-__codelineno-73-5"></a>docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span>production<span class="w"> </span>-t<span class="w"> </span>myapp:prod<span class="w"> </span>.
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#tasks-dockerfile-__codelineno-73-6"></a>
</span><span id="__span-73-7"><a id="__codelineno-73-7" name="__codelineno-73-7" href="#tasks-dockerfile-__codelineno-73-7"></a><span class="c1"># Build for staging</span>
</span><span id="__span-73-8"><a id="__codelineno-73-8" name="__codelineno-73-8" href="#tasks-dockerfile-__codelineno-73-8"></a>docker<span class="w"> </span>build<span class="w"> </span>--build-arg<span class="w"> </span><span class="nv">BUILD_ENV</span><span class="o">=</span>staging<span class="w"> </span>--target<span class="w"> </span>production<span class="w"> </span>-t<span class="w"> </span>myapp:staging<span class="w"> </span>.
</span><span id="__span-73-9"><a id="__codelineno-73-9" name="__codelineno-73-9" href="#tasks-dockerfile-__codelineno-73-9"></a>
</span><span id="__span-73-10"><a id="__codelineno-73-10" name="__codelineno-73-10" href="#tasks-dockerfile-__codelineno-73-10"></a><span class="c1"># Run tests</span>
</span><span id="__span-73-11"><a id="__codelineno-73-11" name="__codelineno-73-11" href="#tasks-dockerfile-__codelineno-73-11"></a>docker<span class="w"> </span>build<span class="w"> </span>--target<span class="w"> </span><span class="nb">test</span><span class="w"> </span>-t<span class="w"> </span>myapp:test<span class="w"> </span>.
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Shared base stages</strong>: Common setup shared across multiple targets</li>
<li><strong>Target builds</strong>: Build specific stages with &ndash;target flag</li>
<li><strong>Conditional configuration</strong>: Build args to customize builds</li>
<li><strong>Development workflow</strong>: Separate dev, test, and production stages</li>
<li><strong>Multi-environment</strong>: Different configurations for staging/production</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-15-dockerfile-security-best-practices">15. Dockerfile Security Best Practices<a class="headerlink" href="#tasks-dockerfile-15-dockerfile-security-best-practices" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Implement security best practices in a Dockerfile including non-root users, minimal attack surface, and proper secret handling.</p>
<h4 id="tasks-dockerfile-scenario_14"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_14" title="Permanent link">&para;</a></h4>
<ul>
<li>Your organization requires container images to meet strict security standards for production deployment. </li>
<li>Implementing security best practices ensures that your containers minimize vulnerabilities, follow the principle of least privilege, and protect sensitive information throughout the build and runtime lifecycle.</li>
</ul>
<h4 id="tasks-dockerfile-resources_12"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_12" title="Permanent link">&para;</a></h4>
<ul>
<li>Create <code>app.py</code>:
  <div class="language-python highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#tasks-dockerfile-__codelineno-74-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#tasks-dockerfile-__codelineno-74-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#tasks-dockerfile-__codelineno-74-3"></a>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#tasks-dockerfile-__codelineno-74-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#tasks-dockerfile-__codelineno-74-5"></a>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#tasks-dockerfile-__codelineno-74-6"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#tasks-dockerfile-__codelineno-74-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">():</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#tasks-dockerfile-__codelineno-74-8"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Running as user: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#tasks-dockerfile-__codelineno-74-9"></a>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#tasks-dockerfile-__codelineno-74-10"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/health&#39;</span><span class="p">)</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#tasks-dockerfile-__codelineno-74-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">health</span><span class="p">():</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#tasks-dockerfile-__codelineno-74-12"></a>    <span class="k">return</span> <span class="s1">&#39;OK&#39;</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#tasks-dockerfile-__codelineno-74-13"></a>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#tasks-dockerfile-__codelineno-74-14"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#tasks-dockerfile-__codelineno-74-15"></a>    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#tasks-dockerfile-__codelineno-74-16"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</span></code></pre></div></li>
<li>Create <code>requirements.txt</code>:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#tasks-dockerfile-__codelineno-75-1"></a>Flask==3.0.0
</span></code></pre></div></li>
<li>Create <code>Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use non-root users, minimal base images, update packages, avoid secrets in images, and implement proper file permissions</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#tasks-dockerfile-__codelineno-76-1"></a><span class="c"># syntax=docker/dockerfile:1</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#tasks-dockerfile-__codelineno-76-2"></a>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#tasks-dockerfile-__codelineno-76-3"></a><span class="c"># Use specific, minimal base image</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#tasks-dockerfile-__codelineno-76-4"></a><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#tasks-dockerfile-__codelineno-76-5"></a>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#tasks-dockerfile-__codelineno-76-6"></a><span class="c"># Update packages and install security updates</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#tasks-dockerfile-__codelineno-76-7"></a><span class="k">RUN</span><span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>upgrade<span class="w"> </span>-y<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#tasks-dockerfile-__codelineno-76-8"></a><span class="w">    </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--no-install-recommends<span class="w"> </span><span class="se">\</span>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#tasks-dockerfile-__codelineno-76-9"></a><span class="w">        </span>curl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#tasks-dockerfile-__codelineno-76-10"></a><span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/apt/lists/*<span class="w"> </span><span class="se">\</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#tasks-dockerfile-__codelineno-76-11"></a><span class="w">        </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt-get<span class="w"> </span>clean
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#tasks-dockerfile-__codelineno-76-12"></a>
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#tasks-dockerfile-__codelineno-76-13"></a><span class="c"># Create non-root user early</span>
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#tasks-dockerfile-__codelineno-76-14"></a><span class="k">RUN</span><span class="w"> </span>groupadd<span class="w"> </span>-r<span class="w"> </span>appuser<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>useradd<span class="w"> </span>-r<span class="w"> </span>-g<span class="w"> </span>appuser<span class="w"> </span>appuser
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#tasks-dockerfile-__codelineno-76-15"></a>
</span><span id="__span-76-16"><a id="__codelineno-76-16" name="__codelineno-76-16" href="#tasks-dockerfile-__codelineno-76-16"></a><span class="c"># Set working directory with proper permissions</span>
</span><span id="__span-76-17"><a id="__codelineno-76-17" name="__codelineno-76-17" href="#tasks-dockerfile-__codelineno-76-17"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-76-18"><a id="__codelineno-76-18" name="__codelineno-76-18" href="#tasks-dockerfile-__codelineno-76-18"></a><span class="k">RUN</span><span class="w"> </span>chown<span class="w"> </span>appuser:appuser<span class="w"> </span>/app
</span><span id="__span-76-19"><a id="__codelineno-76-19" name="__codelineno-76-19" href="#tasks-dockerfile-__codelineno-76-19"></a>
</span><span id="__span-76-20"><a id="__codelineno-76-20" name="__codelineno-76-20" href="#tasks-dockerfile-__codelineno-76-20"></a><span class="c"># Copy only necessary files</span>
</span><span id="__span-76-21"><a id="__codelineno-76-21" name="__codelineno-76-21" href="#tasks-dockerfile-__codelineno-76-21"></a><span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span>appuser:appuser<span class="w"> </span>requirements.txt<span class="w"> </span>.
</span><span id="__span-76-22"><a id="__codelineno-76-22" name="__codelineno-76-22" href="#tasks-dockerfile-__codelineno-76-22"></a>
</span><span id="__span-76-23"><a id="__codelineno-76-23" name="__codelineno-76-23" href="#tasks-dockerfile-__codelineno-76-23"></a><span class="c"># Install dependencies as root, then switch user</span>
</span><span id="__span-76-24"><a id="__codelineno-76-24" name="__codelineno-76-24" href="#tasks-dockerfile-__codelineno-76-24"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>--upgrade<span class="w"> </span>pip<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-76-25"><a id="__codelineno-76-25" name="__codelineno-76-25" href="#tasks-dockerfile-__codelineno-76-25"></a><span class="w">    </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span><span id="__span-76-26"><a id="__codelineno-76-26" name="__codelineno-76-26" href="#tasks-dockerfile-__codelineno-76-26"></a>
</span><span id="__span-76-27"><a id="__codelineno-76-27" name="__codelineno-76-27" href="#tasks-dockerfile-__codelineno-76-27"></a><span class="c"># Copy application code with correct ownership</span>
</span><span id="__span-76-28"><a id="__codelineno-76-28" name="__codelineno-76-28" href="#tasks-dockerfile-__codelineno-76-28"></a><span class="k">COPY</span><span class="w"> </span>--chown<span class="o">=</span>appuser:appuser<span class="w"> </span>app.py<span class="w"> </span>.
</span><span id="__span-76-29"><a id="__codelineno-76-29" name="__codelineno-76-29" href="#tasks-dockerfile-__codelineno-76-29"></a>
</span><span id="__span-76-30"><a id="__codelineno-76-30" name="__codelineno-76-30" href="#tasks-dockerfile-__codelineno-76-30"></a><span class="c"># Switch to non-root user</span>
</span><span id="__span-76-31"><a id="__codelineno-76-31" name="__codelineno-76-31" href="#tasks-dockerfile-__codelineno-76-31"></a><span class="k">USER</span><span class="w"> </span><span class="s">appuser</span>
</span><span id="__span-76-32"><a id="__codelineno-76-32" name="__codelineno-76-32" href="#tasks-dockerfile-__codelineno-76-32"></a>
</span><span id="__span-76-33"><a id="__codelineno-76-33" name="__codelineno-76-33" href="#tasks-dockerfile-__codelineno-76-33"></a><span class="c"># Don&#39;t run as root</span>
</span><span id="__span-76-34"><a id="__codelineno-76-34" name="__codelineno-76-34" href="#tasks-dockerfile-__codelineno-76-34"></a><span class="c"># Don&#39;t expose sensitive ports unnecessarily</span>
</span><span id="__span-76-35"><a id="__codelineno-76-35" name="__codelineno-76-35" href="#tasks-dockerfile-__codelineno-76-35"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>
</span><span id="__span-76-36"><a id="__codelineno-76-36" name="__codelineno-76-36" href="#tasks-dockerfile-__codelineno-76-36"></a>
</span><span id="__span-76-37"><a id="__codelineno-76-37" name="__codelineno-76-37" href="#tasks-dockerfile-__codelineno-76-37"></a><span class="c"># Health check</span>
</span><span id="__span-76-38"><a id="__codelineno-76-38" name="__codelineno-76-38" href="#tasks-dockerfile-__codelineno-76-38"></a><span class="k">HEALTHCHECK</span><span class="w"> </span>--interval<span class="o">=</span>30s<span class="w"> </span>--timeout<span class="o">=</span>10s<span class="w"> </span>--start-period<span class="o">=</span>5s<span class="w"> </span>--retries<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-76-39"><a id="__codelineno-76-39" name="__codelineno-76-39" href="#tasks-dockerfile-__codelineno-76-39"></a><span class="w">    </span>CMD<span class="w"> </span>curl<span class="w"> </span>-f<span class="w"> </span>http://localhost:8000/health<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">1</span>
</span><span id="__span-76-40"><a id="__codelineno-76-40" name="__codelineno-76-40" href="#tasks-dockerfile-__codelineno-76-40"></a>
</span><span id="__span-76-41"><a id="__codelineno-76-41" name="__codelineno-76-41" href="#tasks-dockerfile-__codelineno-76-41"></a><span class="c"># Use exec form of CMD</span>
</span><span id="__span-76-42"><a id="__codelineno-76-42" name="__codelineno-76-42" href="#tasks-dockerfile-__codelineno-76-42"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.py&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>app.py</strong>
<div class="language-python highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#tasks-dockerfile-__codelineno-77-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#tasks-dockerfile-__codelineno-77-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#tasks-dockerfile-__codelineno-77-3"></a>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#tasks-dockerfile-__codelineno-77-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#tasks-dockerfile-__codelineno-77-5"></a>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#tasks-dockerfile-__codelineno-77-6"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#tasks-dockerfile-__codelineno-77-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">():</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#tasks-dockerfile-__codelineno-77-8"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;Running as user: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">()</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#tasks-dockerfile-__codelineno-77-9"></a>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#tasks-dockerfile-__codelineno-77-10"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/health&#39;</span><span class="p">)</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#tasks-dockerfile-__codelineno-77-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">health</span><span class="p">():</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#tasks-dockerfile-__codelineno-77-12"></a>    <span class="k">return</span> <span class="s1">&#39;OK&#39;</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#tasks-dockerfile-__codelineno-77-13"></a>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#tasks-dockerfile-__codelineno-77-14"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#tasks-dockerfile-__codelineno-77-15"></a>    <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s1">&#39;PORT&#39;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#tasks-dockerfile-__codelineno-77-16"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>requirements.txt</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#tasks-dockerfile-__codelineno-78-1"></a>Flask==3.0.0
</span></code></pre></div></p>
<p><strong>Security scanning:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#tasks-dockerfile-__codelineno-79-1"></a><span class="c1"># Build the secure image</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#tasks-dockerfile-__codelineno-79-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>secure-app<span class="w"> </span>.
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#tasks-dockerfile-__codelineno-79-3"></a>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#tasks-dockerfile-__codelineno-79-4"></a><span class="c1"># Scan for vulnerabilities (requires security scanner)</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#tasks-dockerfile-__codelineno-79-5"></a><span class="c1"># docker scan secure-app</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#tasks-dockerfile-__codelineno-79-6"></a>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#tasks-dockerfile-__codelineno-79-7"></a><span class="c1"># Run security checks</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#tasks-dockerfile-__codelineno-79-8"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>secure-app<span class="w"> </span>whoami
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#tasks-dockerfile-__codelineno-79-9"></a>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>secure-app<span class="w"> </span>id
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Non-root user</strong>: Application runs with limited privileges</li>
<li><strong>Minimal base images</strong>: Smaller attack surface</li>
<li><strong>Package updates</strong>: Install security patches</li>
<li><strong>File permissions</strong>: Proper ownership and access controls</li>
<li><strong>No secrets in image</strong>: Sensitive data not embedded in layers</li>
<li><strong>Health checks</strong>: Monitor container health and security</li>
<li><strong>Exec form CMD</strong>: Proper signal handling</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-16-buildkit-advanced-features">16. BuildKit Advanced Features<a class="headerlink" href="#tasks-dockerfile-16-buildkit-advanced-features" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Utilize advanced BuildKit features including mounts, cache mounts, and SSH forwarding for improved build performance and capabilities.</p>
<h4 id="tasks-dockerfile-scenario_15"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_15" title="Permanent link">&para;</a></h4>
<ul>
<li>Your build process involves downloading large dependencies, accessing private repositories, and requires optimal caching for faster CI/CD pipelines. </li>
<li>BuildKit advanced features provide sophisticated caching mechanisms and secure access methods that significantly improve build performance and reliability.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>--mount=type=cache</code>, <code>--mount=type=ssh</code>, and other BuildKit mount types</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#tasks-dockerfile-__codelineno-80-1"></a><span class="c"># syntax=docker/dockerfile:1</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#tasks-dockerfile-__codelineno-80-2"></a>
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#tasks-dockerfile-__codelineno-80-3"></a><span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.21-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#tasks-dockerfile-__codelineno-80-4"></a>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#tasks-dockerfile-__codelineno-80-5"></a><span class="c"># Enable BuildKit</span>
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#tasks-dockerfile-__codelineno-80-6"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#tasks-dockerfile-__codelineno-80-7"></a>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#tasks-dockerfile-__codelineno-80-8"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#tasks-dockerfile-__codelineno-80-9"></a>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#tasks-dockerfile-__codelineno-80-10"></a><span class="c"># Copy go mod files</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#tasks-dockerfile-__codelineno-80-11"></a><span class="k">COPY</span><span class="w"> </span>go.mod<span class="w"> </span>go.sum<span class="w"> </span>./
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#tasks-dockerfile-__codelineno-80-12"></a>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#tasks-dockerfile-__codelineno-80-13"></a><span class="c"># Cache mount for Go modules</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#tasks-dockerfile-__codelineno-80-14"></a><span class="k">RUN</span><span class="w"> </span>--mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>cache,target<span class="o">=</span>/go/pkg/mod<span class="w"> </span><span class="se">\</span>
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#tasks-dockerfile-__codelineno-80-15"></a><span class="w">    </span>go<span class="w"> </span>mod<span class="w"> </span>download
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#tasks-dockerfile-__codelineno-80-16"></a>
</span><span id="__span-80-17"><a id="__codelineno-80-17" name="__codelineno-80-17" href="#tasks-dockerfile-__codelineno-80-17"></a><span class="c"># Copy source</span>
</span><span id="__span-80-18"><a id="__codelineno-80-18" name="__codelineno-80-18" href="#tasks-dockerfile-__codelineno-80-18"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-80-19"><a id="__codelineno-80-19" name="__codelineno-80-19" href="#tasks-dockerfile-__codelineno-80-19"></a>
</span><span id="__span-80-20"><a id="__codelineno-80-20" name="__codelineno-80-20" href="#tasks-dockerfile-__codelineno-80-20"></a><span class="c"># Cache mount for Go build cache</span>
</span><span id="__span-80-21"><a id="__codelineno-80-21" name="__codelineno-80-21" href="#tasks-dockerfile-__codelineno-80-21"></a><span class="k">RUN</span><span class="w"> </span>--mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>cache,target<span class="o">=</span>/root/.cache/go-build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-80-22"><a id="__codelineno-80-22" name="__codelineno-80-22" href="#tasks-dockerfile-__codelineno-80-22"></a><span class="w">    </span><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">GOOS</span><span class="o">=</span>linux<span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-o<span class="w"> </span>main<span class="w"> </span>.
</span><span id="__span-80-23"><a id="__codelineno-80-23" name="__codelineno-80-23" href="#tasks-dockerfile-__codelineno-80-23"></a>
</span><span id="__span-80-24"><a id="__codelineno-80-24" name="__codelineno-80-24" href="#tasks-dockerfile-__codelineno-80-24"></a><span class="k">FROM</span><span class="w"> </span><span class="s">alpine:latest</span>
</span><span id="__span-80-25"><a id="__codelineno-80-25" name="__codelineno-80-25" href="#tasks-dockerfile-__codelineno-80-25"></a>
</span><span id="__span-80-26"><a id="__codelineno-80-26" name="__codelineno-80-26" href="#tasks-dockerfile-__codelineno-80-26"></a><span class="c"># Install ca-certificates for HTTPS</span>
</span><span id="__span-80-27"><a id="__codelineno-80-27" name="__codelineno-80-27" href="#tasks-dockerfile-__codelineno-80-27"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>--no-cache<span class="w"> </span>add<span class="w"> </span>ca-certificates
</span><span id="__span-80-28"><a id="__codelineno-80-28" name="__codelineno-80-28" href="#tasks-dockerfile-__codelineno-80-28"></a>
</span><span id="__span-80-29"><a id="__codelineno-80-29" name="__codelineno-80-29" href="#tasks-dockerfile-__codelineno-80-29"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/root/</span>
</span><span id="__span-80-30"><a id="__codelineno-80-30" name="__codelineno-80-30" href="#tasks-dockerfile-__codelineno-80-30"></a>
</span><span id="__span-80-31"><a id="__codelineno-80-31" name="__codelineno-80-31" href="#tasks-dockerfile-__codelineno-80-31"></a><span class="c"># Copy binary</span>
</span><span id="__span-80-32"><a id="__codelineno-80-32" name="__codelineno-80-32" href="#tasks-dockerfile-__codelineno-80-32"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/main<span class="w"> </span>.
</span><span id="__span-80-33"><a id="__codelineno-80-33" name="__codelineno-80-33" href="#tasks-dockerfile-__codelineno-80-33"></a>
</span><span id="__span-80-34"><a id="__codelineno-80-34" name="__codelineno-80-34" href="#tasks-dockerfile-__codelineno-80-34"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-80-35"><a id="__codelineno-80-35" name="__codelineno-80-35" href="#tasks-dockerfile-__codelineno-80-35"></a>
</span><span id="__span-80-36"><a id="__codelineno-80-36" name="__codelineno-80-36" href="#tasks-dockerfile-__codelineno-80-36"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;./main&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Advanced Dockerfile with SSH:</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#tasks-dockerfile-__codelineno-81-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#tasks-dockerfile-__codelineno-81-2"></a>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#tasks-dockerfile-__codelineno-81-3"></a><span class="k">RUN</span><span class="w"> </span>apk<span class="w"> </span>add<span class="w"> </span>--no-cache<span class="w"> </span>openssh-client<span class="w"> </span>git
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#tasks-dockerfile-__codelineno-81-4"></a>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#tasks-dockerfile-__codelineno-81-5"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#tasks-dockerfile-__codelineno-81-6"></a>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#tasks-dockerfile-__codelineno-81-7"></a><span class="c"># SSH mount for private repositories</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#tasks-dockerfile-__codelineno-81-8"></a><span class="k">RUN</span><span class="w"> </span>--mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>ssh<span class="w"> </span><span class="se">\</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#tasks-dockerfile-__codelineno-81-9"></a><span class="w">    </span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:private/repo.git<span class="w"> </span>.
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#tasks-dockerfile-__codelineno-81-10"></a>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#tasks-dockerfile-__codelineno-81-11"></a><span class="c"># Cache mount for npm</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#tasks-dockerfile-__codelineno-81-12"></a><span class="k">RUN</span><span class="w"> </span>--mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>cache,target<span class="o">=</span>/root/.npm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#tasks-dockerfile-__codelineno-81-13"></a><span class="w">    </span>npm<span class="w"> </span>install
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#tasks-dockerfile-__codelineno-81-14"></a>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#tasks-dockerfile-__codelineno-81-15"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#tasks-dockerfile-__codelineno-81-16"></a>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#tasks-dockerfile-__codelineno-81-17"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Build with BuildKit:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#tasks-dockerfile-__codelineno-82-1"></a><span class="c1"># Enable BuildKit</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#tasks-dockerfile-__codelineno-82-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#tasks-dockerfile-__codelineno-82-3"></a>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#tasks-dockerfile-__codelineno-82-4"></a><span class="c1"># Build with cache mounts</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#tasks-dockerfile-__codelineno-82-5"></a>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>buildkit-demo<span class="w"> </span>.
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#tasks-dockerfile-__codelineno-82-6"></a>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#tasks-dockerfile-__codelineno-82-7"></a><span class="c1"># Build with SSH access</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#tasks-dockerfile-__codelineno-82-8"></a>docker<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#tasks-dockerfile-__codelineno-82-9"></a><span class="w">  </span>--ssh<span class="w"> </span>default<span class="w"> </span><span class="se">\</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#tasks-dockerfile-__codelineno-82-10"></a><span class="w">  </span>-t<span class="w"> </span>ssh-build<span class="w"> </span>.
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#tasks-dockerfile-__codelineno-82-11"></a>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#tasks-dockerfile-__codelineno-82-12"></a><span class="c1"># Use build secrets</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#tasks-dockerfile-__codelineno-82-13"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;secret-token&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#tasks-dockerfile-__codelineno-82-14"></a><span class="w">  </span>--secret<span class="w"> </span><span class="nv">id</span><span class="o">=</span>mysecret<span class="w"> </span><span class="se">\</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#tasks-dockerfile-__codelineno-82-15"></a><span class="w">  </span>-t<span class="w"> </span>secret-build<span class="w"> </span>.
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Cache mounts</strong>: Persistent cache between builds for faster subsequent builds</li>
<li><strong>SSH mounts</strong>: Access to private repositories during build</li>
<li><strong>Secret mounts</strong>: Secure handling of sensitive build-time data</li>
<li><strong>BuildKit</strong>: Modern build system with advanced features</li>
<li><strong>Performance</strong>: Faster builds through intelligent caching</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-17-image-size-optimization">17. Image Size Optimization<a class="headerlink" href="#tasks-dockerfile-17-image-size-optimization" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Optimize image size through various techniques including multi-stage builds, package cleanup, and efficient layer management.</p>
<h4 id="tasks-dockerfile-scenario_16"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_16" title="Permanent link">&para;</a></h4>
<ul>
<li>Your production environment has limited storage and network bandwidth, and you need to minimize deployment times and storage costs. </li>
<li>Image size optimization techniques reduce the attack surface, improve deployment speed, and lower infrastructure costs while maintaining full application functionality.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use multi-stage builds, remove unnecessary packages, combine RUN commands, and use smaller base images</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Dockerfile (Optimized)</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#tasks-dockerfile-__codelineno-83-1"></a><span class="c"># Build stage</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#tasks-dockerfile-__codelineno-83-2"></a><span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.21-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#tasks-dockerfile-__codelineno-83-3"></a>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#tasks-dockerfile-__codelineno-83-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#tasks-dockerfile-__codelineno-83-5"></a>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#tasks-dockerfile-__codelineno-83-6"></a><span class="c"># Copy go mod</span>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#tasks-dockerfile-__codelineno-83-7"></a><span class="k">COPY</span><span class="w"> </span>go.mod<span class="w"> </span>go.sum<span class="w"> </span>./
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#tasks-dockerfile-__codelineno-83-8"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>mod<span class="w"> </span>download
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#tasks-dockerfile-__codelineno-83-9"></a>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#tasks-dockerfile-__codelineno-83-10"></a><span class="c"># Copy source</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#tasks-dockerfile-__codelineno-83-11"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#tasks-dockerfile-__codelineno-83-12"></a>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#tasks-dockerfile-__codelineno-83-13"></a><span class="c"># Build static binary</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#tasks-dockerfile-__codelineno-83-14"></a><span class="k">RUN</span><span class="w"> </span><span class="nv">CGO_ENABLED</span><span class="o">=</span><span class="m">0</span><span class="w"> </span><span class="nv">GOOS</span><span class="o">=</span>linux<span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#tasks-dockerfile-__codelineno-83-15"></a><span class="w">    </span>-a<span class="w"> </span>-installsuffix<span class="w"> </span>cgo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#tasks-dockerfile-__codelineno-83-16"></a><span class="w">    </span>-ldflags<span class="w"> </span><span class="s1">&#39;-w -s&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#tasks-dockerfile-__codelineno-83-17"></a><span class="w">    </span>-o<span class="w"> </span>main<span class="w"> </span>.
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18" href="#tasks-dockerfile-__codelineno-83-18"></a>
</span><span id="__span-83-19"><a id="__codelineno-83-19" name="__codelineno-83-19" href="#tasks-dockerfile-__codelineno-83-19"></a><span class="c"># Strip binary</span>
</span><span id="__span-83-20"><a id="__codelineno-83-20" name="__codelineno-83-20" href="#tasks-dockerfile-__codelineno-83-20"></a><span class="k">RUN</span><span class="w"> </span>strip<span class="w"> </span>main
</span><span id="__span-83-21"><a id="__codelineno-83-21" name="__codelineno-83-21" href="#tasks-dockerfile-__codelineno-83-21"></a>
</span><span id="__span-83-22"><a id="__codelineno-83-22" name="__codelineno-83-22" href="#tasks-dockerfile-__codelineno-83-22"></a><span class="c"># Runtime stage - use scratch for minimal size</span>
</span><span id="__span-83-23"><a id="__codelineno-83-23" name="__codelineno-83-23" href="#tasks-dockerfile-__codelineno-83-23"></a><span class="k">FROM</span><span class="w"> </span><span class="s">scratch</span>
</span><span id="__span-83-24"><a id="__codelineno-83-24" name="__codelineno-83-24" href="#tasks-dockerfile-__codelineno-83-24"></a>
</span><span id="__span-83-25"><a id="__codelineno-83-25" name="__codelineno-83-25" href="#tasks-dockerfile-__codelineno-83-25"></a><span class="c"># Copy CA certificates for HTTPS</span>
</span><span id="__span-83-26"><a id="__codelineno-83-26" name="__codelineno-83-26" href="#tasks-dockerfile-__codelineno-83-26"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/etc/ssl/certs/ca-certificates.crt<span class="w"> </span>/etc/ssl/certs/
</span><span id="__span-83-27"><a id="__codelineno-83-27" name="__codelineno-83-27" href="#tasks-dockerfile-__codelineno-83-27"></a>
</span><span id="__span-83-28"><a id="__codelineno-83-28" name="__codelineno-83-28" href="#tasks-dockerfile-__codelineno-83-28"></a><span class="c"># Copy binary</span>
</span><span id="__span-83-29"><a id="__codelineno-83-29" name="__codelineno-83-29" href="#tasks-dockerfile-__codelineno-83-29"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/main<span class="w"> </span>/main
</span><span id="__span-83-30"><a id="__codelineno-83-30" name="__codelineno-83-30" href="#tasks-dockerfile-__codelineno-83-30"></a>
</span><span id="__span-83-31"><a id="__codelineno-83-31" name="__codelineno-83-31" href="#tasks-dockerfile-__codelineno-83-31"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8080</span>
</span><span id="__span-83-32"><a id="__codelineno-83-32" name="__codelineno-83-32" href="#tasks-dockerfile-__codelineno-83-32"></a>
</span><span id="__span-83-33"><a id="__codelineno-83-33" name="__codelineno-83-33" href="#tasks-dockerfile-__codelineno-83-33"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/main&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Compare with unoptimized:</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#tasks-dockerfile-__codelineno-84-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">golang:1.21-alpine</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#tasks-dockerfile-__codelineno-84-2"></a>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#tasks-dockerfile-__codelineno-84-3"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#tasks-dockerfile-__codelineno-84-4"></a>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#tasks-dockerfile-__codelineno-84-5"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#tasks-dockerfile-__codelineno-84-6"></a>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#tasks-dockerfile-__codelineno-84-7"></a><span class="k">RUN</span><span class="w"> </span>go<span class="w"> </span>build<span class="w"> </span>-o<span class="w"> </span>main<span class="w"> </span>.
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#tasks-dockerfile-__codelineno-84-8"></a>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#tasks-dockerfile-__codelineno-84-9"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;./main&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Size comparison:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#tasks-dockerfile-__codelineno-85-1"></a><span class="c1"># Build optimized version</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#tasks-dockerfile-__codelineno-85-2"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.optimized<span class="w"> </span>-t<span class="w"> </span>optimized-app<span class="w"> </span>.
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#tasks-dockerfile-__codelineno-85-3"></a>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#tasks-dockerfile-__codelineno-85-4"></a><span class="c1"># Build unoptimized version</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#tasks-dockerfile-__codelineno-85-5"></a>docker<span class="w"> </span>build<span class="w"> </span>-f<span class="w"> </span>Dockerfile.unoptimized<span class="w"> </span>-t<span class="w"> </span>unoptimized-app<span class="w"> </span>.
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#tasks-dockerfile-__codelineno-85-6"></a>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#tasks-dockerfile-__codelineno-85-7"></a><span class="c1"># Compare sizes</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#tasks-dockerfile-__codelineno-85-8"></a>docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;(optimized|unoptimized)&quot;</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#tasks-dockerfile-__codelineno-85-9"></a>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#tasks-dockerfile-__codelineno-85-10"></a><span class="c1"># Expected result: optimized image much smaller</span>
</span></code></pre></div></p>
<p><strong>Additional optimization techniques:</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#tasks-dockerfile-__codelineno-86-1"></a><span class="c"># Use .dockerignore</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#tasks-dockerfile-__codelineno-86-2"></a><span class="c"># Combine RUN commands</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#tasks-dockerfile-__codelineno-86-3"></a><span class="c"># Remove package manager cache</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#tasks-dockerfile-__codelineno-86-4"></a><span class="c"># Use smaller base images</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#tasks-dockerfile-__codelineno-86-5"></a><span class="c"># Strip binaries</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#tasks-dockerfile-__codelineno-86-6"></a><span class="c"># Use scratch base for static binaries</span>
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Multi-stage builds</strong>: Separate build and runtime environments</li>
<li><strong>Scratch base</strong>: Minimal possible image size for static binaries</li>
<li><strong>Binary stripping</strong>: Remove debug symbols to reduce size</li>
<li><strong>Package cleanup</strong>: Remove build dependencies from final image</li>
<li><strong>Layer optimization</strong>: Combine commands to reduce layer count</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockerfile-18-complex-application-stack">18. Complex Application Stack<a class="headerlink" href="#tasks-dockerfile-18-complex-application-stack" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a multi-service application stack with a web frontend, API backend, and database using Docker Compose and optimized Dockerfiles.</p>
<h4 id="tasks-dockerfile-scenario_17"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockerfile-scenario_17" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re developing a full-stack web application with multiple interconnected services that need to work together seamlessly. </li>
<li>Containerizing the entire stack ensures consistent deployment across development, testing, and production environments while maintaining service dependencies and network isolation.</li>
</ul>
<h4 id="tasks-dockerfile-resources_13"><strong>Resources:</strong><a class="headerlink" href="#tasks-dockerfile-resources_13" title="Permanent link">&para;</a></h4>
<ul>
<li>Create project structure:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#tasks-dockerfile-__codelineno-87-1"></a>complex-app/
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#tasks-dockerfile-__codelineno-87-2"></a>‚îú‚îÄ‚îÄ docker-compose.yml
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#tasks-dockerfile-__codelineno-87-3"></a>‚îú‚îÄ‚îÄ frontend/
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#tasks-dockerfile-__codelineno-87-4"></a>‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#tasks-dockerfile-__codelineno-87-5"></a>‚îÇ   ‚îú‚îÄ‚îÄ package.json
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#tasks-dockerfile-__codelineno-87-6"></a>‚îÇ   ‚îî‚îÄ‚îÄ src/
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#tasks-dockerfile-__codelineno-87-7"></a>‚îú‚îÄ‚îÄ backend/
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#tasks-dockerfile-__codelineno-87-8"></a>‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#tasks-dockerfile-__codelineno-87-9"></a>‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#tasks-dockerfile-__codelineno-87-10"></a>‚îÇ   ‚îî‚îÄ‚îÄ app.py
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#tasks-dockerfile-__codelineno-87-11"></a>‚îî‚îÄ‚îÄ database/
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#tasks-dockerfile-__codelineno-87-12"></a>    ‚îî‚îÄ‚îÄ init.sql
</span></code></pre></div></li>
<li>Create <code>docker-compose.yml</code> (see solution for content)</li>
<li>Create <code>frontend/Dockerfile</code> (see solution for content)</li>
<li>Create <code>backend/Dockerfile</code> (see solution for content)</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Create separate Dockerfiles for each service, use multi-stage builds, and coordinate with docker-compose.yml</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>Project structure:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#tasks-dockerfile-__codelineno-88-1"></a>complex-app/
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#tasks-dockerfile-__codelineno-88-2"></a>‚îú‚îÄ‚îÄ docker-compose.yml
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#tasks-dockerfile-__codelineno-88-3"></a>‚îú‚îÄ‚îÄ frontend/
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#tasks-dockerfile-__codelineno-88-4"></a>‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#tasks-dockerfile-__codelineno-88-5"></a>‚îÇ   ‚îú‚îÄ‚îÄ package.json
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#tasks-dockerfile-__codelineno-88-6"></a>‚îÇ   ‚îî‚îÄ‚îÄ src/
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#tasks-dockerfile-__codelineno-88-7"></a>‚îú‚îÄ‚îÄ backend/
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#tasks-dockerfile-__codelineno-88-8"></a>‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#tasks-dockerfile-__codelineno-88-9"></a>‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#tasks-dockerfile-__codelineno-88-10"></a>‚îÇ   ‚îî‚îÄ‚îÄ app.py
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#tasks-dockerfile-__codelineno-88-11"></a>‚îî‚îÄ‚îÄ database/
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#tasks-dockerfile-__codelineno-88-12"></a>    ‚îî‚îÄ‚îÄ init.sql
</span></code></pre></div></p>
<p><strong>frontend/Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#tasks-dockerfile-__codelineno-89-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">builder</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#tasks-dockerfile-__codelineno-89-2"></a>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#tasks-dockerfile-__codelineno-89-3"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#tasks-dockerfile-__codelineno-89-4"></a>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#tasks-dockerfile-__codelineno-89-5"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#tasks-dockerfile-__codelineno-89-6"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#tasks-dockerfile-__codelineno-89-7"></a>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#tasks-dockerfile-__codelineno-89-8"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#tasks-dockerfile-__codelineno-89-9"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>run<span class="w"> </span>build
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#tasks-dockerfile-__codelineno-89-10"></a>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#tasks-dockerfile-__codelineno-89-11"></a><span class="k">FROM</span><span class="w"> </span><span class="s">nginx:alpine</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#tasks-dockerfile-__codelineno-89-12"></a>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#tasks-dockerfile-__codelineno-89-13"></a><span class="k">COPY</span><span class="w"> </span>--from<span class="o">=</span>builder<span class="w"> </span>/app/dist<span class="w"> </span>/usr/share/nginx/html
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#tasks-dockerfile-__codelineno-89-14"></a>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15" href="#tasks-dockerfile-__codelineno-89-15"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80</span>
</span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16" href="#tasks-dockerfile-__codelineno-89-16"></a>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17" href="#tasks-dockerfile-__codelineno-89-17"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;nginx&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;-g&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;daemon off;&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>backend/Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#tasks-dockerfile-__codelineno-90-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.11-slim</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#tasks-dockerfile-__codelineno-90-2"></a>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#tasks-dockerfile-__codelineno-90-3"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#tasks-dockerfile-__codelineno-90-4"></a>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#tasks-dockerfile-__codelineno-90-5"></a><span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#tasks-dockerfile-__codelineno-90-6"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>--no-cache-dir<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#tasks-dockerfile-__codelineno-90-7"></a>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#tasks-dockerfile-__codelineno-90-8"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-90-9"><a id="__codelineno-90-9" name="__codelineno-90-9" href="#tasks-dockerfile-__codelineno-90-9"></a>
</span><span id="__span-90-10"><a id="__codelineno-90-10" name="__codelineno-90-10" href="#tasks-dockerfile-__codelineno-90-10"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>
</span><span id="__span-90-11"><a id="__codelineno-90-11" name="__codelineno-90-11" href="#tasks-dockerfile-__codelineno-90-11"></a>
</span><span id="__span-90-12"><a id="__codelineno-90-12" name="__codelineno-90-12" href="#tasks-dockerfile-__codelineno-90-12"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;uvicorn&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app:app&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--host&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;--port&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;8000&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#tasks-dockerfile-__codelineno-91-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#tasks-dockerfile-__codelineno-91-2"></a>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#tasks-dockerfile-__codelineno-91-3"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#tasks-dockerfile-__codelineno-91-4"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#tasks-dockerfile-__codelineno-91-5"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./frontend</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#tasks-dockerfile-__codelineno-91-6"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#tasks-dockerfile-__codelineno-91-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:80&quot;</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#tasks-dockerfile-__codelineno-91-8"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#tasks-dockerfile-__codelineno-91-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#tasks-dockerfile-__codelineno-91-10"></a>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#tasks-dockerfile-__codelineno-91-11"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#tasks-dockerfile-__codelineno-91-12"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./backend</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#tasks-dockerfile-__codelineno-91-13"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14" href="#tasks-dockerfile-__codelineno-91-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8000:8000&quot;</span>
</span><span id="__span-91-15"><a id="__codelineno-91-15" name="__codelineno-91-15" href="#tasks-dockerfile-__codelineno-91-15"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-91-16"><a id="__codelineno-91-16" name="__codelineno-91-16" href="#tasks-dockerfile-__codelineno-91-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=postgresql://user:pass@db:5432/app</span>
</span><span id="__span-91-17"><a id="__codelineno-91-17" name="__codelineno-91-17" href="#tasks-dockerfile-__codelineno-91-17"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-91-18"><a id="__codelineno-91-18" name="__codelineno-91-18" href="#tasks-dockerfile-__codelineno-91-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-91-19"><a id="__codelineno-91-19" name="__codelineno-91-19" href="#tasks-dockerfile-__codelineno-91-19"></a>
</span><span id="__span-91-20"><a id="__codelineno-91-20" name="__codelineno-91-20" href="#tasks-dockerfile-__codelineno-91-20"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-91-21"><a id="__codelineno-91-21" name="__codelineno-91-21" href="#tasks-dockerfile-__codelineno-91-21"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13</span>
</span><span id="__span-91-22"><a id="__codelineno-91-22" name="__codelineno-91-22" href="#tasks-dockerfile-__codelineno-91-22"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-91-23"><a id="__codelineno-91-23" name="__codelineno-91-23" href="#tasks-dockerfile-__codelineno-91-23"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app</span>
</span><span id="__span-91-24"><a id="__codelineno-91-24" name="__codelineno-91-24" href="#tasks-dockerfile-__codelineno-91-24"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-91-25"><a id="__codelineno-91-25" name="__codelineno-91-25" href="#tasks-dockerfile-__codelineno-91-25"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pass</span>
</span><span id="__span-91-26"><a id="__codelineno-91-26" name="__codelineno-91-26" href="#tasks-dockerfile-__codelineno-91-26"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-91-27"><a id="__codelineno-91-27" name="__codelineno-91-27" href="#tasks-dockerfile-__codelineno-91-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-91-28"><a id="__codelineno-91-28" name="__codelineno-91-28" href="#tasks-dockerfile-__codelineno-91-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./database/init.sql:/docker-entrypoint-initdb.d/init.sql</span>
</span><span id="__span-91-29"><a id="__codelineno-91-29" name="__codelineno-91-29" href="#tasks-dockerfile-__codelineno-91-29"></a>
</span><span id="__span-91-30"><a id="__codelineno-91-30" name="__codelineno-91-30" href="#tasks-dockerfile-__codelineno-91-30"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-91-31"><a id="__codelineno-91-31" name="__codelineno-91-31" href="#tasks-dockerfile-__codelineno-91-31"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Build and run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#tasks-dockerfile-__codelineno-92-1"></a><span class="c1"># Build all services</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#tasks-dockerfile-__codelineno-92-2"></a>docker-compose<span class="w"> </span>build
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#tasks-dockerfile-__codelineno-92-3"></a>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#tasks-dockerfile-__codelineno-92-4"></a><span class="c1"># Start the stack</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#tasks-dockerfile-__codelineno-92-5"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#tasks-dockerfile-__codelineno-92-6"></a>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#tasks-dockerfile-__codelineno-92-7"></a><span class="c1"># Check services</span>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#tasks-dockerfile-__codelineno-92-8"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#tasks-dockerfile-__codelineno-92-9"></a>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#tasks-dockerfile-__codelineno-92-10"></a><span class="c1"># Test the application</span>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#tasks-dockerfile-__codelineno-92-11"></a>curl<span class="w"> </span>http://localhost:3000
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#tasks-dockerfile-__codelineno-92-12"></a>curl<span class="w"> </span>http://localhost:8000
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Multi-service architecture</strong>: Separate concerns with microservices</li>
<li><strong>Service dependencies</strong>: Proper startup ordering with depends_on</li>
<li><strong>Optimized builds</strong>: Multi-stage for frontend, minimal for backend</li>
<li><strong>Environment configuration</strong>: Runtime configuration through environment variables</li>
<li><strong>Volume management</strong>: Persistent database storage</li>
<li><strong>Port mapping</strong>: Proper service exposure and communication</li>
</ul>
</details></section><section class="print-page" id="tasks-dockercompose" heading-number="2.5"><p><img alt="DockerLabs Banner" src="../assets/images/docker-logos.png" /></p>
<hr />
<h1 id="tasks-dockercompose-docker-compose-tasks">Docker Compose Tasks<a class="headerlink" href="#tasks-dockercompose-docker-compose-tasks" title="Permanent link">&para;</a></h1>
<ul>
<li>Hands-on Docker Compose exercises covering multi-container application orchestration, service configuration, networking, and deployment patterns.</li>
<li>Each task includes a clear scenario description, helpful hints, and detailed solutions with explanations.</li>
<li>Practice these tasks to master Docker Compose for complex application stacks and microservices architectures.</li>
</ul>
<hr />
<h4 id="tasks-dockercompose-table-of-contents">Table of Contents<a class="headerlink" href="#tasks-dockercompose-table-of-contents" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="#tasks-dockercompose-01-basic-docker-compose-setup">01. Basic Docker Compose Setup</a></li>
<li><a href="#tasks-dockercompose-02-multi-service-application">02. Multi-Service Application</a></li>
<li><a href="#tasks-dockercompose-03-environment-variables-and-configuration">03. Environment Variables and Configuration</a></li>
<li><a href="#tasks-dockercompose-04-volumes-and-data-persistence">04. Volumes and Data Persistence</a></li>
<li><a href="#tasks-dockercompose-05-networking-between-services">05. Networking Between Services</a></li>
<li><a href="#tasks-dockercompose-06-health-checks-and-dependencies">06. Health Checks and Dependencies</a></li>
<li><a href="#tasks-dockercompose-07-scaling-services">07. Scaling Services</a></li>
<li><a href="#tasks-dockercompose-08-build-configuration">08. Build Configuration</a></li>
<li><a href="#tasks-dockercompose-09-override-files">09. Override Files</a></li>
<li><a href="#tasks-dockercompose-10-secrets-management">10. Secrets Management</a></li>
<li><a href="#tasks-dockercompose-11-logging-configuration">11. Logging Configuration</a></li>
<li><a href="#tasks-dockercompose-12-resource-limits">12. Resource Limits</a></li>
<li><a href="#tasks-dockercompose-13-profiles-and-selective-services">13. Profiles and Selective Services</a></li>
<li><a href="#tasks-dockercompose-14-external-networks">14. External Networks</a></li>
<li><a href="#tasks-dockercompose-15-custom-networks">15. Custom Networks</a></li>
<li><a href="#tasks-dockercompose-16-load-balancing">16. Load Balancing</a></li>
<li><a href="#tasks-dockercompose-17-multi-stage-deployments">17. Multi-Stage Deployments</a></li>
<li><a href="#tasks-dockercompose-18-production-ready-stack">18. Production-Ready Stack</a></li>
<li><a href="#tasks-dockercompose-19-basic-yaml-anchors-and-references">19. Basic YAML Anchors and References</a></li>
<li><a href="#tasks-dockercompose-20-merging-service-configurations">20. Merging Service Configurations</a></li>
<li><a href="#tasks-dockercompose-21-using-includes-for-modular-compose-files">21. Using Includes for Modular Compose Files</a></li>
<li><a href="#tasks-dockercompose-22-environment-specific-fragments">22. Environment-Specific Fragments</a></li>
<li><a href="#tasks-dockercompose-23-complex-fragment-hierarchies">23. Complex Fragment Hierarchies</a></li>
<li><a href="#tasks-dockercompose-24-fragment-based-service-templates">24. Fragment-Based Service Templates</a></li>
</ul>
<hr />
<h4 id="tasks-dockercompose-01-basic-docker-compose-setup">01. Basic Docker Compose Setup<a class="headerlink" href="#tasks-dockercompose-01-basic-docker-compose-setup" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a simple docker-compose.yml file to run a single web service with port mapping and volume mounting.</p>
<h4 id="tasks-dockercompose-scenario"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario" title="Permanent link">&para;</a></h4>
<ul>
<li>As a developer, you need to quickly set up a development environment for a web application that requires consistent configuration across team members.</li>
<li>Docker Compose allows you to define and run multi-container applications with a single command, ensuring everyone uses the same setup.</li>
</ul>
<h4 id="tasks-dockercompose-resources">Resources:<a class="headerlink" href="#tasks-dockercompose-resources" title="Permanent link">&para;</a></h4>
<ul>
<li><code>index.html</code> ‚û§ <code>/usr/share/nginx/html</code>
    <div class="language-html highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#tasks-dockercompose-__codelineno-0-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#tasks-dockercompose-__codelineno-0-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#tasks-dockercompose-__codelineno-0-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#tasks-dockercompose-__codelineno-0-4"></a>    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Docker Compose App<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#tasks-dockercompose-__codelineno-0-5"></a><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#tasks-dockercompose-__codelineno-0-6"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#tasks-dockercompose-__codelineno-0-7"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Hello from Docker Compose!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#tasks-dockercompose-__codelineno-0-8"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>This page is served by a container managed by Docker Compose.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#tasks-dockercompose-__codelineno-0-9"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#tasks-dockercompose-__codelineno-0-10"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>version</code>, <code>services</code>, <code>image</code>, <code>ports</code>, and <code>volumes</code> keys</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#tasks-dockercompose-__codelineno-1-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#tasks-dockercompose-__codelineno-1-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#tasks-dockercompose-__codelineno-1-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#tasks-dockercompose-__codelineno-1-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#tasks-dockercompose-__codelineno-1-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#tasks-dockercompose-__codelineno-1-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#tasks-dockercompose-__codelineno-1-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#tasks-dockercompose-__codelineno-1-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./html:/usr/share/nginx/html</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#tasks-dockercompose-__codelineno-2-1"></a><span class="c1"># Start the services</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#tasks-dockercompose-__codelineno-2-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#tasks-dockercompose-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#tasks-dockercompose-__codelineno-2-4"></a><span class="c1"># Check running services</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#tasks-dockercompose-__codelineno-2-5"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#tasks-dockercompose-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#tasks-dockercompose-__codelineno-2-7"></a><span class="c1"># View logs</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#tasks-dockercompose-__codelineno-2-8"></a>docker-compose<span class="w"> </span>logs
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#tasks-dockercompose-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#tasks-dockercompose-__codelineno-2-10"></a><span class="c1"># Stop and remove services</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#tasks-dockercompose-__codelineno-2-11"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>version</strong>: Specifies the Compose file format version</li>
<li><strong>services</strong>: Defines the containers to run</li>
<li><strong>image</strong>: Specifies the Docker image to use</li>
<li><strong>ports</strong>: Maps host ports to container ports</li>
<li><strong>volumes</strong>: Mounts host directories into containers</li>
<li><strong>docker-compose up -d</strong>: Starts services in detached mode</li>
<li><strong>docker-compose down</strong>: Stops and removes containers and networks</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-02-multi-service-application">02. Multi-Service Application<a class="headerlink" href="#tasks-dockercompose-02-multi-service-application" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a docker-compose.yml file that runs a web application with a database backend, demonstrating service communication.</p>
<h4 id="tasks-dockercompose-scenario_1"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_1" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re developing a full-stack application that requires both a web server and a database to work together.</li>
<li>Docker Compose enables you to define and manage multiple interconnected services that can communicate with each other securely.</li>
</ul>
<h4 id="tasks-dockercompose-resources_1">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>web/index.html</code> ‚û§ <code>/usr/share/nginx/html</code>
    <div class="language-html highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#tasks-dockercompose-__codelineno-3-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#tasks-dockercompose-__codelineno-3-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#tasks-dockercompose-__codelineno-3-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Multi-Service App<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#tasks-dockercompose-__codelineno-3-4"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#tasks-dockercompose-__codelineno-3-5"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Web App with Database<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#tasks-dockercompose-__codelineno-3-6"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Connected to PostgreSQL database via Docker Compose networking.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#tasks-dockercompose-__codelineno-3-7"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#tasks-dockercompose-__codelineno-3-8"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>depends_on</code> for service dependencies and named volumes for data persistence</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#tasks-dockercompose-__codelineno-4-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#tasks-dockercompose-__codelineno-4-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#tasks-dockercompose-__codelineno-4-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#tasks-dockercompose-__codelineno-4-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#tasks-dockercompose-__codelineno-4-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#tasks-dockercompose-__codelineno-4-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#tasks-dockercompose-__codelineno-4-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#tasks-dockercompose-__codelineno-4-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#tasks-dockercompose-__codelineno-4-9"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#tasks-dockercompose-__codelineno-4-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#tasks-dockercompose-__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#tasks-dockercompose-__codelineno-4-12"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#tasks-dockercompose-__codelineno-4-13"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#tasks-dockercompose-__codelineno-4-14"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#tasks-dockercompose-__codelineno-4-15"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#tasks-dockercompose-__codelineno-4-16"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#tasks-dockercompose-__codelineno-4-17"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#tasks-dockercompose-__codelineno-4-18"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#tasks-dockercompose-__codelineno-4-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#tasks-dockercompose-__codelineno-4-20"></a>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#tasks-dockercompose-__codelineno-4-21"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#tasks-dockercompose-__codelineno-4-22"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>web/index.html</strong>
<div class="language-html highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#tasks-dockercompose-__codelineno-5-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#tasks-dockercompose-__codelineno-5-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#tasks-dockercompose-__codelineno-5-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Multi-Service App<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#tasks-dockercompose-__codelineno-5-4"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#tasks-dockercompose-__codelineno-5-5"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Web App with Database<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#tasks-dockercompose-__codelineno-5-6"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Connected to PostgreSQL database via Docker Compose networking.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#tasks-dockercompose-__codelineno-5-7"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#tasks-dockercompose-__codelineno-5-8"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#tasks-dockercompose-__codelineno-6-1"></a><span class="c1"># Start all services</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#tasks-dockercompose-__codelineno-6-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#tasks-dockercompose-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#tasks-dockercompose-__codelineno-6-4"></a><span class="c1"># Check service connectivity</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#tasks-dockercompose-__codelineno-6-5"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span>db
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#tasks-dockercompose-__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#tasks-dockercompose-__codelineno-6-7"></a><span class="c1"># View database logs</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#tasks-dockercompose-__codelineno-6-8"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>db
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#tasks-dockercompose-__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#tasks-dockercompose-__codelineno-6-10"></a><span class="c1"># Stop services</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#tasks-dockercompose-__codelineno-6-11"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>depends_on</strong>: Ensures services start in the correct order</li>
<li><strong>environment</strong>: Sets environment variables for service configuration</li>
<li><strong>volumes</strong>: Persists database data between container restarts</li>
<li><strong>Service networking</strong>: Services can communicate using service names as hostnames</li>
<li><strong>docker-compose exec</strong>: Runs commands in running service containers</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-03-environment-variables-and-configuration">03. Environment Variables and Configuration<a class="headerlink" href="#tasks-dockercompose-03-environment-variables-and-configuration" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a configurable application stack using environment variables and .env files for different deployment environments.</p>
<h4 id="tasks-dockercompose-scenario_2"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_2" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application needs to run in multiple environments (development, staging, production) with different configurations like database credentials, ports, and feature flags.</li>
<li>Docker Compose allows you to manage environment-specific configurations using environment variables and .env files.</li>
</ul>
<h4 id="tasks-dockercompose-resources_2">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_2" title="Permanent link">&para;</a></h4>
<ul>
<li><code>.env</code> ‚û§ Environment configuration file
    <div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#tasks-dockercompose-__codelineno-7-1"></a>APP_ENV=development
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#tasks-dockercompose-__codelineno-7-2"></a>WEB_PORT=8080
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#tasks-dockercompose-__codelineno-7-3"></a>DB_NAME=myapp
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#tasks-dockercompose-__codelineno-7-4"></a>DB_USER=user
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#tasks-dockercompose-__codelineno-7-5"></a>DB_PASSWORD=password
</span></code></pre></div></li>
<li><code>web/index.html</code> ‚û§ <code>/usr/share/nginx/html</code>
    <div class="language-html highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#tasks-dockercompose-__codelineno-8-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#tasks-dockercompose-__codelineno-8-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#tasks-dockercompose-__codelineno-8-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Configurable App<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#tasks-dockercompose-__codelineno-8-4"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#tasks-dockercompose-__codelineno-8-5"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Environment: ${ENV}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#tasks-dockercompose-__codelineno-8-6"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Configuration loaded from environment variables.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#tasks-dockercompose-__codelineno-8-7"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#tasks-dockercompose-__codelineno-8-8"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>${VARIABLE_NAME}</code> syntax and .env files for configuration management</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#tasks-dockercompose-__codelineno-9-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#tasks-dockercompose-__codelineno-9-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#tasks-dockercompose-__codelineno-9-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#tasks-dockercompose-__codelineno-9-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#tasks-dockercompose-__codelineno-9-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#tasks-dockercompose-__codelineno-9-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;${WEB_PORT:-8080}:80&quot;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#tasks-dockercompose-__codelineno-9-7"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#tasks-dockercompose-__codelineno-9-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ENV=${APP_ENV:-development}</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#tasks-dockercompose-__codelineno-9-9"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#tasks-dockercompose-__codelineno-9-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#tasks-dockercompose-__codelineno-9-11"></a>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#tasks-dockercompose-__codelineno-9-12"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#tasks-dockercompose-__codelineno-9-13"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#tasks-dockercompose-__codelineno-9-14"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#tasks-dockercompose-__codelineno-9-15"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_NAME}</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#tasks-dockercompose-__codelineno-9-16"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_USER}</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#tasks-dockercompose-__codelineno-9-17"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#tasks-dockercompose-__codelineno-9-18"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#tasks-dockercompose-__codelineno-9-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#tasks-dockercompose-__codelineno-9-20"></a>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#tasks-dockercompose-__codelineno-9-21"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#tasks-dockercompose-__codelineno-9-22"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>.env</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#tasks-dockercompose-__codelineno-10-1"></a>APP_ENV=development
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#tasks-dockercompose-__codelineno-10-2"></a>WEB_PORT=8080
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#tasks-dockercompose-__codelineno-10-3"></a>DB_NAME=myapp
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#tasks-dockercompose-__codelineno-10-4"></a>DB_USER=user
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#tasks-dockercompose-__codelineno-10-5"></a>DB_PASSWORD=password
</span></code></pre></div></p>
<p><strong>web/index.html</strong>
<div class="language-html highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#tasks-dockercompose-__codelineno-11-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#tasks-dockercompose-__codelineno-11-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#tasks-dockercompose-__codelineno-11-3"></a><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Configurable App<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#tasks-dockercompose-__codelineno-11-4"></a><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#tasks-dockercompose-__codelineno-11-5"></a>    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Environment: ${ENV}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#tasks-dockercompose-__codelineno-11-6"></a>    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Configuration loaded from environment variables.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#tasks-dockercompose-__codelineno-11-7"></a><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#tasks-dockercompose-__codelineno-11-8"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#tasks-dockercompose-__codelineno-12-1"></a><span class="c1"># Start with default .env</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#tasks-dockercompose-__codelineno-12-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#tasks-dockercompose-__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#tasks-dockercompose-__codelineno-12-4"></a><span class="c1"># Override environment variables</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#tasks-dockercompose-__codelineno-12-5"></a><span class="nv">WEB_PORT</span><span class="o">=</span><span class="m">3000</span><span class="w"> </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#tasks-dockercompose-__codelineno-12-6"></a>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#tasks-dockercompose-__codelineno-12-7"></a><span class="c1"># Use different .env file</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#tasks-dockercompose-__codelineno-12-8"></a>docker-compose<span class="w"> </span>--env-file<span class="w"> </span>.env.production<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#tasks-dockercompose-__codelineno-12-9"></a>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#tasks-dockercompose-__codelineno-12-10"></a><span class="c1"># Check environment in container</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#tasks-dockercompose-__codelineno-12-11"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ENV
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>${VARIABLE}</strong>: Substitutes environment variable values</li>
<li><strong>${VARIABLE:-default}</strong>: Provides default values for missing variables</li>
<li><strong>.env file</strong>: Automatically loaded by docker-compose</li>
<li><strong>&ndash;env-file</strong>: Specify custom environment file</li>
<li><strong>Runtime overrides</strong>: Command-line variables override file values</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-04-volumes-and-data-persistence">04. Volumes and Data Persistence<a class="headerlink" href="#tasks-dockercompose-04-volumes-and-data-persistence" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Implement different types of volumes (named, bind mounts, tmpfs) for data persistence and performance optimization.</p>
<h4 id="tasks-dockercompose-scenario_3"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_3" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application stack requires different data persistence strategies - some data needs to persist across container restarts, some needs high performance, and some should be temporary.</li>
<li>Docker Compose provides flexible volume management to handle various data persistence requirements.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use named volumes, bind mounts, and tmpfs for different data persistence needs</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#tasks-dockercompose-__codelineno-13-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#tasks-dockercompose-__codelineno-13-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#tasks-dockercompose-__codelineno-13-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#tasks-dockercompose-__codelineno-13-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#tasks-dockercompose-__codelineno-13-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#tasks-dockercompose-__codelineno-13-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#tasks-dockercompose-__codelineno-13-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#tasks-dockercompose-__codelineno-13-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html:ro</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#tasks-dockercompose-__codelineno-13-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logs:/var/log/nginx</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#tasks-dockercompose-__codelineno-13-10"></a>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#tasks-dockercompose-__codelineno-13-11"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#tasks-dockercompose-__codelineno-13-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#tasks-dockercompose-__codelineno-13-13"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#tasks-dockercompose-__codelineno-13-14"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#tasks-dockercompose-__codelineno-13-15"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#tasks-dockercompose-__codelineno-13-16"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#tasks-dockercompose-__codelineno-13-17"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#tasks-dockercompose-__codelineno-13-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#tasks-dockercompose-__codelineno-13-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./init.sql:/docker-entrypoint-initdb.d/init.sql</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#tasks-dockercompose-__codelineno-13-20"></a>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#tasks-dockercompose-__codelineno-13-21"></a><span class="w">  </span><span class="nt">cache</span><span class="p">:</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#tasks-dockercompose-__codelineno-13-22"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:alpine</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#tasks-dockercompose-__codelineno-13-23"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#tasks-dockercompose-__codelineno-13-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cache_data:/data</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#tasks-dockercompose-__codelineno-13-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tmpfs</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#tasks-dockercompose-__codelineno-13-26"></a><span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#tasks-dockercompose-__codelineno-13-27"></a><span class="w">        </span><span class="nt">tmpfs</span><span class="p">:</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#tasks-dockercompose-__codelineno-13-28"></a><span class="w">          </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100m</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#tasks-dockercompose-__codelineno-13-29"></a>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#tasks-dockercompose-__codelineno-13-30"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#tasks-dockercompose-__codelineno-13-31"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#tasks-dockercompose-__codelineno-13-32"></a><span class="w">  </span><span class="nt">logs</span><span class="p">:</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#tasks-dockercompose-__codelineno-13-33"></a><span class="w">  </span><span class="nt">cache_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#tasks-dockercompose-__codelineno-14-1"></a><span class="c1"># Start services</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#tasks-dockercompose-__codelineno-14-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#tasks-dockercompose-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#tasks-dockercompose-__codelineno-14-4"></a><span class="c1"># Check volume usage</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#tasks-dockercompose-__codelineno-14-5"></a>docker<span class="w"> </span>volume<span class="w"> </span>ls
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#tasks-dockercompose-__codelineno-14-6"></a>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#tasks-dockercompose-__codelineno-14-7"></a><span class="c1"># Inspect a volume</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#tasks-dockercompose-__codelineno-14-8"></a>docker<span class="w"> </span>volume<span class="w"> </span>inspect<span class="w"> </span><span class="k">$(</span>docker-compose<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>db<span class="k">)</span>_db_data
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#tasks-dockercompose-__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#tasks-dockercompose-__codelineno-14-10"></a><span class="c1"># View logs volume content</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#tasks-dockercompose-__codelineno-14-11"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ls<span class="w"> </span>-la<span class="w"> </span>/var/log/nginx/
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#tasks-dockercompose-__codelineno-14-12"></a>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#tasks-dockercompose-__codelineno-14-13"></a><span class="c1"># Clean up volumes</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#tasks-dockercompose-__codelineno-14-14"></a>docker-compose<span class="w"> </span>down<span class="w"> </span>-v
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Named volumes</strong>: Managed by Docker, persist across container lifecycle</li>
<li><strong>Bind mounts</strong>: Host directories mounted into containers</li>
<li><strong>:ro</strong>: Read-only mount for security</li>
<li><strong>tmpfs</strong>: Temporary filesystem in memory</li>
<li><strong>Volume lifecycle</strong>: Separate from container lifecycle</li>
<li><strong>docker-compose down -v</strong>: Removes containers and volumes</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-05-networking-between-services">05. Networking Between Services<a class="headerlink" href="#tasks-dockercompose-05-networking-between-services" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Configure custom networks in Docker Compose to control service communication and isolation.</p>
<h4 id="tasks-dockercompose-scenario_4"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_4" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application has multiple services that need controlled communication - some services should be publicly accessible, others should only communicate internally, and some need complete isolation.</li>
<li>Docker Compose networking allows you to create custom networks with specific connectivity rules.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use custom networks with <code>internal: true</code> for backend isolation and multiple network connections</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#tasks-dockercompose-__codelineno-15-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#tasks-dockercompose-__codelineno-15-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#tasks-dockercompose-__codelineno-15-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#tasks-dockercompose-__codelineno-15-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#tasks-dockercompose-__codelineno-15-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#tasks-dockercompose-__codelineno-15-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#tasks-dockercompose-__codelineno-15-7"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#tasks-dockercompose-__codelineno-15-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#tasks-dockercompose-__codelineno-15-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#tasks-dockercompose-__codelineno-15-10"></a>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#tasks-dockercompose-__codelineno-15-11"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#tasks-dockercompose-__codelineno-15-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#tasks-dockercompose-__codelineno-15-13"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#tasks-dockercompose-__codelineno-15-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#tasks-dockercompose-__codelineno-15-15"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;busybox httpd -f -p 8000 -h /tmp&quot;</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#tasks-dockercompose-__codelineno-15-16"></a>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#tasks-dockercompose-__codelineno-15-17"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#tasks-dockercompose-__codelineno-15-18"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#tasks-dockercompose-__codelineno-15-19"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#tasks-dockercompose-__codelineno-15-20"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#tasks-dockercompose-__codelineno-15-21"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#tasks-dockercompose-__codelineno-15-22"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#tasks-dockercompose-__codelineno-15-23"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#tasks-dockercompose-__codelineno-15-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#tasks-dockercompose-__codelineno-15-25"></a>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#tasks-dockercompose-__codelineno-15-26"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#tasks-dockercompose-__codelineno-15-27"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#tasks-dockercompose-__codelineno-15-28"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#tasks-dockercompose-__codelineno-15-29"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#tasks-dockercompose-__codelineno-15-30"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#tasks-dockercompose-__codelineno-15-31"></a><span class="w">    </span><span class="nt">internal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#tasks-dockercompose-__codelineno-16-1"></a><span class="c1"># Start services</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#tasks-dockercompose-__codelineno-16-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#tasks-dockercompose-__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#tasks-dockercompose-__codelineno-16-4"></a><span class="c1"># Check networks</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#tasks-dockercompose-__codelineno-16-5"></a>docker<span class="w"> </span>network<span class="w"> </span>ls
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#tasks-dockercompose-__codelineno-16-6"></a>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#tasks-dockercompose-__codelineno-16-7"></a><span class="c1"># Test connectivity</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#tasks-dockercompose-__codelineno-16-8"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span>api
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#tasks-dockercompose-__codelineno-16-9"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span>db
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#tasks-dockercompose-__codelineno-16-10"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span>db
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#tasks-dockercompose-__codelineno-16-11"></a>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#tasks-dockercompose-__codelineno-16-12"></a><span class="c1"># Check network isolation (should fail)</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#tasks-dockercompose-__codelineno-16-13"></a>curl<span class="w"> </span>http://localhost:8000
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Custom networks</strong>: Isolated communication channels</li>
<li><strong>internal: true</strong>: Prevents external access to backend network</li>
<li><strong>Multiple networks</strong>: Services can connect to multiple networks</li>
<li><strong>Network isolation</strong>: Frontend accessible, backend internal only</li>
<li><strong>Service discovery</strong>: Services communicate using service names</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-06-health-checks-and-dependencies">06. Health Checks and Dependencies<a class="headerlink" href="#tasks-dockercompose-06-health-checks-and-dependencies" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Implement health checks and service dependencies to ensure proper startup order and fault tolerance.</p>
<h4 id="tasks-dockercompose-scenario_5"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_5" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application services have complex dependencies and need to verify they&rsquo;re healthy before other services start depending on them.</li>
<li>Docker Compose health checks ensure services are ready before dependent services start, improving application reliability.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>healthcheck</code> with <code>depends_on.condition: service_healthy</code> for proper service startup sequencing</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#tasks-dockercompose-__codelineno-17-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#tasks-dockercompose-__codelineno-17-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#tasks-dockercompose-__codelineno-17-3"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#tasks-dockercompose-__codelineno-17-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#tasks-dockercompose-__codelineno-17-5"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#tasks-dockercompose-__codelineno-17-6"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#tasks-dockercompose-__codelineno-17-7"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#tasks-dockercompose-__codelineno-17-8"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#tasks-dockercompose-__codelineno-17-9"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#tasks-dockercompose-__codelineno-17-10"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">-d</span><span class="nv"> </span><span class="s">myapp&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#tasks-dockercompose-__codelineno-17-11"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#tasks-dockercompose-__codelineno-17-12"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#tasks-dockercompose-__codelineno-17-13"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#tasks-dockercompose-__codelineno-17-14"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#tasks-dockercompose-__codelineno-17-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#tasks-dockercompose-__codelineno-17-16"></a>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#tasks-dockercompose-__codelineno-17-17"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#tasks-dockercompose-__codelineno-17-18"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#tasks-dockercompose-__codelineno-17-19"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#tasks-dockercompose-__codelineno-17-20"></a><span class="w">      </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#tasks-dockercompose-__codelineno-17-21"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#tasks-dockercompose-__codelineno-17-22"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#tasks-dockercompose-__codelineno-17-23"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8000/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#tasks-dockercompose-__codelineno-17-24"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#tasks-dockercompose-__codelineno-17-25"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#tasks-dockercompose-__codelineno-17-26"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#tasks-dockercompose-__codelineno-17-27"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;OK&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 8000 -h /tmp&#39;</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#tasks-dockercompose-__codelineno-17-28"></a>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#tasks-dockercompose-__codelineno-17-29"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#tasks-dockercompose-__codelineno-17-30"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#tasks-dockercompose-__codelineno-17-31"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#tasks-dockercompose-__codelineno-17-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#tasks-dockercompose-__codelineno-17-33"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#tasks-dockercompose-__codelineno-17-34"></a><span class="w">      </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#tasks-dockercompose-__codelineno-17-35"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#tasks-dockercompose-__codelineno-17-36"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#tasks-dockercompose-__codelineno-17-37"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#tasks-dockercompose-__codelineno-17-38"></a>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#tasks-dockercompose-__codelineno-17-39"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#tasks-dockercompose-__codelineno-17-40"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#tasks-dockercompose-__codelineno-18-1"></a><span class="c1"># Start services (will wait for health checks)</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#tasks-dockercompose-__codelineno-18-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#tasks-dockercompose-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#tasks-dockercompose-__codelineno-18-4"></a><span class="c1"># Monitor startup process</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#tasks-dockercompose-__codelineno-18-5"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>-f
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#tasks-dockercompose-__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#tasks-dockercompose-__codelineno-18-7"></a><span class="c1"># Check service health</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#tasks-dockercompose-__codelineno-18-8"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#tasks-dockercompose-__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#tasks-dockercompose-__codelineno-18-10"></a><span class="c1"># Test health endpoints</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#tasks-dockercompose-__codelineno-18-11"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>curl<span class="w"> </span>http://localhost:8000/health
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>healthcheck</strong>: Defines how to check service health</li>
<li><strong>depends_on.condition</strong>: Waits for healthy dependencies</li>
<li><strong>Startup sequencing</strong>: Services start only when dependencies are ready</li>
<li><strong>Fault tolerance</strong>: Automatic restarts for unhealthy services</li>
<li><strong>Health monitoring</strong>: Continuous health checking during runtime</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-07-scaling-services">07. Scaling Services<a class="headerlink" href="#tasks-dockercompose-07-scaling-services" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Scale services horizontally to handle increased load and implement load balancing.</p>
<h4 id="tasks-dockercompose-scenario_6"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_6" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application is experiencing high traffic and needs to handle more concurrent requests by running multiple instances of services.</li>
<li>Docker Compose scaling allows you to run multiple instances of services and distribute load across them.</li>
</ul>
<h4 id="tasks-dockercompose-resources_3">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_3" title="Permanent link">&para;</a></h4>
<ul>
<li><code>lb/nginx.conf</code> ‚û§ <code>/etc/nginx/nginx.conf</code>
    <div class="language-nginx highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#tasks-dockercompose-__codelineno-19-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#tasks-dockercompose-__codelineno-19-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#tasks-dockercompose-__codelineno-19-3"></a><span class="p">}</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#tasks-dockercompose-__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#tasks-dockercompose-__codelineno-19-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#tasks-dockercompose-__codelineno-19-6"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">api_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#tasks-dockercompose-__codelineno-19-7"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#tasks-dockercompose-__codelineno-19-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#tasks-dockercompose-__codelineno-19-9"></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#tasks-dockercompose-__codelineno-19-10"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#tasks-dockercompose-__codelineno-19-11"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#tasks-dockercompose-__codelineno-19-12"></a>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#tasks-dockercompose-__codelineno-19-13"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#tasks-dockercompose-__codelineno-19-14"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api_backend</span><span class="p">;</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#tasks-dockercompose-__codelineno-19-15"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#tasks-dockercompose-__codelineno-19-16"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#tasks-dockercompose-__codelineno-19-17"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#tasks-dockercompose-__codelineno-19-18"></a>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#tasks-dockercompose-__codelineno-19-19"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#tasks-dockercompose-__codelineno-19-20"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://web</span><span class="p">;</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#tasks-dockercompose-__codelineno-19-21"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#tasks-dockercompose-__codelineno-19-22"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#tasks-dockercompose-__codelineno-19-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#tasks-dockercompose-__codelineno-19-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#tasks-dockercompose-__codelineno-19-25"></a><span class="p">}</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>deploy.replicas</code> to scale services and configure load balancing with nginx upstream</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#tasks-dockercompose-__codelineno-20-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#tasks-dockercompose-__codelineno-20-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#tasks-dockercompose-__codelineno-20-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#tasks-dockercompose-__codelineno-20-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#tasks-dockercompose-__codelineno-20-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#tasks-dockercompose-__codelineno-20-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#tasks-dockercompose-__codelineno-20-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#tasks-dockercompose-__codelineno-20-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#tasks-dockercompose-__codelineno-20-9"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#tasks-dockercompose-__codelineno-20-10"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#tasks-dockercompose-__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#tasks-dockercompose-__codelineno-20-12"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#tasks-dockercompose-__codelineno-20-13"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#tasks-dockercompose-__codelineno-20-14"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#tasks-dockercompose-__codelineno-20-15"></a><span class="l l-Scalar l-Scalar-Plain">while true; do</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#tasks-dockercompose-__codelineno-20-16"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">hostname=\$(hostname)</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#tasks-dockercompose-__codelineno-20-17"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">{ echo -e \&quot;HTTP/1.1 200 OK\r\nContent-Type</span><span class="nt">: text/plain\r\n\r\nAPI Instance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">\$hostname\&quot;; } | nc -l -p 8000 -q 1 &gt; /dev/null</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#tasks-dockercompose-__codelineno-20-18"></a><span class="l l-Scalar l-Scalar-Plain">done&quot;</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#tasks-dockercompose-__codelineno-20-19"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">deploy</span><span class="p p-Indicator">:</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#tasks-dockercompose-__codelineno-20-20"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#tasks-dockercompose-__codelineno-20-21"></a>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#tasks-dockercompose-__codelineno-20-22"></a><span class="w w-Error">  </span><span class="nt">loadbalancer</span><span class="p">:</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#tasks-dockercompose-__codelineno-20-23"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#tasks-dockercompose-__codelineno-20-24"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#tasks-dockercompose-__codelineno-20-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:80&quot;</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#tasks-dockercompose-__codelineno-20-26"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#tasks-dockercompose-__codelineno-20-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./lb/nginx.conf:/etc/nginx/nginx.conf</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#tasks-dockercompose-__codelineno-20-28"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#tasks-dockercompose-__codelineno-20-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#tasks-dockercompose-__codelineno-20-30"></a>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#tasks-dockercompose-__codelineno-20-31"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#tasks-dockercompose-__codelineno-20-32"></a><span class="w">  </span><span class="nt">default</span><span class="p">:</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#tasks-dockercompose-__codelineno-20-33"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span></code></pre></div></p>
<p><strong>lb/nginx.conf</strong>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#tasks-dockercompose-__codelineno-21-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#tasks-dockercompose-__codelineno-21-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#tasks-dockercompose-__codelineno-21-3"></a><span class="p">}</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#tasks-dockercompose-__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#tasks-dockercompose-__codelineno-21-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#tasks-dockercompose-__codelineno-21-6"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">api_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#tasks-dockercompose-__codelineno-21-7"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#tasks-dockercompose-__codelineno-21-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#tasks-dockercompose-__codelineno-21-9"></a>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#tasks-dockercompose-__codelineno-21-10"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#tasks-dockercompose-__codelineno-21-11"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#tasks-dockercompose-__codelineno-21-12"></a>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#tasks-dockercompose-__codelineno-21-13"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#tasks-dockercompose-__codelineno-21-14"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api_backend</span><span class="p">;</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#tasks-dockercompose-__codelineno-21-15"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#tasks-dockercompose-__codelineno-21-16"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#tasks-dockercompose-__codelineno-21-17"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#tasks-dockercompose-__codelineno-21-18"></a>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#tasks-dockercompose-__codelineno-21-19"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#tasks-dockercompose-__codelineno-21-20"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://web</span><span class="p">;</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#tasks-dockercompose-__codelineno-21-21"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#tasks-dockercompose-__codelineno-21-22"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#tasks-dockercompose-__codelineno-21-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#tasks-dockercompose-__codelineno-21-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#tasks-dockercompose-__codelineno-21-25"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#tasks-dockercompose-__codelineno-22-1"></a><span class="c1"># Start scaled services</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#tasks-dockercompose-__codelineno-22-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#tasks-dockercompose-__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#tasks-dockercompose-__codelineno-22-4"></a><span class="c1"># Check running instances</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#tasks-dockercompose-__codelineno-22-5"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#tasks-dockercompose-__codelineno-22-6"></a>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#tasks-dockercompose-__codelineno-22-7"></a><span class="c1"># Scale services dynamically</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#tasks-dockercompose-__codelineno-22-8"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">api</span><span class="o">=</span><span class="m">3</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#tasks-dockercompose-__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#tasks-dockercompose-__codelineno-22-10"></a><span class="c1"># Test load balancing</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#tasks-dockercompose-__codelineno-22-11"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..5<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>curl<span class="w"> </span>http://localhost:9090/api<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#tasks-dockercompose-__codelineno-22-12"></a>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#tasks-dockercompose-__codelineno-22-13"></a><span class="c1"># Scale down</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#tasks-dockercompose-__codelineno-22-14"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">web</span><span class="o">=</span><span class="m">1</span>
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>deploy.replicas</strong>: Specifies number of service instances</li>
<li><strong>Load balancing</strong>: Nginx distributes requests across instances</li>
<li><strong>Service discovery</strong>: Automatic load balancing between replicas</li>
<li><strong>Dynamic scaling</strong>: Change replica count without recreation</li>
<li><strong>Instance identification</strong>: Each replica has unique hostname</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-08-build-configuration">08. Build Configuration<a class="headerlink" href="#tasks-dockercompose-08-build-configuration" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Build custom images within Docker Compose using build contexts and Dockerfiles.</p>
<h4 id="tasks-dockercompose-scenario_7"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_7" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application requires custom Docker images that aren&rsquo;t available publicly, or you need to build images with specific configurations for your stack.</li>
<li>Docker Compose can build images from Dockerfiles as part of the service definition.</li>
</ul>
<h4 id="tasks-dockercompose-resources_4">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_4" title="Permanent link">&para;</a></h4>
<ul>
<li><code>web/Dockerfile</code> ‚û§ Web service Dockerfile
    <div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#tasks-dockercompose-__codelineno-23-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#tasks-dockercompose-__codelineno-23-2"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#tasks-dockercompose-__codelineno-23-3"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#tasks-dockercompose-__codelineno-23-4"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci<span class="w"> </span>--only<span class="o">=</span>production
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#tasks-dockercompose-__codelineno-23-5"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#tasks-dockercompose-__codelineno-23-6"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#tasks-dockercompose-__codelineno-23-7"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span></code></pre></div></li>
<li><code>api/Dockerfile</code> ‚û§ API service Dockerfile
    <div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#tasks-dockercompose-__codelineno-24-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9-slim</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#tasks-dockercompose-__codelineno-24-2"></a><span class="k">ARG</span><span class="w"> </span>APP_VERSION
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#tasks-dockercompose-__codelineno-24-3"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="nv">$APP_VERSION</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#tasks-dockercompose-__codelineno-24-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#tasks-dockercompose-__codelineno-24-5"></a><span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#tasks-dockercompose-__codelineno-24-6"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#tasks-dockercompose-__codelineno-24-7"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#tasks-dockercompose-__codelineno-24-8"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">3000</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#tasks-dockercompose-__codelineno-24-9"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.py&quot;</span><span class="p">]</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>build.context</code> and <code>build.args</code> to build custom images within Compose</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#tasks-dockercompose-__codelineno-25-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#tasks-dockercompose-__codelineno-25-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#tasks-dockercompose-__codelineno-25-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#tasks-dockercompose-__codelineno-25-4"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#tasks-dockercompose-__codelineno-25-5"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#tasks-dockercompose-__codelineno-25-6"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#tasks-dockercompose-__codelineno-25-7"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#tasks-dockercompose-__codelineno-25-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#tasks-dockercompose-__codelineno-25-9"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#tasks-dockercompose-__codelineno-25-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NODE_ENV=production</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#tasks-dockercompose-__codelineno-25-11"></a>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#tasks-dockercompose-__codelineno-25-12"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#tasks-dockercompose-__codelineno-25-13"></a><span class="w">    </span><span class="nt">build</span><span class="p">:</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#tasks-dockercompose-__codelineno-25-14"></a><span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./api</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#tasks-dockercompose-__codelineno-25-15"></a><span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#tasks-dockercompose-__codelineno-25-16"></a><span class="w">      </span><span class="nt">args</span><span class="p">:</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#tasks-dockercompose-__codelineno-25-17"></a><span class="w">        </span><span class="nt">APP_VERSION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.0.0</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#tasks-dockercompose-__codelineno-25-18"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#tasks-dockercompose-__codelineno-25-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#tasks-dockercompose-__codelineno-25-20"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#tasks-dockercompose-__codelineno-25-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=postgresql://user:pass@db:5432/myapp</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#tasks-dockercompose-__codelineno-25-22"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#tasks-dockercompose-__codelineno-25-23"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#tasks-dockercompose-__codelineno-25-24"></a>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#tasks-dockercompose-__codelineno-25-25"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#tasks-dockercompose-__codelineno-25-26"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#tasks-dockercompose-__codelineno-25-27"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#tasks-dockercompose-__codelineno-25-28"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#tasks-dockercompose-__codelineno-25-29"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#tasks-dockercompose-__codelineno-25-30"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#tasks-dockercompose-__codelineno-25-31"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#tasks-dockercompose-__codelineno-25-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#tasks-dockercompose-__codelineno-25-33"></a>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#tasks-dockercompose-__codelineno-25-34"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#tasks-dockercompose-__codelineno-25-35"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>web/Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#tasks-dockercompose-__codelineno-26-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">node:18-alpine</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#tasks-dockercompose-__codelineno-26-2"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#tasks-dockercompose-__codelineno-26-3"></a><span class="k">COPY</span><span class="w"> </span>package*.json<span class="w"> </span>./
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#tasks-dockercompose-__codelineno-26-4"></a><span class="k">RUN</span><span class="w"> </span>npm<span class="w"> </span>ci<span class="w"> </span>--only<span class="o">=</span>production
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#tasks-dockercompose-__codelineno-26-5"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#tasks-dockercompose-__codelineno-26-6"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">80</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#tasks-dockercompose-__codelineno-26-7"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;npm&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>api/Dockerfile</strong>
<div class="language-dockerfile highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#tasks-dockercompose-__codelineno-27-1"></a><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.9-slim</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#tasks-dockercompose-__codelineno-27-2"></a><span class="k">ARG</span><span class="w"> </span>APP_VERSION
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#tasks-dockercompose-__codelineno-27-3"></a><span class="k">ENV</span><span class="w"> </span><span class="nv">VERSION</span><span class="o">=</span><span class="nv">$APP_VERSION</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#tasks-dockercompose-__codelineno-27-4"></a><span class="k">WORKDIR</span><span class="w"> </span><span class="s">/app</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#tasks-dockercompose-__codelineno-27-5"></a><span class="k">COPY</span><span class="w"> </span>requirements.txt<span class="w"> </span>.
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#tasks-dockercompose-__codelineno-27-6"></a><span class="k">RUN</span><span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#tasks-dockercompose-__codelineno-27-7"></a><span class="k">COPY</span><span class="w"> </span>.<span class="w"> </span>.
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#tasks-dockercompose-__codelineno-27-8"></a><span class="k">EXPOSE</span><span class="w"> </span><span class="s">3000</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#tasks-dockercompose-__codelineno-27-9"></a><span class="k">CMD</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;python&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;app.py&quot;</span><span class="p">]</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#tasks-dockercompose-__codelineno-28-1"></a><span class="c1"># Build and start services</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#tasks-dockercompose-__codelineno-28-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>--build<span class="w"> </span>-d
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#tasks-dockercompose-__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#tasks-dockercompose-__codelineno-28-4"></a><span class="c1"># Rebuild specific service</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#tasks-dockercompose-__codelineno-28-5"></a>docker-compose<span class="w"> </span>build<span class="w"> </span>api
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#tasks-dockercompose-__codelineno-28-6"></a>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#tasks-dockercompose-__codelineno-28-7"></a><span class="c1"># Build without cache</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#tasks-dockercompose-__codelineno-28-8"></a>docker-compose<span class="w"> </span>build<span class="w"> </span>--no-cache
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#tasks-dockercompose-__codelineno-28-9"></a>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#tasks-dockercompose-__codelineno-28-10"></a><span class="c1"># View build logs</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#tasks-dockercompose-__codelineno-28-11"></a>docker-compose<span class="w"> </span>build<span class="w"> </span>--progress<span class="w"> </span>plain
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>build.context</strong>: Directory containing Dockerfile and build context</li>
<li><strong>build.dockerfile</strong>: Specify custom Dockerfile name/location</li>
<li><strong>build.args</strong>: Pass build arguments to Dockerfile</li>
<li><strong>&ndash;build</strong>: Force rebuild of images</li>
<li><strong>Selective building</strong>: Rebuild only specific services</li>
<li><strong>Build caching</strong>: Leverages Docker layer caching</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-09-override-files">09. Override Files<a class="headerlink" href="#tasks-dockercompose-09-override-files" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Use multiple docker-compose files to manage different environments and configurations.</p>
<h4 id="tasks-dockercompose-scenario_8"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_8" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application needs different configurations for development, testing, and production environments with varying resource requirements, logging levels, and service configurations.</li>
<li>Docker Compose override files allow you to maintain a base configuration while applying environment-specific customizations.</li>
</ul>
<h4 id="tasks-dockercompose-resources_5">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_5" title="Permanent link">&para;</a></h4>
<ul>
<li><code>docker-compose.override.yml</code> ‚û§ Development overrides
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#tasks-dockercompose-__codelineno-29-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#tasks-dockercompose-__codelineno-29-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#tasks-dockercompose-__codelineno-29-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#tasks-dockercompose-__codelineno-29-4"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#tasks-dockercompose-__codelineno-29-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG=true</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#tasks-dockercompose-__codelineno-29-6"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#tasks-dockercompose-__codelineno-29-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#tasks-dockercompose-__codelineno-29-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/node_modules</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#tasks-dockercompose-__codelineno-29-9"></a>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#tasks-dockercompose-__codelineno-29-10"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#tasks-dockercompose-__codelineno-29-11"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#tasks-dockercompose-__codelineno-29-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#tasks-dockercompose-__codelineno-29-13"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#tasks-dockercompose-__codelineno-29-14"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">devpassword</span>
</span></code></pre></div></li>
<li><code>docker-compose.prod.yml</code> ‚û§ Production overrides
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#tasks-dockercompose-__codelineno-30-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#tasks-dockercompose-__codelineno-30-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#tasks-dockercompose-__codelineno-30-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#tasks-dockercompose-__codelineno-30-4"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#tasks-dockercompose-__codelineno-30-5"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#tasks-dockercompose-__codelineno-30-6"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#tasks-dockercompose-__codelineno-30-7"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#tasks-dockercompose-__codelineno-30-8"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#tasks-dockercompose-__codelineno-30-9"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#tasks-dockercompose-__codelineno-30-10"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#tasks-dockercompose-__codelineno-30-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NODE_ENV=production</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#tasks-dockercompose-__codelineno-30-12"></a>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#tasks-dockercompose-__codelineno-30-13"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#tasks-dockercompose-__codelineno-30-14"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#tasks-dockercompose-__codelineno-30-15"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#tasks-dockercompose-__codelineno-30-16"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#tasks-dockercompose-__codelineno-30-17"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#tasks-dockercompose-__codelineno-30-18"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#tasks-dockercompose-__codelineno-30-19"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#tasks-dockercompose-__codelineno-30-20"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>docker-compose.override.yml</code> for development and custom override files for production</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong> (base)
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#tasks-dockercompose-__codelineno-31-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#tasks-dockercompose-__codelineno-31-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#tasks-dockercompose-__codelineno-31-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#tasks-dockercompose-__codelineno-31-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#tasks-dockercompose-__codelineno-31-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#tasks-dockercompose-__codelineno-31-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#tasks-dockercompose-__codelineno-31-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#tasks-dockercompose-__codelineno-31-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#tasks-dockercompose-__codelineno-31-9"></a>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#tasks-dockercompose-__codelineno-31-10"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#tasks-dockercompose-__codelineno-31-11"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#tasks-dockercompose-__codelineno-31-12"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#tasks-dockercompose-__codelineno-31-13"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#tasks-dockercompose-__codelineno-31-14"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#tasks-dockercompose-__codelineno-31-15"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#tasks-dockercompose-__codelineno-31-16"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#tasks-dockercompose-__codelineno-31-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#tasks-dockercompose-__codelineno-31-18"></a>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#tasks-dockercompose-__codelineno-31-19"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#tasks-dockercompose-__codelineno-31-20"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>docker-compose.override.yml</strong> (development)
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#tasks-dockercompose-__codelineno-32-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#tasks-dockercompose-__codelineno-32-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#tasks-dockercompose-__codelineno-32-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#tasks-dockercompose-__codelineno-32-4"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#tasks-dockercompose-__codelineno-32-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DEBUG=true</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#tasks-dockercompose-__codelineno-32-6"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#tasks-dockercompose-__codelineno-32-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#tasks-dockercompose-__codelineno-32-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/app/node_modules</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#tasks-dockercompose-__codelineno-32-9"></a>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#tasks-dockercompose-__codelineno-32-10"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#tasks-dockercompose-__codelineno-32-11"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#tasks-dockercompose-__codelineno-32-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#tasks-dockercompose-__codelineno-32-13"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#tasks-dockercompose-__codelineno-32-14"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">devpassword</span>
</span></code></pre></div></p>
<p><strong>docker-compose.prod.yml</strong> (production)
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#tasks-dockercompose-__codelineno-33-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#tasks-dockercompose-__codelineno-33-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#tasks-dockercompose-__codelineno-33-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#tasks-dockercompose-__codelineno-33-4"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#tasks-dockercompose-__codelineno-33-5"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#tasks-dockercompose-__codelineno-33-6"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#tasks-dockercompose-__codelineno-33-7"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#tasks-dockercompose-__codelineno-33-8"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#tasks-dockercompose-__codelineno-33-9"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#tasks-dockercompose-__codelineno-33-10"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#tasks-dockercompose-__codelineno-33-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NODE_ENV=production</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#tasks-dockercompose-__codelineno-33-12"></a>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#tasks-dockercompose-__codelineno-33-13"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#tasks-dockercompose-__codelineno-33-14"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#tasks-dockercompose-__codelineno-33-15"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${DB_PASSWORD}</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#tasks-dockercompose-__codelineno-33-16"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#tasks-dockercompose-__codelineno-33-17"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#tasks-dockercompose-__codelineno-33-18"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#tasks-dockercompose-__codelineno-33-19"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#tasks-dockercompose-__codelineno-33-20"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#tasks-dockercompose-__codelineno-34-1"></a><span class="c1"># Development (uses override automatically)</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#tasks-dockercompose-__codelineno-34-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#tasks-dockercompose-__codelineno-34-3"></a>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#tasks-dockercompose-__codelineno-34-4"></a><span class="c1"># Production</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#tasks-dockercompose-__codelineno-34-5"></a>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.prod.yml<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#tasks-dockercompose-__codelineno-34-6"></a>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#tasks-dockercompose-__codelineno-34-7"></a><span class="c1"># Staging with custom override</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#tasks-dockercompose-__codelineno-34-8"></a>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.staging.yml<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#tasks-dockercompose-__codelineno-34-9"></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#tasks-dockercompose-__codelineno-34-10"></a><span class="c1"># List all services from combined files</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#tasks-dockercompose-__codelineno-34-11"></a>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.yml<span class="w"> </span>-f<span class="w"> </span>docker-compose.prod.yml<span class="w"> </span>config
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Automatic override</strong>: docker-compose.override.yml loaded automatically</li>
<li><strong>Multiple files</strong>: Use -f to specify multiple compose files</li>
<li><strong>Merging rules</strong>: Override files extend and modify base configuration</li>
<li><strong>Environment separation</strong>: Different settings for dev/staging/prod</li>
<li><strong>docker-compose config</strong>: Validate and view merged configuration</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-10-secrets-management">10. Secrets Management<a class="headerlink" href="#tasks-dockercompose-10-secrets-management" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Securely manage sensitive data like passwords and API keys using Docker Compose secrets.</p>
<h4 id="tasks-dockercompose-scenario_9"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_9" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application requires sensitive information like database passwords, API keys, and certificates that shouldn&rsquo;t be stored in plain text in your compose files.</li>
<li>Docker Compose secrets provide a secure way to manage sensitive data and make it available to services at runtime.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>secrets</code> with <code>file</code> source to securely pass sensitive data to containers</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#tasks-dockercompose-__codelineno-35-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#tasks-dockercompose-__codelineno-35-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#tasks-dockercompose-__codelineno-35-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#tasks-dockercompose-__codelineno-35-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#tasks-dockercompose-__codelineno-35-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#tasks-dockercompose-__codelineno-35-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#tasks-dockercompose-__codelineno-35-7"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#tasks-dockercompose-__codelineno-35-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_cert</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#tasks-dockercompose-__codelineno-35-9"></a><span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/certs/nginx.crt</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#tasks-dockercompose-__codelineno-35-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx_key</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#tasks-dockercompose-__codelineno-35-11"></a><span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/etc/ssl/private/nginx.key</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#tasks-dockercompose-__codelineno-35-12"></a>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#tasks-dockercompose-__codelineno-35-13"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#tasks-dockercompose-__codelineno-35-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#tasks-dockercompose-__codelineno-35-15"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#tasks-dockercompose-__codelineno-35-16"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#tasks-dockercompose-__codelineno-35-17"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#tasks-dockercompose-__codelineno-35-18"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#tasks-dockercompose-__codelineno-35-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_password</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#tasks-dockercompose-__codelineno-35-20"></a><span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres_password</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#tasks-dockercompose-__codelineno-35-21"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#tasks-dockercompose-__codelineno-35-22"></a><span class="w">      </span><span class="no">sh -c &quot;</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#tasks-dockercompose-__codelineno-35-23"></a><span class="w">      </span><span class="no">export POSTGRES_PASSWORD=$(cat /run/secrets/postgres_password) &amp;&amp;</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#tasks-dockercompose-__codelineno-35-24"></a><span class="w">      </span><span class="no">docker-entrypoint.sh postgres</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#tasks-dockercompose-__codelineno-35-25"></a><span class="w">      </span><span class="no">&quot;</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#tasks-dockercompose-__codelineno-35-26"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#tasks-dockercompose-__codelineno-35-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#tasks-dockercompose-__codelineno-35-28"></a>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#tasks-dockercompose-__codelineno-35-29"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-35-30"><a id="__codelineno-35-30" name="__codelineno-35-30" href="#tasks-dockercompose-__codelineno-35-30"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-35-31"><a id="__codelineno-35-31" name="__codelineno-35-31" href="#tasks-dockercompose-__codelineno-35-31"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-35-32"><a id="__codelineno-35-32" name="__codelineno-35-32" href="#tasks-dockercompose-__codelineno-35-32"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api_key</span>
</span><span id="__span-35-33"><a id="__codelineno-35-33" name="__codelineno-35-33" href="#tasks-dockercompose-__codelineno-35-33"></a><span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/api_key</span>
</span><span id="__span-35-34"><a id="__codelineno-35-34" name="__codelineno-35-34" href="#tasks-dockercompose-__codelineno-35-34"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-35-35"><a id="__codelineno-35-35" name="__codelineno-35-35" href="#tasks-dockercompose-__codelineno-35-35"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">API_KEY_FILE=/run/secrets/api_key</span>
</span><span id="__span-35-36"><a id="__codelineno-35-36" name="__codelineno-35-36" href="#tasks-dockercompose-__codelineno-35-36"></a>
</span><span id="__span-35-37"><a id="__codelineno-35-37" name="__codelineno-35-37" href="#tasks-dockercompose-__codelineno-35-37"></a><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-35-38"><a id="__codelineno-35-38" name="__codelineno-35-38" href="#tasks-dockercompose-__codelineno-35-38"></a><span class="w">  </span><span class="nt">nginx_cert</span><span class="p">:</span>
</span><span id="__span-35-39"><a id="__codelineno-35-39" name="__codelineno-35-39" href="#tasks-dockercompose-__codelineno-35-39"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/nginx.crt</span>
</span><span id="__span-35-40"><a id="__codelineno-35-40" name="__codelineno-35-40" href="#tasks-dockercompose-__codelineno-35-40"></a><span class="w">  </span><span class="nt">nginx_key</span><span class="p">:</span>
</span><span id="__span-35-41"><a id="__codelineno-35-41" name="__codelineno-35-41" href="#tasks-dockercompose-__codelineno-35-41"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/nginx.key</span>
</span><span id="__span-35-42"><a id="__codelineno-35-42" name="__codelineno-35-42" href="#tasks-dockercompose-__codelineno-35-42"></a><span class="w">  </span><span class="nt">db_password</span><span class="p">:</span>
</span><span id="__span-35-43"><a id="__codelineno-35-43" name="__codelineno-35-43" href="#tasks-dockercompose-__codelineno-35-43"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/db_password.txt</span>
</span><span id="__span-35-44"><a id="__codelineno-35-44" name="__codelineno-35-44" href="#tasks-dockercompose-__codelineno-35-44"></a><span class="w">  </span><span class="nt">api_key</span><span class="p">:</span>
</span><span id="__span-35-45"><a id="__codelineno-35-45" name="__codelineno-35-45" href="#tasks-dockercompose-__codelineno-35-45"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/api_key.txt</span>
</span><span id="__span-35-46"><a id="__codelineno-35-46" name="__codelineno-35-46" href="#tasks-dockercompose-__codelineno-35-46"></a>
</span><span id="__span-35-47"><a id="__codelineno-35-47" name="__codelineno-35-47" href="#tasks-dockercompose-__codelineno-35-47"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-35-48"><a id="__codelineno-35-48" name="__codelineno-35-48" href="#tasks-dockercompose-__codelineno-35-48"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#tasks-dockercompose-__codelineno-36-1"></a><span class="c1"># Create secrets directory</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#tasks-dockercompose-__codelineno-36-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>secrets
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#tasks-dockercompose-__codelineno-36-3"></a>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#tasks-dockercompose-__codelineno-36-4"></a><span class="c1"># Create secret files (never commit these)</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#tasks-dockercompose-__codelineno-36-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;mysecretpassword&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>secrets/db_password.txt
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#tasks-dockercompose-__codelineno-36-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;sk-1234567890abcdef&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>secrets/api_key.txt
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#tasks-dockercompose-__codelineno-36-7"></a>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#tasks-dockercompose-__codelineno-36-8"></a><span class="c1"># Start services</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#tasks-dockercompose-__codelineno-36-9"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#tasks-dockercompose-__codelineno-36-10"></a>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#tasks-dockercompose-__codelineno-36-11"></a><span class="c1"># Check secrets in containers</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#tasks-dockercompose-__codelineno-36-12"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>cat<span class="w"> </span>/run/secrets/api_key
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#tasks-dockercompose-__codelineno-36-13"></a>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#tasks-dockercompose-__codelineno-36-14"></a><span class="c1"># Clean up (remove secrets)</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#tasks-dockercompose-__codelineno-36-15"></a>docker-compose<span class="w"> </span>down
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#tasks-dockercompose-__codelineno-36-16"></a>rm<span class="w"> </span>-rf<span class="w"> </span>secrets/
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>secrets</strong>: Secure way to pass sensitive data to containers</li>
<li><strong>file source</strong>: Load secrets from external files</li>
<li><strong>target</strong>: Location where secret is mounted in container</li>
<li><strong>Runtime only</strong>: Secrets not stored in image layers</li>
<li><strong>Access control</strong>: Secrets only available to specified services</li>
<li><strong>External management</strong>: Secrets can be managed by external systems</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-11-logging-configuration">11. Logging Configuration<a class="headerlink" href="#tasks-dockercompose-11-logging-configuration" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Configure centralized logging for all services in a Docker Compose stack.</p>
<h4 id="tasks-dockercompose-scenario_10"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_10" title="Permanent link">&para;</a></h4>
<ul>
<li>Your multi-service application generates logs from different components, and you need to centralize logging for monitoring, debugging, and compliance purposes.</li>
<li>Docker Compose logging configuration allows you to define logging drivers and options for consistent log management across all services.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>logging.driver</code> and <code>logging.options</code> to configure log rotation and formatting</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#tasks-dockercompose-__codelineno-37-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#tasks-dockercompose-__codelineno-37-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#tasks-dockercompose-__codelineno-37-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#tasks-dockercompose-__codelineno-37-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#tasks-dockercompose-__codelineno-37-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#tasks-dockercompose-__codelineno-37-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#tasks-dockercompose-__codelineno-37-7"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#tasks-dockercompose-__codelineno-37-8"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#tasks-dockercompose-__codelineno-37-9"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#tasks-dockercompose-__codelineno-37-10"></a><span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#tasks-dockercompose-__codelineno-37-11"></a><span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#tasks-dockercompose-__codelineno-37-12"></a>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#tasks-dockercompose-__codelineno-37-13"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#tasks-dockercompose-__codelineno-37-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#tasks-dockercompose-__codelineno-37-15"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#tasks-dockercompose-__codelineno-37-16"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#tasks-dockercompose-__codelineno-37-17"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#tasks-dockercompose-__codelineno-37-18"></a><span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;20m&quot;</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#tasks-dockercompose-__codelineno-37-19"></a><span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5&quot;</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#tasks-dockercompose-__codelineno-37-20"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;service&quot;</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#tasks-dockercompose-__codelineno-37-21"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;</span>
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#tasks-dockercompose-__codelineno-37-22"></a><span class="l l-Scalar l-Scalar-Plain">while true; do</span>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#tasks-dockercompose-__codelineno-37-23"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">echo \&quot;\$(date &#39;+%Y-%m-%d %H:%M:%S&#39;) - INFO - API request processed\&quot;</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#tasks-dockercompose-__codelineno-37-24"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">sleep 5</span>
</span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25" href="#tasks-dockercompose-__codelineno-37-25"></a><span class="l l-Scalar l-Scalar-Plain">done&quot;</span>
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26" href="#tasks-dockercompose-__codelineno-37-26"></a>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27" href="#tasks-dockercompose-__codelineno-37-27"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
</span><span id="__span-37-28"><a id="__codelineno-37-28" name="__codelineno-37-28" href="#tasks-dockercompose-__codelineno-37-28"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-37-29"><a id="__codelineno-37-29" name="__codelineno-37-29" href="#tasks-dockercompose-__codelineno-37-29"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-37-30"><a id="__codelineno-37-30" name="__codelineno-37-30" href="#tasks-dockercompose-__codelineno-37-30"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-37-31"><a id="__codelineno-37-31" name="__codelineno-37-31" href="#tasks-dockercompose-__codelineno-37-31"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-37-32"><a id="__codelineno-37-32" name="__codelineno-37-32" href="#tasks-dockercompose-__codelineno-37-32"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-37-33"><a id="__codelineno-37-33" name="__codelineno-37-33" href="#tasks-dockercompose-__codelineno-37-33"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-37-34"><a id="__codelineno-37-34" name="__codelineno-37-34" href="#tasks-dockercompose-__codelineno-37-34"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35" href="#tasks-dockercompose-__codelineno-37-35"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-37-36"><a id="__codelineno-37-36" name="__codelineno-37-36" href="#tasks-dockercompose-__codelineno-37-36"></a><span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;50m&quot;</span>
</span><span id="__span-37-37"><a id="__codelineno-37-37" name="__codelineno-37-37" href="#tasks-dockercompose-__codelineno-37-37"></a><span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
</span><span id="__span-37-38"><a id="__codelineno-37-38" name="__codelineno-37-38" href="#tasks-dockercompose-__codelineno-37-38"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-37-39"><a id="__codelineno-37-39" name="__codelineno-37-39" href="#tasks-dockercompose-__codelineno-37-39"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-37-40"><a id="__codelineno-37-40" name="__codelineno-37-40" href="#tasks-dockercompose-__codelineno-37-40"></a>
</span><span id="__span-37-41"><a id="__codelineno-37-41" name="__codelineno-37-41" href="#tasks-dockercompose-__codelineno-37-41"></a><span class="w w-Error">  </span><span class="nt">log-collector</span><span class="p">:</span>
</span><span id="__span-37-42"><a id="__codelineno-37-42" name="__codelineno-37-42" href="#tasks-dockercompose-__codelineno-37-42"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent/fluent-bit:latest</span>
</span><span id="__span-37-43"><a id="__codelineno-37-43" name="__codelineno-37-43" href="#tasks-dockercompose-__codelineno-37-43"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-37-44"><a id="__codelineno-37-44" name="__codelineno-37-44" href="#tasks-dockercompose-__codelineno-37-44"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
</span><span id="__span-37-45"><a id="__codelineno-37-45" name="__codelineno-37-45" href="#tasks-dockercompose-__codelineno-37-45"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf</span>
</span><span id="__span-37-46"><a id="__codelineno-37-46" name="__codelineno-37-46" href="#tasks-dockercompose-__codelineno-37-46"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-37-47"><a id="__codelineno-37-47" name="__codelineno-37-47" href="#tasks-dockercompose-__codelineno-37-47"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-37-48"><a id="__codelineno-37-48" name="__codelineno-37-48" href="#tasks-dockercompose-__codelineno-37-48"></a>
</span><span id="__span-37-49"><a id="__codelineno-37-49" name="__codelineno-37-49" href="#tasks-dockercompose-__codelineno-37-49"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-37-50"><a id="__codelineno-37-50" name="__codelineno-37-50" href="#tasks-dockercompose-__codelineno-37-50"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#tasks-dockercompose-__codelineno-38-1"></a><span class="c1"># Start services</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#tasks-dockercompose-__codelineno-38-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#tasks-dockercompose-__codelineno-38-3"></a>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#tasks-dockercompose-__codelineno-38-4"></a><span class="c1"># View logs for specific service</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#tasks-dockercompose-__codelineno-38-5"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>web
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#tasks-dockercompose-__codelineno-38-6"></a>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#tasks-dockercompose-__codelineno-38-7"></a><span class="c1"># View logs with timestamps</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#tasks-dockercompose-__codelineno-38-8"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>--timestamps<span class="w"> </span>api
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#tasks-dockercompose-__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#tasks-dockercompose-__codelineno-38-10"></a><span class="c1"># Follow logs in real-time</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#tasks-dockercompose-__codelineno-38-11"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>-f
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#tasks-dockercompose-__codelineno-38-12"></a>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#tasks-dockercompose-__codelineno-38-13"></a><span class="c1"># View logs for all services</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#tasks-dockercompose-__codelineno-38-14"></a>docker-compose<span class="w"> </span>logs
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#tasks-dockercompose-__codelineno-38-15"></a>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#tasks-dockercompose-__codelineno-38-16"></a><span class="c1"># Export logs to file</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#tasks-dockercompose-__codelineno-38-17"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>&gt;<span class="w"> </span>app_logs.txt
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>logging.driver</strong>: Specifies the logging driver (json-file, syslog, etc.)</li>
<li><strong>max-size</strong>: Maximum size of log files before rotation</li>
<li><strong>max-file</strong>: Maximum number of log files to keep</li>
<li><strong>Log rotation</strong>: Automatic log file management</li>
<li><strong>Centralized logging</strong>: Collect logs from multiple services</li>
<li><strong>Log filtering</strong>: View logs by service or time range</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-12-resource-limits">12. Resource Limits<a class="headerlink" href="#tasks-dockercompose-12-resource-limits" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Set CPU and memory limits for services to ensure fair resource allocation and prevent resource exhaustion.</p>
<h4 id="tasks-dockercompose-scenario_11"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_11" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application runs multiple services on shared infrastructure, and you need to ensure that no single service can consume all available resources and impact other services.</li>
<li>Docker Compose resource limits allow you to control CPU and memory usage for each service.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>deploy.resources.limits</code> and <code>deploy.resources.reservations</code> for CPU and memory control</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#tasks-dockercompose-__codelineno-39-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#tasks-dockercompose-__codelineno-39-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#tasks-dockercompose-__codelineno-39-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#tasks-dockercompose-__codelineno-39-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#tasks-dockercompose-__codelineno-39-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#tasks-dockercompose-__codelineno-39-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#tasks-dockercompose-__codelineno-39-7"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#tasks-dockercompose-__codelineno-39-8"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#tasks-dockercompose-__codelineno-39-9"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#tasks-dockercompose-__codelineno-39-10"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#tasks-dockercompose-__codelineno-39-11"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#tasks-dockercompose-__codelineno-39-12"></a><span class="w">        </span><span class="nt">reservations</span><span class="p">:</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#tasks-dockercompose-__codelineno-39-13"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#tasks-dockercompose-__codelineno-39-14"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#tasks-dockercompose-__codelineno-39-15"></a>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#tasks-dockercompose-__codelineno-39-16"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#tasks-dockercompose-__codelineno-39-17"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#tasks-dockercompose-__codelineno-39-18"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#tasks-dockercompose-__codelineno-39-19"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#tasks-dockercompose-__codelineno-39-20"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#tasks-dockercompose-__codelineno-39-21"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#tasks-dockercompose-__codelineno-39-22"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#tasks-dockercompose-__codelineno-39-23"></a><span class="w">        </span><span class="nt">reservations</span><span class="p">:</span>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#tasks-dockercompose-__codelineno-39-24"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#tasks-dockercompose-__codelineno-39-25"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#tasks-dockercompose-__codelineno-39-26"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#tasks-dockercompose-__codelineno-39-27"></a><span class="l l-Scalar l-Scalar-Plain">while true; do</span>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28" href="#tasks-dockercompose-__codelineno-39-28"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">mem=\$(free | grep Mem | awk &#39;{printf \&quot;%.0f\&quot;, \$3/\$2 * 100.0}&#39;)</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29" href="#tasks-dockercompose-__codelineno-39-29"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">cpu=\$(top -bn1 | grep &#39;Cpu(s)&#39; | sed &#39;s/.*, *\([0-9.]*\)%* id.*/\1/&#39; | awk &#39;{print 100 - \$1}&#39;)</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30" href="#tasks-dockercompose-__codelineno-39-30"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">echo \&quot;Memory</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">\${mem}%, CPU</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">\${cpu}%\&quot;</span>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31" href="#tasks-dockercompose-__codelineno-39-31"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">sleep 10</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32" href="#tasks-dockercompose-__codelineno-39-32"></a><span class="l l-Scalar l-Scalar-Plain">done&quot;</span>
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33" href="#tasks-dockercompose-__codelineno-39-33"></a>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34" href="#tasks-dockercompose-__codelineno-39-34"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">db</span><span class="p p-Indicator">:</span>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35" href="#tasks-dockercompose-__codelineno-39-35"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36" href="#tasks-dockercompose-__codelineno-39-36"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37" href="#tasks-dockercompose-__codelineno-39-37"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38" href="#tasks-dockercompose-__codelineno-39-38"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-39-39"><a id="__codelineno-39-39" name="__codelineno-39-39" href="#tasks-dockercompose-__codelineno-39-39"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-39-40"><a id="__codelineno-39-40" name="__codelineno-39-40" href="#tasks-dockercompose-__codelineno-39-40"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-39-41"><a id="__codelineno-39-41" name="__codelineno-39-41" href="#tasks-dockercompose-__codelineno-39-41"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-39-42"><a id="__codelineno-39-42" name="__codelineno-39-42" href="#tasks-dockercompose-__codelineno-39-42"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-39-43"><a id="__codelineno-39-43" name="__codelineno-39-43" href="#tasks-dockercompose-__codelineno-39-43"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-39-44"><a id="__codelineno-39-44" name="__codelineno-39-44" href="#tasks-dockercompose-__codelineno-39-44"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.0&#39;</span>
</span><span id="__span-39-45"><a id="__codelineno-39-45" name="__codelineno-39-45" href="#tasks-dockercompose-__codelineno-39-45"></a><span class="w">        </span><span class="nt">reservations</span><span class="p">:</span>
</span><span id="__span-39-46"><a id="__codelineno-39-46" name="__codelineno-39-46" href="#tasks-dockercompose-__codelineno-39-46"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-39-47"><a id="__codelineno-39-47" name="__codelineno-39-47" href="#tasks-dockercompose-__codelineno-39-47"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-39-48"><a id="__codelineno-39-48" name="__codelineno-39-48" href="#tasks-dockercompose-__codelineno-39-48"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-39-49"><a id="__codelineno-39-49" name="__codelineno-39-49" href="#tasks-dockercompose-__codelineno-39-49"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-39-50"><a id="__codelineno-39-50" name="__codelineno-39-50" href="#tasks-dockercompose-__codelineno-39-50"></a>
</span><span id="__span-39-51"><a id="__codelineno-39-51" name="__codelineno-39-51" href="#tasks-dockercompose-__codelineno-39-51"></a><span class="w w-Error">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span id="__span-39-52"><a id="__codelineno-39-52" name="__codelineno-39-52" href="#tasks-dockercompose-__codelineno-39-52"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id="__span-39-53"><a id="__codelineno-39-53" name="__codelineno-39-53" href="#tasks-dockercompose-__codelineno-39-53"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-39-54"><a id="__codelineno-39-54" name="__codelineno-39-54" href="#tasks-dockercompose-__codelineno-39-54"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:9090&quot;</span>
</span><span id="__span-39-55"><a id="__codelineno-39-55" name="__codelineno-39-55" href="#tasks-dockercompose-__codelineno-39-55"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-39-56"><a id="__codelineno-39-56" name="__codelineno-39-56" href="#tasks-dockercompose-__codelineno-39-56"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml</span>
</span><span id="__span-39-57"><a id="__codelineno-39-57" name="__codelineno-39-57" href="#tasks-dockercompose-__codelineno-39-57"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-39-58"><a id="__codelineno-39-58" name="__codelineno-39-58" href="#tasks-dockercompose-__codelineno-39-58"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-39-59"><a id="__codelineno-39-59" name="__codelineno-39-59" href="#tasks-dockercompose-__codelineno-39-59"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-39-60"><a id="__codelineno-39-60" name="__codelineno-39-60" href="#tasks-dockercompose-__codelineno-39-60"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-39-61"><a id="__codelineno-39-61" name="__codelineno-39-61" href="#tasks-dockercompose-__codelineno-39-61"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-39-62"><a id="__codelineno-39-62" name="__codelineno-39-62" href="#tasks-dockercompose-__codelineno-39-62"></a>
</span><span id="__span-39-63"><a id="__codelineno-39-63" name="__codelineno-39-63" href="#tasks-dockercompose-__codelineno-39-63"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-39-64"><a id="__codelineno-39-64" name="__codelineno-39-64" href="#tasks-dockercompose-__codelineno-39-64"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#tasks-dockercompose-__codelineno-40-1"></a><span class="c1"># Start services with resource limits</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#tasks-dockercompose-__codelineno-40-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#tasks-dockercompose-__codelineno-40-3"></a>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#tasks-dockercompose-__codelineno-40-4"></a><span class="c1"># Check resource usage</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#tasks-dockercompose-__codelineno-40-5"></a>docker<span class="w"> </span>stats
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#tasks-dockercompose-__codelineno-40-6"></a>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#tasks-dockercompose-__codelineno-40-7"></a><span class="c1"># View resource limits</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#tasks-dockercompose-__codelineno-40-8"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#tasks-dockercompose-__codelineno-40-9"></a>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#tasks-dockercompose-__codelineno-40-10"></a><span class="c1"># Monitor specific container</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#tasks-dockercompose-__codelineno-40-11"></a>docker<span class="w"> </span>stats<span class="w"> </span><span class="k">$(</span>docker-compose<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>api<span class="k">)</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#tasks-dockercompose-__codelineno-40-12"></a>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#tasks-dockercompose-__codelineno-40-13"></a><span class="c1"># Check if limits are enforced (try to consume more memory)</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#tasks-dockercompose-__codelineno-40-14"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#tasks-dockercompose-__codelineno-40-15"></a><span class="s2">data=&#39;&#39;</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#tasks-dockercompose-__codelineno-40-16"></a><span class="s2">while true; do</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#tasks-dockercompose-__codelineno-40-17"></a><span class="s2">  data=\&quot;\$data\$data\&quot;</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#tasks-dockercompose-__codelineno-40-18"></a><span class="s2">  sleep 0.1</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#tasks-dockercompose-__codelineno-40-19"></a><span class="s2">done&quot;</span>
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>limits</strong>: Hard limits that containers cannot exceed</li>
<li><strong>reservations</strong>: Guaranteed minimum resources</li>
<li><strong>memory</strong>: RAM limits (supports m, g suffixes)</li>
<li><strong>cpus</strong>: CPU core limits (supports decimal values)</li>
<li><strong>Resource enforcement</strong>: Docker prevents exceeding limits</li>
<li><strong>Monitoring</strong>: Track resource usage with docker stats</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-13-profiles-and-selective-services">13. Profiles and Selective Services<a class="headerlink" href="#tasks-dockercompose-13-profiles-and-selective-services" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Use profiles to run different combinations of services for development, testing, and production.</p>
<h4 id="tasks-dockercompose-scenario_12"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_12" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application has services that are only needed in certain environments - debugging tools for development, testing services for CI/CD, and monitoring services for production.</li>
<li>Docker Compose profiles allow you to define which services run in different scenarios without modifying the compose file.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>profiles</code> to group services and <code>--profile</code> flag to run specific combinations</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#tasks-dockercompose-__codelineno-41-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#tasks-dockercompose-__codelineno-41-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#tasks-dockercompose-__codelineno-41-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#tasks-dockercompose-__codelineno-41-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#tasks-dockercompose-__codelineno-41-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#tasks-dockercompose-__codelineno-41-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#tasks-dockercompose-__codelineno-41-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#tasks-dockercompose-__codelineno-41-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#tasks-dockercompose-__codelineno-41-9"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#tasks-dockercompose-__codelineno-41-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#tasks-dockercompose-__codelineno-41-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#tasks-dockercompose-__codelineno-41-12"></a>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#tasks-dockercompose-__codelineno-41-13"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#tasks-dockercompose-__codelineno-41-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#tasks-dockercompose-__codelineno-41-15"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#tasks-dockercompose-__codelineno-41-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#tasks-dockercompose-__codelineno-41-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#tasks-dockercompose-__codelineno-41-18"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;API Response&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 8000 -h /tmp&#39;</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#tasks-dockercompose-__codelineno-41-19"></a>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#tasks-dockercompose-__codelineno-41-20"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#tasks-dockercompose-__codelineno-41-21"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#tasks-dockercompose-__codelineno-41-22"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#tasks-dockercompose-__codelineno-41-23"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#tasks-dockercompose-__codelineno-41-24"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#tasks-dockercompose-__codelineno-41-25"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#tasks-dockercompose-__codelineno-41-26"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27" href="#tasks-dockercompose-__codelineno-41-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28" href="#tasks-dockercompose-__codelineno-41-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">full</span>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29" href="#tasks-dockercompose-__codelineno-41-29"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30" href="#tasks-dockercompose-__codelineno-41-30"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31" href="#tasks-dockercompose-__codelineno-41-31"></a>
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32" href="#tasks-dockercompose-__codelineno-41-32"></a><span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33" href="#tasks-dockercompose-__codelineno-41-33"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-41-34"><a id="__codelineno-41-34" name="__codelineno-41-34" href="#tasks-dockercompose-__codelineno-41-34"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-41-35"><a id="__codelineno-41-35" name="__codelineno-41-35" href="#tasks-dockercompose-__codelineno-41-35"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debug</span>
</span><span id="__span-41-36"><a id="__codelineno-41-36" name="__codelineno-41-36" href="#tasks-dockercompose-__codelineno-41-36"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tail -f /dev/null</span>
</span><span id="__span-41-37"><a id="__codelineno-41-37" name="__codelineno-41-37" href="#tasks-dockercompose-__codelineno-41-37"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-41-38"><a id="__codelineno-41-38" name="__codelineno-41-38" href="#tasks-dockercompose-__codelineno-41-38"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
</span><span id="__span-41-39"><a id="__codelineno-41-39" name="__codelineno-41-39" href="#tasks-dockercompose-__codelineno-41-39"></a>
</span><span id="__span-41-40"><a id="__codelineno-41-40" name="__codelineno-41-40" href="#tasks-dockercompose-__codelineno-41-40"></a><span class="w">  </span><span class="nt">test</span><span class="p">:</span>
</span><span id="__span-41-41"><a id="__codelineno-41-41" name="__codelineno-41-41" href="#tasks-dockercompose-__codelineno-41-41"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:3.9-alpine</span>
</span><span id="__span-41-42"><a id="__codelineno-41-42" name="__codelineno-41-42" href="#tasks-dockercompose-__codelineno-41-42"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-41-43"><a id="__codelineno-41-43" name="__codelineno-41-43" href="#tasks-dockercompose-__codelineno-41-43"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
</span><span id="__span-41-44"><a id="__codelineno-41-44" name="__codelineno-41-44" href="#tasks-dockercompose-__codelineno-41-44"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python -m pytest /app/tests/</span>
</span><span id="__span-41-45"><a id="__codelineno-41-45" name="__codelineno-41-45" href="#tasks-dockercompose-__codelineno-41-45"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-41-46"><a id="__codelineno-41-46" name="__codelineno-41-46" href="#tasks-dockercompose-__codelineno-41-46"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.:/app</span>
</span><span id="__span-41-47"><a id="__codelineno-41-47" name="__codelineno-41-47" href="#tasks-dockercompose-__codelineno-41-47"></a>
</span><span id="__span-41-48"><a id="__codelineno-41-48" name="__codelineno-41-48" href="#tasks-dockercompose-__codelineno-41-48"></a><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span id="__span-41-49"><a id="__codelineno-41-49" name="__codelineno-41-49" href="#tasks-dockercompose-__codelineno-41-49"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id="__span-41-50"><a id="__codelineno-41-50" name="__codelineno-41-50" href="#tasks-dockercompose-__codelineno-41-50"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-41-51"><a id="__codelineno-41-51" name="__codelineno-41-51" href="#tasks-dockercompose-__codelineno-41-51"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:9090&quot;</span>
</span><span id="__span-41-52"><a id="__codelineno-41-52" name="__codelineno-41-52" href="#tasks-dockercompose-__codelineno-41-52"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-41-53"><a id="__codelineno-41-53" name="__codelineno-41-53" href="#tasks-dockercompose-__codelineno-41-53"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-41-54"><a id="__codelineno-41-54" name="__codelineno-41-54" href="#tasks-dockercompose-__codelineno-41-54"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-41-55"><a id="__codelineno-41-55" name="__codelineno-41-55" href="#tasks-dockercompose-__codelineno-41-55"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-41-56"><a id="__codelineno-41-56" name="__codelineno-41-56" href="#tasks-dockercompose-__codelineno-41-56"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml</span>
</span><span id="__span-41-57"><a id="__codelineno-41-57" name="__codelineno-41-57" href="#tasks-dockercompose-__codelineno-41-57"></a>
</span><span id="__span-41-58"><a id="__codelineno-41-58" name="__codelineno-41-58" href="#tasks-dockercompose-__codelineno-41-58"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-41-59"><a id="__codelineno-41-59" name="__codelineno-41-59" href="#tasks-dockercompose-__codelineno-41-59"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#tasks-dockercompose-__codelineno-42-1"></a><span class="c1"># Run only web service</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#tasks-dockercompose-__codelineno-42-2"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>web<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#tasks-dockercompose-__codelineno-42-3"></a>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#tasks-dockercompose-__codelineno-42-4"></a><span class="c1"># Run web with database</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#tasks-dockercompose-__codelineno-42-5"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>web<span class="w"> </span>--profile<span class="w"> </span>database<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#tasks-dockercompose-__codelineno-42-6"></a>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#tasks-dockercompose-__codelineno-42-7"></a><span class="c1"># Run full application stack</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#tasks-dockercompose-__codelineno-42-8"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>full<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#tasks-dockercompose-__codelineno-42-9"></a>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#tasks-dockercompose-__codelineno-42-10"></a><span class="c1"># Run tests</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#tasks-dockercompose-__codelineno-42-11"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span><span class="nb">test</span><span class="w"> </span>up
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#tasks-dockercompose-__codelineno-42-12"></a>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#tasks-dockercompose-__codelineno-42-13"></a><span class="c1"># Development with debug tools</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#tasks-dockercompose-__codelineno-42-14"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>full<span class="w"> </span>--profile<span class="w"> </span>debug<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#tasks-dockercompose-__codelineno-42-15"></a>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#tasks-dockercompose-__codelineno-42-16"></a><span class="c1"># Production with monitoring</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#tasks-dockercompose-__codelineno-42-17"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>full<span class="w"> </span>--profile<span class="w"> </span>production<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>profiles</strong>: Assign services to specific profiles</li>
<li><strong>&ndash;profile</strong>: Activate specific profiles when running</li>
<li><strong>Service grouping</strong>: Logical grouping of related services</li>
<li><strong>Environment-specific</strong>: Different service combinations per environment</li>
<li><strong>Selective deployment</strong>: Run only needed services for each use case</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-14-external-networks">14. External Networks<a class="headerlink" href="#tasks-dockercompose-14-external-networks" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Connect Docker Compose services to existing external networks for integration with other applications.</p>
<h4 id="tasks-dockercompose-scenario_13"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_13" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application needs to communicate with services running outside of Docker Compose, such as a company-wide database or legacy applications.</li>
<li>Docker Compose external networks allow services to connect to pre-existing Docker networks.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>external: true</code> and <code>name</code> to connect to existing Docker networks</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#tasks-dockercompose-__codelineno-43-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#tasks-dockercompose-__codelineno-43-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#tasks-dockercompose-__codelineno-43-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#tasks-dockercompose-__codelineno-43-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#tasks-dockercompose-__codelineno-43-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#tasks-dockercompose-__codelineno-43-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#tasks-dockercompose-__codelineno-43-7"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#tasks-dockercompose-__codelineno-43-8"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#tasks-dockercompose-__codelineno-43-9"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-network</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#tasks-dockercompose-__codelineno-43-10"></a>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#tasks-dockercompose-__codelineno-43-11"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#tasks-dockercompose-__codelineno-43-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#tasks-dockercompose-__codelineno-43-13"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#tasks-dockercompose-__codelineno-43-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">app-network</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#tasks-dockercompose-__codelineno-43-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-network</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#tasks-dockercompose-__codelineno-43-16"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;busybox httpd -f -p 8000 -h /tmp&quot;</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#tasks-dockercompose-__codelineno-43-17"></a>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#tasks-dockercompose-__codelineno-43-18"></a><span class="w">  </span><span class="nt">legacy-connector</span><span class="p">:</span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#tasks-dockercompose-__codelineno-43-19"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#tasks-dockercompose-__codelineno-43-20"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#tasks-dockercompose-__codelineno-43-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">external-network</span>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#tasks-dockercompose-__codelineno-43-22"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ping -c 4 legacy-service</span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#tasks-dockercompose-__codelineno-43-23"></a>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#tasks-dockercompose-__codelineno-43-24"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#tasks-dockercompose-__codelineno-43-25"></a><span class="w">  </span><span class="nt">app-network</span><span class="p">:</span>
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#tasks-dockercompose-__codelineno-43-26"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27" href="#tasks-dockercompose-__codelineno-43-27"></a><span class="w">  </span><span class="nt">external-network</span><span class="p">:</span>
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28" href="#tasks-dockercompose-__codelineno-43-28"></a><span class="w">    </span><span class="nt">external</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29" href="#tasks-dockercompose-__codelineno-43-29"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">company-network</span>
</span></code></pre></div></p>
<p><strong>Setup Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#tasks-dockercompose-__codelineno-44-1"></a><span class="c1"># Create external network (if not exists)</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#tasks-dockercompose-__codelineno-44-2"></a>docker<span class="w"> </span>network<span class="w"> </span>create<span class="w"> </span>company-network
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#tasks-dockercompose-__codelineno-44-3"></a>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#tasks-dockercompose-__codelineno-44-4"></a><span class="c1"># Start external service</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#tasks-dockercompose-__codelineno-44-5"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>legacy-service<span class="w"> </span>--network<span class="w"> </span>company-network<span class="w"> </span>alpine<span class="w"> </span>sleep<span class="w"> </span>infinity
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#tasks-dockercompose-__codelineno-44-6"></a>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#tasks-dockercompose-__codelineno-44-7"></a><span class="c1"># Start compose services</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#tasks-dockercompose-__codelineno-44-8"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#tasks-dockercompose-__codelineno-44-9"></a>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#tasks-dockercompose-__codelineno-44-10"></a><span class="c1"># Test connectivity</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#tasks-dockercompose-__codelineno-44-11"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>legacy-connector<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span>legacy-service
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#tasks-dockercompose-__codelineno-44-12"></a>
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#tasks-dockercompose-__codelineno-44-13"></a><span class="c1"># Check networks</span>
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#tasks-dockercompose-__codelineno-44-14"></a>docker<span class="w"> </span>network<span class="w"> </span>ls
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#tasks-dockercompose-__codelineno-44-15"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>company-network
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>external: true</strong>: Connect to existing Docker network</li>
<li><strong>name</strong>: Specify the exact network name</li>
<li><strong>Network sharing</strong>: Services can communicate across compose files</li>
<li><strong>Legacy integration</strong>: Connect to existing infrastructure</li>
<li><strong>Network isolation</strong>: Control which services access external networks</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-15-custom-networks">15. Custom Networks<a class="headerlink" href="#tasks-dockercompose-15-custom-networks" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create custom networks with specific configurations for advanced networking requirements.</p>
<h4 id="tasks-dockercompose-scenario_14"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_14" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application requires specific network configurations like custom subnets, IP ranges, or network drivers for security, performance, or compliance reasons.</li>
<li>Docker Compose custom networks allow you to define network properties like IP ranges, subnets, and drivers.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>ipam.config</code> to define custom subnets and <code>ipv4_address</code> for static IP assignment</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#tasks-dockercompose-__codelineno-45-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#tasks-dockercompose-__codelineno-45-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#tasks-dockercompose-__codelineno-45-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#tasks-dockercompose-__codelineno-45-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#tasks-dockercompose-__codelineno-45-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#tasks-dockercompose-__codelineno-45-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#tasks-dockercompose-__codelineno-45-7"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#tasks-dockercompose-__codelineno-45-8"></a><span class="w">      </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#tasks-dockercompose-__codelineno-45-9"></a><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.10</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#tasks-dockercompose-__codelineno-45-10"></a>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#tasks-dockercompose-__codelineno-45-11"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#tasks-dockercompose-__codelineno-45-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#tasks-dockercompose-__codelineno-45-13"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#tasks-dockercompose-__codelineno-45-14"></a><span class="w">      </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#tasks-dockercompose-__codelineno-45-15"></a><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.11</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#tasks-dockercompose-__codelineno-45-16"></a><span class="w">      </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#tasks-dockercompose-__codelineno-45-17"></a><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.10</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#tasks-dockercompose-__codelineno-45-18"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;busybox httpd -f -p 8000 -h /tmp&quot;</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#tasks-dockercompose-__codelineno-45-19"></a>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#tasks-dockercompose-__codelineno-45-20"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#tasks-dockercompose-__codelineno-45-21"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#tasks-dockercompose-__codelineno-45-22"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#tasks-dockercompose-__codelineno-45-23"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#tasks-dockercompose-__codelineno-45-24"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25" href="#tasks-dockercompose-__codelineno-45-25"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26" href="#tasks-dockercompose-__codelineno-45-26"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-45-27"><a id="__codelineno-45-27" name="__codelineno-45-27" href="#tasks-dockercompose-__codelineno-45-27"></a><span class="w">      </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-45-28"><a id="__codelineno-45-28" name="__codelineno-45-28" href="#tasks-dockercompose-__codelineno-45-28"></a><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.11</span>
</span><span id="__span-45-29"><a id="__codelineno-45-29" name="__codelineno-45-29" href="#tasks-dockercompose-__codelineno-45-29"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-45-30"><a id="__codelineno-45-30" name="__codelineno-45-30" href="#tasks-dockercompose-__codelineno-45-30"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-45-31"><a id="__codelineno-45-31" name="__codelineno-45-31" href="#tasks-dockercompose-__codelineno-45-31"></a>
</span><span id="__span-45-32"><a id="__codelineno-45-32" name="__codelineno-45-32" href="#tasks-dockercompose-__codelineno-45-32"></a><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span id="__span-45-33"><a id="__codelineno-45-33" name="__codelineno-45-33" href="#tasks-dockercompose-__codelineno-45-33"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-45-34"><a id="__codelineno-45-34" name="__codelineno-45-34" href="#tasks-dockercompose-__codelineno-45-34"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-45-35"><a id="__codelineno-45-35" name="__codelineno-45-35" href="#tasks-dockercompose-__codelineno-45-35"></a><span class="w">      </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-45-36"><a id="__codelineno-45-36" name="__codelineno-45-36" href="#tasks-dockercompose-__codelineno-45-36"></a><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.12</span>
</span><span id="__span-45-37"><a id="__codelineno-45-37" name="__codelineno-45-37" href="#tasks-dockercompose-__codelineno-45-37"></a><span class="w">      </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-45-38"><a id="__codelineno-45-38" name="__codelineno-45-38" href="#tasks-dockercompose-__codelineno-45-38"></a><span class="w">        </span><span class="nt">ipv4_address</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.12</span>
</span><span id="__span-45-39"><a id="__codelineno-45-39" name="__codelineno-45-39" href="#tasks-dockercompose-__codelineno-45-39"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">watch -n 5 &#39;echo &quot;Monitoring networks&quot;&#39;</span>
</span><span id="__span-45-40"><a id="__codelineno-45-40" name="__codelineno-45-40" href="#tasks-dockercompose-__codelineno-45-40"></a>
</span><span id="__span-45-41"><a id="__codelineno-45-41" name="__codelineno-45-41" href="#tasks-dockercompose-__codelineno-45-41"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-45-42"><a id="__codelineno-45-42" name="__codelineno-45-42" href="#tasks-dockercompose-__codelineno-45-42"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-45-43"><a id="__codelineno-45-43" name="__codelineno-45-43" href="#tasks-dockercompose-__codelineno-45-43"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-45-44"><a id="__codelineno-45-44" name="__codelineno-45-44" href="#tasks-dockercompose-__codelineno-45-44"></a><span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
</span><span id="__span-45-45"><a id="__codelineno-45-45" name="__codelineno-45-45" href="#tasks-dockercompose-__codelineno-45-45"></a><span class="w">      </span><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-45-46"><a id="__codelineno-45-46" name="__codelineno-45-46" href="#tasks-dockercompose-__codelineno-45-46"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.0/16</span>
</span><span id="__span-45-47"><a id="__codelineno-45-47" name="__codelineno-45-47" href="#tasks-dockercompose-__codelineno-45-47"></a><span class="w">          </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.1</span>
</span><span id="__span-45-48"><a id="__codelineno-45-48" name="__codelineno-45-48" href="#tasks-dockercompose-__codelineno-45-48"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-45-49"><a id="__codelineno-45-49" name="__codelineno-45-49" href="#tasks-dockercompose-__codelineno-45-49"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-45-50"><a id="__codelineno-45-50" name="__codelineno-45-50" href="#tasks-dockercompose-__codelineno-45-50"></a><span class="w">    </span><span class="nt">internal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-45-51"><a id="__codelineno-45-51" name="__codelineno-45-51" href="#tasks-dockercompose-__codelineno-45-51"></a><span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
</span><span id="__span-45-52"><a id="__codelineno-45-52" name="__codelineno-45-52" href="#tasks-dockercompose-__codelineno-45-52"></a><span class="w">      </span><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-45-53"><a id="__codelineno-45-53" name="__codelineno-45-53" href="#tasks-dockercompose-__codelineno-45-53"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.0/16</span>
</span><span id="__span-45-54"><a id="__codelineno-45-54" name="__codelineno-45-54" href="#tasks-dockercompose-__codelineno-45-54"></a><span class="w">          </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.1</span>
</span><span id="__span-45-55"><a id="__codelineno-45-55" name="__codelineno-45-55" href="#tasks-dockercompose-__codelineno-45-55"></a>
</span><span id="__span-45-56"><a id="__codelineno-45-56" name="__codelineno-45-56" href="#tasks-dockercompose-__codelineno-45-56"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-45-57"><a id="__codelineno-45-57" name="__codelineno-45-57" href="#tasks-dockercompose-__codelineno-45-57"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#tasks-dockercompose-__codelineno-46-1"></a><span class="c1"># Start services with custom networks</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#tasks-dockercompose-__codelineno-46-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#tasks-dockercompose-__codelineno-46-3"></a>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#tasks-dockercompose-__codelineno-46-4"></a><span class="c1"># Check network configurations</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#tasks-dockercompose-__codelineno-46-5"></a>docker<span class="w"> </span>network<span class="w"> </span>ls
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#tasks-dockercompose-__codelineno-46-6"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span><span class="k">$(</span>docker-compose<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>web<span class="w"> </span><span class="p">|</span><span class="w"> </span>xargs<span class="w"> </span>docker<span class="w"> </span>inspect<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s1">&#39;.[0].NetworkSettings.Networks | keys[]&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#tasks-dockercompose-__codelineno-46-7"></a>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#tasks-dockercompose-__codelineno-46-8"></a><span class="c1"># Test connectivity</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#tasks-dockercompose-__codelineno-46-9"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">172</span>.20.0.11
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#tasks-dockercompose-__codelineno-46-10"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>ping<span class="w"> </span>-c<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="m">172</span>.21.0.11
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#tasks-dockercompose-__codelineno-46-11"></a>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#tasks-dockercompose-__codelineno-46-12"></a><span class="c1"># Check IP assignments</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#tasks-dockercompose-__codelineno-46-13"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>ip<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span>eth0
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>ipam.config</strong>: Define custom IP address management</li>
<li><strong>subnet</strong>: IP address range for the network</li>
<li><strong>ipv4_address</strong>: Assign static IP to specific services</li>
<li><strong>internal: true</strong>: Prevent external access to backend network</li>
<li><strong>Network segmentation</strong>: Separate frontend and backend traffic</li>
<li><strong>IP predictability</strong>: Static IPs for consistent service communication</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-16-load-balancing">16. Load Balancing<a class="headerlink" href="#tasks-dockercompose-16-load-balancing" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Implement load balancing across multiple service instances for high availability and scalability.</p>
<h4 id="tasks-dockercompose-scenario_15"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_15" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application needs to handle high traffic loads and provide fault tolerance by distributing requests across multiple service instances.</li>
<li>Docker Compose load balancing works with service scaling to automatically distribute traffic across healthy instances.</li>
</ul>
<h4 id="tasks-dockercompose-resources_6">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_6" title="Permanent link">&para;</a></h4>
<ul>
<li><code>nginx/loadbalancer.conf</code> ‚û§ <code>/etc/nginx/nginx.conf</code>
    <div class="language-nginx highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#tasks-dockercompose-__codelineno-47-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#tasks-dockercompose-__codelineno-47-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#tasks-dockercompose-__codelineno-47-3"></a><span class="p">}</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#tasks-dockercompose-__codelineno-47-4"></a>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#tasks-dockercompose-__codelineno-47-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#tasks-dockercompose-__codelineno-47-6"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">web_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#tasks-dockercompose-__codelineno-47-7"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">web</span><span class="p">:</span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#tasks-dockercompose-__codelineno-47-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#tasks-dockercompose-__codelineno-47-9"></a>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#tasks-dockercompose-__codelineno-47-10"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">api_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#tasks-dockercompose-__codelineno-47-11"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#tasks-dockercompose-__codelineno-47-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#tasks-dockercompose-__codelineno-47-13"></a>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#tasks-dockercompose-__codelineno-47-14"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#tasks-dockercompose-__codelineno-47-15"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#tasks-dockercompose-__codelineno-47-16"></a>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#tasks-dockercompose-__codelineno-47-17"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#tasks-dockercompose-__codelineno-47-18"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://web_backend</span><span class="p">;</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#tasks-dockercompose-__codelineno-47-19"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#tasks-dockercompose-__codelineno-47-20"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#tasks-dockercompose-__codelineno-47-21"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#tasks-dockercompose-__codelineno-47-22"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#tasks-dockercompose-__codelineno-47-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#tasks-dockercompose-__codelineno-47-24"></a>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#tasks-dockercompose-__codelineno-47-25"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#tasks-dockercompose-__codelineno-47-26"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api_backend</span><span class="p">;</span>
</span><span id="__span-47-27"><a id="__codelineno-47-27" name="__codelineno-47-27" href="#tasks-dockercompose-__codelineno-47-27"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-47-28"><a id="__codelineno-47-28" name="__codelineno-47-28" href="#tasks-dockercompose-__codelineno-47-28"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-47-29"><a id="__codelineno-47-29" name="__codelineno-47-29" href="#tasks-dockercompose-__codelineno-47-29"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span id="__span-47-30"><a id="__codelineno-47-30" name="__codelineno-47-30" href="#tasks-dockercompose-__codelineno-47-30"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
</span><span id="__span-47-31"><a id="__codelineno-47-31" name="__codelineno-47-31" href="#tasks-dockercompose-__codelineno-47-31"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-47-32"><a id="__codelineno-47-32" name="__codelineno-47-32" href="#tasks-dockercompose-__codelineno-47-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-47-33"><a id="__codelineno-47-33" name="__codelineno-47-33" href="#tasks-dockercompose-__codelineno-47-33"></a><span class="p">}</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use nginx as load balancer with upstream blocks and deploy.replicas for scaling</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#tasks-dockercompose-__codelineno-48-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#tasks-dockercompose-__codelineno-48-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#tasks-dockercompose-__codelineno-48-3"></a><span class="w">  </span><span class="nt">loadbalancer</span><span class="p">:</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#tasks-dockercompose-__codelineno-48-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#tasks-dockercompose-__codelineno-48-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#tasks-dockercompose-__codelineno-48-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#tasks-dockercompose-__codelineno-48-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#tasks-dockercompose-__codelineno-48-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./nginx/loadbalancer.conf:/etc/nginx/nginx.conf</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#tasks-dockercompose-__codelineno-48-9"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#tasks-dockercompose-__codelineno-48-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#tasks-dockercompose-__codelineno-48-11"></a>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#tasks-dockercompose-__codelineno-48-12"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#tasks-dockercompose-__codelineno-48-13"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#tasks-dockercompose-__codelineno-48-14"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#tasks-dockercompose-__codelineno-48-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#tasks-dockercompose-__codelineno-48-16"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#tasks-dockercompose-__codelineno-48-17"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#tasks-dockercompose-__codelineno-48-18"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#tasks-dockercompose-__codelineno-48-19"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#tasks-dockercompose-__codelineno-48-20"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-48-21"><a id="__codelineno-48-21" name="__codelineno-48-21" href="#tasks-dockercompose-__codelineno-48-21"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-48-22"><a id="__codelineno-48-22" name="__codelineno-48-22" href="#tasks-dockercompose-__codelineno-48-22"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-48-23"><a id="__codelineno-48-23" name="__codelineno-48-23" href="#tasks-dockercompose-__codelineno-48-23"></a>
</span><span id="__span-48-24"><a id="__codelineno-48-24" name="__codelineno-48-24" href="#tasks-dockercompose-__codelineno-48-24"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-48-25"><a id="__codelineno-48-25" name="__codelineno-48-25" href="#tasks-dockercompose-__codelineno-48-25"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-48-26"><a id="__codelineno-48-26" name="__codelineno-48-26" href="#tasks-dockercompose-__codelineno-48-26"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-48-27"><a id="__codelineno-48-27" name="__codelineno-48-27" href="#tasks-dockercompose-__codelineno-48-27"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-48-28"><a id="__codelineno-48-28" name="__codelineno-48-28" href="#tasks-dockercompose-__codelineno-48-28"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &quot;</span>
</span><span id="__span-48-29"><a id="__codelineno-48-29" name="__codelineno-48-29" href="#tasks-dockercompose-__codelineno-48-29"></a><span class="l l-Scalar l-Scalar-Plain">while true; do</span>
</span><span id="__span-48-30"><a id="__codelineno-48-30" name="__codelineno-48-30" href="#tasks-dockercompose-__codelineno-48-30"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">hostname=\$(hostname)</span>
</span><span id="__span-48-31"><a id="__codelineno-48-31" name="__codelineno-48-31" href="#tasks-dockercompose-__codelineno-48-31"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">{ echo -e \&quot;HTTP/1.1 200 OK\r\nContent-Type</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">text/plain\r\n\r\nAPI Response from \$hostname\&quot;; } | nc -l -p 8000 -q 1 &gt; /dev/null</span>
</span><span id="__span-48-32"><a id="__codelineno-48-32" name="__codelineno-48-32" href="#tasks-dockercompose-__codelineno-48-32"></a><span class="l l-Scalar l-Scalar-Plain">done&quot;</span>
</span><span id="__span-48-33"><a id="__codelineno-48-33" name="__codelineno-48-33" href="#tasks-dockercompose-__codelineno-48-33"></a><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">healthcheck</span><span class="p p-Indicator">:</span>
</span><span id="__span-48-34"><a id="__codelineno-48-34" name="__codelineno-48-34" href="#tasks-dockercompose-__codelineno-48-34"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;OK&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-48-35"><a id="__codelineno-48-35" name="__codelineno-48-35" href="#tasks-dockercompose-__codelineno-48-35"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
</span><span id="__span-48-36"><a id="__codelineno-48-36" name="__codelineno-48-36" href="#tasks-dockercompose-__codelineno-48-36"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-48-37"><a id="__codelineno-48-37" name="__codelineno-48-37" href="#tasks-dockercompose-__codelineno-48-37"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-48-38"><a id="__codelineno-48-38" name="__codelineno-48-38" href="#tasks-dockercompose-__codelineno-48-38"></a>
</span><span id="__span-48-39"><a id="__codelineno-48-39" name="__codelineno-48-39" href="#tasks-dockercompose-__codelineno-48-39"></a><span class="w w-Error">  </span><span class="nt">redis</span><span class="p">:</span>
</span><span id="__span-48-40"><a id="__codelineno-48-40" name="__codelineno-48-40" href="#tasks-dockercompose-__codelineno-48-40"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:alpine</span>
</span><span id="__span-48-41"><a id="__codelineno-48-41" name="__codelineno-48-41" href="#tasks-dockercompose-__codelineno-48-41"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-48-42"><a id="__codelineno-48-42" name="__codelineno-48-42" href="#tasks-dockercompose-__codelineno-48-42"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
</span><span id="__span-48-43"><a id="__codelineno-48-43" name="__codelineno-48-43" href="#tasks-dockercompose-__codelineno-48-43"></a>
</span><span id="__span-48-44"><a id="__codelineno-48-44" name="__codelineno-48-44" href="#tasks-dockercompose-__codelineno-48-44"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-48-45"><a id="__codelineno-48-45" name="__codelineno-48-45" href="#tasks-dockercompose-__codelineno-48-45"></a><span class="w">  </span><span class="nt">redis_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>nginx/loadbalancer.conf</strong>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#tasks-dockercompose-__codelineno-49-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#tasks-dockercompose-__codelineno-49-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#tasks-dockercompose-__codelineno-49-3"></a><span class="p">}</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#tasks-dockercompose-__codelineno-49-4"></a>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#tasks-dockercompose-__codelineno-49-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#tasks-dockercompose-__codelineno-49-6"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">web_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#tasks-dockercompose-__codelineno-49-7"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">web</span><span class="p">:</span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#tasks-dockercompose-__codelineno-49-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#tasks-dockercompose-__codelineno-49-9"></a>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#tasks-dockercompose-__codelineno-49-10"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">api_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#tasks-dockercompose-__codelineno-49-11"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#tasks-dockercompose-__codelineno-49-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#tasks-dockercompose-__codelineno-49-13"></a>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#tasks-dockercompose-__codelineno-49-14"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#tasks-dockercompose-__codelineno-49-15"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#tasks-dockercompose-__codelineno-49-16"></a>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#tasks-dockercompose-__codelineno-49-17"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#tasks-dockercompose-__codelineno-49-18"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://web_backend</span><span class="p">;</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#tasks-dockercompose-__codelineno-49-19"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#tasks-dockercompose-__codelineno-49-20"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#tasks-dockercompose-__codelineno-49-21"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#tasks-dockercompose-__codelineno-49-22"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#tasks-dockercompose-__codelineno-49-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#tasks-dockercompose-__codelineno-49-24"></a>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#tasks-dockercompose-__codelineno-49-25"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#tasks-dockercompose-__codelineno-49-26"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api_backend</span><span class="p">;</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#tasks-dockercompose-__codelineno-49-27"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#tasks-dockercompose-__codelineno-49-28"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#tasks-dockercompose-__codelineno-49-29"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-For</span><span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30" href="#tasks-dockercompose-__codelineno-49-30"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="nv">$scheme</span><span class="p">;</span>
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31" href="#tasks-dockercompose-__codelineno-49-31"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32" href="#tasks-dockercompose-__codelineno-49-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33" href="#tasks-dockercompose-__codelineno-49-33"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#tasks-dockercompose-__codelineno-50-1"></a><span class="c1"># Start load balanced services</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#tasks-dockercompose-__codelineno-50-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#tasks-dockercompose-__codelineno-50-3"></a>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#tasks-dockercompose-__codelineno-50-4"></a><span class="c1"># Test load balancing</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#tasks-dockercompose-__codelineno-50-5"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..10<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:8080/api<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;API Response&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#tasks-dockercompose-__codelineno-50-6"></a>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#tasks-dockercompose-__codelineno-50-7"></a><span class="c1"># Check service instances</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#tasks-dockercompose-__codelineno-50-8"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#tasks-dockercompose-__codelineno-50-9"></a>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#tasks-dockercompose-__codelineno-50-10"></a><span class="c1"># Scale services</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#tasks-dockercompose-__codelineno-50-11"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span><span class="nv">web</span><span class="o">=</span><span class="m">5</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#tasks-dockercompose-__codelineno-50-12"></a>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#tasks-dockercompose-__codelineno-50-13"></a><span class="c1"># Test failover (stop one instance)</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#tasks-dockercompose-__codelineno-50-14"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web.1<span class="w"> </span>nginx<span class="w"> </span>-s<span class="w"> </span>stop
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#tasks-dockercompose-__codelineno-50-15"></a><span class="c1"># Requests should still work</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#tasks-dockercompose-__codelineno-50-16"></a>curl<span class="w"> </span>http://localhost:8080/
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>upstream blocks</strong>: Define backend server groups for load balancing</li>
<li><strong>proxy_pass</strong>: Forward requests to backend services</li>
<li><strong>deploy.replicas</strong>: Create multiple instances for load distribution</li>
<li><strong>healthcheck</strong>: Ensure only healthy instances receive traffic</li>
<li><strong>Automatic failover</strong>: Traffic rerouted when instances become unhealthy</li>
<li><strong>Session persistence</strong>: Optional sticky sessions for stateful applications</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-17-multi-stage-deployments">17. Multi-Stage Deployments<a class="headerlink" href="#tasks-dockercompose-17-multi-stage-deployments" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Implement blue-green or canary deployment strategies using Docker Compose.</p>
<h4 id="tasks-dockercompose-scenario_16"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_16" title="Permanent link">&para;</a></h4>
<ul>
<li>You need to deploy application updates with zero downtime and the ability to quickly rollback if issues occur.</li>
<li>Multi-stage deployments with Docker Compose allow you to run multiple versions of your application simultaneously and gradually shift traffic.</li>
</ul>
<h4 id="tasks-dockercompose-resources_7">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_7" title="Permanent link">&para;</a></h4>
<ul>
<li><code>nginx/nginx.conf</code> ‚û§ Load balancer configuration for canary deployment
    <div class="language-nginx highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#tasks-dockercompose-__codelineno-51-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#tasks-dockercompose-__codelineno-51-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#tasks-dockercompose-__codelineno-51-3"></a><span class="p">}</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#tasks-dockercompose-__codelineno-51-4"></a>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#tasks-dockercompose-__codelineno-51-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#tasks-dockercompose-__codelineno-51-6"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">web_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#tasks-dockercompose-__codelineno-51-7"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">web-v1</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">weight=9</span><span class="p">;</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#tasks-dockercompose-__codelineno-51-8"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">web-v2</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">weight=1</span><span class="p">;</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#tasks-dockercompose-__codelineno-51-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#tasks-dockercompose-__codelineno-51-10"></a>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#tasks-dockercompose-__codelineno-51-11"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">api_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#tasks-dockercompose-__codelineno-51-12"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api-v1</span><span class="p">:</span><span class="mi">8000</span><span class="w"> </span><span class="s">weight=9</span><span class="p">;</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#tasks-dockercompose-__codelineno-51-13"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api-v2</span><span class="p">:</span><span class="mi">8000</span><span class="w"> </span><span class="s">weight=1</span><span class="p">;</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#tasks-dockercompose-__codelineno-51-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#tasks-dockercompose-__codelineno-51-15"></a>
</span><span id="__span-51-16"><a id="__codelineno-51-16" name="__codelineno-51-16" href="#tasks-dockercompose-__codelineno-51-16"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-17"><a id="__codelineno-51-17" name="__codelineno-51-17" href="#tasks-dockercompose-__codelineno-51-17"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-51-18"><a id="__codelineno-51-18" name="__codelineno-51-18" href="#tasks-dockercompose-__codelineno-51-18"></a>
</span><span id="__span-51-19"><a id="__codelineno-51-19" name="__codelineno-51-19" href="#tasks-dockercompose-__codelineno-51-19"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-20"><a id="__codelineno-51-20" name="__codelineno-51-20" href="#tasks-dockercompose-__codelineno-51-20"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://web_backend</span><span class="p">;</span>
</span><span id="__span-51-21"><a id="__codelineno-51-21" name="__codelineno-51-21" href="#tasks-dockercompose-__codelineno-51-21"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-51-22"><a id="__codelineno-51-22" name="__codelineno-51-22" href="#tasks-dockercompose-__codelineno-51-22"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-51-23"><a id="__codelineno-51-23" name="__codelineno-51-23" href="#tasks-dockercompose-__codelineno-51-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-51-24"><a id="__codelineno-51-24" name="__codelineno-51-24" href="#tasks-dockercompose-__codelineno-51-24"></a>
</span><span id="__span-51-25"><a id="__codelineno-51-25" name="__codelineno-51-25" href="#tasks-dockercompose-__codelineno-51-25"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-51-26"><a id="__codelineno-51-26" name="__codelineno-51-26" href="#tasks-dockercompose-__codelineno-51-26"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api_backend</span><span class="p">;</span>
</span><span id="__span-51-27"><a id="__codelineno-51-27" name="__codelineno-51-27" href="#tasks-dockercompose-__codelineno-51-27"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-51-28"><a id="__codelineno-51-28" name="__codelineno-51-28" href="#tasks-dockercompose-__codelineno-51-28"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-51-29"><a id="__codelineno-51-29" name="__codelineno-51-29" href="#tasks-dockercompose-__codelineno-51-29"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-51-30"><a id="__codelineno-51-30" name="__codelineno-51-30" href="#tasks-dockercompose-__codelineno-51-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-51-31"><a id="__codelineno-51-31" name="__codelineno-51-31" href="#tasks-dockercompose-__codelineno-51-31"></a><span class="p">}</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use profiles to control which version runs and nginx upstream weights for traffic shifting</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong> (base)
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#tasks-dockercompose-__codelineno-52-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#tasks-dockercompose-__codelineno-52-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#tasks-dockercompose-__codelineno-52-3"></a><span class="w">  </span><span class="nt">loadbalancer</span><span class="p">:</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#tasks-dockercompose-__codelineno-52-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#tasks-dockercompose-__codelineno-52-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#tasks-dockercompose-__codelineno-52-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#tasks-dockercompose-__codelineno-52-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#tasks-dockercompose-__codelineno-52-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./nginx/nginx.conf:/etc/nginx/nginx.conf</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#tasks-dockercompose-__codelineno-52-9"></a>
</span><span id="__span-52-10"><a id="__codelineno-52-10" name="__codelineno-52-10" href="#tasks-dockercompose-__codelineno-52-10"></a><span class="w">  </span><span class="nt">web-v1</span><span class="p">:</span>
</span><span id="__span-52-11"><a id="__codelineno-52-11" name="__codelineno-52-11" href="#tasks-dockercompose-__codelineno-52-11"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-52-12"><a id="__codelineno-52-12" name="__codelineno-52-12" href="#tasks-dockercompose-__codelineno-52-12"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-52-13"><a id="__codelineno-52-13" name="__codelineno-52-13" href="#tasks-dockercompose-__codelineno-52-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web/v1:/usr/share/nginx/html</span>
</span><span id="__span-52-14"><a id="__codelineno-52-14" name="__codelineno-52-14" href="#tasks-dockercompose-__codelineno-52-14"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-52-15"><a id="__codelineno-52-15" name="__codelineno-52-15" href="#tasks-dockercompose-__codelineno-52-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VERSION=v1</span>
</span><span id="__span-52-16"><a id="__codelineno-52-16" name="__codelineno-52-16" href="#tasks-dockercompose-__codelineno-52-16"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-52-17"><a id="__codelineno-52-17" name="__codelineno-52-17" href="#tasks-dockercompose-__codelineno-52-17"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-52-18"><a id="__codelineno-52-18" name="__codelineno-52-18" href="#tasks-dockercompose-__codelineno-52-18"></a>
</span><span id="__span-52-19"><a id="__codelineno-52-19" name="__codelineno-52-19" href="#tasks-dockercompose-__codelineno-52-19"></a><span class="w">  </span><span class="nt">web-v2</span><span class="p">:</span>
</span><span id="__span-52-20"><a id="__codelineno-52-20" name="__codelineno-52-20" href="#tasks-dockercompose-__codelineno-52-20"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-52-21"><a id="__codelineno-52-21" name="__codelineno-52-21" href="#tasks-dockercompose-__codelineno-52-21"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-52-22"><a id="__codelineno-52-22" name="__codelineno-52-22" href="#tasks-dockercompose-__codelineno-52-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web/v2:/usr/share/nginx/html</span>
</span><span id="__span-52-23"><a id="__codelineno-52-23" name="__codelineno-52-23" href="#tasks-dockercompose-__codelineno-52-23"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-52-24"><a id="__codelineno-52-24" name="__codelineno-52-24" href="#tasks-dockercompose-__codelineno-52-24"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VERSION=v2</span>
</span><span id="__span-52-25"><a id="__codelineno-52-25" name="__codelineno-52-25" href="#tasks-dockercompose-__codelineno-52-25"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-52-26"><a id="__codelineno-52-26" name="__codelineno-52-26" href="#tasks-dockercompose-__codelineno-52-26"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-52-27"><a id="__codelineno-52-27" name="__codelineno-52-27" href="#tasks-dockercompose-__codelineno-52-27"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-52-28"><a id="__codelineno-52-28" name="__codelineno-52-28" href="#tasks-dockercompose-__codelineno-52-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
</span><span id="__span-52-29"><a id="__codelineno-52-29" name="__codelineno-52-29" href="#tasks-dockercompose-__codelineno-52-29"></a>
</span><span id="__span-52-30"><a id="__codelineno-52-30" name="__codelineno-52-30" href="#tasks-dockercompose-__codelineno-52-30"></a><span class="w">  </span><span class="nt">api-v1</span><span class="p">:</span>
</span><span id="__span-52-31"><a id="__codelineno-52-31" name="__codelineno-52-31" href="#tasks-dockercompose-__codelineno-52-31"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-52-32"><a id="__codelineno-52-32" name="__codelineno-52-32" href="#tasks-dockercompose-__codelineno-52-32"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-52-33"><a id="__codelineno-52-33" name="__codelineno-52-33" href="#tasks-dockercompose-__codelineno-52-33"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VERSION=v1</span>
</span><span id="__span-52-34"><a id="__codelineno-52-34" name="__codelineno-52-34" href="#tasks-dockercompose-__codelineno-52-34"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;API v1&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 8000 -h /tmp&#39;</span>
</span><span id="__span-52-35"><a id="__codelineno-52-35" name="__codelineno-52-35" href="#tasks-dockercompose-__codelineno-52-35"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-52-36"><a id="__codelineno-52-36" name="__codelineno-52-36" href="#tasks-dockercompose-__codelineno-52-36"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-52-37"><a id="__codelineno-52-37" name="__codelineno-52-37" href="#tasks-dockercompose-__codelineno-52-37"></a>
</span><span id="__span-52-38"><a id="__codelineno-52-38" name="__codelineno-52-38" href="#tasks-dockercompose-__codelineno-52-38"></a><span class="w">  </span><span class="nt">api-v2</span><span class="p">:</span>
</span><span id="__span-52-39"><a id="__codelineno-52-39" name="__codelineno-52-39" href="#tasks-dockercompose-__codelineno-52-39"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-52-40"><a id="__codelineno-52-40" name="__codelineno-52-40" href="#tasks-dockercompose-__codelineno-52-40"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-52-41"><a id="__codelineno-52-41" name="__codelineno-52-41" href="#tasks-dockercompose-__codelineno-52-41"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VERSION=v2</span>
</span><span id="__span-52-42"><a id="__codelineno-52-42" name="__codelineno-52-42" href="#tasks-dockercompose-__codelineno-52-42"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;API v2 - New Feature!&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 8000 -h /tmp&#39;</span>
</span><span id="__span-52-43"><a id="__codelineno-52-43" name="__codelineno-52-43" href="#tasks-dockercompose-__codelineno-52-43"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-52-44"><a id="__codelineno-52-44" name="__codelineno-52-44" href="#tasks-dockercompose-__codelineno-52-44"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-52-45"><a id="__codelineno-52-45" name="__codelineno-52-45" href="#tasks-dockercompose-__codelineno-52-45"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-52-46"><a id="__codelineno-52-46" name="__codelineno-52-46" href="#tasks-dockercompose-__codelineno-52-46"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
</span></code></pre></div></p>
<p><strong>nginx/nginx.conf</strong> (canary deployment - 90% v1, 10% v2)
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#tasks-dockercompose-__codelineno-53-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#tasks-dockercompose-__codelineno-53-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#tasks-dockercompose-__codelineno-53-3"></a><span class="p">}</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#tasks-dockercompose-__codelineno-53-4"></a>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#tasks-dockercompose-__codelineno-53-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#tasks-dockercompose-__codelineno-53-6"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">web_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#tasks-dockercompose-__codelineno-53-7"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">web-v1</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">weight=9</span><span class="p">;</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#tasks-dockercompose-__codelineno-53-8"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">web-v2</span><span class="p">:</span><span class="mi">80</span><span class="w"> </span><span class="s">weight=1</span><span class="p">;</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#tasks-dockercompose-__codelineno-53-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#tasks-dockercompose-__codelineno-53-10"></a>
</span><span id="__span-53-11"><a id="__codelineno-53-11" name="__codelineno-53-11" href="#tasks-dockercompose-__codelineno-53-11"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">api_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-12"><a id="__codelineno-53-12" name="__codelineno-53-12" href="#tasks-dockercompose-__codelineno-53-12"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api-v1</span><span class="p">:</span><span class="mi">8000</span><span class="w"> </span><span class="s">weight=9</span><span class="p">;</span>
</span><span id="__span-53-13"><a id="__codelineno-53-13" name="__codelineno-53-13" href="#tasks-dockercompose-__codelineno-53-13"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api-v2</span><span class="p">:</span><span class="mi">8000</span><span class="w"> </span><span class="s">weight=1</span><span class="p">;</span>
</span><span id="__span-53-14"><a id="__codelineno-53-14" name="__codelineno-53-14" href="#tasks-dockercompose-__codelineno-53-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-53-15"><a id="__codelineno-53-15" name="__codelineno-53-15" href="#tasks-dockercompose-__codelineno-53-15"></a>
</span><span id="__span-53-16"><a id="__codelineno-53-16" name="__codelineno-53-16" href="#tasks-dockercompose-__codelineno-53-16"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-17"><a id="__codelineno-53-17" name="__codelineno-53-17" href="#tasks-dockercompose-__codelineno-53-17"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-53-18"><a id="__codelineno-53-18" name="__codelineno-53-18" href="#tasks-dockercompose-__codelineno-53-18"></a>
</span><span id="__span-53-19"><a id="__codelineno-53-19" name="__codelineno-53-19" href="#tasks-dockercompose-__codelineno-53-19"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-20"><a id="__codelineno-53-20" name="__codelineno-53-20" href="#tasks-dockercompose-__codelineno-53-20"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://web_backend</span><span class="p">;</span>
</span><span id="__span-53-21"><a id="__codelineno-53-21" name="__codelineno-53-21" href="#tasks-dockercompose-__codelineno-53-21"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-53-22"><a id="__codelineno-53-22" name="__codelineno-53-22" href="#tasks-dockercompose-__codelineno-53-22"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-53-23"><a id="__codelineno-53-23" name="__codelineno-53-23" href="#tasks-dockercompose-__codelineno-53-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-53-24"><a id="__codelineno-53-24" name="__codelineno-53-24" href="#tasks-dockercompose-__codelineno-53-24"></a>
</span><span id="__span-53-25"><a id="__codelineno-53-25" name="__codelineno-53-25" href="#tasks-dockercompose-__codelineno-53-25"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-53-26"><a id="__codelineno-53-26" name="__codelineno-53-26" href="#tasks-dockercompose-__codelineno-53-26"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api_backend</span><span class="p">;</span>
</span><span id="__span-53-27"><a id="__codelineno-53-27" name="__codelineno-53-27" href="#tasks-dockercompose-__codelineno-53-27"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
</span><span id="__span-53-28"><a id="__codelineno-53-28" name="__codelineno-53-28" href="#tasks-dockercompose-__codelineno-53-28"></a><span class="w">            </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Real-IP</span><span class="w"> </span><span class="nv">$remote_addr</span><span class="p">;</span>
</span><span id="__span-53-29"><a id="__codelineno-53-29" name="__codelineno-53-29" href="#tasks-dockercompose-__codelineno-53-29"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-53-30"><a id="__codelineno-53-30" name="__codelineno-53-30" href="#tasks-dockercompose-__codelineno-53-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-53-31"><a id="__codelineno-53-31" name="__codelineno-53-31" href="#tasks-dockercompose-__codelineno-53-31"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#tasks-dockercompose-__codelineno-54-1"></a><span class="c1"># Start with only v1</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#tasks-dockercompose-__codelineno-54-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#tasks-dockercompose-__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#tasks-dockercompose-__codelineno-54-4"></a><span class="c1"># Test current version</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#tasks-dockercompose-__codelineno-54-5"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..10<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:8080/api<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#tasks-dockercompose-__codelineno-54-6"></a>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#tasks-dockercompose-__codelineno-54-7"></a><span class="c1"># Deploy v2 alongside v1 (canary)</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#tasks-dockercompose-__codelineno-54-8"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>v2<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#tasks-dockercompose-__codelineno-54-9"></a>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#tasks-dockercompose-__codelineno-54-10"></a><span class="c1"># Update nginx config for canary deployment</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#tasks-dockercompose-__codelineno-54-11"></a><span class="c1"># (edit nginx.conf to add v2 with low weight)</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#tasks-dockercompose-__codelineno-54-12"></a>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#tasks-dockercompose-__codelineno-54-13"></a><span class="c1"># Reload nginx config</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#tasks-dockercompose-__codelineno-54-14"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>loadbalancer<span class="w"> </span>nginx<span class="w"> </span>-s<span class="w"> </span>reload
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#tasks-dockercompose-__codelineno-54-15"></a>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#tasks-dockercompose-__codelineno-54-16"></a><span class="c1"># Test canary deployment</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#tasks-dockercompose-__codelineno-54-17"></a><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..20<span class="o">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>curl<span class="w"> </span>-s<span class="w"> </span>http://localhost:8080/api<span class="p">;</span><span class="w"> </span><span class="k">done</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#tasks-dockercompose-__codelineno-54-18"></a>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#tasks-dockercompose-__codelineno-54-19"></a><span class="c1"># Full rollout to v2 (blue-green)</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#tasks-dockercompose-__codelineno-54-20"></a><span class="c1"># Update nginx.conf to send all traffic to v2</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#tasks-dockercompose-__codelineno-54-21"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>loadbalancer<span class="w"> </span>nginx<span class="w"> </span>-s<span class="w"> </span>reload
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#tasks-dockercompose-__codelineno-54-22"></a>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#tasks-dockercompose-__codelineno-54-23"></a><span class="c1"># Remove v1 services</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#tasks-dockercompose-__codelineno-54-24"></a>docker-compose<span class="w"> </span>rm<span class="w"> </span>-f<span class="w"> </span>web-v1<span class="w"> </span>api-v1
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Canary deployment</strong>: Route small percentage of traffic to new version</li>
<li><strong>Blue-green deployment</strong>: Switch all traffic to new version at once</li>
<li><strong>Profiles</strong>: Control which version services are running</li>
<li><strong>Load balancer config</strong>: Dynamic traffic shifting without downtime</li>
<li><strong>Rollback capability</strong>: Quickly switch back to previous version</li>
<li><strong>Zero downtime</strong>: New version tested before full rollout</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-18-production-ready-stack">18. Production-Ready Stack<a class="headerlink" href="#tasks-dockercompose-18-production-ready-stack" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create a complete production-ready application stack with monitoring, logging, and security best practices.</p>
<h4 id="tasks-dockercompose-scenario_17"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_17" title="Permanent link">&para;</a></h4>
<ul>
<li>You&rsquo;re deploying a critical application to production that requires monitoring, centralized logging, security hardening, and automated backups.</li>
<li>A production-ready Docker Compose stack includes all necessary components for running applications reliably in production environments.</li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Combine all production best practices: health checks, secrets, resource limits, logging, monitoring, and backups</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#tasks-dockercompose-__codelineno-55-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#tasks-dockercompose-__codelineno-55-2"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#tasks-dockercompose-__codelineno-55-3"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#tasks-dockercompose-__codelineno-55-4"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#tasks-dockercompose-__codelineno-55-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#tasks-dockercompose-__codelineno-55-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#tasks-dockercompose-__codelineno-55-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;443:443&quot;</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#tasks-dockercompose-__codelineno-55-8"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#tasks-dockercompose-__codelineno-55-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web:/usr/share/nginx/html:ro</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#tasks-dockercompose-__codelineno-55-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./nginx/nginx.conf:/etc/nginx/nginx.conf:ro</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#tasks-dockercompose-__codelineno-55-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./ssl:/etc/ssl/certs:ro</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#tasks-dockercompose-__codelineno-55-12"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#tasks-dockercompose-__codelineno-55-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#tasks-dockercompose-__codelineno-55-14"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#tasks-dockercompose-__codelineno-55-15"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;curl&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;-f&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#tasks-dockercompose-__codelineno-55-16"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-55-17"><a id="__codelineno-55-17" name="__codelineno-55-17" href="#tasks-dockercompose-__codelineno-55-17"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-55-18"><a id="__codelineno-55-18" name="__codelineno-55-18" href="#tasks-dockercompose-__codelineno-55-18"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-55-19"><a id="__codelineno-55-19" name="__codelineno-55-19" href="#tasks-dockercompose-__codelineno-55-19"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-55-20"><a id="__codelineno-55-20" name="__codelineno-55-20" href="#tasks-dockercompose-__codelineno-55-20"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-55-21"><a id="__codelineno-55-21" name="__codelineno-55-21" href="#tasks-dockercompose-__codelineno-55-21"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-55-22"><a id="__codelineno-55-22" name="__codelineno-55-22" href="#tasks-dockercompose-__codelineno-55-22"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-55-23"><a id="__codelineno-55-23" name="__codelineno-55-23" href="#tasks-dockercompose-__codelineno-55-23"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-55-24"><a id="__codelineno-55-24" name="__codelineno-55-24" href="#tasks-dockercompose-__codelineno-55-24"></a><span class="w">      </span><span class="nt">restart_policy</span><span class="p">:</span>
</span><span id="__span-55-25"><a id="__codelineno-55-25" name="__codelineno-55-25" href="#tasks-dockercompose-__codelineno-55-25"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id="__span-55-26"><a id="__codelineno-55-26" name="__codelineno-55-26" href="#tasks-dockercompose-__codelineno-55-26"></a><span class="w">        </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-55-27"><a id="__codelineno-55-27" name="__codelineno-55-27" href="#tasks-dockercompose-__codelineno-55-27"></a><span class="w">        </span><span class="nt">max_attempts</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-55-28"><a id="__codelineno-55-28" name="__codelineno-55-28" href="#tasks-dockercompose-__codelineno-55-28"></a><span class="w">        </span><span class="nt">window</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">120s</span>
</span><span id="__span-55-29"><a id="__codelineno-55-29" name="__codelineno-55-29" href="#tasks-dockercompose-__codelineno-55-29"></a>
</span><span id="__span-55-30"><a id="__codelineno-55-30" name="__codelineno-55-30" href="#tasks-dockercompose-__codelineno-55-30"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-55-31"><a id="__codelineno-55-31" name="__codelineno-55-31" href="#tasks-dockercompose-__codelineno-55-31"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-55-32"><a id="__codelineno-55-32" name="__codelineno-55-32" href="#tasks-dockercompose-__codelineno-55-32"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-55-33"><a id="__codelineno-55-33" name="__codelineno-55-33" href="#tasks-dockercompose-__codelineno-55-33"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATABASE_URL=postgresql://user:pass@db:5432/myapp</span>
</span><span id="__span-55-34"><a id="__codelineno-55-34" name="__codelineno-55-34" href="#tasks-dockercompose-__codelineno-55-34"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDIS_URL=redis://redis:6379</span>
</span><span id="__span-55-35"><a id="__codelineno-55-35" name="__codelineno-55-35" href="#tasks-dockercompose-__codelineno-55-35"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-55-36"><a id="__codelineno-55-36" name="__codelineno-55-36" href="#tasks-dockercompose-__codelineno-55-36"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api_key</span>
</span><span id="__span-55-37"><a id="__codelineno-55-37" name="__codelineno-55-37" href="#tasks-dockercompose-__codelineno-55-37"></a><span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/run/secrets/api_key</span>
</span><span id="__span-55-38"><a id="__codelineno-55-38" name="__codelineno-55-38" href="#tasks-dockercompose-__codelineno-55-38"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-55-39"><a id="__codelineno-55-39" name="__codelineno-55-39" href="#tasks-dockercompose-__codelineno-55-39"></a><span class="w">      </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-55-40"><a id="__codelineno-55-40" name="__codelineno-55-40" href="#tasks-dockercompose-__codelineno-55-40"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id="__span-55-41"><a id="__codelineno-55-41" name="__codelineno-55-41" href="#tasks-dockercompose-__codelineno-55-41"></a><span class="w">      </span><span class="nt">redis</span><span class="p">:</span>
</span><span id="__span-55-42"><a id="__codelineno-55-42" name="__codelineno-55-42" href="#tasks-dockercompose-__codelineno-55-42"></a><span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_healthy</span>
</span><span id="__span-55-43"><a id="__codelineno-55-43" name="__codelineno-55-43" href="#tasks-dockercompose-__codelineno-55-43"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-55-44"><a id="__codelineno-55-44" name="__codelineno-55-44" href="#tasks-dockercompose-__codelineno-55-44"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost:8000/health&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-55-45"><a id="__codelineno-55-45" name="__codelineno-55-45" href="#tasks-dockercompose-__codelineno-55-45"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-55-46"><a id="__codelineno-55-46" name="__codelineno-55-46" href="#tasks-dockercompose-__codelineno-55-46"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-55-47"><a id="__codelineno-55-47" name="__codelineno-55-47" href="#tasks-dockercompose-__codelineno-55-47"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-55-48"><a id="__codelineno-55-48" name="__codelineno-55-48" href="#tasks-dockercompose-__codelineno-55-48"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-55-49"><a id="__codelineno-55-49" name="__codelineno-55-49" href="#tasks-dockercompose-__codelineno-55-49"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-55-50"><a id="__codelineno-55-50" name="__codelineno-55-50" href="#tasks-dockercompose-__codelineno-55-50"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-55-51"><a id="__codelineno-55-51" name="__codelineno-55-51" href="#tasks-dockercompose-__codelineno-55-51"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-55-52"><a id="__codelineno-55-52" name="__codelineno-55-52" href="#tasks-dockercompose-__codelineno-55-52"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-55-53"><a id="__codelineno-55-53" name="__codelineno-55-53" href="#tasks-dockercompose-__codelineno-55-53"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-55-54"><a id="__codelineno-55-54" name="__codelineno-55-54" href="#tasks-dockercompose-__codelineno-55-54"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-55-55"><a id="__codelineno-55-55" name="__codelineno-55-55" href="#tasks-dockercompose-__codelineno-55-55"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-55-56"><a id="__codelineno-55-56" name="__codelineno-55-56" href="#tasks-dockercompose-__codelineno-55-56"></a><span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-55-57"><a id="__codelineno-55-57" name="__codelineno-55-57" href="#tasks-dockercompose-__codelineno-55-57"></a><span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-55-58"><a id="__codelineno-55-58" name="__codelineno-55-58" href="#tasks-dockercompose-__codelineno-55-58"></a>
</span><span id="__span-55-59"><a id="__codelineno-55-59" name="__codelineno-55-59" href="#tasks-dockercompose-__codelineno-55-59"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-55-60"><a id="__codelineno-55-60" name="__codelineno-55-60" href="#tasks-dockercompose-__codelineno-55-60"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-55-61"><a id="__codelineno-55-61" name="__codelineno-55-61" href="#tasks-dockercompose-__codelineno-55-61"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-55-62"><a id="__codelineno-55-62" name="__codelineno-55-62" href="#tasks-dockercompose-__codelineno-55-62"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-55-63"><a id="__codelineno-55-63" name="__codelineno-55-63" href="#tasks-dockercompose-__codelineno-55-63"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-55-64"><a id="__codelineno-55-64" name="__codelineno-55-64" href="#tasks-dockercompose-__codelineno-55-64"></a><span class="w">    </span><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-55-65"><a id="__codelineno-55-65" name="__codelineno-55-65" href="#tasks-dockercompose-__codelineno-55-65"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_password</span>
</span><span id="__span-55-66"><a id="__codelineno-55-66" name="__codelineno-55-66" href="#tasks-dockercompose-__codelineno-55-66"></a><span class="w">        </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres_password</span>
</span><span id="__span-55-67"><a id="__codelineno-55-67" name="__codelineno-55-67" href="#tasks-dockercompose-__codelineno-55-67"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-55-68"><a id="__codelineno-55-68" name="__codelineno-55-68" href="#tasks-dockercompose-__codelineno-55-68"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-55-69"><a id="__codelineno-55-69" name="__codelineno-55-69" href="#tasks-dockercompose-__codelineno-55-69"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./backup:/backup</span>
</span><span id="__span-55-70"><a id="__codelineno-55-70" name="__codelineno-55-70" href="#tasks-dockercompose-__codelineno-55-70"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-55-71"><a id="__codelineno-55-71" name="__codelineno-55-71" href="#tasks-dockercompose-__codelineno-55-71"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">-d</span><span class="nv"> </span><span class="s">myapp&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-55-72"><a id="__codelineno-55-72" name="__codelineno-55-72" href="#tasks-dockercompose-__codelineno-55-72"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-55-73"><a id="__codelineno-55-73" name="__codelineno-55-73" href="#tasks-dockercompose-__codelineno-55-73"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-55-74"><a id="__codelineno-55-74" name="__codelineno-55-74" href="#tasks-dockercompose-__codelineno-55-74"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-55-75"><a id="__codelineno-55-75" name="__codelineno-55-75" href="#tasks-dockercompose-__codelineno-55-75"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-55-76"><a id="__codelineno-55-76" name="__codelineno-55-76" href="#tasks-dockercompose-__codelineno-55-76"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-55-77"><a id="__codelineno-55-77" name="__codelineno-55-77" href="#tasks-dockercompose-__codelineno-55-77"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-55-78"><a id="__codelineno-55-78" name="__codelineno-55-78" href="#tasks-dockercompose-__codelineno-55-78"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-55-79"><a id="__codelineno-55-79" name="__codelineno-55-79" href="#tasks-dockercompose-__codelineno-55-79"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.0&#39;</span>
</span><span id="__span-55-80"><a id="__codelineno-55-80" name="__codelineno-55-80" href="#tasks-dockercompose-__codelineno-55-80"></a><span class="w">    </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-55-81"><a id="__codelineno-55-81" name="__codelineno-55-81" href="#tasks-dockercompose-__codelineno-55-81"></a><span class="w">      </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-55-82"><a id="__codelineno-55-82" name="__codelineno-55-82" href="#tasks-dockercompose-__codelineno-55-82"></a><span class="w">      </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-55-83"><a id="__codelineno-55-83" name="__codelineno-55-83" href="#tasks-dockercompose-__codelineno-55-83"></a><span class="w">        </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;50m&quot;</span>
</span><span id="__span-55-84"><a id="__codelineno-55-84" name="__codelineno-55-84" href="#tasks-dockercompose-__codelineno-55-84"></a><span class="w">        </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5&quot;</span>
</span><span id="__span-55-85"><a id="__codelineno-55-85" name="__codelineno-55-85" href="#tasks-dockercompose-__codelineno-55-85"></a>
</span><span id="__span-55-86"><a id="__codelineno-55-86" name="__codelineno-55-86" href="#tasks-dockercompose-__codelineno-55-86"></a><span class="w">  </span><span class="nt">redis</span><span class="p">:</span>
</span><span id="__span-55-87"><a id="__codelineno-55-87" name="__codelineno-55-87" href="#tasks-dockercompose-__codelineno-55-87"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:alpine</span>
</span><span id="__span-55-88"><a id="__codelineno-55-88" name="__codelineno-55-88" href="#tasks-dockercompose-__codelineno-55-88"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-55-89"><a id="__codelineno-55-89" name="__codelineno-55-89" href="#tasks-dockercompose-__codelineno-55-89"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis_data:/data</span>
</span><span id="__span-55-90"><a id="__codelineno-55-90" name="__codelineno-55-90" href="#tasks-dockercompose-__codelineno-55-90"></a><span class="w">    </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-55-91"><a id="__codelineno-55-91" name="__codelineno-55-91" href="#tasks-dockercompose-__codelineno-55-91"></a><span class="w">      </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;redis-cli&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ping&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-55-92"><a id="__codelineno-55-92" name="__codelineno-55-92" href="#tasks-dockercompose-__codelineno-55-92"></a><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-55-93"><a id="__codelineno-55-93" name="__codelineno-55-93" href="#tasks-dockercompose-__codelineno-55-93"></a><span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3s</span>
</span><span id="__span-55-94"><a id="__codelineno-55-94" name="__codelineno-55-94" href="#tasks-dockercompose-__codelineno-55-94"></a><span class="w">      </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-55-95"><a id="__codelineno-55-95" name="__codelineno-55-95" href="#tasks-dockercompose-__codelineno-55-95"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-55-96"><a id="__codelineno-55-96" name="__codelineno-55-96" href="#tasks-dockercompose-__codelineno-55-96"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-55-97"><a id="__codelineno-55-97" name="__codelineno-55-97" href="#tasks-dockercompose-__codelineno-55-97"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-55-98"><a id="__codelineno-55-98" name="__codelineno-55-98" href="#tasks-dockercompose-__codelineno-55-98"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-55-99"><a id="__codelineno-55-99" name="__codelineno-55-99" href="#tasks-dockercompose-__codelineno-55-99"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-55-100"><a id="__codelineno-55-100" name="__codelineno-55-100" href="#tasks-dockercompose-__codelineno-55-100"></a>
</span><span id="__span-55-101"><a id="__codelineno-55-101" name="__codelineno-55-101" href="#tasks-dockercompose-__codelineno-55-101"></a><span class="w">  </span><span class="nt">backup</span><span class="p">:</span>
</span><span id="__span-55-102"><a id="__codelineno-55-102" name="__codelineno-55-102" href="#tasks-dockercompose-__codelineno-55-102"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-55-103"><a id="__codelineno-55-103" name="__codelineno-55-103" href="#tasks-dockercompose-__codelineno-55-103"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-55-104"><a id="__codelineno-55-104" name="__codelineno-55-104" href="#tasks-dockercompose-__codelineno-55-104"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data:ro</span>
</span><span id="__span-55-105"><a id="__codelineno-55-105" name="__codelineno-55-105" href="#tasks-dockercompose-__codelineno-55-105"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./backup:/backup</span>
</span><span id="__span-55-106"><a id="__codelineno-55-106" name="__codelineno-55-106" href="#tasks-dockercompose-__codelineno-55-106"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;</span>
</span><span id="__span-55-107"><a id="__codelineno-55-107" name="__codelineno-55-107" href="#tasks-dockercompose-__codelineno-55-107"></a><span class="w">      </span><span class="no">sh -c &quot;</span>
</span><span id="__span-55-108"><a id="__codelineno-55-108" name="__codelineno-55-108" href="#tasks-dockercompose-__codelineno-55-108"></a><span class="w">      </span><span class="no">while true; do</span>
</span><span id="__span-55-109"><a id="__codelineno-55-109" name="__codelineno-55-109" href="#tasks-dockercompose-__codelineno-55-109"></a><span class="w">        </span><span class="no">pg_dump -U user -h db myapp &gt; /backup/backup_$(date +%Y%m%d_%H%M%S).sql</span>
</span><span id="__span-55-110"><a id="__codelineno-55-110" name="__codelineno-55-110" href="#tasks-dockercompose-__codelineno-55-110"></a><span class="w">        </span><span class="no">sleep 3600</span>
</span><span id="__span-55-111"><a id="__codelineno-55-111" name="__codelineno-55-111" href="#tasks-dockercompose-__codelineno-55-111"></a><span class="w">      </span><span class="no">done</span>
</span><span id="__span-55-112"><a id="__codelineno-55-112" name="__codelineno-55-112" href="#tasks-dockercompose-__codelineno-55-112"></a><span class="w">      </span><span class="no">&quot;</span>
</span><span id="__span-55-113"><a id="__codelineno-55-113" name="__codelineno-55-113" href="#tasks-dockercompose-__codelineno-55-113"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-55-114"><a id="__codelineno-55-114" name="__codelineno-55-114" href="#tasks-dockercompose-__codelineno-55-114"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-55-115"><a id="__codelineno-55-115" name="__codelineno-55-115" href="#tasks-dockercompose-__codelineno-55-115"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-55-116"><a id="__codelineno-55-116" name="__codelineno-55-116" href="#tasks-dockercompose-__codelineno-55-116"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backup</span>
</span><span id="__span-55-117"><a id="__codelineno-55-117" name="__codelineno-55-117" href="#tasks-dockercompose-__codelineno-55-117"></a>
</span><span id="__span-55-118"><a id="__codelineno-55-118" name="__codelineno-55-118" href="#tasks-dockercompose-__codelineno-55-118"></a><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span>
</span><span id="__span-55-119"><a id="__codelineno-55-119" name="__codelineno-55-119" href="#tasks-dockercompose-__codelineno-55-119"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id="__span-55-120"><a id="__codelineno-55-120" name="__codelineno-55-120" href="#tasks-dockercompose-__codelineno-55-120"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-55-121"><a id="__codelineno-55-121" name="__codelineno-55-121" href="#tasks-dockercompose-__codelineno-55-121"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;9090:9090&quot;</span>
</span><span id="__span-55-122"><a id="__codelineno-55-122" name="__codelineno-55-122" href="#tasks-dockercompose-__codelineno-55-122"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-55-123"><a id="__codelineno-55-123" name="__codelineno-55-123" href="#tasks-dockercompose-__codelineno-55-123"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro</span>
</span><span id="__span-55-124"><a id="__codelineno-55-124" name="__codelineno-55-124" href="#tasks-dockercompose-__codelineno-55-124"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring_data:/prometheus</span>
</span><span id="__span-55-125"><a id="__codelineno-55-125" name="__codelineno-55-125" href="#tasks-dockercompose-__codelineno-55-125"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span>
</span><span id="__span-55-126"><a id="__codelineno-55-126" name="__codelineno-55-126" href="#tasks-dockercompose-__codelineno-55-126"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--config.file=/etc/prometheus/prometheus.yml&#39;</span>
</span><span id="__span-55-127"><a id="__codelineno-55-127" name="__codelineno-55-127" href="#tasks-dockercompose-__codelineno-55-127"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.path=/prometheus&#39;</span>
</span><span id="__span-55-128"><a id="__codelineno-55-128" name="__codelineno-55-128" href="#tasks-dockercompose-__codelineno-55-128"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--web.console.libraries=/etc/prometheus/console_libraries&#39;</span>
</span><span id="__span-55-129"><a id="__codelineno-55-129" name="__codelineno-55-129" href="#tasks-dockercompose-__codelineno-55-129"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--web.console.templates=/etc/prometheus/consoles&#39;</span>
</span><span id="__span-55-130"><a id="__codelineno-55-130" name="__codelineno-55-130" href="#tasks-dockercompose-__codelineno-55-130"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--storage.tsdb.retention.time=200h&#39;</span>
</span><span id="__span-55-131"><a id="__codelineno-55-131" name="__codelineno-55-131" href="#tasks-dockercompose-__codelineno-55-131"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;--web.enable-lifecycle&#39;</span>
</span><span id="__span-55-132"><a id="__codelineno-55-132" name="__codelineno-55-132" href="#tasks-dockercompose-__codelineno-55-132"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-55-133"><a id="__codelineno-55-133" name="__codelineno-55-133" href="#tasks-dockercompose-__codelineno-55-133"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-55-134"><a id="__codelineno-55-134" name="__codelineno-55-134" href="#tasks-dockercompose-__codelineno-55-134"></a>
</span><span id="__span-55-135"><a id="__codelineno-55-135" name="__codelineno-55-135" href="#tasks-dockercompose-__codelineno-55-135"></a><span class="w">  </span><span class="nt">log-aggregator</span><span class="p">:</span>
</span><span id="__span-55-136"><a id="__codelineno-55-136" name="__codelineno-55-136" href="#tasks-dockercompose-__codelineno-55-136"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fluent/fluent-bit:latest</span>
</span><span id="__span-55-137"><a id="__codelineno-55-137" name="__codelineno-55-137" href="#tasks-dockercompose-__codelineno-55-137"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-55-138"><a id="__codelineno-55-138" name="__codelineno-55-138" href="#tasks-dockercompose-__codelineno-55-138"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/containers:/var/lib/docker/containers:ro</span>
</span><span id="__span-55-139"><a id="__codelineno-55-139" name="__codelineno-55-139" href="#tasks-dockercompose-__codelineno-55-139"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf:ro</span>
</span><span id="__span-55-140"><a id="__codelineno-55-140" name="__codelineno-55-140" href="#tasks-dockercompose-__codelineno-55-140"></a><span class="w">    </span><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-55-141"><a id="__codelineno-55-141" name="__codelineno-55-141" href="#tasks-dockercompose-__codelineno-55-141"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logging</span>
</span><span id="__span-55-142"><a id="__codelineno-55-142" name="__codelineno-55-142" href="#tasks-dockercompose-__codelineno-55-142"></a>
</span><span id="__span-55-143"><a id="__codelineno-55-143" name="__codelineno-55-143" href="#tasks-dockercompose-__codelineno-55-143"></a><span class="nt">secrets</span><span class="p">:</span>
</span><span id="__span-55-144"><a id="__codelineno-55-144" name="__codelineno-55-144" href="#tasks-dockercompose-__codelineno-55-144"></a><span class="w">  </span><span class="nt">api_key</span><span class="p">:</span>
</span><span id="__span-55-145"><a id="__codelineno-55-145" name="__codelineno-55-145" href="#tasks-dockercompose-__codelineno-55-145"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/api_key.txt</span>
</span><span id="__span-55-146"><a id="__codelineno-55-146" name="__codelineno-55-146" href="#tasks-dockercompose-__codelineno-55-146"></a><span class="w">  </span><span class="nt">db_password</span><span class="p">:</span>
</span><span id="__span-55-147"><a id="__codelineno-55-147" name="__codelineno-55-147" href="#tasks-dockercompose-__codelineno-55-147"></a><span class="w">    </span><span class="nt">file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./secrets/db_password.txt</span>
</span><span id="__span-55-148"><a id="__codelineno-55-148" name="__codelineno-55-148" href="#tasks-dockercompose-__codelineno-55-148"></a>
</span><span id="__span-55-149"><a id="__codelineno-55-149" name="__codelineno-55-149" href="#tasks-dockercompose-__codelineno-55-149"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-55-150"><a id="__codelineno-55-150" name="__codelineno-55-150" href="#tasks-dockercompose-__codelineno-55-150"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span><span id="__span-55-151"><a id="__codelineno-55-151" name="__codelineno-55-151" href="#tasks-dockercompose-__codelineno-55-151"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-55-152"><a id="__codelineno-55-152" name="__codelineno-55-152" href="#tasks-dockercompose-__codelineno-55-152"></a><span class="w">  </span><span class="nt">redis_data</span><span class="p">:</span>
</span><span id="__span-55-153"><a id="__codelineno-55-153" name="__codelineno-55-153" href="#tasks-dockercompose-__codelineno-55-153"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-55-154"><a id="__codelineno-55-154" name="__codelineno-55-154" href="#tasks-dockercompose-__codelineno-55-154"></a><span class="w">  </span><span class="nt">monitoring_data</span><span class="p">:</span>
</span><span id="__span-55-155"><a id="__codelineno-55-155" name="__codelineno-55-155" href="#tasks-dockercompose-__codelineno-55-155"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-55-156"><a id="__codelineno-55-156" name="__codelineno-55-156" href="#tasks-dockercompose-__codelineno-55-156"></a>
</span><span id="__span-55-157"><a id="__codelineno-55-157" name="__codelineno-55-157" href="#tasks-dockercompose-__codelineno-55-157"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-55-158"><a id="__codelineno-55-158" name="__codelineno-55-158" href="#tasks-dockercompose-__codelineno-55-158"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-55-159"><a id="__codelineno-55-159" name="__codelineno-55-159" href="#tasks-dockercompose-__codelineno-55-159"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-55-160"><a id="__codelineno-55-160" name="__codelineno-55-160" href="#tasks-dockercompose-__codelineno-55-160"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-55-161"><a id="__codelineno-55-161" name="__codelineno-55-161" href="#tasks-dockercompose-__codelineno-55-161"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-55-162"><a id="__codelineno-55-162" name="__codelineno-55-162" href="#tasks-dockercompose-__codelineno-55-162"></a><span class="w">    </span><span class="nt">internal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#tasks-dockercompose-__codelineno-56-1"></a><span class="c1"># Create secrets</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#tasks-dockercompose-__codelineno-56-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>secrets
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#tasks-dockercompose-__codelineno-56-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;my-secret-api-key&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>secrets/api_key.txt
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#tasks-dockercompose-__codelineno-56-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;my-secret-db-password&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>secrets/db_password.txt
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#tasks-dockercompose-__codelineno-56-5"></a>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#tasks-dockercompose-__codelineno-56-6"></a><span class="c1"># Start production stack</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#tasks-dockercompose-__codelineno-56-7"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#tasks-dockercompose-__codelineno-56-8"></a>
</span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#tasks-dockercompose-__codelineno-56-9"></a><span class="c1"># Start with monitoring</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#tasks-dockercompose-__codelineno-56-10"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>monitoring<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#tasks-dockercompose-__codelineno-56-11"></a>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#tasks-dockercompose-__codelineno-56-12"></a><span class="c1"># Start with logging</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#tasks-dockercompose-__codelineno-56-13"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>logging<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#tasks-dockercompose-__codelineno-56-14"></a>
</span><span id="__span-56-15"><a id="__codelineno-56-15" name="__codelineno-56-15" href="#tasks-dockercompose-__codelineno-56-15"></a><span class="c1"># Start backup service</span>
</span><span id="__span-56-16"><a id="__codelineno-56-16" name="__codelineno-56-16" href="#tasks-dockercompose-__codelineno-56-16"></a>docker-compose<span class="w"> </span>--profile<span class="w"> </span>backup<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-56-17"><a id="__codelineno-56-17" name="__codelineno-56-17" href="#tasks-dockercompose-__codelineno-56-17"></a>
</span><span id="__span-56-18"><a id="__codelineno-56-18" name="__codelineno-56-18" href="#tasks-dockercompose-__codelineno-56-18"></a><span class="c1"># Check all services</span>
</span><span id="__span-56-19"><a id="__codelineno-56-19" name="__codelineno-56-19" href="#tasks-dockercompose-__codelineno-56-19"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-56-20"><a id="__codelineno-56-20" name="__codelineno-56-20" href="#tasks-dockercompose-__codelineno-56-20"></a>
</span><span id="__span-56-21"><a id="__codelineno-56-21" name="__codelineno-56-21" href="#tasks-dockercompose-__codelineno-56-21"></a><span class="c1"># View logs</span>
</span><span id="__span-56-22"><a id="__codelineno-56-22" name="__codelineno-56-22" href="#tasks-dockercompose-__codelineno-56-22"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>-f
</span><span id="__span-56-23"><a id="__codelineno-56-23" name="__codelineno-56-23" href="#tasks-dockercompose-__codelineno-56-23"></a>
</span><span id="__span-56-24"><a id="__codelineno-56-24" name="__codelineno-56-24" href="#tasks-dockercompose-__codelineno-56-24"></a><span class="c1"># Monitor resources</span>
</span><span id="__span-56-25"><a id="__codelineno-56-25" name="__codelineno-56-25" href="#tasks-dockercompose-__codelineno-56-25"></a>docker<span class="w"> </span>stats
</span><span id="__span-56-26"><a id="__codelineno-56-26" name="__codelineno-56-26" href="#tasks-dockercompose-__codelineno-56-26"></a>
</span><span id="__span-56-27"><a id="__codelineno-56-27" name="__codelineno-56-27" href="#tasks-dockercompose-__codelineno-56-27"></a><span class="c1"># Backup database</span>
</span><span id="__span-56-28"><a id="__codelineno-56-28" name="__codelineno-56-28" href="#tasks-dockercompose-__codelineno-56-28"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>backup<span class="w"> </span>ls<span class="w"> </span>/backup/
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Production hardening</strong>: Resource limits, health checks, secrets management</li>
<li><strong>Monitoring</strong>: Prometheus for metrics collection</li>
<li><strong>Logging</strong>: Centralized log aggregation with Fluent Bit</li>
<li><strong>Backup</strong>: Automated database backups</li>
<li><strong>Security</strong>: Secrets, read-only volumes, network isolation</li>
<li><strong>High availability</strong>: Health checks, restart policies, resource management</li>
<li><strong>Scalability</strong>: Profiles for optional services, resource limits</li>
<li><strong>Maintainability</strong>: Structured configuration, clear separation of concerns</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-19-basic-yaml-anchors-and-references">19. Basic YAML Anchors and References<a class="headerlink" href="#tasks-dockercompose-19-basic-yaml-anchors-and-references" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Learn the fundamentals of YAML anchors and references to avoid repetition in Docker Compose files.</p>
<h4 id="tasks-dockercompose-scenario_18"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_18" title="Permanent link">&para;</a></h4>
<ul>
<li>You have multiple services that share common configuration elements like environment variables, volumes, or network settings.</li>
<li>YAML anchors (&amp;) and references (*) allow you to define reusable configuration blocks and reference them throughout your compose file.</li>
</ul>
<h4 id="tasks-dockercompose-resources_8">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_8" title="Permanent link">&para;</a></h4>
<ul>
<li><code>docker-compose.yml</code> ‚û§ Main compose file with anchors and references
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#tasks-dockercompose-__codelineno-57-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#tasks-dockercompose-__codelineno-57-2"></a>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#tasks-dockercompose-__codelineno-57-3"></a><span class="nt">x-common-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-env</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#tasks-dockercompose-__codelineno-57-4"></a><span class="w">  </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#tasks-dockercompose-__codelineno-57-5"></a><span class="w">  </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#tasks-dockercompose-__codelineno-57-6"></a>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#tasks-dockercompose-__codelineno-57-7"></a><span class="nt">x-common-volumes</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-volumes</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#tasks-dockercompose-__codelineno-57-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/app/logs</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#tasks-dockercompose-__codelineno-57-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config:/app/config:ro</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#tasks-dockercompose-__codelineno-57-10"></a>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#tasks-dockercompose-__codelineno-57-11"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#tasks-dockercompose-__codelineno-57-12"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#tasks-dockercompose-__codelineno-57-13"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#tasks-dockercompose-__codelineno-57-14"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#tasks-dockercompose-__codelineno-57-15"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-env</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#tasks-dockercompose-__codelineno-57-16"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#tasks-dockercompose-__codelineno-57-17"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-volumes</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#tasks-dockercompose-__codelineno-57-18"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#tasks-dockercompose-__codelineno-57-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#tasks-dockercompose-__codelineno-57-20"></a>
</span><span id="__span-57-21"><a id="__codelineno-57-21" name="__codelineno-57-21" href="#tasks-dockercompose-__codelineno-57-21"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-57-22"><a id="__codelineno-57-22" name="__codelineno-57-22" href="#tasks-dockercompose-__codelineno-57-22"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-57-23"><a id="__codelineno-57-23" name="__codelineno-57-23" href="#tasks-dockercompose-__codelineno-57-23"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-57-24"><a id="__codelineno-57-24" name="__codelineno-57-24" href="#tasks-dockercompose-__codelineno-57-24"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-env</span>
</span><span id="__span-57-25"><a id="__codelineno-57-25" name="__codelineno-57-25" href="#tasks-dockercompose-__codelineno-57-25"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-57-26"><a id="__codelineno-57-26" name="__codelineno-57-26" href="#tasks-dockercompose-__codelineno-57-26"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-volumes</span>
</span><span id="__span-57-27"><a id="__codelineno-57-27" name="__codelineno-57-27" href="#tasks-dockercompose-__codelineno-57-27"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-57-28"><a id="__codelineno-57-28" name="__codelineno-57-28" href="#tasks-dockercompose-__codelineno-57-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>&amp;anchor-name</code> to define reusable blocks and <code>*anchor-name</code> to reference them</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#tasks-dockercompose-__codelineno-58-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#tasks-dockercompose-__codelineno-58-2"></a>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#tasks-dockercompose-__codelineno-58-3"></a><span class="nt">x-common-env</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-env</span>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#tasks-dockercompose-__codelineno-58-4"></a><span class="w">  </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#tasks-dockercompose-__codelineno-58-5"></a><span class="w">  </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#tasks-dockercompose-__codelineno-58-6"></a><span class="w">  </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#tasks-dockercompose-__codelineno-58-7"></a>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#tasks-dockercompose-__codelineno-58-8"></a><span class="nt">x-common-volumes</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-volumes</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#tasks-dockercompose-__codelineno-58-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./logs:/app/logs</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#tasks-dockercompose-__codelineno-58-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./config:/app/config:ro</span>
</span><span id="__span-58-11"><a id="__codelineno-58-11" name="__codelineno-58-11" href="#tasks-dockercompose-__codelineno-58-11"></a>
</span><span id="__span-58-12"><a id="__codelineno-58-12" name="__codelineno-58-12" href="#tasks-dockercompose-__codelineno-58-12"></a><span class="nt">x-common-deploy</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-deploy</span>
</span><span id="__span-58-13"><a id="__codelineno-58-13" name="__codelineno-58-13" href="#tasks-dockercompose-__codelineno-58-13"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-58-14"><a id="__codelineno-58-14" name="__codelineno-58-14" href="#tasks-dockercompose-__codelineno-58-14"></a><span class="w">    </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-58-15"><a id="__codelineno-58-15" name="__codelineno-58-15" href="#tasks-dockercompose-__codelineno-58-15"></a><span class="w">      </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-58-16"><a id="__codelineno-58-16" name="__codelineno-58-16" href="#tasks-dockercompose-__codelineno-58-16"></a><span class="w">      </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-58-17"><a id="__codelineno-58-17" name="__codelineno-58-17" href="#tasks-dockercompose-__codelineno-58-17"></a><span class="w">    </span><span class="nt">restart_policy</span><span class="p">:</span>
</span><span id="__span-58-18"><a id="__codelineno-58-18" name="__codelineno-58-18" href="#tasks-dockercompose-__codelineno-58-18"></a><span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id="__span-58-19"><a id="__codelineno-58-19" name="__codelineno-58-19" href="#tasks-dockercompose-__codelineno-58-19"></a>
</span><span id="__span-58-20"><a id="__codelineno-58-20" name="__codelineno-58-20" href="#tasks-dockercompose-__codelineno-58-20"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-58-21"><a id="__codelineno-58-21" name="__codelineno-58-21" href="#tasks-dockercompose-__codelineno-58-21"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-58-22"><a id="__codelineno-58-22" name="__codelineno-58-22" href="#tasks-dockercompose-__codelineno-58-22"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-58-23"><a id="__codelineno-58-23" name="__codelineno-58-23" href="#tasks-dockercompose-__codelineno-58-23"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-58-24"><a id="__codelineno-58-24" name="__codelineno-58-24" href="#tasks-dockercompose-__codelineno-58-24"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-env</span>
</span><span id="__span-58-25"><a id="__codelineno-58-25" name="__codelineno-58-25" href="#tasks-dockercompose-__codelineno-58-25"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-58-26"><a id="__codelineno-58-26" name="__codelineno-58-26" href="#tasks-dockercompose-__codelineno-58-26"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-volumes</span>
</span><span id="__span-58-27"><a id="__codelineno-58-27" name="__codelineno-58-27" href="#tasks-dockercompose-__codelineno-58-27"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-58-28"><a id="__codelineno-58-28" name="__codelineno-58-28" href="#tasks-dockercompose-__codelineno-58-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-58-29"><a id="__codelineno-58-29" name="__codelineno-58-29" href="#tasks-dockercompose-__codelineno-58-29"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-deploy</span>
</span><span id="__span-58-30"><a id="__codelineno-58-30" name="__codelineno-58-30" href="#tasks-dockercompose-__codelineno-58-30"></a>
</span><span id="__span-58-31"><a id="__codelineno-58-31" name="__codelineno-58-31" href="#tasks-dockercompose-__codelineno-58-31"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-58-32"><a id="__codelineno-58-32" name="__codelineno-58-32" href="#tasks-dockercompose-__codelineno-58-32"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-58-33"><a id="__codelineno-58-33" name="__codelineno-58-33" href="#tasks-dockercompose-__codelineno-58-33"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-58-34"><a id="__codelineno-58-34" name="__codelineno-58-34" href="#tasks-dockercompose-__codelineno-58-34"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-env</span>
</span><span id="__span-58-35"><a id="__codelineno-58-35" name="__codelineno-58-35" href="#tasks-dockercompose-__codelineno-58-35"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-58-36"><a id="__codelineno-58-36" name="__codelineno-58-36" href="#tasks-dockercompose-__codelineno-58-36"></a><span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id="__span-58-37"><a id="__codelineno-58-37" name="__codelineno-58-37" href="#tasks-dockercompose-__codelineno-58-37"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-volumes</span>
</span><span id="__span-58-38"><a id="__codelineno-58-38" name="__codelineno-58-38" href="#tasks-dockercompose-__codelineno-58-38"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-58-39"><a id="__codelineno-58-39" name="__codelineno-58-39" href="#tasks-dockercompose-__codelineno-58-39"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-58-40"><a id="__codelineno-58-40" name="__codelineno-58-40" href="#tasks-dockercompose-__codelineno-58-40"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-deploy</span>
</span><span id="__span-58-41"><a id="__codelineno-58-41" name="__codelineno-58-41" href="#tasks-dockercompose-__codelineno-58-41"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-58-42"><a id="__codelineno-58-42" name="__codelineno-58-42" href="#tasks-dockercompose-__codelineno-58-42"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-58-43"><a id="__codelineno-58-43" name="__codelineno-58-43" href="#tasks-dockercompose-__codelineno-58-43"></a>
</span><span id="__span-58-44"><a id="__codelineno-58-44" name="__codelineno-58-44" href="#tasks-dockercompose-__codelineno-58-44"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-58-45"><a id="__codelineno-58-45" name="__codelineno-58-45" href="#tasks-dockercompose-__codelineno-58-45"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-58-46"><a id="__codelineno-58-46" name="__codelineno-58-46" href="#tasks-dockercompose-__codelineno-58-46"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-58-47"><a id="__codelineno-58-47" name="__codelineno-58-47" href="#tasks-dockercompose-__codelineno-58-47"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-58-48"><a id="__codelineno-58-48" name="__codelineno-58-48" href="#tasks-dockercompose-__codelineno-58-48"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-58-49"><a id="__codelineno-58-49" name="__codelineno-58-49" href="#tasks-dockercompose-__codelineno-58-49"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-58-50"><a id="__codelineno-58-50" name="__codelineno-58-50" href="#tasks-dockercompose-__codelineno-58-50"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-58-51"><a id="__codelineno-58-51" name="__codelineno-58-51" href="#tasks-dockercompose-__codelineno-58-51"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-58-52"><a id="__codelineno-58-52" name="__codelineno-58-52" href="#tasks-dockercompose-__codelineno-58-52"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-deploy</span>
</span><span id="__span-58-53"><a id="__codelineno-58-53" name="__codelineno-58-53" href="#tasks-dockercompose-__codelineno-58-53"></a>
</span><span id="__span-58-54"><a id="__codelineno-58-54" name="__codelineno-58-54" href="#tasks-dockercompose-__codelineno-58-54"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-58-55"><a id="__codelineno-58-55" name="__codelineno-58-55" href="#tasks-dockercompose-__codelineno-58-55"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#tasks-dockercompose-__codelineno-59-1"></a><span class="c1"># Start services</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#tasks-dockercompose-__codelineno-59-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#tasks-dockercompose-__codelineno-59-3"></a>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#tasks-dockercompose-__codelineno-59-4"></a><span class="c1"># Check environment variables</span>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#tasks-dockercompose-__codelineno-59-5"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>APP_ENV
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#tasks-dockercompose-__codelineno-59-6"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>SERVICE_NAME
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#tasks-dockercompose-__codelineno-59-7"></a>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#tasks-dockercompose-__codelineno-59-8"></a><span class="c1"># View configuration</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#tasks-dockercompose-__codelineno-59-9"></a>docker-compose<span class="w"> </span>config
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#tasks-dockercompose-__codelineno-59-10"></a>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#tasks-dockercompose-__codelineno-59-11"></a><span class="c1"># Stop services</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#tasks-dockercompose-__codelineno-59-12"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>x- prefix</strong>: Extension fields for reusable configurations</li>
<li><strong>&amp;anchor</strong>: Defines a named anchor for later reference</li>
<li>***reference**: References the anchored configuration</li>
<li><strong>&lt;&lt;: *anchor</strong>: Merges the referenced configuration</li>
<li><strong>DRY principle</strong>: Avoids repetition in compose files</li>
<li><strong>Maintainability</strong>: Changes to common config affect all services</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-20-merging-service-configurations">20. Merging Service Configurations<a class="headerlink" href="#tasks-dockercompose-20-merging-service-configurations" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Use YAML merge keys to combine base configurations with service-specific overrides.</p>
<h4 id="tasks-dockercompose-scenario_19"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_19" title="Permanent link">&para;</a></h4>
<ul>
<li>Your services have a common base configuration but need individual customizations for ports, environment variables, or resource limits.</li>
<li>The merge key (&lt;&lt;) allows you to combine multiple configurations, with later values overriding earlier ones.</li>
</ul>
<h4 id="tasks-dockercompose-resources_9">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_9" title="Permanent link">&para;</a></h4>
<ul>
<li><code>docker-compose.yml</code> ‚û§ Compose file demonstrating merge operations
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#tasks-dockercompose-__codelineno-60-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#tasks-dockercompose-__codelineno-60-2"></a>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#tasks-dockercompose-__codelineno-60-3"></a><span class="nt">x-base-service</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;base-service</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#tasks-dockercompose-__codelineno-60-4"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#tasks-dockercompose-__codelineno-60-5"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#tasks-dockercompose-__codelineno-60-6"></a><span class="w">    </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#tasks-dockercompose-__codelineno-60-7"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#tasks-dockercompose-__codelineno-60-8"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#tasks-dockercompose-__codelineno-60-9"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#tasks-dockercompose-__codelineno-60-10"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#tasks-dockercompose-__codelineno-60-11"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#tasks-dockercompose-__codelineno-60-12"></a>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#tasks-dockercompose-__codelineno-60-13"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#tasks-dockercompose-__codelineno-60-14"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#tasks-dockercompose-__codelineno-60-15"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base-service</span>
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#tasks-dockercompose-__codelineno-60-16"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-60-17"><a id="__codelineno-60-17" name="__codelineno-60-17" href="#tasks-dockercompose-__codelineno-60-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-60-18"><a id="__codelineno-60-18" name="__codelineno-60-18" href="#tasks-dockercompose-__codelineno-60-18"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx -g &#39;daemon off;&#39;</span>
</span><span id="__span-60-19"><a id="__codelineno-60-19" name="__codelineno-60-19" href="#tasks-dockercompose-__codelineno-60-19"></a>
</span><span id="__span-60-20"><a id="__codelineno-60-20" name="__codelineno-60-20" href="#tasks-dockercompose-__codelineno-60-20"></a><span class="w">  </span><span class="nt">worker</span><span class="p">:</span>
</span><span id="__span-60-21"><a id="__codelineno-60-21" name="__codelineno-60-21" href="#tasks-dockercompose-__codelineno-60-21"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base-service</span>
</span><span id="__span-60-22"><a id="__codelineno-60-22" name="__codelineno-60-22" href="#tasks-dockercompose-__codelineno-60-22"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-60-23"><a id="__codelineno-60-23" name="__codelineno-60-23" href="#tasks-dockercompose-__codelineno-60-23"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-60-24"><a id="__codelineno-60-24" name="__codelineno-60-24" href="#tasks-dockercompose-__codelineno-60-24"></a><span class="w">      </span><span class="nt">WORKER_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">background</span>
</span><span id="__span-60-25"><a id="__codelineno-60-25" name="__codelineno-60-25" href="#tasks-dockercompose-__codelineno-60-25"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;while true; do echo &quot;Working...&quot;; sleep 30; done&#39;</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>&lt;&lt;: *anchor</code> to merge configurations and override specific values</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#tasks-dockercompose-__codelineno-61-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#tasks-dockercompose-__codelineno-61-2"></a>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#tasks-dockercompose-__codelineno-61-3"></a><span class="nt">x-base-service</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;base-service</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#tasks-dockercompose-__codelineno-61-4"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#tasks-dockercompose-__codelineno-61-5"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#tasks-dockercompose-__codelineno-61-6"></a><span class="w">    </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#tasks-dockercompose-__codelineno-61-7"></a><span class="w">    </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#tasks-dockercompose-__codelineno-61-8"></a><span class="w">    </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#tasks-dockercompose-__codelineno-61-9"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#tasks-dockercompose-__codelineno-61-10"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#tasks-dockercompose-__codelineno-61-11"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#tasks-dockercompose-__codelineno-61-12"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#tasks-dockercompose-__codelineno-61-13"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#tasks-dockercompose-__codelineno-61-14"></a><span class="w">    </span><span class="nt">restart_policy</span><span class="p">:</span>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#tasks-dockercompose-__codelineno-61-15"></a><span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#tasks-dockercompose-__codelineno-61-16"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#tasks-dockercompose-__codelineno-61-17"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#tasks-dockercompose-__codelineno-61-18"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#tasks-dockercompose-__codelineno-61-19"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#tasks-dockercompose-__codelineno-61-20"></a><span class="w">      </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-61-21"><a id="__codelineno-61-21" name="__codelineno-61-21" href="#tasks-dockercompose-__codelineno-61-21"></a>
</span><span id="__span-61-22"><a id="__codelineno-61-22" name="__codelineno-61-22" href="#tasks-dockercompose-__codelineno-61-22"></a><span class="nt">x-web-config</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;web-config</span>
</span><span id="__span-61-23"><a id="__codelineno-61-23" name="__codelineno-61-23" href="#tasks-dockercompose-__codelineno-61-23"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base-service</span>
</span><span id="__span-61-24"><a id="__codelineno-61-24" name="__codelineno-61-24" href="#tasks-dockercompose-__codelineno-61-24"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-61-25"><a id="__codelineno-61-25" name="__codelineno-61-25" href="#tasks-dockercompose-__codelineno-61-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-61-26"><a id="__codelineno-61-26" name="__codelineno-61-26" href="#tasks-dockercompose-__codelineno-61-26"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-61-27"><a id="__codelineno-61-27" name="__codelineno-61-27" href="#tasks-dockercompose-__codelineno-61-27"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-61-28"><a id="__codelineno-61-28" name="__codelineno-61-28" href="#tasks-dockercompose-__codelineno-61-28"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-61-29"><a id="__codelineno-61-29" name="__codelineno-61-29" href="#tasks-dockercompose-__codelineno-61-29"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-61-30"><a id="__codelineno-61-30" name="__codelineno-61-30" href="#tasks-dockercompose-__codelineno-61-30"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-61-31"><a id="__codelineno-61-31" name="__codelineno-61-31" href="#tasks-dockercompose-__codelineno-61-31"></a>
</span><span id="__span-61-32"><a id="__codelineno-61-32" name="__codelineno-61-32" href="#tasks-dockercompose-__codelineno-61-32"></a><span class="nt">x-api-config</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;api-config</span>
</span><span id="__span-61-33"><a id="__codelineno-61-33" name="__codelineno-61-33" href="#tasks-dockercompose-__codelineno-61-33"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base-service</span>
</span><span id="__span-61-34"><a id="__codelineno-61-34" name="__codelineno-61-34" href="#tasks-dockercompose-__codelineno-61-34"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-61-35"><a id="__codelineno-61-35" name="__codelineno-61-35" href="#tasks-dockercompose-__codelineno-61-35"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-61-36"><a id="__codelineno-61-36" name="__codelineno-61-36" href="#tasks-dockercompose-__codelineno-61-36"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-61-37"><a id="__codelineno-61-37" name="__codelineno-61-37" href="#tasks-dockercompose-__codelineno-61-37"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-61-38"><a id="__codelineno-61-38" name="__codelineno-61-38" href="#tasks-dockercompose-__codelineno-61-38"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-61-39"><a id="__codelineno-61-39" name="__codelineno-61-39" href="#tasks-dockercompose-__codelineno-61-39"></a><span class="w">    </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id="__span-61-40"><a id="__codelineno-61-40" name="__codelineno-61-40" href="#tasks-dockercompose-__codelineno-61-40"></a><span class="w">  </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-61-41"><a id="__codelineno-61-41" name="__codelineno-61-41" href="#tasks-dockercompose-__codelineno-61-41"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-61-42"><a id="__codelineno-61-42" name="__codelineno-61-42" href="#tasks-dockercompose-__codelineno-61-42"></a>
</span><span id="__span-61-43"><a id="__codelineno-61-43" name="__codelineno-61-43" href="#tasks-dockercompose-__codelineno-61-43"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-61-44"><a id="__codelineno-61-44" name="__codelineno-61-44" href="#tasks-dockercompose-__codelineno-61-44"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-61-45"><a id="__codelineno-61-45" name="__codelineno-61-45" href="#tasks-dockercompose-__codelineno-61-45"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-config</span>
</span><span id="__span-61-46"><a id="__codelineno-61-46" name="__codelineno-61-46" href="#tasks-dockercompose-__codelineno-61-46"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;&lt;h1&gt;Web Service&lt;/h1&gt;&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 80 -h /tmp&#39;</span>
</span><span id="__span-61-47"><a id="__codelineno-61-47" name="__codelineno-61-47" href="#tasks-dockercompose-__codelineno-61-47"></a>
</span><span id="__span-61-48"><a id="__codelineno-61-48" name="__codelineno-61-48" href="#tasks-dockercompose-__codelineno-61-48"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-61-49"><a id="__codelineno-61-49" name="__codelineno-61-49" href="#tasks-dockercompose-__codelineno-61-49"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-config</span>
</span><span id="__span-61-50"><a id="__codelineno-61-50" name="__codelineno-61-50" href="#tasks-dockercompose-__codelineno-61-50"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;while true; do echo &quot;API running on port 3000&quot;; sleep 10; done&#39;</span>
</span><span id="__span-61-51"><a id="__codelineno-61-51" name="__codelineno-61-51" href="#tasks-dockercompose-__codelineno-61-51"></a>
</span><span id="__span-61-52"><a id="__codelineno-61-52" name="__codelineno-61-52" href="#tasks-dockercompose-__codelineno-61-52"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-61-53"><a id="__codelineno-61-53" name="__codelineno-61-53" href="#tasks-dockercompose-__codelineno-61-53"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-61-54"><a id="__codelineno-61-54" name="__codelineno-61-54" href="#tasks-dockercompose-__codelineno-61-54"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-61-55"><a id="__codelineno-61-55" name="__codelineno-61-55" href="#tasks-dockercompose-__codelineno-61-55"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-61-56"><a id="__codelineno-61-56" name="__codelineno-61-56" href="#tasks-dockercompose-__codelineno-61-56"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-61-57"><a id="__codelineno-61-57" name="__codelineno-61-57" href="#tasks-dockercompose-__codelineno-61-57"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-61-58"><a id="__codelineno-61-58" name="__codelineno-61-58" href="#tasks-dockercompose-__codelineno-61-58"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-61-59"><a id="__codelineno-61-59" name="__codelineno-61-59" href="#tasks-dockercompose-__codelineno-61-59"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-61-60"><a id="__codelineno-61-60" name="__codelineno-61-60" href="#tasks-dockercompose-__codelineno-61-60"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span><span class="w"> </span><span class="nv">*base-service</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-61-61"><a id="__codelineno-61-61" name="__codelineno-61-61" href="#tasks-dockercompose-__codelineno-61-61"></a>
</span><span id="__span-61-62"><a id="__codelineno-61-62" name="__codelineno-61-62" href="#tasks-dockercompose-__codelineno-61-62"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-61-63"><a id="__codelineno-61-63" name="__codelineno-61-63" href="#tasks-dockercompose-__codelineno-61-63"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#tasks-dockercompose-__codelineno-62-1"></a><span class="c1"># Start services</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#tasks-dockercompose-__codelineno-62-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#tasks-dockercompose-__codelineno-62-3"></a>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#tasks-dockercompose-__codelineno-62-4"></a><span class="c1"># Check merged configurations</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#tasks-dockercompose-__codelineno-62-5"></a>docker-compose<span class="w"> </span>config
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#tasks-dockercompose-__codelineno-62-6"></a>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#tasks-dockercompose-__codelineno-62-7"></a><span class="c1"># Test services</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#tasks-dockercompose-__codelineno-62-8"></a>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#tasks-dockercompose-__codelineno-62-9"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>api
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#tasks-dockercompose-__codelineno-62-10"></a>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#tasks-dockercompose-__codelineno-62-11"></a><span class="c1"># Inspect service configurations</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#tasks-dockercompose-__codelineno-62-12"></a>docker<span class="w"> </span>inspect<span class="w"> </span><span class="k">$(</span>docker-compose<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>web<span class="k">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.[0].Config.Env&#39;</span>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#tasks-dockercompose-__codelineno-62-13"></a>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#tasks-dockercompose-__codelineno-62-14"></a><span class="c1"># Stop services</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#tasks-dockercompose-__codelineno-62-15"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>&lt;&lt;: *anchor</strong>: Merges the referenced configuration into the current block</li>
<li><strong>Override behavior</strong>: Later values override earlier ones with the same key</li>
<li><strong>Nested merges</strong>: Can merge multiple levels of configuration</li>
<li><strong>Base + specific</strong>: Common pattern of base config plus service-specific additions</li>
<li><strong>Configuration inheritance</strong>: Services inherit from base configurations</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-21-using-includes-for-modular-compose-files">21. Using Includes for Modular Compose Files<a class="headerlink" href="#tasks-dockercompose-21-using-includes-for-modular-compose-files" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Split large compose files into smaller, manageable modules using Docker Compose includes.</p>
<h4 id="tasks-dockercompose-scenario_20"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_20" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application stack is complex with many services, networks, and volumes, making the compose file difficult to maintain.</li>
<li>Docker Compose includes allow you to split your configuration across multiple files for better organization and reusability.</li>
</ul>
<h4 id="tasks-dockercompose-resources_10">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_10" title="Permanent link">&para;</a></h4>
<ul>
<li><code>docker-compose.yml</code> ‚û§ Main compose file with includes
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#tasks-dockercompose-__codelineno-63-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#tasks-dockercompose-__codelineno-63-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services.yml</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#tasks-dockercompose-__codelineno-63-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networks.yml</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#tasks-dockercompose-__codelineno-63-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volumes.yml</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#tasks-dockercompose-__codelineno-63-5"></a>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#tasks-dockercompose-__codelineno-63-6"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#tasks-dockercompose-__codelineno-63-7"></a>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#tasks-dockercompose-__codelineno-63-8"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#tasks-dockercompose-__codelineno-63-9"></a><span class="w">  </span><span class="nt">proxy</span><span class="p">:</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#tasks-dockercompose-__codelineno-63-10"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-63-11"><a id="__codelineno-63-11" name="__codelineno-63-11" href="#tasks-dockercompose-__codelineno-63-11"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-63-12"><a id="__codelineno-63-12" name="__codelineno-63-12" href="#tasks-dockercompose-__codelineno-63-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
</span></code></pre></div></li>
<li><code>services.yml</code> ‚û§ Service definitions
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#tasks-dockercompose-__codelineno-64-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#tasks-dockercompose-__codelineno-64-2"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#tasks-dockercompose-__codelineno-64-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#tasks-dockercompose-__codelineno-64-4"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#tasks-dockercompose-__codelineno-64-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#tasks-dockercompose-__codelineno-64-6"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#tasks-dockercompose-__codelineno-64-7"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#tasks-dockercompose-__codelineno-64-8"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#tasks-dockercompose-__codelineno-64-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#tasks-dockercompose-__codelineno-64-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span></code></pre></div></li>
<li><code>networks.yml</code> ‚û§ Network definitions
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#tasks-dockercompose-__codelineno-65-1"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#tasks-dockercompose-__codelineno-65-2"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#tasks-dockercompose-__codelineno-65-3"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#tasks-dockercompose-__codelineno-65-4"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#tasks-dockercompose-__codelineno-65-5"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#tasks-dockercompose-__codelineno-65-6"></a><span class="w">    </span><span class="nt">internal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use <code>include</code> directive to reference external compose files</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong> (main)
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#tasks-dockercompose-__codelineno-66-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#tasks-dockercompose-__codelineno-66-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">services.yml</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#tasks-dockercompose-__codelineno-66-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networks.yml</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#tasks-dockercompose-__codelineno-66-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">volumes.yml</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#tasks-dockercompose-__codelineno-66-5"></a>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#tasks-dockercompose-__codelineno-66-6"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#tasks-dockercompose-__codelineno-66-7"></a>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#tasks-dockercompose-__codelineno-66-8"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#tasks-dockercompose-__codelineno-66-9"></a><span class="w">  </span><span class="nt">proxy</span><span class="p">:</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#tasks-dockercompose-__codelineno-66-10"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#tasks-dockercompose-__codelineno-66-11"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#tasks-dockercompose-__codelineno-66-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;80:80&quot;</span>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#tasks-dockercompose-__codelineno-66-13"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#tasks-dockercompose-__codelineno-66-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./proxy/nginx.conf:/etc/nginx/nginx.conf:ro</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#tasks-dockercompose-__codelineno-66-15"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#tasks-dockercompose-__codelineno-66-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#tasks-dockercompose-__codelineno-66-17"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#tasks-dockercompose-__codelineno-66-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#tasks-dockercompose-__codelineno-66-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span></code></pre></div></p>
<p><strong>services.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#tasks-dockercompose-__codelineno-67-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#tasks-dockercompose-__codelineno-67-2"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#tasks-dockercompose-__codelineno-67-3"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#tasks-dockercompose-__codelineno-67-4"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#tasks-dockercompose-__codelineno-67-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web_data:/usr/share/nginx/html</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#tasks-dockercompose-__codelineno-67-6"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#tasks-dockercompose-__codelineno-67-7"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#tasks-dockercompose-__codelineno-67-8"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#tasks-dockercompose-__codelineno-67-9"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#tasks-dockercompose-__codelineno-67-10"></a>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#tasks-dockercompose-__codelineno-67-11"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#tasks-dockercompose-__codelineno-67-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#tasks-dockercompose-__codelineno-67-13"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#tasks-dockercompose-__codelineno-67-14"></a><span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#tasks-dockercompose-__codelineno-67-15"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#tasks-dockercompose-__codelineno-67-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#tasks-dockercompose-__codelineno-67-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#tasks-dockercompose-__codelineno-67-18"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#tasks-dockercompose-__codelineno-67-19"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20" href="#tasks-dockercompose-__codelineno-67-20"></a>
</span><span id="__span-67-21"><a id="__codelineno-67-21" name="__codelineno-67-21" href="#tasks-dockercompose-__codelineno-67-21"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-67-22"><a id="__codelineno-67-22" name="__codelineno-67-22" href="#tasks-dockercompose-__codelineno-67-22"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-67-23"><a id="__codelineno-67-23" name="__codelineno-67-23" href="#tasks-dockercompose-__codelineno-67-23"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-67-24"><a id="__codelineno-67-24" name="__codelineno-67-24" href="#tasks-dockercompose-__codelineno-67-24"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-67-25"><a id="__codelineno-67-25" name="__codelineno-67-25" href="#tasks-dockercompose-__codelineno-67-25"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-67-26"><a id="__codelineno-67-26" name="__codelineno-67-26" href="#tasks-dockercompose-__codelineno-67-26"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-67-27"><a id="__codelineno-67-27" name="__codelineno-67-27" href="#tasks-dockercompose-__codelineno-67-27"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-67-28"><a id="__codelineno-67-28" name="__codelineno-67-28" href="#tasks-dockercompose-__codelineno-67-28"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-67-29"><a id="__codelineno-67-29" name="__codelineno-67-29" href="#tasks-dockercompose-__codelineno-67-29"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-67-30"><a id="__codelineno-67-30" name="__codelineno-67-30" href="#tasks-dockercompose-__codelineno-67-30"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span></code></pre></div></p>
<p><strong>networks.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#tasks-dockercompose-__codelineno-68-1"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#tasks-dockercompose-__codelineno-68-2"></a><span class="w">  </span><span class="nt">frontend</span><span class="p">:</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#tasks-dockercompose-__codelineno-68-3"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#tasks-dockercompose-__codelineno-68-4"></a><span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#tasks-dockercompose-__codelineno-68-5"></a><span class="w">      </span><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-68-6"><a id="__codelineno-68-6" name="__codelineno-68-6" href="#tasks-dockercompose-__codelineno-68-6"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.20.0.0/16</span>
</span><span id="__span-68-7"><a id="__codelineno-68-7" name="__codelineno-68-7" href="#tasks-dockercompose-__codelineno-68-7"></a><span class="w">  </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-68-8"><a id="__codelineno-68-8" name="__codelineno-68-8" href="#tasks-dockercompose-__codelineno-68-8"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-68-9"><a id="__codelineno-68-9" name="__codelineno-68-9" href="#tasks-dockercompose-__codelineno-68-9"></a><span class="w">    </span><span class="nt">internal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-68-10"><a id="__codelineno-68-10" name="__codelineno-68-10" href="#tasks-dockercompose-__codelineno-68-10"></a><span class="w">    </span><span class="nt">ipam</span><span class="p">:</span>
</span><span id="__span-68-11"><a id="__codelineno-68-11" name="__codelineno-68-11" href="#tasks-dockercompose-__codelineno-68-11"></a><span class="w">      </span><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-68-12"><a id="__codelineno-68-12" name="__codelineno-68-12" href="#tasks-dockercompose-__codelineno-68-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">subnet</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.21.0.0/16</span>
</span></code></pre></div></p>
<p><strong>volumes.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#tasks-dockercompose-__codelineno-69-1"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#tasks-dockercompose-__codelineno-69-2"></a><span class="w">  </span><span class="nt">web_data</span><span class="p">:</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#tasks-dockercompose-__codelineno-69-3"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>proxy/nginx.conf</strong>
<div class="language-nginx highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#tasks-dockercompose-__codelineno-70-1"></a><span class="k">events</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#tasks-dockercompose-__codelineno-70-2"></a><span class="w">    </span><span class="kn">worker_connections</span><span class="w"> </span><span class="mi">1024</span><span class="p">;</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#tasks-dockercompose-__codelineno-70-3"></a><span class="p">}</span>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#tasks-dockercompose-__codelineno-70-4"></a>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#tasks-dockercompose-__codelineno-70-5"></a><span class="k">http</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#tasks-dockercompose-__codelineno-70-6"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">web_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#tasks-dockercompose-__codelineno-70-7"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">web</span><span class="p">:</span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-70-8"><a id="__codelineno-70-8" name="__codelineno-70-8" href="#tasks-dockercompose-__codelineno-70-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-70-9"><a id="__codelineno-70-9" name="__codelineno-70-9" href="#tasks-dockercompose-__codelineno-70-9"></a>
</span><span id="__span-70-10"><a id="__codelineno-70-10" name="__codelineno-70-10" href="#tasks-dockercompose-__codelineno-70-10"></a><span class="w">    </span><span class="kn">upstream</span><span class="w"> </span><span class="s">api_backend</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-11"><a id="__codelineno-70-11" name="__codelineno-70-11" href="#tasks-dockercompose-__codelineno-70-11"></a><span class="w">        </span><span class="kn">server</span><span class="w"> </span><span class="n">api</span><span class="p">:</span><span class="mi">3000</span><span class="p">;</span>
</span><span id="__span-70-12"><a id="__codelineno-70-12" name="__codelineno-70-12" href="#tasks-dockercompose-__codelineno-70-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-70-13"><a id="__codelineno-70-13" name="__codelineno-70-13" href="#tasks-dockercompose-__codelineno-70-13"></a>
</span><span id="__span-70-14"><a id="__codelineno-70-14" name="__codelineno-70-14" href="#tasks-dockercompose-__codelineno-70-14"></a><span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-15"><a id="__codelineno-70-15" name="__codelineno-70-15" href="#tasks-dockercompose-__codelineno-70-15"></a><span class="w">        </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span>
</span><span id="__span-70-16"><a id="__codelineno-70-16" name="__codelineno-70-16" href="#tasks-dockercompose-__codelineno-70-16"></a>
</span><span id="__span-70-17"><a id="__codelineno-70-17" name="__codelineno-70-17" href="#tasks-dockercompose-__codelineno-70-17"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-18"><a id="__codelineno-70-18" name="__codelineno-70-18" href="#tasks-dockercompose-__codelineno-70-18"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://web_backend</span><span class="p">;</span>
</span><span id="__span-70-19"><a id="__codelineno-70-19" name="__codelineno-70-19" href="#tasks-dockercompose-__codelineno-70-19"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-70-20"><a id="__codelineno-70-20" name="__codelineno-70-20" href="#tasks-dockercompose-__codelineno-70-20"></a>
</span><span id="__span-70-21"><a id="__codelineno-70-21" name="__codelineno-70-21" href="#tasks-dockercompose-__codelineno-70-21"></a><span class="w">        </span><span class="kn">location</span><span class="w"> </span><span class="s">/api</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-70-22"><a id="__codelineno-70-22" name="__codelineno-70-22" href="#tasks-dockercompose-__codelineno-70-22"></a><span class="w">            </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://api_backend</span><span class="p">;</span>
</span><span id="__span-70-23"><a id="__codelineno-70-23" name="__codelineno-70-23" href="#tasks-dockercompose-__codelineno-70-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-70-24"><a id="__codelineno-70-24" name="__codelineno-70-24" href="#tasks-dockercompose-__codelineno-70-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-70-25"><a id="__codelineno-70-25" name="__codelineno-70-25" href="#tasks-dockercompose-__codelineno-70-25"></a><span class="p">}</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#tasks-dockercompose-__codelineno-71-1"></a><span class="c1"># Start all services from modular files</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#tasks-dockercompose-__codelineno-71-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#tasks-dockercompose-__codelineno-71-3"></a>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#tasks-dockercompose-__codelineno-71-4"></a><span class="c1"># Check included configurations</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#tasks-dockercompose-__codelineno-71-5"></a>docker-compose<span class="w"> </span>config
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#tasks-dockercompose-__codelineno-71-6"></a>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#tasks-dockercompose-__codelineno-71-7"></a><span class="c1"># List all services from includes</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#tasks-dockercompose-__codelineno-71-8"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#tasks-dockercompose-__codelineno-71-9"></a>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#tasks-dockercompose-__codelineno-71-10"></a><span class="c1"># View logs from specific service</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#tasks-dockercompose-__codelineno-71-11"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>web
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#tasks-dockercompose-__codelineno-71-12"></a>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#tasks-dockercompose-__codelineno-71-13"></a><span class="c1"># Stop all services</span>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#tasks-dockercompose-__codelineno-71-14"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>include</strong>: References external compose files to include their configurations</li>
<li><strong>Modular organization</strong>: Split large files into logical components</li>
<li><strong>Reusability</strong>: Include files can be shared across projects</li>
<li><strong>Maintainability</strong>: Easier to manage and version control smaller files</li>
<li><strong>Override capability</strong>: Main file can override included configurations</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-22-environment-specific-fragments">22. Environment-Specific Fragments<a class="headerlink" href="#tasks-dockercompose-22-environment-specific-fragments" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create environment-specific configurations using fragments and conditional includes.</p>
<h4 id="tasks-dockercompose-scenario_21"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_21" title="Permanent link">&para;</a></h4>
<ul>
<li>You need different service configurations for development, staging, and production environments with varying resource allocations, logging levels, and monitoring.</li>
<li>Fragments combined with includes allow you to maintain environment-specific configurations while sharing common elements.</li>
</ul>
<h4 id="tasks-dockercompose-resources_11">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_11" title="Permanent link">&para;</a></h4>
<ul>
<li><code>docker-compose.yml</code> ‚û§ Main file with environment includes
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#tasks-dockercompose-__codelineno-72-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#tasks-dockercompose-__codelineno-72-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common.yml</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#tasks-dockercompose-__codelineno-72-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environments/${ENVIRONMENT}.yml</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#tasks-dockercompose-__codelineno-72-4"></a>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#tasks-dockercompose-__codelineno-72-5"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span></code></pre></div></li>
<li><code>environments/development.yml</code> ‚û§ Development-specific config
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#tasks-dockercompose-__codelineno-73-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#tasks-dockercompose-__codelineno-73-2"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#tasks-dockercompose-__codelineno-73-3"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#tasks-dockercompose-__codelineno-73-4"></a><span class="w">      </span><span class="nt">DEBUG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-73-5"><a id="__codelineno-73-5" name="__codelineno-73-5" href="#tasks-dockercompose-__codelineno-73-5"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-73-6"><a id="__codelineno-73-6" name="__codelineno-73-6" href="#tasks-dockercompose-__codelineno-73-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span></code></pre></div></li>
<li><code>environments/production.yml</code> ‚û§ Production-specific config
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#tasks-dockercompose-__codelineno-74-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#tasks-dockercompose-__codelineno-74-2"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#tasks-dockercompose-__codelineno-74-3"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#tasks-dockercompose-__codelineno-74-4"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#tasks-dockercompose-__codelineno-74-5"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#tasks-dockercompose-__codelineno-74-6"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#tasks-dockercompose-__codelineno-74-7"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#tasks-dockercompose-__codelineno-74-8"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#tasks-dockercompose-__codelineno-74-9"></a><span class="w">      </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Use environment variables in include paths and fragments for environment-specific configurations</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong> (main)
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#tasks-dockercompose-__codelineno-75-1"></a><span class="nt">include</span><span class="p">:</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#tasks-dockercompose-__codelineno-75-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">common.yml</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#tasks-dockercompose-__codelineno-75-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environments/${ENVIRONMENT:-development}.yml</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#tasks-dockercompose-__codelineno-75-4"></a>
</span><span id="__span-75-5"><a id="__codelineno-75-5" name="__codelineno-75-5" href="#tasks-dockercompose-__codelineno-75-5"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-75-6"><a id="__codelineno-75-6" name="__codelineno-75-6" href="#tasks-dockercompose-__codelineno-75-6"></a>
</span><span id="__span-75-7"><a id="__codelineno-75-7" name="__codelineno-75-7" href="#tasks-dockercompose-__codelineno-75-7"></a><span class="nt">x-env-overrides</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;env-overrides</span>
</span><span id="__span-75-8"><a id="__codelineno-75-8" name="__codelineno-75-8" href="#tasks-dockercompose-__codelineno-75-8"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-75-9"><a id="__codelineno-75-9" name="__codelineno-75-9" href="#tasks-dockercompose-__codelineno-75-9"></a><span class="w">    </span><span class="nt">ENVIRONMENT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${ENVIRONMENT:-development}</span>
</span><span id="__span-75-10"><a id="__codelineno-75-10" name="__codelineno-75-10" href="#tasks-dockercompose-__codelineno-75-10"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-75-11"><a id="__codelineno-75-11" name="__codelineno-75-11" href="#tasks-dockercompose-__codelineno-75-11"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-75-12"><a id="__codelineno-75-12" name="__codelineno-75-12" href="#tasks-dockercompose-__codelineno-75-12"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-75-13"><a id="__codelineno-75-13" name="__codelineno-75-13" href="#tasks-dockercompose-__codelineno-75-13"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${LOG_MAX_SIZE:-10m}</span>
</span><span id="__span-75-14"><a id="__codelineno-75-14" name="__codelineno-75-14" href="#tasks-dockercompose-__codelineno-75-14"></a><span class="w">      </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${LOG_MAX_FILE:-3}</span>
</span></code></pre></div></p>
<p><strong>common.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#tasks-dockercompose-__codelineno-76-1"></a><span class="nt">x-common-service</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;common-service</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#tasks-dockercompose-__codelineno-76-2"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alpine:latest</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#tasks-dockercompose-__codelineno-76-3"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*env-overrides</span>
</span><span id="__span-76-4"><a id="__codelineno-76-4" name="__codelineno-76-4" href="#tasks-dockercompose-__codelineno-76-4"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-76-5"><a id="__codelineno-76-5" name="__codelineno-76-5" href="#tasks-dockercompose-__codelineno-76-5"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-76-6"><a id="__codelineno-76-6" name="__codelineno-76-6" href="#tasks-dockercompose-__codelineno-76-6"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-76-7"><a id="__codelineno-76-7" name="__codelineno-76-7" href="#tasks-dockercompose-__codelineno-76-7"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${MEMORY_LIMIT:-128M}</span>
</span><span id="__span-76-8"><a id="__codelineno-76-8" name="__codelineno-76-8" href="#tasks-dockercompose-__codelineno-76-8"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">${CPU_LIMIT:-0.25}</span>
</span><span id="__span-76-9"><a id="__codelineno-76-9" name="__codelineno-76-9" href="#tasks-dockercompose-__codelineno-76-9"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-76-10"><a id="__codelineno-76-10" name="__codelineno-76-10" href="#tasks-dockercompose-__codelineno-76-10"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;OK&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-76-11"><a id="__codelineno-76-11" name="__codelineno-76-11" href="#tasks-dockercompose-__codelineno-76-11"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-76-12"><a id="__codelineno-76-12" name="__codelineno-76-12" href="#tasks-dockercompose-__codelineno-76-12"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-76-13"><a id="__codelineno-76-13" name="__codelineno-76-13" href="#tasks-dockercompose-__codelineno-76-13"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-76-14"><a id="__codelineno-76-14" name="__codelineno-76-14" href="#tasks-dockercompose-__codelineno-76-14"></a>
</span><span id="__span-76-15"><a id="__codelineno-76-15" name="__codelineno-76-15" href="#tasks-dockercompose-__codelineno-76-15"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-76-16"><a id="__codelineno-76-16" name="__codelineno-76-16" href="#tasks-dockercompose-__codelineno-76-16"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-76-17"><a id="__codelineno-76-17" name="__codelineno-76-17" href="#tasks-dockercompose-__codelineno-76-17"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-service</span>
</span><span id="__span-76-18"><a id="__codelineno-76-18" name="__codelineno-76-18" href="#tasks-dockercompose-__codelineno-76-18"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;echo &quot;&lt;h1&gt;Web Service - ${ENVIRONMENT}&lt;/h1&gt;&quot; &gt; /tmp/index.html &amp;&amp; busybox httpd -f -p 80 -h /tmp&#39;</span>
</span><span id="__span-76-19"><a id="__codelineno-76-19" name="__codelineno-76-19" href="#tasks-dockercompose-__codelineno-76-19"></a>
</span><span id="__span-76-20"><a id="__codelineno-76-20" name="__codelineno-76-20" href="#tasks-dockercompose-__codelineno-76-20"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-76-21"><a id="__codelineno-76-21" name="__codelineno-76-21" href="#tasks-dockercompose-__codelineno-76-21"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-service</span>
</span><span id="__span-76-22"><a id="__codelineno-76-22" name="__codelineno-76-22" href="#tasks-dockercompose-__codelineno-76-22"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-76-23"><a id="__codelineno-76-23" name="__codelineno-76-23" href="#tasks-dockercompose-__codelineno-76-23"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*common-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-76-24"><a id="__codelineno-76-24" name="__codelineno-76-24" href="#tasks-dockercompose-__codelineno-76-24"></a><span class="w">      </span><span class="nt">SERVICE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-76-25"><a id="__codelineno-76-25" name="__codelineno-76-25" href="#tasks-dockercompose-__codelineno-76-25"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh -c &#39;while true; do echo &quot;API in ${ENVIRONMENT}&quot;; sleep 10; done&#39;</span>
</span><span id="__span-76-26"><a id="__codelineno-76-26" name="__codelineno-76-26" href="#tasks-dockercompose-__codelineno-76-26"></a>
</span><span id="__span-76-27"><a id="__codelineno-76-27" name="__codelineno-76-27" href="#tasks-dockercompose-__codelineno-76-27"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-76-28"><a id="__codelineno-76-28" name="__codelineno-76-28" href="#tasks-dockercompose-__codelineno-76-28"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-76-29"><a id="__codelineno-76-29" name="__codelineno-76-29" href="#tasks-dockercompose-__codelineno-76-29"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-76-30"><a id="__codelineno-76-30" name="__codelineno-76-30" href="#tasks-dockercompose-__codelineno-76-30"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-76-31"><a id="__codelineno-76-31" name="__codelineno-76-31" href="#tasks-dockercompose-__codelineno-76-31"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-76-32"><a id="__codelineno-76-32" name="__codelineno-76-32" href="#tasks-dockercompose-__codelineno-76-32"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-76-33"><a id="__codelineno-76-33" name="__codelineno-76-33" href="#tasks-dockercompose-__codelineno-76-33"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-76-34"><a id="__codelineno-76-34" name="__codelineno-76-34" href="#tasks-dockercompose-__codelineno-76-34"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-76-35"><a id="__codelineno-76-35" name="__codelineno-76-35" href="#tasks-dockercompose-__codelineno-76-35"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*env-overrides</span>
</span><span id="__span-76-36"><a id="__codelineno-76-36" name="__codelineno-76-36" href="#tasks-dockercompose-__codelineno-76-36"></a>
</span><span id="__span-76-37"><a id="__codelineno-76-37" name="__codelineno-76-37" href="#tasks-dockercompose-__codelineno-76-37"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-76-38"><a id="__codelineno-76-38" name="__codelineno-76-38" href="#tasks-dockercompose-__codelineno-76-38"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>environments/development.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#tasks-dockercompose-__codelineno-77-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#tasks-dockercompose-__codelineno-77-2"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#tasks-dockercompose-__codelineno-77-3"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#tasks-dockercompose-__codelineno-77-4"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#tasks-dockercompose-__codelineno-77-5"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#tasks-dockercompose-__codelineno-77-6"></a><span class="w">      </span><span class="nt">DEBUG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#tasks-dockercompose-__codelineno-77-7"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#tasks-dockercompose-__codelineno-77-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./dev-logs:/app/logs</span>
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#tasks-dockercompose-__codelineno-77-9"></a>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#tasks-dockercompose-__codelineno-77-10"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#tasks-dockercompose-__codelineno-77-11"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#tasks-dockercompose-__codelineno-77-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#tasks-dockercompose-__codelineno-77-13"></a>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#tasks-dockercompose-__codelineno-77-14"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#tasks-dockercompose-__codelineno-77-15"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#tasks-dockercompose-__codelineno-77-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span>
</span></code></pre></div></p>
<p><strong>environments/production.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#tasks-dockercompose-__codelineno-78-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#tasks-dockercompose-__codelineno-78-2"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#tasks-dockercompose-__codelineno-78-3"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#tasks-dockercompose-__codelineno-78-4"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#tasks-dockercompose-__codelineno-78-5"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#tasks-dockercompose-__codelineno-78-6"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#tasks-dockercompose-__codelineno-78-7"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#tasks-dockercompose-__codelineno-78-8"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#tasks-dockercompose-__codelineno-78-9"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#tasks-dockercompose-__codelineno-78-10"></a><span class="w">      </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#tasks-dockercompose-__codelineno-78-11"></a>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#tasks-dockercompose-__codelineno-78-12"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#tasks-dockercompose-__codelineno-78-13"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#tasks-dockercompose-__codelineno-78-14"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#tasks-dockercompose-__codelineno-78-15"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#tasks-dockercompose-__codelineno-78-16"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#tasks-dockercompose-__codelineno-78-17"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18" href="#tasks-dockercompose-__codelineno-78-18"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19" href="#tasks-dockercompose-__codelineno-78-19"></a>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20" href="#tasks-dockercompose-__codelineno-78-20"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-78-21"><a id="__codelineno-78-21" name="__codelineno-78-21" href="#tasks-dockercompose-__codelineno-78-21"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-78-22"><a id="__codelineno-78-22" name="__codelineno-78-22" href="#tasks-dockercompose-__codelineno-78-22"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-78-23"><a id="__codelineno-78-23" name="__codelineno-78-23" href="#tasks-dockercompose-__codelineno-78-23"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-78-24"><a id="__codelineno-78-24" name="__codelineno-78-24" href="#tasks-dockercompose-__codelineno-78-24"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-78-25"><a id="__codelineno-78-25" name="__codelineno-78-25" href="#tasks-dockercompose-__codelineno-78-25"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.0&#39;</span>
</span></code></pre></div></p>
<p><strong>environments/staging.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#tasks-dockercompose-__codelineno-79-1"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#tasks-dockercompose-__codelineno-79-2"></a><span class="w">  </span><span class="nt">web</span><span class="p">:</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#tasks-dockercompose-__codelineno-79-3"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#tasks-dockercompose-__codelineno-79-4"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#tasks-dockercompose-__codelineno-79-5"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#tasks-dockercompose-__codelineno-79-6"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#tasks-dockercompose-__codelineno-79-7"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#tasks-dockercompose-__codelineno-79-8"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#tasks-dockercompose-__codelineno-79-9"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#tasks-dockercompose-__codelineno-79-10"></a><span class="w">      </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#tasks-dockercompose-__codelineno-79-11"></a>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#tasks-dockercompose-__codelineno-79-12"></a><span class="w">  </span><span class="nt">api</span><span class="p">:</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#tasks-dockercompose-__codelineno-79-13"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#tasks-dockercompose-__codelineno-79-14"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#tasks-dockercompose-__codelineno-79-15"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#tasks-dockercompose-__codelineno-79-16"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#tasks-dockercompose-__codelineno-79-17"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#tasks-dockercompose-__codelineno-79-18"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#tasks-dockercompose-__codelineno-79-19"></a>
</span><span id="__span-79-20"><a id="__codelineno-79-20" name="__codelineno-79-20" href="#tasks-dockercompose-__codelineno-79-20"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-79-21"><a id="__codelineno-79-21" name="__codelineno-79-21" href="#tasks-dockercompose-__codelineno-79-21"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-79-22"><a id="__codelineno-79-22" name="__codelineno-79-22" href="#tasks-dockercompose-__codelineno-79-22"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-79-23"><a id="__codelineno-79-23" name="__codelineno-79-23" href="#tasks-dockercompose-__codelineno-79-23"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-79-24"><a id="__codelineno-79-24" name="__codelineno-79-24" href="#tasks-dockercompose-__codelineno-79-24"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-79-25"><a id="__codelineno-79-25" name="__codelineno-79-25" href="#tasks-dockercompose-__codelineno-79-25"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#tasks-dockercompose-__codelineno-80-1"></a><span class="c1"># Development environment</span>
</span><span id="__span-80-2"><a id="__codelineno-80-2" name="__codelineno-80-2" href="#tasks-dockercompose-__codelineno-80-2"></a><span class="nv">ENVIRONMENT</span><span class="o">=</span>development<span class="w"> </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-80-3"><a id="__codelineno-80-3" name="__codelineno-80-3" href="#tasks-dockercompose-__codelineno-80-3"></a>
</span><span id="__span-80-4"><a id="__codelineno-80-4" name="__codelineno-80-4" href="#tasks-dockercompose-__codelineno-80-4"></a><span class="c1"># Production environment</span>
</span><span id="__span-80-5"><a id="__codelineno-80-5" name="__codelineno-80-5" href="#tasks-dockercompose-__codelineno-80-5"></a><span class="nv">ENVIRONMENT</span><span class="o">=</span>production<span class="w"> </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-80-6"><a id="__codelineno-80-6" name="__codelineno-80-6" href="#tasks-dockercompose-__codelineno-80-6"></a>
</span><span id="__span-80-7"><a id="__codelineno-80-7" name="__codelineno-80-7" href="#tasks-dockercompose-__codelineno-80-7"></a><span class="c1"># Staging environment</span>
</span><span id="__span-80-8"><a id="__codelineno-80-8" name="__codelineno-80-8" href="#tasks-dockercompose-__codelineno-80-8"></a><span class="nv">ENVIRONMENT</span><span class="o">=</span>staging<span class="w"> </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-80-9"><a id="__codelineno-80-9" name="__codelineno-80-9" href="#tasks-dockercompose-__codelineno-80-9"></a>
</span><span id="__span-80-10"><a id="__codelineno-80-10" name="__codelineno-80-10" href="#tasks-dockercompose-__codelineno-80-10"></a><span class="c1"># Check current configuration</span>
</span><span id="__span-80-11"><a id="__codelineno-80-11" name="__codelineno-80-11" href="#tasks-dockercompose-__codelineno-80-11"></a>docker-compose<span class="w"> </span>config
</span><span id="__span-80-12"><a id="__codelineno-80-12" name="__codelineno-80-12" href="#tasks-dockercompose-__codelineno-80-12"></a>
</span><span id="__span-80-13"><a id="__codelineno-80-13" name="__codelineno-80-13" href="#tasks-dockercompose-__codelineno-80-13"></a><span class="c1"># View environment-specific settings</span>
</span><span id="__span-80-14"><a id="__codelineno-80-14" name="__codelineno-80-14" href="#tasks-dockercompose-__codelineno-80-14"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>ENVIRONMENT
</span><span id="__span-80-15"><a id="__codelineno-80-15" name="__codelineno-80-15" href="#tasks-dockercompose-__codelineno-80-15"></a>
</span><span id="__span-80-16"><a id="__codelineno-80-16" name="__codelineno-80-16" href="#tasks-dockercompose-__codelineno-80-16"></a><span class="c1"># Stop services</span>
</span><span id="__span-80-17"><a id="__codelineno-80-17" name="__codelineno-80-17" href="#tasks-dockercompose-__codelineno-80-17"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Environment variables in includes</strong>: Dynamic file inclusion based on environment</li>
<li><strong>Fragment overrides</strong>: Environment files override common configurations</li>
<li><strong>Conditional configuration</strong>: Different settings per environment</li>
<li><strong>Scalability</strong>: Easy to add new environments</li>
<li><strong>Maintainability</strong>: Separate concerns for common vs environment-specific config</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-23-complex-fragment-hierarchies">23. Complex Fragment Hierarchies<a class="headerlink" href="#tasks-dockercompose-23-complex-fragment-hierarchies" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Build complex configuration hierarchies using nested anchors and multiple inheritance levels.</p>
<h4 id="tasks-dockercompose-scenario_22"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_22" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application has services with multiple inheritance levels - base configurations, service-type configurations, and instance-specific overrides.</li>
<li>Complex fragment hierarchies allow you to build sophisticated configuration inheritance chains.</li>
</ul>
<h4 id="tasks-dockercompose-resources_12">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_12" title="Permanent link">&para;</a></h4>
<ul>
<li><code>docker-compose.yml</code> ‚û§ Complex fragment hierarchy
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#tasks-dockercompose-__codelineno-81-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#tasks-dockercompose-__codelineno-81-2"></a>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#tasks-dockercompose-__codelineno-81-3"></a><span class="nt">x-base</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;base</span>
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#tasks-dockercompose-__codelineno-81-4"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-81-5"><a id="__codelineno-81-5" name="__codelineno-81-5" href="#tasks-dockercompose-__codelineno-81-5"></a><span class="w">    </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-81-6"><a id="__codelineno-81-6" name="__codelineno-81-6" href="#tasks-dockercompose-__codelineno-81-6"></a>
</span><span id="__span-81-7"><a id="__codelineno-81-7" name="__codelineno-81-7" href="#tasks-dockercompose-__codelineno-81-7"></a><span class="nt">x-service-base</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;service-base</span>
</span><span id="__span-81-8"><a id="__codelineno-81-8" name="__codelineno-81-8" href="#tasks-dockercompose-__codelineno-81-8"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*base</span>
</span><span id="__span-81-9"><a id="__codelineno-81-9" name="__codelineno-81-9" href="#tasks-dockercompose-__codelineno-81-9"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-81-10"><a id="__codelineno-81-10" name="__codelineno-81-10" href="#tasks-dockercompose-__codelineno-81-10"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-81-11"><a id="__codelineno-81-11" name="__codelineno-81-11" href="#tasks-dockercompose-__codelineno-81-11"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-81-12"><a id="__codelineno-81-12" name="__codelineno-81-12" href="#tasks-dockercompose-__codelineno-81-12"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id="__span-81-13"><a id="__codelineno-81-13" name="__codelineno-81-13" href="#tasks-dockercompose-__codelineno-81-13"></a>
</span><span id="__span-81-14"><a id="__codelineno-81-14" name="__codelineno-81-14" href="#tasks-dockercompose-__codelineno-81-14"></a><span class="nt">x-web-service</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;web-service</span>
</span><span id="__span-81-15"><a id="__codelineno-81-15" name="__codelineno-81-15" href="#tasks-dockercompose-__codelineno-81-15"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span>
</span><span id="__span-81-16"><a id="__codelineno-81-16" name="__codelineno-81-16" href="#tasks-dockercompose-__codelineno-81-16"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-81-17"><a id="__codelineno-81-17" name="__codelineno-81-17" href="#tasks-dockercompose-__codelineno-81-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-81-18"><a id="__codelineno-81-18" name="__codelineno-81-18" href="#tasks-dockercompose-__codelineno-81-18"></a>
</span><span id="__span-81-19"><a id="__codelineno-81-19" name="__codelineno-81-19" href="#tasks-dockercompose-__codelineno-81-19"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-81-20"><a id="__codelineno-81-20" name="__codelineno-81-20" href="#tasks-dockercompose-__codelineno-81-20"></a><span class="w">  </span><span class="nt">web-primary</span><span class="p">:</span>
</span><span id="__span-81-21"><a id="__codelineno-81-21" name="__codelineno-81-21" href="#tasks-dockercompose-__codelineno-81-21"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-service</span>
</span><span id="__span-81-22"><a id="__codelineno-81-22" name="__codelineno-81-22" href="#tasks-dockercompose-__codelineno-81-22"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-81-23"><a id="__codelineno-81-23" name="__codelineno-81-23" href="#tasks-dockercompose-__codelineno-81-23"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-81-24"><a id="__codelineno-81-24" name="__codelineno-81-24" href="#tasks-dockercompose-__codelineno-81-24"></a><span class="w">      </span><span class="nt">INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary</span>
</span><span id="__span-81-25"><a id="__codelineno-81-25" name="__codelineno-81-25" href="#tasks-dockercompose-__codelineno-81-25"></a>
</span><span id="__span-81-26"><a id="__codelineno-81-26" name="__codelineno-81-26" href="#tasks-dockercompose-__codelineno-81-26"></a><span class="w">  </span><span class="nt">web-secondary</span><span class="p">:</span>
</span><span id="__span-81-27"><a id="__codelineno-81-27" name="__codelineno-81-27" href="#tasks-dockercompose-__codelineno-81-27"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-service</span>
</span><span id="__span-81-28"><a id="__codelineno-81-28" name="__codelineno-81-28" href="#tasks-dockercompose-__codelineno-81-28"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-81-29"><a id="__codelineno-81-29" name="__codelineno-81-29" href="#tasks-dockercompose-__codelineno-81-29"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-service</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-81-30"><a id="__codelineno-81-30" name="__codelineno-81-30" href="#tasks-dockercompose-__codelineno-81-30"></a><span class="w">      </span><span class="nt">INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secondary</span>
</span><span id="__span-81-31"><a id="__codelineno-81-31" name="__codelineno-81-31" href="#tasks-dockercompose-__codelineno-81-31"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-81-32"><a id="__codelineno-81-32" name="__codelineno-81-32" href="#tasks-dockercompose-__codelineno-81-32"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-service</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-81-33"><a id="__codelineno-81-33" name="__codelineno-81-33" href="#tasks-dockercompose-__codelineno-81-33"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Create multi-level inheritance chains with anchors and merges</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#tasks-dockercompose-__codelineno-82-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#tasks-dockercompose-__codelineno-82-2"></a>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#tasks-dockercompose-__codelineno-82-3"></a><span class="nt">x-global</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;global</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#tasks-dockercompose-__codelineno-82-4"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#tasks-dockercompose-__codelineno-82-5"></a><span class="w">    </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#tasks-dockercompose-__codelineno-82-6"></a><span class="w">    </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id="__span-82-7"><a id="__codelineno-82-7" name="__codelineno-82-7" href="#tasks-dockercompose-__codelineno-82-7"></a><span class="w">    </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id="__span-82-8"><a id="__codelineno-82-8" name="__codelineno-82-8" href="#tasks-dockercompose-__codelineno-82-8"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-82-9"><a id="__codelineno-82-9" name="__codelineno-82-9" href="#tasks-dockercompose-__codelineno-82-9"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-82-10"><a id="__codelineno-82-10" name="__codelineno-82-10" href="#tasks-dockercompose-__codelineno-82-10"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-82-11"><a id="__codelineno-82-11" name="__codelineno-82-11" href="#tasks-dockercompose-__codelineno-82-11"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-82-12"><a id="__codelineno-82-12" name="__codelineno-82-12" href="#tasks-dockercompose-__codelineno-82-12"></a><span class="w">      </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-82-13"><a id="__codelineno-82-13" name="__codelineno-82-13" href="#tasks-dockercompose-__codelineno-82-13"></a>
</span><span id="__span-82-14"><a id="__codelineno-82-14" name="__codelineno-82-14" href="#tasks-dockercompose-__codelineno-82-14"></a><span class="nt">x-infrastructure</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;infrastructure</span>
</span><span id="__span-82-15"><a id="__codelineno-82-15" name="__codelineno-82-15" href="#tasks-dockercompose-__codelineno-82-15"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*global</span>
</span><span id="__span-82-16"><a id="__codelineno-82-16" name="__codelineno-82-16" href="#tasks-dockercompose-__codelineno-82-16"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-82-17"><a id="__codelineno-82-17" name="__codelineno-82-17" href="#tasks-dockercompose-__codelineno-82-17"></a><span class="w">    </span><span class="nt">restart_policy</span><span class="p">:</span>
</span><span id="__span-82-18"><a id="__codelineno-82-18" name="__codelineno-82-18" href="#tasks-dockercompose-__codelineno-82-18"></a><span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id="__span-82-19"><a id="__codelineno-82-19" name="__codelineno-82-19" href="#tasks-dockercompose-__codelineno-82-19"></a><span class="w">      </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-82-20"><a id="__codelineno-82-20" name="__codelineno-82-20" href="#tasks-dockercompose-__codelineno-82-20"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-82-21"><a id="__codelineno-82-21" name="__codelineno-82-21" href="#tasks-dockercompose-__codelineno-82-21"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-82-22"><a id="__codelineno-82-22" name="__codelineno-82-22" href="#tasks-dockercompose-__codelineno-82-22"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id="__span-82-23"><a id="__codelineno-82-23" name="__codelineno-82-23" href="#tasks-dockercompose-__codelineno-82-23"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-82-24"><a id="__codelineno-82-24" name="__codelineno-82-24" href="#tasks-dockercompose-__codelineno-82-24"></a>
</span><span id="__span-82-25"><a id="__codelineno-82-25" name="__codelineno-82-25" href="#tasks-dockercompose-__codelineno-82-25"></a><span class="nt">x-web-infrastructure</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;web-infrastructure</span>
</span><span id="__span-82-26"><a id="__codelineno-82-26" name="__codelineno-82-26" href="#tasks-dockercompose-__codelineno-82-26"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*infrastructure</span>
</span><span id="__span-82-27"><a id="__codelineno-82-27" name="__codelineno-82-27" href="#tasks-dockercompose-__codelineno-82-27"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-82-28"><a id="__codelineno-82-28" name="__codelineno-82-28" href="#tasks-dockercompose-__codelineno-82-28"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-82-29"><a id="__codelineno-82-29" name="__codelineno-82-29" href="#tasks-dockercompose-__codelineno-82-29"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-82-30"><a id="__codelineno-82-30" name="__codelineno-82-30" href="#tasks-dockercompose-__codelineno-82-30"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-82-31"><a id="__codelineno-82-31" name="__codelineno-82-31" href="#tasks-dockercompose-__codelineno-82-31"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-82-32"><a id="__codelineno-82-32" name="__codelineno-82-32" href="#tasks-dockercompose-__codelineno-82-32"></a>
</span><span id="__span-82-33"><a id="__codelineno-82-33" name="__codelineno-82-33" href="#tasks-dockercompose-__codelineno-82-33"></a><span class="nt">x-api-infrastructure</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;api-infrastructure</span>
</span><span id="__span-82-34"><a id="__codelineno-82-34" name="__codelineno-82-34" href="#tasks-dockercompose-__codelineno-82-34"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*infrastructure</span>
</span><span id="__span-82-35"><a id="__codelineno-82-35" name="__codelineno-82-35" href="#tasks-dockercompose-__codelineno-82-35"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-82-36"><a id="__codelineno-82-36" name="__codelineno-82-36" href="#tasks-dockercompose-__codelineno-82-36"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-82-37"><a id="__codelineno-82-37" name="__codelineno-82-37" href="#tasks-dockercompose-__codelineno-82-37"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-82-38"><a id="__codelineno-82-38" name="__codelineno-82-38" href="#tasks-dockercompose-__codelineno-82-38"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-82-39"><a id="__codelineno-82-39" name="__codelineno-82-39" href="#tasks-dockercompose-__codelineno-82-39"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;API</span><span class="nv"> </span><span class="s">health</span><span class="nv"> </span><span class="s">check&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-82-40"><a id="__codelineno-82-40" name="__codelineno-82-40" href="#tasks-dockercompose-__codelineno-82-40"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-82-41"><a id="__codelineno-82-41" name="__codelineno-82-41" href="#tasks-dockercompose-__codelineno-82-41"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-82-42"><a id="__codelineno-82-42" name="__codelineno-82-42" href="#tasks-dockercompose-__codelineno-82-42"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-82-43"><a id="__codelineno-82-43" name="__codelineno-82-43" href="#tasks-dockercompose-__codelineno-82-43"></a>
</span><span id="__span-82-44"><a id="__codelineno-82-44" name="__codelineno-82-44" href="#tasks-dockercompose-__codelineno-82-44"></a><span class="nt">x-database-infrastructure</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;database-infrastructure</span>
</span><span id="__span-82-45"><a id="__codelineno-82-45" name="__codelineno-82-45" href="#tasks-dockercompose-__codelineno-82-45"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*infrastructure</span>
</span><span id="__span-82-46"><a id="__codelineno-82-46" name="__codelineno-82-46" href="#tasks-dockercompose-__codelineno-82-46"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-82-47"><a id="__codelineno-82-47" name="__codelineno-82-47" href="#tasks-dockercompose-__codelineno-82-47"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-82-48"><a id="__codelineno-82-48" name="__codelineno-82-48" href="#tasks-dockercompose-__codelineno-82-48"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id="__span-82-49"><a id="__codelineno-82-49" name="__codelineno-82-49" href="#tasks-dockercompose-__codelineno-82-49"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-82-50"><a id="__codelineno-82-50" name="__codelineno-82-50" href="#tasks-dockercompose-__codelineno-82-50"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">-d</span><span class="nv"> </span><span class="s">myapp&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-82-51"><a id="__codelineno-82-51" name="__codelineno-82-51" href="#tasks-dockercompose-__codelineno-82-51"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-82-52"><a id="__codelineno-82-52" name="__codelineno-82-52" href="#tasks-dockercompose-__codelineno-82-52"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-82-53"><a id="__codelineno-82-53" name="__codelineno-82-53" href="#tasks-dockercompose-__codelineno-82-53"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-82-54"><a id="__codelineno-82-54" name="__codelineno-82-54" href="#tasks-dockercompose-__codelineno-82-54"></a>
</span><span id="__span-82-55"><a id="__codelineno-82-55" name="__codelineno-82-55" href="#tasks-dockercompose-__codelineno-82-55"></a><span class="nt">x-web-primary</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;web-primary</span>
</span><span id="__span-82-56"><a id="__codelineno-82-56" name="__codelineno-82-56" href="#tasks-dockercompose-__codelineno-82-56"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-infrastructure</span>
</span><span id="__span-82-57"><a id="__codelineno-82-57" name="__codelineno-82-57" href="#tasks-dockercompose-__codelineno-82-57"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-82-58"><a id="__codelineno-82-58" name="__codelineno-82-58" href="#tasks-dockercompose-__codelineno-82-58"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-82-59"><a id="__codelineno-82-59" name="__codelineno-82-59" href="#tasks-dockercompose-__codelineno-82-59"></a><span class="w">    </span><span class="nt">INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">primary</span>
</span><span id="__span-82-60"><a id="__codelineno-82-60" name="__codelineno-82-60" href="#tasks-dockercompose-__codelineno-82-60"></a><span class="w">    </span><span class="nt">ROLE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-82-61"><a id="__codelineno-82-61" name="__codelineno-82-61" href="#tasks-dockercompose-__codelineno-82-61"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-82-62"><a id="__codelineno-82-62" name="__codelineno-82-62" href="#tasks-dockercompose-__codelineno-82-62"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-82-63"><a id="__codelineno-82-63" name="__codelineno-82-63" href="#tasks-dockercompose-__codelineno-82-63"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-82-64"><a id="__codelineno-82-64" name="__codelineno-82-64" href="#tasks-dockercompose-__codelineno-82-64"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-82-65"><a id="__codelineno-82-65" name="__codelineno-82-65" href="#tasks-dockercompose-__codelineno-82-65"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-82-66"><a id="__codelineno-82-66" name="__codelineno-82-66" href="#tasks-dockercompose-__codelineno-82-66"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;service.role=primary&quot;</span>
</span><span id="__span-82-67"><a id="__codelineno-82-67" name="__codelineno-82-67" href="#tasks-dockercompose-__codelineno-82-67"></a>
</span><span id="__span-82-68"><a id="__codelineno-82-68" name="__codelineno-82-68" href="#tasks-dockercompose-__codelineno-82-68"></a><span class="nt">x-web-secondary</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;web-secondary</span>
</span><span id="__span-82-69"><a id="__codelineno-82-69" name="__codelineno-82-69" href="#tasks-dockercompose-__codelineno-82-69"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-infrastructure</span>
</span><span id="__span-82-70"><a id="__codelineno-82-70" name="__codelineno-82-70" href="#tasks-dockercompose-__codelineno-82-70"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-82-71"><a id="__codelineno-82-71" name="__codelineno-82-71" href="#tasks-dockercompose-__codelineno-82-71"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-82-72"><a id="__codelineno-82-72" name="__codelineno-82-72" href="#tasks-dockercompose-__codelineno-82-72"></a><span class="w">    </span><span class="nt">INSTANCE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secondary</span>
</span><span id="__span-82-73"><a id="__codelineno-82-73" name="__codelineno-82-73" href="#tasks-dockercompose-__codelineno-82-73"></a><span class="w">    </span><span class="nt">ROLE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-82-74"><a id="__codelineno-82-74" name="__codelineno-82-74" href="#tasks-dockercompose-__codelineno-82-74"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-82-75"><a id="__codelineno-82-75" name="__codelineno-82-75" href="#tasks-dockercompose-__codelineno-82-75"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8081:80&quot;</span>
</span><span id="__span-82-76"><a id="__codelineno-82-76" name="__codelineno-82-76" href="#tasks-dockercompose-__codelineno-82-76"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-82-77"><a id="__codelineno-82-77" name="__codelineno-82-77" href="#tasks-dockercompose-__codelineno-82-77"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-82-78"><a id="__codelineno-82-78" name="__codelineno-82-78" href="#tasks-dockercompose-__codelineno-82-78"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-82-79"><a id="__codelineno-82-79" name="__codelineno-82-79" href="#tasks-dockercompose-__codelineno-82-79"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;service.role=secondary&quot;</span>
</span><span id="__span-82-80"><a id="__codelineno-82-80" name="__codelineno-82-80" href="#tasks-dockercompose-__codelineno-82-80"></a>
</span><span id="__span-82-81"><a id="__codelineno-82-81" name="__codelineno-82-81" href="#tasks-dockercompose-__codelineno-82-81"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-82-82"><a id="__codelineno-82-82" name="__codelineno-82-82" href="#tasks-dockercompose-__codelineno-82-82"></a><span class="w">  </span><span class="nt">web-primary</span><span class="p">:</span>
</span><span id="__span-82-83"><a id="__codelineno-82-83" name="__codelineno-82-83" href="#tasks-dockercompose-__codelineno-82-83"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-primary</span>
</span><span id="__span-82-84"><a id="__codelineno-82-84" name="__codelineno-82-84" href="#tasks-dockercompose-__codelineno-82-84"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-82-85"><a id="__codelineno-82-85" name="__codelineno-82-85" href="#tasks-dockercompose-__codelineno-82-85"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-82-86"><a id="__codelineno-82-86" name="__codelineno-82-86" href="#tasks-dockercompose-__codelineno-82-86"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web/primary:/usr/share/nginx/html:ro</span>
</span><span id="__span-82-87"><a id="__codelineno-82-87" name="__codelineno-82-87" href="#tasks-dockercompose-__codelineno-82-87"></a>
</span><span id="__span-82-88"><a id="__codelineno-82-88" name="__codelineno-82-88" href="#tasks-dockercompose-__codelineno-82-88"></a><span class="w">  </span><span class="nt">web-secondary</span><span class="p">:</span>
</span><span id="__span-82-89"><a id="__codelineno-82-89" name="__codelineno-82-89" href="#tasks-dockercompose-__codelineno-82-89"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-secondary</span>
</span><span id="__span-82-90"><a id="__codelineno-82-90" name="__codelineno-82-90" href="#tasks-dockercompose-__codelineno-82-90"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-82-91"><a id="__codelineno-82-91" name="__codelineno-82-91" href="#tasks-dockercompose-__codelineno-82-91"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-82-92"><a id="__codelineno-82-92" name="__codelineno-82-92" href="#tasks-dockercompose-__codelineno-82-92"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web/secondary:/usr/share/nginx/html:ro</span>
</span><span id="__span-82-93"><a id="__codelineno-82-93" name="__codelineno-82-93" href="#tasks-dockercompose-__codelineno-82-93"></a>
</span><span id="__span-82-94"><a id="__codelineno-82-94" name="__codelineno-82-94" href="#tasks-dockercompose-__codelineno-82-94"></a><span class="w">  </span><span class="nt">api-main</span><span class="p">:</span>
</span><span id="__span-82-95"><a id="__codelineno-82-95" name="__codelineno-82-95" href="#tasks-dockercompose-__codelineno-82-95"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-infrastructure</span>
</span><span id="__span-82-96"><a id="__codelineno-82-96" name="__codelineno-82-96" href="#tasks-dockercompose-__codelineno-82-96"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-82-97"><a id="__codelineno-82-97" name="__codelineno-82-97" href="#tasks-dockercompose-__codelineno-82-97"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-82-98"><a id="__codelineno-82-98" name="__codelineno-82-98" href="#tasks-dockercompose-__codelineno-82-98"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-82-99"><a id="__codelineno-82-99" name="__codelineno-82-99" href="#tasks-dockercompose-__codelineno-82-99"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-82-100"><a id="__codelineno-82-100" name="__codelineno-82-100" href="#tasks-dockercompose-__codelineno-82-100"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-82-101"><a id="__codelineno-82-101" name="__codelineno-82-101" href="#tasks-dockercompose-__codelineno-82-101"></a><span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id="__span-82-102"><a id="__codelineno-82-102" name="__codelineno-82-102" href="#tasks-dockercompose-__codelineno-82-102"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-82-103"><a id="__codelineno-82-103" name="__codelineno-82-103" href="#tasks-dockercompose-__codelineno-82-103"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-82-104"><a id="__codelineno-82-104" name="__codelineno-82-104" href="#tasks-dockercompose-__codelineno-82-104"></a>
</span><span id="__span-82-105"><a id="__codelineno-82-105" name="__codelineno-82-105" href="#tasks-dockercompose-__codelineno-82-105"></a><span class="w">  </span><span class="nt">api-worker</span><span class="p">:</span>
</span><span id="__span-82-106"><a id="__codelineno-82-106" name="__codelineno-82-106" href="#tasks-dockercompose-__codelineno-82-106"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-infrastructure</span>
</span><span id="__span-82-107"><a id="__codelineno-82-107" name="__codelineno-82-107" href="#tasks-dockercompose-__codelineno-82-107"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-82-108"><a id="__codelineno-82-108" name="__codelineno-82-108" href="#tasks-dockercompose-__codelineno-82-108"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-82-109"><a id="__codelineno-82-109" name="__codelineno-82-109" href="#tasks-dockercompose-__codelineno-82-109"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-82-110"><a id="__codelineno-82-110" name="__codelineno-82-110" href="#tasks-dockercompose-__codelineno-82-110"></a><span class="w">      </span><span class="nt">WORKER_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">background</span>
</span><span id="__span-82-111"><a id="__codelineno-82-111" name="__codelineno-82-111" href="#tasks-dockercompose-__codelineno-82-111"></a><span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id="__span-82-112"><a id="__codelineno-82-112" name="__codelineno-82-112" href="#tasks-dockercompose-__codelineno-82-112"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-82-113"><a id="__codelineno-82-113" name="__codelineno-82-113" href="#tasks-dockercompose-__codelineno-82-113"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-82-114"><a id="__codelineno-82-114" name="__codelineno-82-114" href="#tasks-dockercompose-__codelineno-82-114"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-82-115"><a id="__codelineno-82-115" name="__codelineno-82-115" href="#tasks-dockercompose-__codelineno-82-115"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-82-116"><a id="__codelineno-82-116" name="__codelineno-82-116" href="#tasks-dockercompose-__codelineno-82-116"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-82-117"><a id="__codelineno-82-117" name="__codelineno-82-117" href="#tasks-dockercompose-__codelineno-82-117"></a>
</span><span id="__span-82-118"><a id="__codelineno-82-118" name="__codelineno-82-118" href="#tasks-dockercompose-__codelineno-82-118"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-82-119"><a id="__codelineno-82-119" name="__codelineno-82-119" href="#tasks-dockercompose-__codelineno-82-119"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*database-infrastructure</span>
</span><span id="__span-82-120"><a id="__codelineno-82-120" name="__codelineno-82-120" href="#tasks-dockercompose-__codelineno-82-120"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-82-121"><a id="__codelineno-82-121" name="__codelineno-82-121" href="#tasks-dockercompose-__codelineno-82-121"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-82-122"><a id="__codelineno-82-122" name="__codelineno-82-122" href="#tasks-dockercompose-__codelineno-82-122"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*database-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-82-123"><a id="__codelineno-82-123" name="__codelineno-82-123" href="#tasks-dockercompose-__codelineno-82-123"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-82-124"><a id="__codelineno-82-124" name="__codelineno-82-124" href="#tasks-dockercompose-__codelineno-82-124"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-82-125"><a id="__codelineno-82-125" name="__codelineno-82-125" href="#tasks-dockercompose-__codelineno-82-125"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-82-126"><a id="__codelineno-82-126" name="__codelineno-82-126" href="#tasks-dockercompose-__codelineno-82-126"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-82-127"><a id="__codelineno-82-127" name="__codelineno-82-127" href="#tasks-dockercompose-__codelineno-82-127"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-82-128"><a id="__codelineno-82-128" name="__codelineno-82-128" href="#tasks-dockercompose-__codelineno-82-128"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-82-129"><a id="__codelineno-82-129" name="__codelineno-82-129" href="#tasks-dockercompose-__codelineno-82-129"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span>
</span><span id="__span-82-130"><a id="__codelineno-82-130" name="__codelineno-82-130" href="#tasks-dockercompose-__codelineno-82-130"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-82-131"><a id="__codelineno-82-131" name="__codelineno-82-131" href="#tasks-dockercompose-__codelineno-82-131"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*database-infrastructure</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-82-132"><a id="__codelineno-82-132" name="__codelineno-82-132" href="#tasks-dockercompose-__codelineno-82-132"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-82-133"><a id="__codelineno-82-133" name="__codelineno-82-133" href="#tasks-dockercompose-__codelineno-82-133"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-82-134"><a id="__codelineno-82-134" name="__codelineno-82-134" href="#tasks-dockercompose-__codelineno-82-134"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-82-135"><a id="__codelineno-82-135" name="__codelineno-82-135" href="#tasks-dockercompose-__codelineno-82-135"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-82-136"><a id="__codelineno-82-136" name="__codelineno-82-136" href="#tasks-dockercompose-__codelineno-82-136"></a>
</span><span id="__span-82-137"><a id="__codelineno-82-137" name="__codelineno-82-137" href="#tasks-dockercompose-__codelineno-82-137"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-82-138"><a id="__codelineno-82-138" name="__codelineno-82-138" href="#tasks-dockercompose-__codelineno-82-138"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#tasks-dockercompose-__codelineno-83-1"></a><span class="c1"># Start complex hierarchy services</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#tasks-dockercompose-__codelineno-83-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#tasks-dockercompose-__codelineno-83-3"></a>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#tasks-dockercompose-__codelineno-83-4"></a><span class="c1"># Check configuration hierarchy</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#tasks-dockercompose-__codelineno-83-5"></a>docker-compose<span class="w"> </span>config<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-50
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#tasks-dockercompose-__codelineno-83-6"></a>
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#tasks-dockercompose-__codelineno-83-7"></a><span class="c1"># View service inheritance</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#tasks-dockercompose-__codelineno-83-8"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>web-primary<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>INSTANCE
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#tasks-dockercompose-__codelineno-83-9"></a>docker-compose<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>api-worker<span class="w"> </span>env<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>WORKER_TYPE
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#tasks-dockercompose-__codelineno-83-10"></a>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#tasks-dockercompose-__codelineno-83-11"></a><span class="c1"># Check labels and metadata</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#tasks-dockercompose-__codelineno-83-12"></a>docker<span class="w"> </span>inspect<span class="w"> </span><span class="k">$(</span>docker-compose<span class="w"> </span>ps<span class="w"> </span>-q<span class="w"> </span>web-primary<span class="k">)</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.[0].Config.Labels&#39;</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#tasks-dockercompose-__codelineno-83-13"></a>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#tasks-dockercompose-__codelineno-83-14"></a><span class="c1"># Stop services</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#tasks-dockercompose-__codelineno-83-15"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Multi-level inheritance</strong>: Global ‚Üí Infrastructure ‚Üí Service-type ‚Üí Instance-specific</li>
<li><strong>Complex merging</strong>: Multiple levels of configuration inheritance</li>
<li><strong>Override chains</strong>: Each level can override previous configurations</li>
<li><strong>Modular design</strong>: Easy to add new service types or instances</li>
<li><strong>Configuration clarity</strong>: Clear separation of concerns across inheritance levels</li>
</ul>
</details>
<hr />
<h4 id="tasks-dockercompose-24-fragment-based-service-templates">24. Fragment-Based Service Templates<a class="headerlink" href="#tasks-dockercompose-24-fragment-based-service-templates" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Create reusable service templates using fragments for common service patterns.</p>
<h4 id="tasks-dockercompose-scenario_23"><strong>Scenario:</strong><a class="headerlink" href="#tasks-dockercompose-scenario_23" title="Permanent link">&para;</a></h4>
<ul>
<li>Your application uses similar service patterns repeatedly (like web services, worker services, or API services) with slight variations.</li>
<li>Service templates using fragments allow you to define reusable patterns and instantiate them with specific configurations.</li>
</ul>
<h4 id="tasks-dockercompose-resources_13">Resources:<a class="headerlink" href="#tasks-dockercompose-resources_13" title="Permanent link">&para;</a></h4>
<ul>
<li><code>docker-compose.yml</code> ‚û§ Service templates with fragments
    <div class="language-yaml highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#tasks-dockercompose-__codelineno-84-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#tasks-dockercompose-__codelineno-84-2"></a>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#tasks-dockercompose-__codelineno-84-3"></a><span class="nt">x-web-template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;web-template</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#tasks-dockercompose-__codelineno-84-4"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#tasks-dockercompose-__codelineno-84-5"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#tasks-dockercompose-__codelineno-84-6"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#tasks-dockercompose-__codelineno-84-7"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#tasks-dockercompose-__codelineno-84-8"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#tasks-dockercompose-__codelineno-84-9"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#tasks-dockercompose-__codelineno-84-10"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#tasks-dockercompose-__codelineno-84-11"></a>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#tasks-dockercompose-__codelineno-84-12"></a><span class="nt">x-api-template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;api-template</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#tasks-dockercompose-__codelineno-84-13"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-84-14"><a id="__codelineno-84-14" name="__codelineno-84-14" href="#tasks-dockercompose-__codelineno-84-14"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-84-15"><a id="__codelineno-84-15" name="__codelineno-84-15" href="#tasks-dockercompose-__codelineno-84-15"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-84-16"><a id="__codelineno-84-16" name="__codelineno-84-16" href="#tasks-dockercompose-__codelineno-84-16"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-84-17"><a id="__codelineno-84-17" name="__codelineno-84-17" href="#tasks-dockercompose-__codelineno-84-17"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-84-18"><a id="__codelineno-84-18" name="__codelineno-84-18" href="#tasks-dockercompose-__codelineno-84-18"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-84-19"><a id="__codelineno-84-19" name="__codelineno-84-19" href="#tasks-dockercompose-__codelineno-84-19"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-84-20"><a id="__codelineno-84-20" name="__codelineno-84-20" href="#tasks-dockercompose-__codelineno-84-20"></a>
</span><span id="__span-84-21"><a id="__codelineno-84-21" name="__codelineno-84-21" href="#tasks-dockercompose-__codelineno-84-21"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-84-22"><a id="__codelineno-84-22" name="__codelineno-84-22" href="#tasks-dockercompose-__codelineno-84-22"></a><span class="w">  </span><span class="nt">web-frontend</span><span class="p">:</span>
</span><span id="__span-84-23"><a id="__codelineno-84-23" name="__codelineno-84-23" href="#tasks-dockercompose-__codelineno-84-23"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span>
</span><span id="__span-84-24"><a id="__codelineno-84-24" name="__codelineno-84-24" href="#tasks-dockercompose-__codelineno-84-24"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-84-25"><a id="__codelineno-84-25" name="__codelineno-84-25" href="#tasks-dockercompose-__codelineno-84-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-84-26"><a id="__codelineno-84-26" name="__codelineno-84-26" href="#tasks-dockercompose-__codelineno-84-26"></a>
</span><span id="__span-84-27"><a id="__codelineno-84-27" name="__codelineno-84-27" href="#tasks-dockercompose-__codelineno-84-27"></a><span class="w">  </span><span class="nt">web-admin</span><span class="p">:</span>
</span><span id="__span-84-28"><a id="__codelineno-84-28" name="__codelineno-84-28" href="#tasks-dockercompose-__codelineno-84-28"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span>
</span><span id="__span-84-29"><a id="__codelineno-84-29" name="__codelineno-84-29" href="#tasks-dockercompose-__codelineno-84-29"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-84-30"><a id="__codelineno-84-30" name="__codelineno-84-30" href="#tasks-dockercompose-__codelineno-84-30"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8081:80&quot;</span>
</span><span id="__span-84-31"><a id="__codelineno-84-31" name="__codelineno-84-31" href="#tasks-dockercompose-__codelineno-84-31"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-84-32"><a id="__codelineno-84-32" name="__codelineno-84-32" href="#tasks-dockercompose-__codelineno-84-32"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-84-33"><a id="__codelineno-84-33" name="__codelineno-84-33" href="#tasks-dockercompose-__codelineno-84-33"></a><span class="w">      </span><span class="nt">SECTION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span></code></pre></div></li>
</ul>
</li>
</ul>
<p><strong>Hint:</strong> Define service templates as anchors and instantiate them with specific overrides</p>
<details>
<summary>Solution</summary>
<p><strong>Solution:</strong></p>
<p><strong>docker-compose.yml</strong>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#tasks-dockercompose-__codelineno-85-1"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#tasks-dockercompose-__codelineno-85-2"></a>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#tasks-dockercompose-__codelineno-85-3"></a><span class="nt">x-service-base</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;service-base</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#tasks-dockercompose-__codelineno-85-4"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#tasks-dockercompose-__codelineno-85-5"></a><span class="w">    </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#tasks-dockercompose-__codelineno-85-6"></a><span class="w">    </span><span class="nt">LOG_LEVEL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">info</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#tasks-dockercompose-__codelineno-85-7"></a><span class="w">    </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UTC</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#tasks-dockercompose-__codelineno-85-8"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#tasks-dockercompose-__codelineno-85-9"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json-file</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#tasks-dockercompose-__codelineno-85-10"></a><span class="w">    </span><span class="nt">options</span><span class="p">:</span>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#tasks-dockercompose-__codelineno-85-11"></a><span class="w">      </span><span class="nt">max-size</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10m&quot;</span>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12" href="#tasks-dockercompose-__codelineno-85-12"></a><span class="w">      </span><span class="nt">max-file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13" href="#tasks-dockercompose-__codelineno-85-13"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14" href="#tasks-dockercompose-__codelineno-85-14"></a><span class="w">    </span><span class="nt">restart_policy</span><span class="p">:</span>
</span><span id="__span-85-15"><a id="__codelineno-85-15" name="__codelineno-85-15" href="#tasks-dockercompose-__codelineno-85-15"></a><span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</span><span id="__span-85-16"><a id="__codelineno-85-16" name="__codelineno-85-16" href="#tasks-dockercompose-__codelineno-85-16"></a><span class="w">      </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-85-17"><a id="__codelineno-85-17" name="__codelineno-85-17" href="#tasks-dockercompose-__codelineno-85-17"></a>
</span><span id="__span-85-18"><a id="__codelineno-85-18" name="__codelineno-85-18" href="#tasks-dockercompose-__codelineno-85-18"></a><span class="nt">x-web-template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;web-template</span>
</span><span id="__span-85-19"><a id="__codelineno-85-19" name="__codelineno-85-19" href="#tasks-dockercompose-__codelineno-85-19"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span>
</span><span id="__span-85-20"><a id="__codelineno-85-20" name="__codelineno-85-20" href="#tasks-dockercompose-__codelineno-85-20"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:alpine</span>
</span><span id="__span-85-21"><a id="__codelineno-85-21" name="__codelineno-85-21" href="#tasks-dockercompose-__codelineno-85-21"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-22"><a id="__codelineno-85-22" name="__codelineno-85-22" href="#tasks-dockercompose-__codelineno-85-22"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-23"><a id="__codelineno-85-23" name="__codelineno-85-23" href="#tasks-dockercompose-__codelineno-85-23"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web</span>
</span><span id="__span-85-24"><a id="__codelineno-85-24" name="__codelineno-85-24" href="#tasks-dockercompose-__codelineno-85-24"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-85-25"><a id="__codelineno-85-25" name="__codelineno-85-25" href="#tasks-dockercompose-__codelineno-85-25"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;wget&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--no-verbose&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--tries=1&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;--spider&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;http://localhost/&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-85-26"><a id="__codelineno-85-26" name="__codelineno-85-26" href="#tasks-dockercompose-__codelineno-85-26"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-85-27"><a id="__codelineno-85-27" name="__codelineno-85-27" href="#tasks-dockercompose-__codelineno-85-27"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-85-28"><a id="__codelineno-85-28" name="__codelineno-85-28" href="#tasks-dockercompose-__codelineno-85-28"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-85-29"><a id="__codelineno-85-29" name="__codelineno-85-29" href="#tasks-dockercompose-__codelineno-85-29"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-85-30"><a id="__codelineno-85-30" name="__codelineno-85-30" href="#tasks-dockercompose-__codelineno-85-30"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-85-31"><a id="__codelineno-85-31" name="__codelineno-85-31" href="#tasks-dockercompose-__codelineno-85-31"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-85-32"><a id="__codelineno-85-32" name="__codelineno-85-32" href="#tasks-dockercompose-__codelineno-85-32"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-85-33"><a id="__codelineno-85-33" name="__codelineno-85-33" href="#tasks-dockercompose-__codelineno-85-33"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256M</span>
</span><span id="__span-85-34"><a id="__codelineno-85-34" name="__codelineno-85-34" href="#tasks-dockercompose-__codelineno-85-34"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.5&#39;</span>
</span><span id="__span-85-35"><a id="__codelineno-85-35" name="__codelineno-85-35" href="#tasks-dockercompose-__codelineno-85-35"></a>
</span><span id="__span-85-36"><a id="__codelineno-85-36" name="__codelineno-85-36" href="#tasks-dockercompose-__codelineno-85-36"></a><span class="nt">x-api-template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;api-template</span>
</span><span id="__span-85-37"><a id="__codelineno-85-37" name="__codelineno-85-37" href="#tasks-dockercompose-__codelineno-85-37"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span>
</span><span id="__span-85-38"><a id="__codelineno-85-38" name="__codelineno-85-38" href="#tasks-dockercompose-__codelineno-85-38"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:18-alpine</span>
</span><span id="__span-85-39"><a id="__codelineno-85-39" name="__codelineno-85-39" href="#tasks-dockercompose-__codelineno-85-39"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-40"><a id="__codelineno-85-40" name="__codelineno-85-40" href="#tasks-dockercompose-__codelineno-85-40"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-41"><a id="__codelineno-85-41" name="__codelineno-85-41" href="#tasks-dockercompose-__codelineno-85-41"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api</span>
</span><span id="__span-85-42"><a id="__codelineno-85-42" name="__codelineno-85-42" href="#tasks-dockercompose-__codelineno-85-42"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-85-43"><a id="__codelineno-85-43" name="__codelineno-85-43" href="#tasks-dockercompose-__codelineno-85-43"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;API</span><span class="nv"> </span><span class="s">OK&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-85-44"><a id="__codelineno-85-44" name="__codelineno-85-44" href="#tasks-dockercompose-__codelineno-85-44"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30s</span>
</span><span id="__span-85-45"><a id="__codelineno-85-45" name="__codelineno-85-45" href="#tasks-dockercompose-__codelineno-85-45"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-85-46"><a id="__codelineno-85-46" name="__codelineno-85-46" href="#tasks-dockercompose-__codelineno-85-46"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-85-47"><a id="__codelineno-85-47" name="__codelineno-85-47" href="#tasks-dockercompose-__codelineno-85-47"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-85-48"><a id="__codelineno-85-48" name="__codelineno-85-48" href="#tasks-dockercompose-__codelineno-85-48"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-85-49"><a id="__codelineno-85-49" name="__codelineno-85-49" href="#tasks-dockercompose-__codelineno-85-49"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-85-50"><a id="__codelineno-85-50" name="__codelineno-85-50" href="#tasks-dockercompose-__codelineno-85-50"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-85-51"><a id="__codelineno-85-51" name="__codelineno-85-51" href="#tasks-dockercompose-__codelineno-85-51"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512M</span>
</span><span id="__span-85-52"><a id="__codelineno-85-52" name="__codelineno-85-52" href="#tasks-dockercompose-__codelineno-85-52"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;1.0&#39;</span>
</span><span id="__span-85-53"><a id="__codelineno-85-53" name="__codelineno-85-53" href="#tasks-dockercompose-__codelineno-85-53"></a>
</span><span id="__span-85-54"><a id="__codelineno-85-54" name="__codelineno-85-54" href="#tasks-dockercompose-__codelineno-85-54"></a><span class="nt">x-worker-template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;worker-template</span>
</span><span id="__span-85-55"><a id="__codelineno-85-55" name="__codelineno-85-55" href="#tasks-dockercompose-__codelineno-85-55"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span>
</span><span id="__span-85-56"><a id="__codelineno-85-56" name="__codelineno-85-56" href="#tasks-dockercompose-__codelineno-85-56"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">python:3.9-alpine</span>
</span><span id="__span-85-57"><a id="__codelineno-85-57" name="__codelineno-85-57" href="#tasks-dockercompose-__codelineno-85-57"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-58"><a id="__codelineno-85-58" name="__codelineno-85-58" href="#tasks-dockercompose-__codelineno-85-58"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-59"><a id="__codelineno-85-59" name="__codelineno-85-59" href="#tasks-dockercompose-__codelineno-85-59"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker</span>
</span><span id="__span-85-60"><a id="__codelineno-85-60" name="__codelineno-85-60" href="#tasks-dockercompose-__codelineno-85-60"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-85-61"><a id="__codelineno-85-61" name="__codelineno-85-61" href="#tasks-dockercompose-__codelineno-85-61"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;echo&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;Worker</span><span class="nv"> </span><span class="s">OK&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-85-62"><a id="__codelineno-85-62" name="__codelineno-85-62" href="#tasks-dockercompose-__codelineno-85-62"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60s</span>
</span><span id="__span-85-63"><a id="__codelineno-85-63" name="__codelineno-85-63" href="#tasks-dockercompose-__codelineno-85-63"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-85-64"><a id="__codelineno-85-64" name="__codelineno-85-64" href="#tasks-dockercompose-__codelineno-85-64"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-85-65"><a id="__codelineno-85-65" name="__codelineno-85-65" href="#tasks-dockercompose-__codelineno-85-65"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-85-66"><a id="__codelineno-85-66" name="__codelineno-85-66" href="#tasks-dockercompose-__codelineno-85-66"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-85-67"><a id="__codelineno-85-67" name="__codelineno-85-67" href="#tasks-dockercompose-__codelineno-85-67"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-85-68"><a id="__codelineno-85-68" name="__codelineno-85-68" href="#tasks-dockercompose-__codelineno-85-68"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-85-69"><a id="__codelineno-85-69" name="__codelineno-85-69" href="#tasks-dockercompose-__codelineno-85-69"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id="__span-85-70"><a id="__codelineno-85-70" name="__codelineno-85-70" href="#tasks-dockercompose-__codelineno-85-70"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-85-71"><a id="__codelineno-85-71" name="__codelineno-85-71" href="#tasks-dockercompose-__codelineno-85-71"></a>
</span><span id="__span-85-72"><a id="__codelineno-85-72" name="__codelineno-85-72" href="#tasks-dockercompose-__codelineno-85-72"></a><span class="nt">x-database-template</span><span class="p">:</span><span class="w"> </span><span class="nl">&amp;database-template</span>
</span><span id="__span-85-73"><a id="__codelineno-85-73" name="__codelineno-85-73" href="#tasks-dockercompose-__codelineno-85-73"></a><span class="w">  </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span>
</span><span id="__span-85-74"><a id="__codelineno-85-74" name="__codelineno-85-74" href="#tasks-dockercompose-__codelineno-85-74"></a><span class="w">  </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:13-alpine</span>
</span><span id="__span-85-75"><a id="__codelineno-85-75" name="__codelineno-85-75" href="#tasks-dockercompose-__codelineno-85-75"></a><span class="w">  </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-76"><a id="__codelineno-85-76" name="__codelineno-85-76" href="#tasks-dockercompose-__codelineno-85-76"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-77"><a id="__codelineno-85-77" name="__codelineno-85-77" href="#tasks-dockercompose-__codelineno-85-77"></a><span class="w">    </span><span class="nt">SERVICE_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id="__span-85-78"><a id="__codelineno-85-78" name="__codelineno-85-78" href="#tasks-dockercompose-__codelineno-85-78"></a><span class="w">  </span><span class="nt">healthcheck</span><span class="p">:</span>
</span><span id="__span-85-79"><a id="__codelineno-85-79" name="__codelineno-85-79" href="#tasks-dockercompose-__codelineno-85-79"></a><span class="w">    </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;CMD-SHELL&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;pg_isready</span><span class="nv"> </span><span class="s">-U</span><span class="nv"> </span><span class="s">${POSTGRES_USER:-user}</span><span class="nv"> </span><span class="s">-d</span><span class="nv"> </span><span class="s">${POSTGRES_DB:-myapp}&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-85-80"><a id="__codelineno-85-80" name="__codelineno-85-80" href="#tasks-dockercompose-__codelineno-85-80"></a><span class="w">    </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-85-81"><a id="__codelineno-85-81" name="__codelineno-85-81" href="#tasks-dockercompose-__codelineno-85-81"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5s</span>
</span><span id="__span-85-82"><a id="__codelineno-85-82" name="__codelineno-85-82" href="#tasks-dockercompose-__codelineno-85-82"></a><span class="w">    </span><span class="nt">retries</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-85-83"><a id="__codelineno-85-83" name="__codelineno-85-83" href="#tasks-dockercompose-__codelineno-85-83"></a><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-85-84"><a id="__codelineno-85-84" name="__codelineno-85-84" href="#tasks-dockercompose-__codelineno-85-84"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*service-base</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-85-85"><a id="__codelineno-85-85" name="__codelineno-85-85" href="#tasks-dockercompose-__codelineno-85-85"></a><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-85-86"><a id="__codelineno-85-86" name="__codelineno-85-86" href="#tasks-dockercompose-__codelineno-85-86"></a><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-85-87"><a id="__codelineno-85-87" name="__codelineno-85-87" href="#tasks-dockercompose-__codelineno-85-87"></a><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1G</span>
</span><span id="__span-85-88"><a id="__codelineno-85-88" name="__codelineno-85-88" href="#tasks-dockercompose-__codelineno-85-88"></a><span class="w">        </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;2.0&#39;</span>
</span><span id="__span-85-89"><a id="__codelineno-85-89" name="__codelineno-85-89" href="#tasks-dockercompose-__codelineno-85-89"></a>
</span><span id="__span-85-90"><a id="__codelineno-85-90" name="__codelineno-85-90" href="#tasks-dockercompose-__codelineno-85-90"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-85-91"><a id="__codelineno-85-91" name="__codelineno-85-91" href="#tasks-dockercompose-__codelineno-85-91"></a><span class="w">  </span><span class="c1"># Web services</span>
</span><span id="__span-85-92"><a id="__codelineno-85-92" name="__codelineno-85-92" href="#tasks-dockercompose-__codelineno-85-92"></a><span class="w">  </span><span class="nt">web-frontend</span><span class="p">:</span>
</span><span id="__span-85-93"><a id="__codelineno-85-93" name="__codelineno-85-93" href="#tasks-dockercompose-__codelineno-85-93"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span>
</span><span id="__span-85-94"><a id="__codelineno-85-94" name="__codelineno-85-94" href="#tasks-dockercompose-__codelineno-85-94"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-85-95"><a id="__codelineno-85-95" name="__codelineno-85-95" href="#tasks-dockercompose-__codelineno-85-95"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:80&quot;</span>
</span><span id="__span-85-96"><a id="__codelineno-85-96" name="__codelineno-85-96" href="#tasks-dockercompose-__codelineno-85-96"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-85-97"><a id="__codelineno-85-97" name="__codelineno-85-97" href="#tasks-dockercompose-__codelineno-85-97"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web/frontend:/usr/share/nginx/html:ro</span>
</span><span id="__span-85-98"><a id="__codelineno-85-98" name="__codelineno-85-98" href="#tasks-dockercompose-__codelineno-85-98"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-99"><a id="__codelineno-85-99" name="__codelineno-85-99" href="#tasks-dockercompose-__codelineno-85-99"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-100"><a id="__codelineno-85-100" name="__codelineno-85-100" href="#tasks-dockercompose-__codelineno-85-100"></a><span class="w">      </span><span class="nt">SECTION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-85-101"><a id="__codelineno-85-101" name="__codelineno-85-101" href="#tasks-dockercompose-__codelineno-85-101"></a>
</span><span id="__span-85-102"><a id="__codelineno-85-102" name="__codelineno-85-102" href="#tasks-dockercompose-__codelineno-85-102"></a><span class="w">  </span><span class="nt">web-admin</span><span class="p">:</span>
</span><span id="__span-85-103"><a id="__codelineno-85-103" name="__codelineno-85-103" href="#tasks-dockercompose-__codelineno-85-103"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span>
</span><span id="__span-85-104"><a id="__codelineno-85-104" name="__codelineno-85-104" href="#tasks-dockercompose-__codelineno-85-104"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-85-105"><a id="__codelineno-85-105" name="__codelineno-85-105" href="#tasks-dockercompose-__codelineno-85-105"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8081:80&quot;</span>
</span><span id="__span-85-106"><a id="__codelineno-85-106" name="__codelineno-85-106" href="#tasks-dockercompose-__codelineno-85-106"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-85-107"><a id="__codelineno-85-107" name="__codelineno-85-107" href="#tasks-dockercompose-__codelineno-85-107"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web/admin:/usr/share/nginx/html:ro</span>
</span><span id="__span-85-108"><a id="__codelineno-85-108" name="__codelineno-85-108" href="#tasks-dockercompose-__codelineno-85-108"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-109"><a id="__codelineno-85-109" name="__codelineno-85-109" href="#tasks-dockercompose-__codelineno-85-109"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-110"><a id="__codelineno-85-110" name="__codelineno-85-110" href="#tasks-dockercompose-__codelineno-85-110"></a><span class="w">      </span><span class="nt">SECTION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span>
</span><span id="__span-85-111"><a id="__codelineno-85-111" name="__codelineno-85-111" href="#tasks-dockercompose-__codelineno-85-111"></a>
</span><span id="__span-85-112"><a id="__codelineno-85-112" name="__codelineno-85-112" href="#tasks-dockercompose-__codelineno-85-112"></a><span class="w">  </span><span class="nt">web-api-docs</span><span class="p">:</span>
</span><span id="__span-85-113"><a id="__codelineno-85-113" name="__codelineno-85-113" href="#tasks-dockercompose-__codelineno-85-113"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span>
</span><span id="__span-85-114"><a id="__codelineno-85-114" name="__codelineno-85-114" href="#tasks-dockercompose-__codelineno-85-114"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-85-115"><a id="__codelineno-85-115" name="__codelineno-85-115" href="#tasks-dockercompose-__codelineno-85-115"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8082:80&quot;</span>
</span><span id="__span-85-116"><a id="__codelineno-85-116" name="__codelineno-85-116" href="#tasks-dockercompose-__codelineno-85-116"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-85-117"><a id="__codelineno-85-117" name="__codelineno-85-117" href="#tasks-dockercompose-__codelineno-85-117"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./web/docs:/usr/share/nginx/html:ro</span>
</span><span id="__span-85-118"><a id="__codelineno-85-118" name="__codelineno-85-118" href="#tasks-dockercompose-__codelineno-85-118"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-119"><a id="__codelineno-85-119" name="__codelineno-85-119" href="#tasks-dockercompose-__codelineno-85-119"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-120"><a id="__codelineno-85-120" name="__codelineno-85-120" href="#tasks-dockercompose-__codelineno-85-120"></a><span class="w">      </span><span class="nt">SECTION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">api-docs</span>
</span><span id="__span-85-121"><a id="__codelineno-85-121" name="__codelineno-85-121" href="#tasks-dockercompose-__codelineno-85-121"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-85-122"><a id="__codelineno-85-122" name="__codelineno-85-122" href="#tasks-dockercompose-__codelineno-85-122"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*web-template</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-85-123"><a id="__codelineno-85-123" name="__codelineno-85-123" href="#tasks-dockercompose-__codelineno-85-123"></a><span class="w">      </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-85-124"><a id="__codelineno-85-124" name="__codelineno-85-124" href="#tasks-dockercompose-__codelineno-85-124"></a><span class="w">        </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-85-125"><a id="__codelineno-85-125" name="__codelineno-85-125" href="#tasks-dockercompose-__codelineno-85-125"></a><span class="w">          </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128M</span>
</span><span id="__span-85-126"><a id="__codelineno-85-126" name="__codelineno-85-126" href="#tasks-dockercompose-__codelineno-85-126"></a><span class="w">          </span><span class="nt">cpus</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.25&#39;</span>
</span><span id="__span-85-127"><a id="__codelineno-85-127" name="__codelineno-85-127" href="#tasks-dockercompose-__codelineno-85-127"></a>
</span><span id="__span-85-128"><a id="__codelineno-85-128" name="__codelineno-85-128" href="#tasks-dockercompose-__codelineno-85-128"></a><span class="w">  </span><span class="c1"># API services</span>
</span><span id="__span-85-129"><a id="__codelineno-85-129" name="__codelineno-85-129" href="#tasks-dockercompose-__codelineno-85-129"></a><span class="w">  </span><span class="nt">api-users</span><span class="p">:</span>
</span><span id="__span-85-130"><a id="__codelineno-85-130" name="__codelineno-85-130" href="#tasks-dockercompose-__codelineno-85-130"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-template</span>
</span><span id="__span-85-131"><a id="__codelineno-85-131" name="__codelineno-85-131" href="#tasks-dockercompose-__codelineno-85-131"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-85-132"><a id="__codelineno-85-132" name="__codelineno-85-132" href="#tasks-dockercompose-__codelineno-85-132"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3000:3000&quot;</span>
</span><span id="__span-85-133"><a id="__codelineno-85-133" name="__codelineno-85-133" href="#tasks-dockercompose-__codelineno-85-133"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-134"><a id="__codelineno-85-134" name="__codelineno-85-134" href="#tasks-dockercompose-__codelineno-85-134"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-135"><a id="__codelineno-85-135" name="__codelineno-85-135" href="#tasks-dockercompose-__codelineno-85-135"></a><span class="w">      </span><span class="nt">MODULE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">users</span>
</span><span id="__span-85-136"><a id="__codelineno-85-136" name="__codelineno-85-136" href="#tasks-dockercompose-__codelineno-85-136"></a><span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id="__span-85-137"><a id="__codelineno-85-137" name="__codelineno-85-137" href="#tasks-dockercompose-__codelineno-85-137"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-85-138"><a id="__codelineno-85-138" name="__codelineno-85-138" href="#tasks-dockercompose-__codelineno-85-138"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-85-139"><a id="__codelineno-85-139" name="__codelineno-85-139" href="#tasks-dockercompose-__codelineno-85-139"></a>
</span><span id="__span-85-140"><a id="__codelineno-85-140" name="__codelineno-85-140" href="#tasks-dockercompose-__codelineno-85-140"></a><span class="w">  </span><span class="nt">api-products</span><span class="p">:</span>
</span><span id="__span-85-141"><a id="__codelineno-85-141" name="__codelineno-85-141" href="#tasks-dockercompose-__codelineno-85-141"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-template</span>
</span><span id="__span-85-142"><a id="__codelineno-85-142" name="__codelineno-85-142" href="#tasks-dockercompose-__codelineno-85-142"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-85-143"><a id="__codelineno-85-143" name="__codelineno-85-143" href="#tasks-dockercompose-__codelineno-85-143"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;3001:3000&quot;</span>
</span><span id="__span-85-144"><a id="__codelineno-85-144" name="__codelineno-85-144" href="#tasks-dockercompose-__codelineno-85-144"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-145"><a id="__codelineno-85-145" name="__codelineno-85-145" href="#tasks-dockercompose-__codelineno-85-145"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*api-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-146"><a id="__codelineno-85-146" name="__codelineno-85-146" href="#tasks-dockercompose-__codelineno-85-146"></a><span class="w">      </span><span class="nt">MODULE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">products</span>
</span><span id="__span-85-147"><a id="__codelineno-85-147" name="__codelineno-85-147" href="#tasks-dockercompose-__codelineno-85-147"></a><span class="w">      </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://db:5432/myapp</span>
</span><span id="__span-85-148"><a id="__codelineno-85-148" name="__codelineno-85-148" href="#tasks-dockercompose-__codelineno-85-148"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-85-149"><a id="__codelineno-85-149" name="__codelineno-85-149" href="#tasks-dockercompose-__codelineno-85-149"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
</span><span id="__span-85-150"><a id="__codelineno-85-150" name="__codelineno-85-150" href="#tasks-dockercompose-__codelineno-85-150"></a>
</span><span id="__span-85-151"><a id="__codelineno-85-151" name="__codelineno-85-151" href="#tasks-dockercompose-__codelineno-85-151"></a><span class="w">  </span><span class="c1"># Worker services</span>
</span><span id="__span-85-152"><a id="__codelineno-85-152" name="__codelineno-85-152" href="#tasks-dockercompose-__codelineno-85-152"></a><span class="w">  </span><span class="nt">worker-email</span><span class="p">:</span>
</span><span id="__span-85-153"><a id="__codelineno-85-153" name="__codelineno-85-153" href="#tasks-dockercompose-__codelineno-85-153"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*worker-template</span>
</span><span id="__span-85-154"><a id="__codelineno-85-154" name="__codelineno-85-154" href="#tasks-dockercompose-__codelineno-85-154"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-155"><a id="__codelineno-85-155" name="__codelineno-85-155" href="#tasks-dockercompose-__codelineno-85-155"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*worker-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-156"><a id="__codelineno-85-156" name="__codelineno-85-156" href="#tasks-dockercompose-__codelineno-85-156"></a><span class="w">      </span><span class="nt">WORKER_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email</span>
</span><span id="__span-85-157"><a id="__codelineno-85-157" name="__codelineno-85-157" href="#tasks-dockercompose-__codelineno-85-157"></a><span class="w">      </span><span class="nt">QUEUE_NAME</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">email_queue</span>
</span><span id="__span-85-158"><a id="__codelineno-85-158" name="__codelineno-85-158" href="#tasks-dockercompose-__codelineno-85-158"></a><span class="w">    </span><span class="nt">deploy</span><span class="p">:</span>
</span><span id="__span-85-159"><a id="__codelineno-85-159" name="__codelineno-85-159" href="#tasks-dockercompose-__codelineno-85-159"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*worker-template</span><span class="l l-Scalar l-Scalar-Plain">.deploy</span>
</span><span id="__span-85-160"><a id="__codelineno-85-160" name="__codelineno-85-160" href="#tasks-dockercompose-__codelineno-85-160"></a><span class="w">      </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-85-161"><a id="__codelineno-85-161" name="__codelineno-85-161" href="#tasks-dockercompose-__codelineno-85-161"></a>
</span><span id="__span-85-162"><a id="__codelineno-85-162" name="__codelineno-85-162" href="#tasks-dockercompose-__codelineno-85-162"></a><span class="w">  </span><span class="nt">worker-reports</span><span class="p">:</span>
</span><span id="__span-85-163"><a id="__codelineno-85-163" name="__codelineno-85-163" href="#tasks-dockercompose-__codelineno-85-163"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*worker-template</span>
</span><span id="__span-85-164"><a id="__codelineno-85-164" name="__codelineno-85-164" href="#tasks-dockercompose-__codelineno-85-164"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-165"><a id="__codelineno-85-165" name="__codelineno-85-165" href="#tasks-dockercompose-__codelineno-85-165"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*worker-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-166"><a id="__codelineno-85-166" name="__codelineno-85-166" href="#tasks-dockercompose-__codelineno-85-166"></a><span class="w">      </span><span class="nt">WORKER_TYPE</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">reports</span>
</span><span id="__span-85-167"><a id="__codelineno-85-167" name="__codelineno-85-167" href="#tasks-dockercompose-__codelineno-85-167"></a><span class="w">      </span><span class="nt">SCHEDULE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0</span><span class="nv"> </span><span class="s">*/6</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span>
</span><span id="__span-85-168"><a id="__codelineno-85-168" name="__codelineno-85-168" href="#tasks-dockercompose-__codelineno-85-168"></a>
</span><span id="__span-85-169"><a id="__codelineno-85-169" name="__codelineno-85-169" href="#tasks-dockercompose-__codelineno-85-169"></a><span class="w">  </span><span class="c1"># Database</span>
</span><span id="__span-85-170"><a id="__codelineno-85-170" name="__codelineno-85-170" href="#tasks-dockercompose-__codelineno-85-170"></a><span class="w">  </span><span class="nt">db</span><span class="p">:</span>
</span><span id="__span-85-171"><a id="__codelineno-85-171" name="__codelineno-85-171" href="#tasks-dockercompose-__codelineno-85-171"></a><span class="w">    </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*database-template</span>
</span><span id="__span-85-172"><a id="__codelineno-85-172" name="__codelineno-85-172" href="#tasks-dockercompose-__codelineno-85-172"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-85-173"><a id="__codelineno-85-173" name="__codelineno-85-173" href="#tasks-dockercompose-__codelineno-85-173"></a><span class="w">      </span><span class="nt">&lt;&lt;</span><span class="p">:</span><span class="w"> </span><span class="nv">*database-template</span><span class="l l-Scalar l-Scalar-Plain">.environment</span>
</span><span id="__span-85-174"><a id="__codelineno-85-174" name="__codelineno-85-174" href="#tasks-dockercompose-__codelineno-85-174"></a><span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-85-175"><a id="__codelineno-85-175" name="__codelineno-85-175" href="#tasks-dockercompose-__codelineno-85-175"></a><span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">user</span>
</span><span id="__span-85-176"><a id="__codelineno-85-176" name="__codelineno-85-176" href="#tasks-dockercompose-__codelineno-85-176"></a><span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">password</span>
</span><span id="__span-85-177"><a id="__codelineno-85-177" name="__codelineno-85-177" href="#tasks-dockercompose-__codelineno-85-177"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-85-178"><a id="__codelineno-85-178" name="__codelineno-85-178" href="#tasks-dockercompose-__codelineno-85-178"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">db_data:/var/lib/postgresql/data</span>
</span><span id="__span-85-179"><a id="__codelineno-85-179" name="__codelineno-85-179" href="#tasks-dockercompose-__codelineno-85-179"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-85-180"><a id="__codelineno-85-180" name="__codelineno-85-180" href="#tasks-dockercompose-__codelineno-85-180"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5432:5432&quot;</span>
</span><span id="__span-85-181"><a id="__codelineno-85-181" name="__codelineno-85-181" href="#tasks-dockercompose-__codelineno-85-181"></a>
</span><span id="__span-85-182"><a id="__codelineno-85-182" name="__codelineno-85-182" href="#tasks-dockercompose-__codelineno-85-182"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-85-183"><a id="__codelineno-85-183" name="__codelineno-85-183" href="#tasks-dockercompose-__codelineno-85-183"></a><span class="w">  </span><span class="nt">db_data</span><span class="p">:</span>
</span></code></pre></div></p>
<p><strong>Commands:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#tasks-dockercompose-__codelineno-86-1"></a><span class="c1"># Start templated services</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#tasks-dockercompose-__codelineno-86-2"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#tasks-dockercompose-__codelineno-86-3"></a>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#tasks-dockercompose-__codelineno-86-4"></a><span class="c1"># Check template instantiation</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#tasks-dockercompose-__codelineno-86-5"></a>docker-compose<span class="w"> </span>ps
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#tasks-dockercompose-__codelineno-86-6"></a>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#tasks-dockercompose-__codelineno-86-7"></a><span class="c1"># View service configurations</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#tasks-dockercompose-__codelineno-86-8"></a>docker-compose<span class="w"> </span>config<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-A<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="s2">&quot;web-frontend:&quot;</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#tasks-dockercompose-__codelineno-86-9"></a>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#tasks-dockercompose-__codelineno-86-10"></a><span class="c1"># Test different service types</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#tasks-dockercompose-__codelineno-86-11"></a>curl<span class="w"> </span>http://localhost:8080
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#tasks-dockercompose-__codelineno-86-12"></a>curl<span class="w"> </span>http://localhost:8081
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#tasks-dockercompose-__codelineno-86-13"></a>docker-compose<span class="w"> </span>logs<span class="w"> </span>api-users
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#tasks-dockercompose-__codelineno-86-14"></a>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#tasks-dockercompose-__codelineno-86-15"></a><span class="c1"># Scale templated services</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#tasks-dockercompose-__codelineno-86-16"></a>docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>--scale<span class="w"> </span>worker-email<span class="o">=</span><span class="m">3</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#tasks-dockercompose-__codelineno-86-17"></a>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#tasks-dockercompose-__codelineno-86-18"></a><span class="c1"># Stop services</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#tasks-dockercompose-__codelineno-86-19"></a>docker-compose<span class="w"> </span>down
</span></code></pre></div></p>
<p><strong>Explanation:</strong></p>
<ul>
<li><strong>Service templates</strong>: Reusable patterns for common service types</li>
<li><strong>Template instantiation</strong>: Create multiple services from the same template</li>
<li><strong>Customization</strong>: Override template defaults for specific instances</li>
<li><strong>Consistency</strong>: Ensure similar services follow the same patterns</li>
<li><strong>Maintainability</strong>: Changes to templates affect all instances</li>
<li><strong>Scalability</strong>: Easy to add new services following established patterns</li>
</ul>
</details></section></section></div><style>.print-site-enumerate-headings #section-1 > h1:before { content: '1 ' }
.print-site-enumerate-headings #index > h1:before { content: '1.1 ' }

                .print-site-enumerate-headings #index h2:before { content: '1.1.' counter(counter-index-2) ' ' }
                .print-site-enumerate-headings #index h2 {  counter-increment: counter-index-2 }
            
.print-site-enumerate-headings #001-dockercli > h1:before { content: '1.2 ' }

                .print-site-enumerate-headings #001-dockercli h2:before { content: '1.2.' counter(counter-001-dockercli-2) ' ' }
                .print-site-enumerate-headings #001-dockercli h2 {  counter-increment: counter-001-dockercli-2 }
            
.print-site-enumerate-headings #002-dockerfile > h1:before { content: '1.3 ' }

                .print-site-enumerate-headings #002-dockerfile h2:before { content: '1.3.' counter(counter-002-dockerfile-2) ' ' }
                .print-site-enumerate-headings #002-dockerfile h2 {  counter-increment: counter-002-dockerfile-2 }
            
.print-site-enumerate-headings #003-dockerfile-multistage > h1:before { content: '1.4 ' }

                .print-site-enumerate-headings #003-dockerfile-multistage h2:before { content: '1.4.' counter(counter-003-dockerfile-multistage-2) ' ' }
                .print-site-enumerate-headings #003-dockerfile-multistage h2 {  counter-increment: counter-003-dockerfile-multistage-2 }
            
.print-site-enumerate-headings #004-localregistry > h1:before { content: '1.5 ' }

                .print-site-enumerate-headings #004-localregistry h2:before { content: '1.5.' counter(counter-004-localregistry-2) ' ' }
                .print-site-enumerate-headings #004-localregistry h2 {  counter-increment: counter-004-localregistry-2 }
            
.print-site-enumerate-headings #005-dockercompose-basics > h1:before { content: '1.6 ' }

                .print-site-enumerate-headings #005-dockercompose-basics h2:before { content: '1.6.' counter(counter-005-dockercompose-basics-2) ' ' }
                .print-site-enumerate-headings #005-dockercompose-basics h2 {  counter-increment: counter-005-dockercompose-basics-2 }
            
.print-site-enumerate-headings #006-dockercompose-env > h1:before { content: '1.7 ' }

                .print-site-enumerate-headings #006-dockercompose-env h2:before { content: '1.7.' counter(counter-006-dockercompose-env-2) ' ' }
                .print-site-enumerate-headings #006-dockercompose-env h2 {  counter-increment: counter-006-dockercompose-env-2 }
            
.print-site-enumerate-headings #007-dockercompose-fragments > h1:before { content: '1.8 ' }

                .print-site-enumerate-headings #007-dockercompose-fragments h2:before { content: '1.8.' counter(counter-007-dockercompose-fragments-2) ' ' }
                .print-site-enumerate-headings #007-dockercompose-fragments h2 {  counter-increment: counter-007-dockercompose-fragments-2 }
            
.print-site-enumerate-headings #008-crictl > h1:before { content: '1.9 ' }

                .print-site-enumerate-headings #008-crictl h2:before { content: '1.9.' counter(counter-008-crictl-2) ' ' }
                .print-site-enumerate-headings #008-crictl h2 {  counter-increment: counter-008-crictl-2 }
            
.print-site-enumerate-headings #009-dive-layers > h1:before { content: '1.10 ' }

                .print-site-enumerate-headings #009-dive-layers h2:before { content: '1.10.' counter(counter-009-dive-layers-2) ' ' }
                .print-site-enumerate-headings #009-dive-layers h2 {  counter-increment: counter-009-dive-layers-2 }
            
.print-site-enumerate-headings #010-bake > h1:before { content: '1.11 ' }

                .print-site-enumerate-headings #010-bake h2:before { content: '1.11.' counter(counter-010-bake-2) ' ' }
                .print-site-enumerate-headings #010-bake h2 {  counter-increment: counter-010-bake-2 }
            
.print-site-enumerate-headings #011-security%26trust > h1:before { content: '1.12 ' }

                .print-site-enumerate-headings #011-security%26trust h2:before { content: '1.12.' counter(counter-011-security%26trust-2) ' ' }
                .print-site-enumerate-headings #011-security%26trust h2 {  counter-increment: counter-011-security%26trust-2 }
            
.print-site-enumerate-headings #012-gvisor > h1:before { content: '1.13 ' }

                .print-site-enumerate-headings #012-gvisor h2:before { content: '1.13.' counter(counter-012-gvisor-2) ' ' }
                .print-site-enumerate-headings #012-gvisor h2 {  counter-increment: counter-012-gvisor-2 }
            
.print-site-enumerate-headings #013-cgroup > h1:before { content: '1.14 ' }

                .print-site-enumerate-headings #013-cgroup h2:before { content: '1.14.' counter(counter-013-cgroup-2) ' ' }
                .print-site-enumerate-headings #013-cgroup h2 {  counter-increment: counter-013-cgroup-2 }
            
.print-site-enumerate-headings #014-dockerdaemon > h1:before { content: '1.15 ' }

                .print-site-enumerate-headings #014-dockerdaemon h2:before { content: '1.15.' counter(counter-014-dockerdaemon-2) ' ' }
                .print-site-enumerate-headings #014-dockerdaemon h2 {  counter-increment: counter-014-dockerdaemon-2 }
            
.print-site-enumerate-headings #015-networking > h1:before { content: '1.16 ' }

                .print-site-enumerate-headings #015-networking h2:before { content: '1.16.' counter(counter-015-networking-2) ' ' }
                .print-site-enumerate-headings #015-networking h2 {  counter-increment: counter-015-networking-2 }
            
.print-site-enumerate-headings #016-advanced-build > h1:before { content: '1.17 ' }

                .print-site-enumerate-headings #016-advanced-build h2:before { content: '1.17.' counter(counter-016-advanced-build-2) ' ' }
                .print-site-enumerate-headings #016-advanced-build h2 {  counter-increment: counter-016-advanced-build-2 }
            
.print-site-enumerate-headings #017-logging > h1:before { content: '1.18 ' }

                .print-site-enumerate-headings #017-logging h2:before { content: '1.18.' counter(counter-017-logging-2) ' ' }
                .print-site-enumerate-headings #017-logging h2 {  counter-increment: counter-017-logging-2 }
            
.print-site-enumerate-headings #100-hands-on > h1:before { content: '1.19 ' }

                .print-site-enumerate-headings #100-hands-on h2:before { content: '1.19.' counter(counter-100-hands-on-2) ' ' }
                .print-site-enumerate-headings #100-hands-on h2 {  counter-increment: counter-100-hands-on-2 }
            
.print-site-enumerate-headings #section-2 > h1:before { content: '2 ' }
.print-site-enumerate-headings #tasks > h1:before { content: '2.1 ' }

                .print-site-enumerate-headings #tasks h2:before { content: '2.1.' counter(counter-tasks-2) ' ' }
                .print-site-enumerate-headings #tasks h2 {  counter-increment: counter-tasks-2 }
            
.print-site-enumerate-headings #tasks-dockerbasics > h1:before { content: '2.2 ' }

                .print-site-enumerate-headings #tasks-dockerbasics h2:before { content: '2.2.' counter(counter-tasks-dockerbasics-2) ' ' }
                .print-site-enumerate-headings #tasks-dockerbasics h2 {  counter-increment: counter-tasks-dockerbasics-2 }
            
.print-site-enumerate-headings #tasks-docker-cli-tasks > h1:before { content: '2.3 ' }

                .print-site-enumerate-headings #tasks-docker-cli-tasks h2:before { content: '2.3.' counter(counter-tasks-docker-cli-tasks-2) ' ' }
                .print-site-enumerate-headings #tasks-docker-cli-tasks h2 {  counter-increment: counter-tasks-docker-cli-tasks-2 }
            
.print-site-enumerate-headings #tasks-dockerfile > h1:before { content: '2.4 ' }

                .print-site-enumerate-headings #tasks-dockerfile h2:before { content: '2.4.' counter(counter-tasks-dockerfile-2) ' ' }
                .print-site-enumerate-headings #tasks-dockerfile h2 {  counter-increment: counter-tasks-dockerfile-2 }
            
.print-site-enumerate-headings #tasks-dockercompose > h1:before { content: '2.5 ' }

                .print-site-enumerate-headings #tasks-dockercompose h2:before { content: '2.5.' counter(counter-tasks-dockercompose-2) ' ' }
                .print-site-enumerate-headings #tasks-dockercompose h2 {  counter-increment: counter-tasks-dockercompose-2 }
            </style>
<!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Render date of last update -->


<!-- Render date of creation -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render authors -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render committers from GitHub -->


<!-- Render committers from GitLab -->


<!-- Render committers -->


<!-- ---------------------------------------------------------------------- -->

<!-- Determine date of last update -->


<!-- Source file information -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Footer -->
<footer class="md-footer">
  <div class="logo1"></div>
  <div class="logo2"></div>

  <!-- Link to previous and/or next page -->
  
    
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ¬©2021-2025 Nir Geier<br/><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target="_blank" rel="noopener"><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a>
    </div>
  
  
</div>

      <!-- Social links -->
      
        
<div class="md-social">
    
    
    
    
    
    <a href="https://github.com/nirgeier/DockerLabs" target="_blank" rel="noopener" title="View on GitHub"
        class="md-social__link social-class__github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/DockerLabs/network/members" target="_blank" rel="noopener" title="Fork this repo"
        class="md-social__link social-class__fork">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/DockerLabs/stargazers" target="_blank" rel="noopener" title="Star this repo"
        class="md-social__link social-class__star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener" title="Connect on LinkedIn"
        class="md-social__link social-class__linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://discord.gg/U6xW23Ss" target="_blank" rel="noopener" title="Follow me on Discord"
        class="md-social__link social-class__discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://stackoverflow.com/users/1755598/codewizard" target="_blank" rel="noopener" title="Follow me on Stack Overflow"
        class="md-social__link social-class__stackoverflow">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://wa.me/972548122310" target="_blank" rel="noopener" title="Follow me on WhatsApp"
        class="md-social__link social-class__whatsapp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg>
    </a>
    
    
    
    
    
    <a href="mailto:nirg@codewizard.co.il" target="_blank" rel="noopener" title="Email me"
        class="md-social__link social-class__email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg>
    </a>
    
</div>
      
    </div>
  </div>
</footer>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "/DockerLabs/", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "content.footer.last-updated", "content.footer.contributors", {"navigation.expand": false}, "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", {"navigation.top": true}, "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate", "toc.sticky"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="https://buttons.github.io/buttons.js"></script>
      
    
  </body>
</html>